function xE(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function yE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function wE(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var Fm={exports:{}},pl={},_m={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dv;function vE(){if(dv)return Ke;dv=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function m(L){return L===null||typeof L!="object"?null:(L=f&&L[f]||L["@@iterator"],typeof L=="function"?L:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,w={};function v(L,W,ie){this.props=L,this.context=W,this.refs=w,this.updater=ie||g}v.prototype.isReactComponent={},v.prototype.setState=function(L,W){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,W,"setState")},v.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function b(){}b.prototype=v.prototype;function C(L,W,ie){this.props=L,this.context=W,this.refs=w,this.updater=ie||g}var S=C.prototype=new b;S.constructor=C,y(S,v.prototype),S.isPureReactComponent=!0;var $=Array.isArray,N=Object.prototype.hasOwnProperty,R={current:null},O={key:!0,ref:!0,__self:!0,__source:!0};function F(L,W,ie){var ce,he={},fe=null,we=null;if(W!=null)for(ce in W.ref!==void 0&&(we=W.ref),W.key!==void 0&&(fe=""+W.key),W)N.call(W,ce)&&!O.hasOwnProperty(ce)&&(he[ce]=W[ce]);var ve=arguments.length-2;if(ve===1)he.children=ie;else if(1<ve){for(var be=Array(ve),Fe=0;Fe<ve;Fe++)be[Fe]=arguments[Fe+2];he.children=be}if(L&&L.defaultProps)for(ce in ve=L.defaultProps,ve)he[ce]===void 0&&(he[ce]=ve[ce]);return{$$typeof:n,type:L,key:fe,ref:we,props:he,_owner:R.current}}function A(L,W){return{$$typeof:n,type:L.type,key:W,ref:L.ref,props:L.props,_owner:L._owner}}function D(L){return typeof L=="object"&&L!==null&&L.$$typeof===n}function T(L){var W={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(ie){return W[ie]})}var z=/\/+/g;function U(L,W){return typeof L=="object"&&L!==null&&L.key!=null?T(""+L.key):W.toString(36)}function Q(L,W,ie,ce,he){var fe=typeof L;(fe==="undefined"||fe==="boolean")&&(L=null);var we=!1;if(L===null)we=!0;else switch(fe){case"string":case"number":we=!0;break;case"object":switch(L.$$typeof){case n:case e:we=!0}}if(we)return we=L,he=he(we),L=ce===""?"."+U(we,0):ce,$(he)?(ie="",L!=null&&(ie=L.replace(z,"$&/")+"/"),Q(he,W,ie,"",function(Fe){return Fe})):he!=null&&(D(he)&&(he=A(he,ie+(!he.key||we&&we.key===he.key?"":(""+he.key).replace(z,"$&/")+"/")+L)),W.push(he)),1;if(we=0,ce=ce===""?".":ce+":",$(L))for(var ve=0;ve<L.length;ve++){fe=L[ve];var be=ce+U(fe,ve);we+=Q(fe,W,ie,be,he)}else if(be=m(L),typeof be=="function")for(L=be.call(L),ve=0;!(fe=L.next()).done;)fe=fe.value,be=ce+U(fe,ve++),we+=Q(fe,W,ie,be,he);else if(fe==="object")throw W=String(L),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.");return we}function q(L,W,ie){if(L==null)return L;var ce=[],he=0;return Q(L,ce,"","",function(fe){return W.call(ie,fe,he++)}),ce}function J(L){if(L._status===-1){var W=L._result;W=W(),W.then(function(ie){(L._status===0||L._status===-1)&&(L._status=1,L._result=ie)},function(ie){(L._status===0||L._status===-1)&&(L._status=2,L._result=ie)}),L._status===-1&&(L._status=0,L._result=W)}if(L._status===1)return L._result.default;throw L._result}var ne={current:null},B={transition:null},X={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:B,ReactCurrentOwner:R};function Y(){throw Error("act(...) is not supported in production builds of React.")}return Ke.Children={map:q,forEach:function(L,W,ie){q(L,function(){W.apply(this,arguments)},ie)},count:function(L){var W=0;return q(L,function(){W++}),W},toArray:function(L){return q(L,function(W){return W})||[]},only:function(L){if(!D(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},Ke.Component=v,Ke.Fragment=t,Ke.Profiler=r,Ke.PureComponent=C,Ke.StrictMode=s,Ke.Suspense=u,Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,Ke.act=Y,Ke.cloneElement=function(L,W,ie){if(L==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+L+".");var ce=y({},L.props),he=L.key,fe=L.ref,we=L._owner;if(W!=null){if(W.ref!==void 0&&(fe=W.ref,we=R.current),W.key!==void 0&&(he=""+W.key),L.type&&L.type.defaultProps)var ve=L.type.defaultProps;for(be in W)N.call(W,be)&&!O.hasOwnProperty(be)&&(ce[be]=W[be]===void 0&&ve!==void 0?ve[be]:W[be])}var be=arguments.length-2;if(be===1)ce.children=ie;else if(1<be){ve=Array(be);for(var Fe=0;Fe<be;Fe++)ve[Fe]=arguments[Fe+2];ce.children=ve}return{$$typeof:n,type:L.type,key:he,ref:fe,props:ce,_owner:we}},Ke.createContext=function(L){return L={$$typeof:i,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},L.Provider={$$typeof:o,_context:L},L.Consumer=L},Ke.createElement=F,Ke.createFactory=function(L){var W=F.bind(null,L);return W.type=L,W},Ke.createRef=function(){return{current:null}},Ke.forwardRef=function(L){return{$$typeof:l,render:L}},Ke.isValidElement=D,Ke.lazy=function(L){return{$$typeof:d,_payload:{_status:-1,_result:L},_init:J}},Ke.memo=function(L,W){return{$$typeof:h,type:L,compare:W===void 0?null:W}},Ke.startTransition=function(L){var W=B.transition;B.transition={};try{L()}finally{B.transition=W}},Ke.unstable_act=Y,Ke.useCallback=function(L,W){return ne.current.useCallback(L,W)},Ke.useContext=function(L){return ne.current.useContext(L)},Ke.useDebugValue=function(){},Ke.useDeferredValue=function(L){return ne.current.useDeferredValue(L)},Ke.useEffect=function(L,W){return ne.current.useEffect(L,W)},Ke.useId=function(){return ne.current.useId()},Ke.useImperativeHandle=function(L,W,ie){return ne.current.useImperativeHandle(L,W,ie)},Ke.useInsertionEffect=function(L,W){return ne.current.useInsertionEffect(L,W)},Ke.useLayoutEffect=function(L,W){return ne.current.useLayoutEffect(L,W)},Ke.useMemo=function(L,W){return ne.current.useMemo(L,W)},Ke.useReducer=function(L,W,ie){return ne.current.useReducer(L,W,ie)},Ke.useRef=function(L){return ne.current.useRef(L)},Ke.useState=function(L){return ne.current.useState(L)},Ke.useSyncExternalStore=function(L,W,ie){return ne.current.useSyncExternalStore(L,W,ie)},Ke.useTransition=function(){return ne.current.useTransition()},Ke.version="18.3.1",Ke}var fv;function Wg(){return fv||(fv=1,_m.exports=vE()),_m.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pv;function bE(){if(pv)return pl;pv=1;var n=Wg(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(l,u,h){var d,f={},m=null,g=null;h!==void 0&&(m=""+h),u.key!==void 0&&(m=""+u.key),u.ref!==void 0&&(g=u.ref);for(d in u)s.call(u,d)&&!o.hasOwnProperty(d)&&(f[d]=u[d]);if(l&&l.defaultProps)for(d in u=l.defaultProps,u)f[d]===void 0&&(f[d]=u[d]);return{$$typeof:e,type:l,key:m,ref:g,props:f,_owner:r.current}}return pl.Fragment=t,pl.jsx=i,pl.jsxs=i,pl}var mv;function kE(){return mv||(mv=1,Fm.exports=bE()),Fm.exports}var kn=kE(),Nr=Wg(),hh={},Om={exports:{}},Hn={},Lm={exports:{}},Pm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gv;function CE(){return gv||(gv=1,function(n){function e(B,X){var Y=B.length;B.push(X);e:for(;0<Y;){var L=Y-1>>>1,W=B[L];if(0<r(W,X))B[L]=X,B[Y]=W,Y=L;else break e}}function t(B){return B.length===0?null:B[0]}function s(B){if(B.length===0)return null;var X=B[0],Y=B.pop();if(Y!==X){B[0]=Y;e:for(var L=0,W=B.length,ie=W>>>1;L<ie;){var ce=2*(L+1)-1,he=B[ce],fe=ce+1,we=B[fe];if(0>r(he,Y))fe<W&&0>r(we,he)?(B[L]=we,B[fe]=Y,L=fe):(B[L]=he,B[ce]=Y,L=ce);else if(fe<W&&0>r(we,Y))B[L]=we,B[fe]=Y,L=fe;else break e}}return X}function r(B,X){var Y=B.sortIndex-X.sortIndex;return Y!==0?Y:B.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();n.unstable_now=function(){return i.now()-l}}var u=[],h=[],d=1,f=null,m=3,g=!1,y=!1,w=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(B){for(var X=t(h);X!==null;){if(X.callback===null)s(h);else if(X.startTime<=B)s(h),X.sortIndex=X.expirationTime,e(u,X);else break;X=t(h)}}function $(B){if(w=!1,S(B),!y)if(t(u)!==null)y=!0,J(N);else{var X=t(h);X!==null&&ne($,X.startTime-B)}}function N(B,X){y=!1,w&&(w=!1,b(F),F=-1),g=!0;var Y=m;try{for(S(X),f=t(u);f!==null&&(!(f.expirationTime>X)||B&&!T());){var L=f.callback;if(typeof L=="function"){f.callback=null,m=f.priorityLevel;var W=L(f.expirationTime<=X);X=n.unstable_now(),typeof W=="function"?f.callback=W:f===t(u)&&s(u),S(X)}else s(u);f=t(u)}if(f!==null)var ie=!0;else{var ce=t(h);ce!==null&&ne($,ce.startTime-X),ie=!1}return ie}finally{f=null,m=Y,g=!1}}var R=!1,O=null,F=-1,A=5,D=-1;function T(){return!(n.unstable_now()-D<A)}function z(){if(O!==null){var B=n.unstable_now();D=B;var X=!0;try{X=O(!0,B)}finally{X?U():(R=!1,O=null)}}else R=!1}var U;if(typeof C=="function")U=function(){C(z)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,q=Q.port2;Q.port1.onmessage=z,U=function(){q.postMessage(null)}}else U=function(){v(z,0)};function J(B){O=B,R||(R=!0,U())}function ne(B,X){F=v(function(){B(n.unstable_now())},X)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(B){B.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,J(N))},n.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<B?Math.floor(1e3/B):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(B){switch(m){case 1:case 2:case 3:var X=3;break;default:X=m}var Y=m;m=X;try{return B()}finally{m=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(B,X){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var Y=m;m=B;try{return X()}finally{m=Y}},n.unstable_scheduleCallback=function(B,X,Y){var L=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?L+Y:L):Y=L,B){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=Y+W,B={id:d++,callback:X,priorityLevel:B,startTime:Y,expirationTime:W,sortIndex:-1},Y>L?(B.sortIndex=Y,e(h,B),t(u)===null&&B===t(h)&&(w?(b(F),F=-1):w=!0,ne($,Y-L))):(B.sortIndex=W,e(u,B),y||g||(y=!0,J(N))),B},n.unstable_shouldYield=T,n.unstable_wrapCallback=function(B){var X=m;return function(){var Y=m;m=X;try{return B.apply(this,arguments)}finally{m=Y}}}}(Pm)),Pm}var xv;function IE(){return xv||(xv=1,Lm.exports=CE()),Lm.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yv;function $E(){if(yv)return Hn;yv=1;var n=Wg(),e=IE();function t(a){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+a,p=1;p<arguments.length;p++)c+="&args[]="+encodeURIComponent(arguments[p]);return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function o(a,c){i(a,c),i(a+"Capture",c)}function i(a,c){for(r[a]=c,a=0;a<c.length;a++)s.add(c[a])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function m(a){return u.call(f,a)?!0:u.call(d,a)?!1:h.test(a)?f[a]=!0:(d[a]=!0,!1)}function g(a,c,p,x){if(p!==null&&p.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return x?!1:p!==null?!p.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function y(a,c,p,x){if(c===null||typeof c>"u"||g(a,c,p,x))return!0;if(x)return!1;if(p!==null)switch(p.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function w(a,c,p,x,k,I,E){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=x,this.attributeNamespace=k,this.mustUseProperty=p,this.propertyName=a,this.type=c,this.sanitizeURL=I,this.removeEmptyString=E}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){v[a]=new w(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var c=a[0];v[c]=new w(c,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){v[a]=new w(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){v[a]=new w(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){v[a]=new w(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){v[a]=new w(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){v[a]=new w(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){v[a]=new w(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){v[a]=new w(a,5,!1,a.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function C(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var c=a.replace(b,C);v[c]=new w(c,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var c=a.replace(b,C);v[c]=new w(c,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var c=a.replace(b,C);v[c]=new w(c,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){v[a]=new w(a,1,!1,a.toLowerCase(),null,!1,!1)}),v.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){v[a]=new w(a,1,!1,a.toLowerCase(),null,!0,!0)});function S(a,c,p,x){var k=v.hasOwnProperty(c)?v[c]:null;(k!==null?k.type!==0:x||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(y(c,p,k,x)&&(p=null),x||k===null?m(c)&&(p===null?a.removeAttribute(c):a.setAttribute(c,""+p)):k.mustUseProperty?a[k.propertyName]=p===null?k.type===3?!1:"":p:(c=k.attributeName,x=k.attributeNamespace,p===null?a.removeAttribute(c):(k=k.type,p=k===3||k===4&&p===!0?"":""+p,x?a.setAttributeNS(x,c,p):a.setAttribute(c,p))))}var $=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,N=Symbol.for("react.element"),R=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),T=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),Q=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ne=Symbol.for("react.offscreen"),B=Symbol.iterator;function X(a){return a===null||typeof a!="object"?null:(a=B&&a[B]||a["@@iterator"],typeof a=="function"?a:null)}var Y=Object.assign,L;function W(a){if(L===void 0)try{throw Error()}catch(p){var c=p.stack.trim().match(/\n( *(at )?)/);L=c&&c[1]||""}return`
`+L+a}var ie=!1;function ce(a,c){if(!a||ie)return"";ie=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(oe){var x=oe}Reflect.construct(a,[],c)}else{try{c.call()}catch(oe){x=oe}a.call(c.prototype)}else{try{throw Error()}catch(oe){x=oe}a()}}catch(oe){if(oe&&x&&typeof oe.stack=="string"){for(var k=oe.stack.split(`
`),I=x.stack.split(`
`),E=k.length-1,P=I.length-1;1<=E&&0<=P&&k[E]!==I[P];)P--;for(;1<=E&&0<=P;E--,P--)if(k[E]!==I[P]){if(E!==1||P!==1)do if(E--,P--,0>P||k[E]!==I[P]){var V=`
`+k[E].replace(" at new "," at ");return a.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",a.displayName)),V}while(1<=E&&0<=P);break}}}finally{ie=!1,Error.prepareStackTrace=p}return(a=a?a.displayName||a.name:"")?W(a):""}function he(a){switch(a.tag){case 5:return W(a.type);case 16:return W("Lazy");case 13:return W("Suspense");case 19:return W("SuspenseList");case 0:case 2:case 15:return a=ce(a.type,!1),a;case 11:return a=ce(a.type.render,!1),a;case 1:return a=ce(a.type,!0),a;default:return""}}function fe(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case O:return"Fragment";case R:return"Portal";case A:return"Profiler";case F:return"StrictMode";case U:return"Suspense";case Q:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case T:return(a.displayName||"Context")+".Consumer";case D:return(a._context.displayName||"Context")+".Provider";case z:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case q:return c=a.displayName||null,c!==null?c:fe(a.type)||"Memo";case J:c=a._payload,a=a._init;try{return fe(a(c))}catch{}}return null}function we(a){var c=a.type;switch(a.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=c.render,a=a.displayName||a.name||"",c.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(c);case 8:return c===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function ve(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function be(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Fe(a){var c=be(a)?"checked":"value",p=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),x=""+a[c];if(!a.hasOwnProperty(c)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var k=p.get,I=p.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return k.call(this)},set:function(E){x=""+E,I.call(this,E)}}),Object.defineProperty(a,c,{enumerable:p.enumerable}),{getValue:function(){return x},setValue:function(E){x=""+E},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function We(a){a._valueTracker||(a._valueTracker=Fe(a))}function Ze(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var p=c.getValue(),x="";return a&&(x=be(a)?a.checked?"true":"false":a.value),a=x,a!==p?(c.setValue(a),!0):!1}function et(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function it(a,c){var p=c.checked;return Y({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:p??a._wrapperState.initialChecked})}function ct(a,c){var p=c.defaultValue==null?"":c.defaultValue,x=c.checked!=null?c.checked:c.defaultChecked;p=ve(c.value!=null?c.value:p),a._wrapperState={initialChecked:x,initialValue:p,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function tt(a,c){c=c.checked,c!=null&&S(a,"checked",c,!1)}function dt(a,c){tt(a,c);var p=ve(c.value),x=c.type;if(p!=null)x==="number"?(p===0&&a.value===""||a.value!=p)&&(a.value=""+p):a.value!==""+p&&(a.value=""+p);else if(x==="submit"||x==="reset"){a.removeAttribute("value");return}c.hasOwnProperty("value")?Zn(a,c.type,p):c.hasOwnProperty("defaultValue")&&Zn(a,c.type,ve(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(a.defaultChecked=!!c.defaultChecked)}function vt(a,c,p){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var x=c.type;if(!(x!=="submit"&&x!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+a._wrapperState.initialValue,p||c===a.value||(a.value=c),a.defaultValue=c}p=a.name,p!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,p!==""&&(a.name=p)}function Zn(a,c,p){(c!=="number"||et(a.ownerDocument)!==a)&&(p==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+p&&(a.defaultValue=""+p))}var $t=Array.isArray;function Rn(a,c,p,x){if(a=a.options,c){c={};for(var k=0;k<p.length;k++)c["$"+p[k]]=!0;for(p=0;p<a.length;p++)k=c.hasOwnProperty("$"+a[p].value),a[p].selected!==k&&(a[p].selected=k),k&&x&&(a[p].defaultSelected=!0)}else{for(p=""+ve(p),c=null,k=0;k<a.length;k++){if(a[k].value===p){a[k].selected=!0,x&&(a[k].defaultSelected=!0);return}c!==null||a[k].disabled||(c=a[k])}c!==null&&(c.selected=!0)}}function dn(a,c){if(c.dangerouslySetInnerHTML!=null)throw Error(t(91));return Y({},c,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Ys(a,c){var p=c.value;if(p==null){if(p=c.children,c=c.defaultValue,p!=null){if(c!=null)throw Error(t(92));if($t(p)){if(1<p.length)throw Error(t(93));p=p[0]}c=p}c==null&&(c=""),p=c}a._wrapperState={initialValue:ve(p)}}function zn(a,c){var p=ve(c.value),x=ve(c.defaultValue);p!=null&&(p=""+p,p!==a.value&&(a.value=p),c.defaultValue==null&&a.defaultValue!==p&&(a.defaultValue=p)),x!=null&&(a.defaultValue=""+x)}function hs(a){var c=a.textContent;c===a._wrapperState.initialValue&&c!==""&&c!==null&&(a.value=c)}function Ds(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ds(a,c){return a==null||a==="http://www.w3.org/1999/xhtml"?Ds(c):a==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Jn,Pr=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,p,x,k){MSApp.execUnsafeLocalFunction(function(){return a(c,p,x,k)})}:a}(function(a,c){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=c;else{for(Jn=Jn||document.createElement("div"),Jn.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=Jn.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;c.firstChild;)a.appendChild(c.firstChild)}});function xr(a,c){if(c){var p=a.firstChild;if(p&&p===a.lastChild&&p.nodeType===3){p.nodeValue=c;return}}a.textContent=c}var yr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Uf=["Webkit","ms","Moz","O"];Object.keys(yr).forEach(function(a){Uf.forEach(function(c){c=c+a.charAt(0).toUpperCase()+a.substring(1),yr[c]=yr[a]})});function So(a,c,p){return c==null||typeof c=="boolean"||c===""?"":p||typeof c!="number"||c===0||yr.hasOwnProperty(a)&&yr[a]?(""+c).trim():c+"px"}function sc(a,c){a=a.style;for(var p in c)if(c.hasOwnProperty(p)){var x=p.indexOf("--")===0,k=So(p,c[p],x);p==="float"&&(p="cssFloat"),x?a.setProperty(p,k):a[p]=k}}var Gf=Y({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hf(a,c){if(c){if(Gf[a]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(t(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(t(61))}if(c.style!=null&&typeof c.style!="object")throw Error(t(62))}}function jf(a,c){if(a.indexOf("-")===-1)return typeof c.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kf=null;function qf(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Xf=null,wi=null,vi=null;function E1(a){if(a=Ja(a)){if(typeof Xf!="function")throw Error(t(280));var c=a.stateNode;c&&(c=Sc(c),Xf(a.stateNode,a.type,c))}}function R1(a){wi?vi?vi.push(a):vi=[a]:wi=a}function D1(){if(wi){var a=wi,c=vi;if(vi=wi=null,E1(a),c)for(a=0;a<c.length;a++)E1(c[a])}}function A1(a,c){return a(c)}function F1(){}var Yf=!1;function _1(a,c,p){if(Yf)return a(c,p);Yf=!0;try{return A1(a,c,p)}finally{Yf=!1,(wi!==null||vi!==null)&&(F1(),D1())}}function Aa(a,c){var p=a.stateNode;if(p===null)return null;var x=Sc(p);if(x===null)return null;p=x[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(a=a.type,x=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!x;break e;default:a=!1}if(a)return null;if(p&&typeof p!="function")throw Error(t(231,c,typeof p));return p}var Qf=!1;if(l)try{var Fa={};Object.defineProperty(Fa,"passive",{get:function(){Qf=!0}}),window.addEventListener("test",Fa,Fa),window.removeEventListener("test",Fa,Fa)}catch{Qf=!1}function CN(a,c,p,x,k,I,E,P,V){var oe=Array.prototype.slice.call(arguments,3);try{c.apply(p,oe)}catch(me){this.onError(me)}}var _a=!1,rc=null,oc=!1,Zf=null,IN={onError:function(a){_a=!0,rc=a}};function $N(a,c,p,x,k,I,E,P,V){_a=!1,rc=null,CN.apply(IN,arguments)}function SN(a,c,p,x,k,I,E,P,V){if($N.apply(this,arguments),_a){if(_a){var oe=rc;_a=!1,rc=null}else throw Error(t(198));oc||(oc=!0,Zf=oe)}}function No(a){var c=a,p=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,c.flags&4098&&(p=c.return),a=c.return;while(a)}return c.tag===3?p:null}function O1(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function L1(a){if(No(a)!==a)throw Error(t(188))}function NN(a){var c=a.alternate;if(!c){if(c=No(a),c===null)throw Error(t(188));return c!==a?null:a}for(var p=a,x=c;;){var k=p.return;if(k===null)break;var I=k.alternate;if(I===null){if(x=k.return,x!==null){p=x;continue}break}if(k.child===I.child){for(I=k.child;I;){if(I===p)return L1(k),a;if(I===x)return L1(k),c;I=I.sibling}throw Error(t(188))}if(p.return!==x.return)p=k,x=I;else{for(var E=!1,P=k.child;P;){if(P===p){E=!0,p=k,x=I;break}if(P===x){E=!0,x=k,p=I;break}P=P.sibling}if(!E){for(P=I.child;P;){if(P===p){E=!0,p=I,x=k;break}if(P===x){E=!0,x=I,p=k;break}P=P.sibling}if(!E)throw Error(t(189))}}if(p.alternate!==x)throw Error(t(190))}if(p.tag!==3)throw Error(t(188));return p.stateNode.current===p?a:c}function P1(a){return a=NN(a),a!==null?M1(a):null}function M1(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var c=M1(a);if(c!==null)return c;a=a.sibling}return null}var z1=e.unstable_scheduleCallback,B1=e.unstable_cancelCallback,TN=e.unstable_shouldYield,EN=e.unstable_requestPaint,Ot=e.unstable_now,RN=e.unstable_getCurrentPriorityLevel,Jf=e.unstable_ImmediatePriority,V1=e.unstable_UserBlockingPriority,ic=e.unstable_NormalPriority,DN=e.unstable_LowPriority,W1=e.unstable_IdlePriority,ac=null,Qs=null;function AN(a){if(Qs&&typeof Qs.onCommitFiberRoot=="function")try{Qs.onCommitFiberRoot(ac,a,void 0,(a.current.flags&128)===128)}catch{}}var As=Math.clz32?Math.clz32:ON,FN=Math.log,_N=Math.LN2;function ON(a){return a>>>=0,a===0?32:31-(FN(a)/_N|0)|0}var lc=64,uc=4194304;function Oa(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function cc(a,c){var p=a.pendingLanes;if(p===0)return 0;var x=0,k=a.suspendedLanes,I=a.pingedLanes,E=p&268435455;if(E!==0){var P=E&~k;P!==0?x=Oa(P):(I&=E,I!==0&&(x=Oa(I)))}else E=p&~k,E!==0?x=Oa(E):I!==0&&(x=Oa(I));if(x===0)return 0;if(c!==0&&c!==x&&!(c&k)&&(k=x&-x,I=c&-c,k>=I||k===16&&(I&4194240)!==0))return c;if(x&4&&(x|=p&16),c=a.entangledLanes,c!==0)for(a=a.entanglements,c&=x;0<c;)p=31-As(c),k=1<<p,x|=a[p],c&=~k;return x}function LN(a,c){switch(a){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function PN(a,c){for(var p=a.suspendedLanes,x=a.pingedLanes,k=a.expirationTimes,I=a.pendingLanes;0<I;){var E=31-As(I),P=1<<E,V=k[E];V===-1?(!(P&p)||P&x)&&(k[E]=LN(P,c)):V<=c&&(a.expiredLanes|=P),I&=~P}}function ep(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function U1(){var a=lc;return lc<<=1,!(lc&4194240)&&(lc=64),a}function tp(a){for(var c=[],p=0;31>p;p++)c.push(a);return c}function La(a,c,p){a.pendingLanes|=c,c!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,c=31-As(c),a[c]=p}function MN(a,c){var p=a.pendingLanes&~c;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=c,a.mutableReadLanes&=c,a.entangledLanes&=c,c=a.entanglements;var x=a.eventTimes;for(a=a.expirationTimes;0<p;){var k=31-As(p),I=1<<k;c[k]=0,x[k]=-1,a[k]=-1,p&=~I}}function np(a,c){var p=a.entangledLanes|=c;for(a=a.entanglements;p;){var x=31-As(p),k=1<<x;k&c|a[x]&c&&(a[x]|=c),p&=~k}}var ut=0;function G1(a){return a&=-a,1<a?4<a?a&268435455?16:536870912:4:1}var H1,sp,j1,K1,q1,rp=!1,hc=[],Mr=null,zr=null,Br=null,Pa=new Map,Ma=new Map,Vr=[],zN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function X1(a,c){switch(a){case"focusin":case"focusout":Mr=null;break;case"dragenter":case"dragleave":zr=null;break;case"mouseover":case"mouseout":Br=null;break;case"pointerover":case"pointerout":Pa.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ma.delete(c.pointerId)}}function za(a,c,p,x,k,I){return a===null||a.nativeEvent!==I?(a={blockedOn:c,domEventName:p,eventSystemFlags:x,nativeEvent:I,targetContainers:[k]},c!==null&&(c=Ja(c),c!==null&&sp(c)),a):(a.eventSystemFlags|=x,c=a.targetContainers,k!==null&&c.indexOf(k)===-1&&c.push(k),a)}function BN(a,c,p,x,k){switch(c){case"focusin":return Mr=za(Mr,a,c,p,x,k),!0;case"dragenter":return zr=za(zr,a,c,p,x,k),!0;case"mouseover":return Br=za(Br,a,c,p,x,k),!0;case"pointerover":var I=k.pointerId;return Pa.set(I,za(Pa.get(I)||null,a,c,p,x,k)),!0;case"gotpointercapture":return I=k.pointerId,Ma.set(I,za(Ma.get(I)||null,a,c,p,x,k)),!0}return!1}function Y1(a){var c=To(a.target);if(c!==null){var p=No(c);if(p!==null){if(c=p.tag,c===13){if(c=O1(p),c!==null){a.blockedOn=c,q1(a.priority,function(){j1(p)});return}}else if(c===3&&p.stateNode.current.memoizedState.isDehydrated){a.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}a.blockedOn=null}function dc(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var p=ip(a.domEventName,a.eventSystemFlags,c[0],a.nativeEvent);if(p===null){p=a.nativeEvent;var x=new p.constructor(p.type,p);Kf=x,p.target.dispatchEvent(x),Kf=null}else return c=Ja(p),c!==null&&sp(c),a.blockedOn=p,!1;c.shift()}return!0}function Q1(a,c,p){dc(a)&&p.delete(c)}function VN(){rp=!1,Mr!==null&&dc(Mr)&&(Mr=null),zr!==null&&dc(zr)&&(zr=null),Br!==null&&dc(Br)&&(Br=null),Pa.forEach(Q1),Ma.forEach(Q1)}function Ba(a,c){a.blockedOn===c&&(a.blockedOn=null,rp||(rp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,VN)))}function Va(a){function c(k){return Ba(k,a)}if(0<hc.length){Ba(hc[0],a);for(var p=1;p<hc.length;p++){var x=hc[p];x.blockedOn===a&&(x.blockedOn=null)}}for(Mr!==null&&Ba(Mr,a),zr!==null&&Ba(zr,a),Br!==null&&Ba(Br,a),Pa.forEach(c),Ma.forEach(c),p=0;p<Vr.length;p++)x=Vr[p],x.blockedOn===a&&(x.blockedOn=null);for(;0<Vr.length&&(p=Vr[0],p.blockedOn===null);)Y1(p),p.blockedOn===null&&Vr.shift()}var bi=$.ReactCurrentBatchConfig,fc=!0;function WN(a,c,p,x){var k=ut,I=bi.transition;bi.transition=null;try{ut=1,op(a,c,p,x)}finally{ut=k,bi.transition=I}}function UN(a,c,p,x){var k=ut,I=bi.transition;bi.transition=null;try{ut=4,op(a,c,p,x)}finally{ut=k,bi.transition=I}}function op(a,c,p,x){if(fc){var k=ip(a,c,p,x);if(k===null)Cp(a,c,x,pc,p),X1(a,x);else if(BN(k,a,c,p,x))x.stopPropagation();else if(X1(a,x),c&4&&-1<zN.indexOf(a)){for(;k!==null;){var I=Ja(k);if(I!==null&&H1(I),I=ip(a,c,p,x),I===null&&Cp(a,c,x,pc,p),I===k)break;k=I}k!==null&&x.stopPropagation()}else Cp(a,c,x,null,p)}}var pc=null;function ip(a,c,p,x){if(pc=null,a=qf(x),a=To(a),a!==null)if(c=No(a),c===null)a=null;else if(p=c.tag,p===13){if(a=O1(c),a!==null)return a;a=null}else if(p===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null);return pc=a,null}function Z1(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(RN()){case Jf:return 1;case V1:return 4;case ic:case DN:return 16;case W1:return 536870912;default:return 16}default:return 16}}var Wr=null,ap=null,mc=null;function J1(){if(mc)return mc;var a,c=ap,p=c.length,x,k="value"in Wr?Wr.value:Wr.textContent,I=k.length;for(a=0;a<p&&c[a]===k[a];a++);var E=p-a;for(x=1;x<=E&&c[p-x]===k[I-x];x++);return mc=k.slice(a,1<x?1-x:void 0)}function gc(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function xc(){return!0}function ey(){return!1}function es(a){function c(p,x,k,I,E){this._reactName=p,this._targetInst=k,this.type=x,this.nativeEvent=I,this.target=E,this.currentTarget=null;for(var P in a)a.hasOwnProperty(P)&&(p=a[P],this[P]=p?p(I):I[P]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?xc:ey,this.isPropagationStopped=ey,this}return Y(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){},isPersistent:xc}),c}var ki={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lp=es(ki),Wa=Y({},ki,{view:0,detail:0}),GN=es(Wa),up,cp,Ua,yc=Y({},Wa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dp,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ua&&(Ua&&a.type==="mousemove"?(up=a.screenX-Ua.screenX,cp=a.screenY-Ua.screenY):cp=up=0,Ua=a),up)},movementY:function(a){return"movementY"in a?a.movementY:cp}}),ty=es(yc),HN=Y({},yc,{dataTransfer:0}),jN=es(HN),KN=Y({},Wa,{relatedTarget:0}),hp=es(KN),qN=Y({},ki,{animationName:0,elapsedTime:0,pseudoElement:0}),XN=es(qN),YN=Y({},ki,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),QN=es(YN),ZN=Y({},ki,{data:0}),ny=es(ZN),JN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nT(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=tT[a])?!!c[a]:!1}function dp(){return nT}var sT=Y({},Wa,{key:function(a){if(a.key){var c=JN[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=gc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?eT[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dp,charCode:function(a){return a.type==="keypress"?gc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?gc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),rT=es(sT),oT=Y({},yc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sy=es(oT),iT=Y({},Wa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dp}),aT=es(iT),lT=Y({},ki,{propertyName:0,elapsedTime:0,pseudoElement:0}),uT=es(lT),cT=Y({},yc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),hT=es(cT),dT=[9,13,27,32],fp=l&&"CompositionEvent"in window,Ga=null;l&&"documentMode"in document&&(Ga=document.documentMode);var fT=l&&"TextEvent"in window&&!Ga,ry=l&&(!fp||Ga&&8<Ga&&11>=Ga),oy=" ",iy=!1;function ay(a,c){switch(a){case"keyup":return dT.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ly(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Ci=!1;function pT(a,c){switch(a){case"compositionend":return ly(c);case"keypress":return c.which!==32?null:(iy=!0,oy);case"textInput":return a=c.data,a===oy&&iy?null:a;default:return null}}function mT(a,c){if(Ci)return a==="compositionend"||!fp&&ay(a,c)?(a=J1(),mc=ap=Wr=null,Ci=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return ry&&c.locale!=="ko"?null:c.data;default:return null}}var gT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uy(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!gT[a.type]:c==="textarea"}function cy(a,c,p,x){R1(x),c=Cc(c,"onChange"),0<c.length&&(p=new lp("onChange","change",null,p,x),a.push({event:p,listeners:c}))}var Ha=null,ja=null;function xT(a){Ty(a,0)}function wc(a){var c=Ti(a);if(Ze(c))return a}function yT(a,c){if(a==="change")return c}var hy=!1;if(l){var pp;if(l){var mp="oninput"in document;if(!mp){var dy=document.createElement("div");dy.setAttribute("oninput","return;"),mp=typeof dy.oninput=="function"}pp=mp}else pp=!1;hy=pp&&(!document.documentMode||9<document.documentMode)}function fy(){Ha&&(Ha.detachEvent("onpropertychange",py),ja=Ha=null)}function py(a){if(a.propertyName==="value"&&wc(ja)){var c=[];cy(c,ja,a,qf(a)),_1(xT,c)}}function wT(a,c,p){a==="focusin"?(fy(),Ha=c,ja=p,Ha.attachEvent("onpropertychange",py)):a==="focusout"&&fy()}function vT(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return wc(ja)}function bT(a,c){if(a==="click")return wc(c)}function kT(a,c){if(a==="input"||a==="change")return wc(c)}function CT(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Fs=typeof Object.is=="function"?Object.is:CT;function Ka(a,c){if(Fs(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var p=Object.keys(a),x=Object.keys(c);if(p.length!==x.length)return!1;for(x=0;x<p.length;x++){var k=p[x];if(!u.call(c,k)||!Fs(a[k],c[k]))return!1}return!0}function my(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function gy(a,c){var p=my(a);a=0;for(var x;p;){if(p.nodeType===3){if(x=a+p.textContent.length,a<=c&&x>=c)return{node:p,offset:c-a};a=x}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=my(p)}}function xy(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?xy(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function yy(){for(var a=window,c=et();c instanceof a.HTMLIFrameElement;){try{var p=typeof c.contentWindow.location.href=="string"}catch{p=!1}if(p)a=c.contentWindow;else break;c=et(a.document)}return c}function gp(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}function IT(a){var c=yy(),p=a.focusedElem,x=a.selectionRange;if(c!==p&&p&&p.ownerDocument&&xy(p.ownerDocument.documentElement,p)){if(x!==null&&gp(p)){if(c=x.start,a=x.end,a===void 0&&(a=c),"selectionStart"in p)p.selectionStart=c,p.selectionEnd=Math.min(a,p.value.length);else if(a=(c=p.ownerDocument||document)&&c.defaultView||window,a.getSelection){a=a.getSelection();var k=p.textContent.length,I=Math.min(x.start,k);x=x.end===void 0?I:Math.min(x.end,k),!a.extend&&I>x&&(k=x,x=I,I=k),k=gy(p,I);var E=gy(p,x);k&&E&&(a.rangeCount!==1||a.anchorNode!==k.node||a.anchorOffset!==k.offset||a.focusNode!==E.node||a.focusOffset!==E.offset)&&(c=c.createRange(),c.setStart(k.node,k.offset),a.removeAllRanges(),I>x?(a.addRange(c),a.extend(E.node,E.offset)):(c.setEnd(E.node,E.offset),a.addRange(c)))}}for(c=[],a=p;a=a.parentNode;)a.nodeType===1&&c.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof p.focus=="function"&&p.focus(),p=0;p<c.length;p++)a=c[p],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var $T=l&&"documentMode"in document&&11>=document.documentMode,Ii=null,xp=null,qa=null,yp=!1;function wy(a,c,p){var x=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;yp||Ii==null||Ii!==et(x)||(x=Ii,"selectionStart"in x&&gp(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),qa&&Ka(qa,x)||(qa=x,x=Cc(xp,"onSelect"),0<x.length&&(c=new lp("onSelect","select",null,c,p),a.push({event:c,listeners:x}),c.target=Ii)))}function vc(a,c){var p={};return p[a.toLowerCase()]=c.toLowerCase(),p["Webkit"+a]="webkit"+c,p["Moz"+a]="moz"+c,p}var $i={animationend:vc("Animation","AnimationEnd"),animationiteration:vc("Animation","AnimationIteration"),animationstart:vc("Animation","AnimationStart"),transitionend:vc("Transition","TransitionEnd")},wp={},vy={};l&&(vy=document.createElement("div").style,"AnimationEvent"in window||(delete $i.animationend.animation,delete $i.animationiteration.animation,delete $i.animationstart.animation),"TransitionEvent"in window||delete $i.transitionend.transition);function bc(a){if(wp[a])return wp[a];if(!$i[a])return a;var c=$i[a],p;for(p in c)if(c.hasOwnProperty(p)&&p in vy)return wp[a]=c[p];return a}var by=bc("animationend"),ky=bc("animationiteration"),Cy=bc("animationstart"),Iy=bc("transitionend"),$y=new Map,Sy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ur(a,c){$y.set(a,c),o(c,[a])}for(var vp=0;vp<Sy.length;vp++){var bp=Sy[vp],ST=bp.toLowerCase(),NT=bp[0].toUpperCase()+bp.slice(1);Ur(ST,"on"+NT)}Ur(by,"onAnimationEnd"),Ur(ky,"onAnimationIteration"),Ur(Cy,"onAnimationStart"),Ur("dblclick","onDoubleClick"),Ur("focusin","onFocus"),Ur("focusout","onBlur"),Ur(Iy,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),TT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xa));function Ny(a,c,p){var x=a.type||"unknown-event";a.currentTarget=p,SN(x,c,void 0,a),a.currentTarget=null}function Ty(a,c){c=(c&4)!==0;for(var p=0;p<a.length;p++){var x=a[p],k=x.event;x=x.listeners;e:{var I=void 0;if(c)for(var E=x.length-1;0<=E;E--){var P=x[E],V=P.instance,oe=P.currentTarget;if(P=P.listener,V!==I&&k.isPropagationStopped())break e;Ny(k,P,oe),I=V}else for(E=0;E<x.length;E++){if(P=x[E],V=P.instance,oe=P.currentTarget,P=P.listener,V!==I&&k.isPropagationStopped())break e;Ny(k,P,oe),I=V}}}if(oc)throw a=Zf,oc=!1,Zf=null,a}function bt(a,c){var p=c[Ep];p===void 0&&(p=c[Ep]=new Set);var x=a+"__bubble";p.has(x)||(Ey(c,a,2,!1),p.add(x))}function kp(a,c,p){var x=0;c&&(x|=4),Ey(p,a,x,c)}var kc="_reactListening"+Math.random().toString(36).slice(2);function Ya(a){if(!a[kc]){a[kc]=!0,s.forEach(function(p){p!=="selectionchange"&&(TT.has(p)||kp(p,!1,a),kp(p,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[kc]||(c[kc]=!0,kp("selectionchange",!1,c))}}function Ey(a,c,p,x){switch(Z1(c)){case 1:var k=WN;break;case 4:k=UN;break;default:k=op}p=k.bind(null,c,p,a),k=void 0,!Qf||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(k=!0),x?k!==void 0?a.addEventListener(c,p,{capture:!0,passive:k}):a.addEventListener(c,p,!0):k!==void 0?a.addEventListener(c,p,{passive:k}):a.addEventListener(c,p,!1)}function Cp(a,c,p,x,k){var I=x;if(!(c&1)&&!(c&2)&&x!==null)e:for(;;){if(x===null)return;var E=x.tag;if(E===3||E===4){var P=x.stateNode.containerInfo;if(P===k||P.nodeType===8&&P.parentNode===k)break;if(E===4)for(E=x.return;E!==null;){var V=E.tag;if((V===3||V===4)&&(V=E.stateNode.containerInfo,V===k||V.nodeType===8&&V.parentNode===k))return;E=E.return}for(;P!==null;){if(E=To(P),E===null)return;if(V=E.tag,V===5||V===6){x=I=E;continue e}P=P.parentNode}}x=x.return}_1(function(){var oe=I,me=qf(p),ge=[];e:{var pe=$y.get(a);if(pe!==void 0){var Ie=lp,Te=a;switch(a){case"keypress":if(gc(p)===0)break e;case"keydown":case"keyup":Ie=rT;break;case"focusin":Te="focus",Ie=hp;break;case"focusout":Te="blur",Ie=hp;break;case"beforeblur":case"afterblur":Ie=hp;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ie=ty;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ie=jN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ie=aT;break;case by:case ky:case Cy:Ie=XN;break;case Iy:Ie=uT;break;case"scroll":Ie=GN;break;case"wheel":Ie=hT;break;case"copy":case"cut":case"paste":Ie=QN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ie=sy}var Ee=(c&4)!==0,Lt=!Ee&&a==="scroll",te=Ee?pe!==null?pe+"Capture":null:pe;Ee=[];for(var H=oe,se;H!==null;){se=H;var ye=se.stateNode;if(se.tag===5&&ye!==null&&(se=ye,te!==null&&(ye=Aa(H,te),ye!=null&&Ee.push(Qa(H,ye,se)))),Lt)break;H=H.return}0<Ee.length&&(pe=new Ie(pe,Te,null,p,me),ge.push({event:pe,listeners:Ee}))}}if(!(c&7)){e:{if(pe=a==="mouseover"||a==="pointerover",Ie=a==="mouseout"||a==="pointerout",pe&&p!==Kf&&(Te=p.relatedTarget||p.fromElement)&&(To(Te)||Te[wr]))break e;if((Ie||pe)&&(pe=me.window===me?me:(pe=me.ownerDocument)?pe.defaultView||pe.parentWindow:window,Ie?(Te=p.relatedTarget||p.toElement,Ie=oe,Te=Te?To(Te):null,Te!==null&&(Lt=No(Te),Te!==Lt||Te.tag!==5&&Te.tag!==6)&&(Te=null)):(Ie=null,Te=oe),Ie!==Te)){if(Ee=ty,ye="onMouseLeave",te="onMouseEnter",H="mouse",(a==="pointerout"||a==="pointerover")&&(Ee=sy,ye="onPointerLeave",te="onPointerEnter",H="pointer"),Lt=Ie==null?pe:Ti(Ie),se=Te==null?pe:Ti(Te),pe=new Ee(ye,H+"leave",Ie,p,me),pe.target=Lt,pe.relatedTarget=se,ye=null,To(me)===oe&&(Ee=new Ee(te,H+"enter",Te,p,me),Ee.target=se,Ee.relatedTarget=Lt,ye=Ee),Lt=ye,Ie&&Te)t:{for(Ee=Ie,te=Te,H=0,se=Ee;se;se=Si(se))H++;for(se=0,ye=te;ye;ye=Si(ye))se++;for(;0<H-se;)Ee=Si(Ee),H--;for(;0<se-H;)te=Si(te),se--;for(;H--;){if(Ee===te||te!==null&&Ee===te.alternate)break t;Ee=Si(Ee),te=Si(te)}Ee=null}else Ee=null;Ie!==null&&Ry(ge,pe,Ie,Ee,!1),Te!==null&&Lt!==null&&Ry(ge,Lt,Te,Ee,!0)}}e:{if(pe=oe?Ti(oe):window,Ie=pe.nodeName&&pe.nodeName.toLowerCase(),Ie==="select"||Ie==="input"&&pe.type==="file")var De=yT;else if(uy(pe))if(hy)De=kT;else{De=vT;var Le=wT}else(Ie=pe.nodeName)&&Ie.toLowerCase()==="input"&&(pe.type==="checkbox"||pe.type==="radio")&&(De=bT);if(De&&(De=De(a,oe))){cy(ge,De,p,me);break e}Le&&Le(a,pe,oe),a==="focusout"&&(Le=pe._wrapperState)&&Le.controlled&&pe.type==="number"&&Zn(pe,"number",pe.value)}switch(Le=oe?Ti(oe):window,a){case"focusin":(uy(Le)||Le.contentEditable==="true")&&(Ii=Le,xp=oe,qa=null);break;case"focusout":qa=xp=Ii=null;break;case"mousedown":yp=!0;break;case"contextmenu":case"mouseup":case"dragend":yp=!1,wy(ge,p,me);break;case"selectionchange":if($T)break;case"keydown":case"keyup":wy(ge,p,me)}var Pe;if(fp)e:{switch(a){case"compositionstart":var ze="onCompositionStart";break e;case"compositionend":ze="onCompositionEnd";break e;case"compositionupdate":ze="onCompositionUpdate";break e}ze=void 0}else Ci?ay(a,p)&&(ze="onCompositionEnd"):a==="keydown"&&p.keyCode===229&&(ze="onCompositionStart");ze&&(ry&&p.locale!=="ko"&&(Ci||ze!=="onCompositionStart"?ze==="onCompositionEnd"&&Ci&&(Pe=J1()):(Wr=me,ap="value"in Wr?Wr.value:Wr.textContent,Ci=!0)),Le=Cc(oe,ze),0<Le.length&&(ze=new ny(ze,a,null,p,me),ge.push({event:ze,listeners:Le}),Pe?ze.data=Pe:(Pe=ly(p),Pe!==null&&(ze.data=Pe)))),(Pe=fT?pT(a,p):mT(a,p))&&(oe=Cc(oe,"onBeforeInput"),0<oe.length&&(me=new ny("onBeforeInput","beforeinput",null,p,me),ge.push({event:me,listeners:oe}),me.data=Pe))}Ty(ge,c)})}function Qa(a,c,p){return{instance:a,listener:c,currentTarget:p}}function Cc(a,c){for(var p=c+"Capture",x=[];a!==null;){var k=a,I=k.stateNode;k.tag===5&&I!==null&&(k=I,I=Aa(a,p),I!=null&&x.unshift(Qa(a,I,k)),I=Aa(a,c),I!=null&&x.push(Qa(a,I,k))),a=a.return}return x}function Si(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Ry(a,c,p,x,k){for(var I=c._reactName,E=[];p!==null&&p!==x;){var P=p,V=P.alternate,oe=P.stateNode;if(V!==null&&V===x)break;P.tag===5&&oe!==null&&(P=oe,k?(V=Aa(p,I),V!=null&&E.unshift(Qa(p,V,P))):k||(V=Aa(p,I),V!=null&&E.push(Qa(p,V,P)))),p=p.return}E.length!==0&&a.push({event:c,listeners:E})}var ET=/\r\n?/g,RT=/\u0000|\uFFFD/g;function Dy(a){return(typeof a=="string"?a:""+a).replace(ET,`
`).replace(RT,"")}function Ic(a,c,p){if(c=Dy(c),Dy(a)!==c&&p)throw Error(t(425))}function $c(){}var Ip=null,$p=null;function Sp(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Np=typeof setTimeout=="function"?setTimeout:void 0,DT=typeof clearTimeout=="function"?clearTimeout:void 0,Ay=typeof Promise=="function"?Promise:void 0,AT=typeof queueMicrotask=="function"?queueMicrotask:typeof Ay<"u"?function(a){return Ay.resolve(null).then(a).catch(FT)}:Np;function FT(a){setTimeout(function(){throw a})}function Tp(a,c){var p=c,x=0;do{var k=p.nextSibling;if(a.removeChild(p),k&&k.nodeType===8)if(p=k.data,p==="/$"){if(x===0){a.removeChild(k),Va(c);return}x--}else p!=="$"&&p!=="$?"&&p!=="$!"||x++;p=k}while(p);Va(c)}function Gr(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return a}function Fy(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var p=a.data;if(p==="$"||p==="$!"||p==="$?"){if(c===0)return a;c--}else p==="/$"&&c++}a=a.previousSibling}return null}var Ni=Math.random().toString(36).slice(2),Zs="__reactFiber$"+Ni,Za="__reactProps$"+Ni,wr="__reactContainer$"+Ni,Ep="__reactEvents$"+Ni,_T="__reactListeners$"+Ni,OT="__reactHandles$"+Ni;function To(a){var c=a[Zs];if(c)return c;for(var p=a.parentNode;p;){if(c=p[wr]||p[Zs]){if(p=c.alternate,c.child!==null||p!==null&&p.child!==null)for(a=Fy(a);a!==null;){if(p=a[Zs])return p;a=Fy(a)}return c}a=p,p=a.parentNode}return null}function Ja(a){return a=a[Zs]||a[wr],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Ti(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function Sc(a){return a[Za]||null}var Rp=[],Ei=-1;function Hr(a){return{current:a}}function kt(a){0>Ei||(a.current=Rp[Ei],Rp[Ei]=null,Ei--)}function xt(a,c){Ei++,Rp[Ei]=a.current,a.current=c}var jr={},yn=Hr(jr),Bn=Hr(!1),Eo=jr;function Ri(a,c){var p=a.type.contextTypes;if(!p)return jr;var x=a.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===c)return x.__reactInternalMemoizedMaskedChildContext;var k={},I;for(I in p)k[I]=c[I];return x&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=c,a.__reactInternalMemoizedMaskedChildContext=k),k}function Vn(a){return a=a.childContextTypes,a!=null}function Nc(){kt(Bn),kt(yn)}function _y(a,c,p){if(yn.current!==jr)throw Error(t(168));xt(yn,c),xt(Bn,p)}function Oy(a,c,p){var x=a.stateNode;if(c=c.childContextTypes,typeof x.getChildContext!="function")return p;x=x.getChildContext();for(var k in x)if(!(k in c))throw Error(t(108,we(a)||"Unknown",k));return Y({},p,x)}function Tc(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||jr,Eo=yn.current,xt(yn,a),xt(Bn,Bn.current),!0}function Ly(a,c,p){var x=a.stateNode;if(!x)throw Error(t(169));p?(a=Oy(a,c,Eo),x.__reactInternalMemoizedMergedChildContext=a,kt(Bn),kt(yn),xt(yn,a)):kt(Bn),xt(Bn,p)}var vr=null,Ec=!1,Dp=!1;function Py(a){vr===null?vr=[a]:vr.push(a)}function LT(a){Ec=!0,Py(a)}function Kr(){if(!Dp&&vr!==null){Dp=!0;var a=0,c=ut;try{var p=vr;for(ut=1;a<p.length;a++){var x=p[a];do x=x(!0);while(x!==null)}vr=null,Ec=!1}catch(k){throw vr!==null&&(vr=vr.slice(a+1)),z1(Jf,Kr),k}finally{ut=c,Dp=!1}}return null}var Di=[],Ai=0,Rc=null,Dc=0,fs=[],ps=0,Ro=null,br=1,kr="";function Do(a,c){Di[Ai++]=Dc,Di[Ai++]=Rc,Rc=a,Dc=c}function My(a,c,p){fs[ps++]=br,fs[ps++]=kr,fs[ps++]=Ro,Ro=a;var x=br;a=kr;var k=32-As(x)-1;x&=~(1<<k),p+=1;var I=32-As(c)+k;if(30<I){var E=k-k%5;I=(x&(1<<E)-1).toString(32),x>>=E,k-=E,br=1<<32-As(c)+k|p<<k|x,kr=I+a}else br=1<<I|p<<k|x,kr=a}function Ap(a){a.return!==null&&(Do(a,1),My(a,1,0))}function Fp(a){for(;a===Rc;)Rc=Di[--Ai],Di[Ai]=null,Dc=Di[--Ai],Di[Ai]=null;for(;a===Ro;)Ro=fs[--ps],fs[ps]=null,kr=fs[--ps],fs[ps]=null,br=fs[--ps],fs[ps]=null}var ts=null,ns=null,St=!1,_s=null;function zy(a,c){var p=ys(5,null,null,0);p.elementType="DELETED",p.stateNode=c,p.return=a,c=a.deletions,c===null?(a.deletions=[p],a.flags|=16):c.push(p)}function By(a,c){switch(a.tag){case 5:var p=a.type;return c=c.nodeType!==1||p.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(a.stateNode=c,ts=a,ns=Gr(c.firstChild),!0):!1;case 6:return c=a.pendingProps===""||c.nodeType!==3?null:c,c!==null?(a.stateNode=c,ts=a,ns=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(p=Ro!==null?{id:br,overflow:kr}:null,a.memoizedState={dehydrated:c,treeContext:p,retryLane:1073741824},p=ys(18,null,null,0),p.stateNode=c,p.return=a,a.child=p,ts=a,ns=null,!0):!1;default:return!1}}function _p(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Op(a){if(St){var c=ns;if(c){var p=c;if(!By(a,c)){if(_p(a))throw Error(t(418));c=Gr(p.nextSibling);var x=ts;c&&By(a,c)?zy(x,p):(a.flags=a.flags&-4097|2,St=!1,ts=a)}}else{if(_p(a))throw Error(t(418));a.flags=a.flags&-4097|2,St=!1,ts=a}}}function Vy(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;ts=a}function Ac(a){if(a!==ts)return!1;if(!St)return Vy(a),St=!0,!1;var c;if((c=a.tag!==3)&&!(c=a.tag!==5)&&(c=a.type,c=c!=="head"&&c!=="body"&&!Sp(a.type,a.memoizedProps)),c&&(c=ns)){if(_p(a))throw Wy(),Error(t(418));for(;c;)zy(a,c),c=Gr(c.nextSibling)}if(Vy(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8){var p=a.data;if(p==="/$"){if(c===0){ns=Gr(a.nextSibling);break e}c--}else p!=="$"&&p!=="$!"&&p!=="$?"||c++}a=a.nextSibling}ns=null}}else ns=ts?Gr(a.stateNode.nextSibling):null;return!0}function Wy(){for(var a=ns;a;)a=Gr(a.nextSibling)}function Fi(){ns=ts=null,St=!1}function Lp(a){_s===null?_s=[a]:_s.push(a)}var PT=$.ReactCurrentBatchConfig;function el(a,c,p){if(a=p.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(p._owner){if(p=p._owner,p){if(p.tag!==1)throw Error(t(309));var x=p.stateNode}if(!x)throw Error(t(147,a));var k=x,I=""+a;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===I?c.ref:(c=function(E){var P=k.refs;E===null?delete P[I]:P[I]=E},c._stringRef=I,c)}if(typeof a!="string")throw Error(t(284));if(!p._owner)throw Error(t(290,a))}return a}function Fc(a,c){throw a=Object.prototype.toString.call(c),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a))}function Uy(a){var c=a._init;return c(a._payload)}function Gy(a){function c(te,H){if(a){var se=te.deletions;se===null?(te.deletions=[H],te.flags|=16):se.push(H)}}function p(te,H){if(!a)return null;for(;H!==null;)c(te,H),H=H.sibling;return null}function x(te,H){for(te=new Map;H!==null;)H.key!==null?te.set(H.key,H):te.set(H.index,H),H=H.sibling;return te}function k(te,H){return te=to(te,H),te.index=0,te.sibling=null,te}function I(te,H,se){return te.index=se,a?(se=te.alternate,se!==null?(se=se.index,se<H?(te.flags|=2,H):se):(te.flags|=2,H)):(te.flags|=1048576,H)}function E(te){return a&&te.alternate===null&&(te.flags|=2),te}function P(te,H,se,ye){return H===null||H.tag!==6?(H=Nm(se,te.mode,ye),H.return=te,H):(H=k(H,se),H.return=te,H)}function V(te,H,se,ye){var De=se.type;return De===O?me(te,H,se.props.children,ye,se.key):H!==null&&(H.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===J&&Uy(De)===H.type)?(ye=k(H,se.props),ye.ref=el(te,H,se),ye.return=te,ye):(ye=sh(se.type,se.key,se.props,null,te.mode,ye),ye.ref=el(te,H,se),ye.return=te,ye)}function oe(te,H,se,ye){return H===null||H.tag!==4||H.stateNode.containerInfo!==se.containerInfo||H.stateNode.implementation!==se.implementation?(H=Tm(se,te.mode,ye),H.return=te,H):(H=k(H,se.children||[]),H.return=te,H)}function me(te,H,se,ye,De){return H===null||H.tag!==7?(H=zo(se,te.mode,ye,De),H.return=te,H):(H=k(H,se),H.return=te,H)}function ge(te,H,se){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Nm(""+H,te.mode,se),H.return=te,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case N:return se=sh(H.type,H.key,H.props,null,te.mode,se),se.ref=el(te,null,H),se.return=te,se;case R:return H=Tm(H,te.mode,se),H.return=te,H;case J:var ye=H._init;return ge(te,ye(H._payload),se)}if($t(H)||X(H))return H=zo(H,te.mode,se,null),H.return=te,H;Fc(te,H)}return null}function pe(te,H,se,ye){var De=H!==null?H.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return De!==null?null:P(te,H,""+se,ye);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case N:return se.key===De?V(te,H,se,ye):null;case R:return se.key===De?oe(te,H,se,ye):null;case J:return De=se._init,pe(te,H,De(se._payload),ye)}if($t(se)||X(se))return De!==null?null:me(te,H,se,ye,null);Fc(te,se)}return null}function Ie(te,H,se,ye,De){if(typeof ye=="string"&&ye!==""||typeof ye=="number")return te=te.get(se)||null,P(H,te,""+ye,De);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case N:return te=te.get(ye.key===null?se:ye.key)||null,V(H,te,ye,De);case R:return te=te.get(ye.key===null?se:ye.key)||null,oe(H,te,ye,De);case J:var Le=ye._init;return Ie(te,H,se,Le(ye._payload),De)}if($t(ye)||X(ye))return te=te.get(se)||null,me(H,te,ye,De,null);Fc(H,ye)}return null}function Te(te,H,se,ye){for(var De=null,Le=null,Pe=H,ze=H=0,on=null;Pe!==null&&ze<se.length;ze++){Pe.index>ze?(on=Pe,Pe=null):on=Pe.sibling;var nt=pe(te,Pe,se[ze],ye);if(nt===null){Pe===null&&(Pe=on);break}a&&Pe&&nt.alternate===null&&c(te,Pe),H=I(nt,H,ze),Le===null?De=nt:Le.sibling=nt,Le=nt,Pe=on}if(ze===se.length)return p(te,Pe),St&&Do(te,ze),De;if(Pe===null){for(;ze<se.length;ze++)Pe=ge(te,se[ze],ye),Pe!==null&&(H=I(Pe,H,ze),Le===null?De=Pe:Le.sibling=Pe,Le=Pe);return St&&Do(te,ze),De}for(Pe=x(te,Pe);ze<se.length;ze++)on=Ie(Pe,te,ze,se[ze],ye),on!==null&&(a&&on.alternate!==null&&Pe.delete(on.key===null?ze:on.key),H=I(on,H,ze),Le===null?De=on:Le.sibling=on,Le=on);return a&&Pe.forEach(function(no){return c(te,no)}),St&&Do(te,ze),De}function Ee(te,H,se,ye){var De=X(se);if(typeof De!="function")throw Error(t(150));if(se=De.call(se),se==null)throw Error(t(151));for(var Le=De=null,Pe=H,ze=H=0,on=null,nt=se.next();Pe!==null&&!nt.done;ze++,nt=se.next()){Pe.index>ze?(on=Pe,Pe=null):on=Pe.sibling;var no=pe(te,Pe,nt.value,ye);if(no===null){Pe===null&&(Pe=on);break}a&&Pe&&no.alternate===null&&c(te,Pe),H=I(no,H,ze),Le===null?De=no:Le.sibling=no,Le=no,Pe=on}if(nt.done)return p(te,Pe),St&&Do(te,ze),De;if(Pe===null){for(;!nt.done;ze++,nt=se.next())nt=ge(te,nt.value,ye),nt!==null&&(H=I(nt,H,ze),Le===null?De=nt:Le.sibling=nt,Le=nt);return St&&Do(te,ze),De}for(Pe=x(te,Pe);!nt.done;ze++,nt=se.next())nt=Ie(Pe,te,ze,nt.value,ye),nt!==null&&(a&&nt.alternate!==null&&Pe.delete(nt.key===null?ze:nt.key),H=I(nt,H,ze),Le===null?De=nt:Le.sibling=nt,Le=nt);return a&&Pe.forEach(function(gE){return c(te,gE)}),St&&Do(te,ze),De}function Lt(te,H,se,ye){if(typeof se=="object"&&se!==null&&se.type===O&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case N:e:{for(var De=se.key,Le=H;Le!==null;){if(Le.key===De){if(De=se.type,De===O){if(Le.tag===7){p(te,Le.sibling),H=k(Le,se.props.children),H.return=te,te=H;break e}}else if(Le.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===J&&Uy(De)===Le.type){p(te,Le.sibling),H=k(Le,se.props),H.ref=el(te,Le,se),H.return=te,te=H;break e}p(te,Le);break}else c(te,Le);Le=Le.sibling}se.type===O?(H=zo(se.props.children,te.mode,ye,se.key),H.return=te,te=H):(ye=sh(se.type,se.key,se.props,null,te.mode,ye),ye.ref=el(te,H,se),ye.return=te,te=ye)}return E(te);case R:e:{for(Le=se.key;H!==null;){if(H.key===Le)if(H.tag===4&&H.stateNode.containerInfo===se.containerInfo&&H.stateNode.implementation===se.implementation){p(te,H.sibling),H=k(H,se.children||[]),H.return=te,te=H;break e}else{p(te,H);break}else c(te,H);H=H.sibling}H=Tm(se,te.mode,ye),H.return=te,te=H}return E(te);case J:return Le=se._init,Lt(te,H,Le(se._payload),ye)}if($t(se))return Te(te,H,se,ye);if(X(se))return Ee(te,H,se,ye);Fc(te,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,H!==null&&H.tag===6?(p(te,H.sibling),H=k(H,se),H.return=te,te=H):(p(te,H),H=Nm(se,te.mode,ye),H.return=te,te=H),E(te)):p(te,H)}return Lt}var _i=Gy(!0),Hy=Gy(!1),_c=Hr(null),Oc=null,Oi=null,Pp=null;function Mp(){Pp=Oi=Oc=null}function zp(a){var c=_c.current;kt(_c),a._currentValue=c}function Bp(a,c,p){for(;a!==null;){var x=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,x!==null&&(x.childLanes|=c)):x!==null&&(x.childLanes&c)!==c&&(x.childLanes|=c),a===p)break;a=a.return}}function Li(a,c){Oc=a,Pp=Oi=null,a=a.dependencies,a!==null&&a.firstContext!==null&&(a.lanes&c&&(Wn=!0),a.firstContext=null)}function ms(a){var c=a._currentValue;if(Pp!==a)if(a={context:a,memoizedValue:c,next:null},Oi===null){if(Oc===null)throw Error(t(308));Oi=a,Oc.dependencies={lanes:0,firstContext:a}}else Oi=Oi.next=a;return c}var Ao=null;function Vp(a){Ao===null?Ao=[a]:Ao.push(a)}function jy(a,c,p,x){var k=c.interleaved;return k===null?(p.next=p,Vp(c)):(p.next=k.next,k.next=p),c.interleaved=p,Cr(a,x)}function Cr(a,c){a.lanes|=c;var p=a.alternate;for(p!==null&&(p.lanes|=c),p=a,a=a.return;a!==null;)a.childLanes|=c,p=a.alternate,p!==null&&(p.childLanes|=c),p=a,a=a.return;return p.tag===3?p.stateNode:null}var qr=!1;function Wp(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ky(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Ir(a,c){return{eventTime:a,lane:c,tag:0,payload:null,callback:null,next:null}}function Xr(a,c,p){var x=a.updateQueue;if(x===null)return null;if(x=x.shared,Je&2){var k=x.pending;return k===null?c.next=c:(c.next=k.next,k.next=c),x.pending=c,Cr(a,p)}return k=x.interleaved,k===null?(c.next=c,Vp(x)):(c.next=k.next,k.next=c),x.interleaved=c,Cr(a,p)}function Lc(a,c,p){if(c=c.updateQueue,c!==null&&(c=c.shared,(p&4194240)!==0)){var x=c.lanes;x&=a.pendingLanes,p|=x,c.lanes=p,np(a,p)}}function qy(a,c){var p=a.updateQueue,x=a.alternate;if(x!==null&&(x=x.updateQueue,p===x)){var k=null,I=null;if(p=p.firstBaseUpdate,p!==null){do{var E={eventTime:p.eventTime,lane:p.lane,tag:p.tag,payload:p.payload,callback:p.callback,next:null};I===null?k=I=E:I=I.next=E,p=p.next}while(p!==null);I===null?k=I=c:I=I.next=c}else k=I=c;p={baseState:x.baseState,firstBaseUpdate:k,lastBaseUpdate:I,shared:x.shared,effects:x.effects},a.updateQueue=p;return}a=p.lastBaseUpdate,a===null?p.firstBaseUpdate=c:a.next=c,p.lastBaseUpdate=c}function Pc(a,c,p,x){var k=a.updateQueue;qr=!1;var I=k.firstBaseUpdate,E=k.lastBaseUpdate,P=k.shared.pending;if(P!==null){k.shared.pending=null;var V=P,oe=V.next;V.next=null,E===null?I=oe:E.next=oe,E=V;var me=a.alternate;me!==null&&(me=me.updateQueue,P=me.lastBaseUpdate,P!==E&&(P===null?me.firstBaseUpdate=oe:P.next=oe,me.lastBaseUpdate=V))}if(I!==null){var ge=k.baseState;E=0,me=oe=V=null,P=I;do{var pe=P.lane,Ie=P.eventTime;if((x&pe)===pe){me!==null&&(me=me.next={eventTime:Ie,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var Te=a,Ee=P;switch(pe=c,Ie=p,Ee.tag){case 1:if(Te=Ee.payload,typeof Te=="function"){ge=Te.call(Ie,ge,pe);break e}ge=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=Ee.payload,pe=typeof Te=="function"?Te.call(Ie,ge,pe):Te,pe==null)break e;ge=Y({},ge,pe);break e;case 2:qr=!0}}P.callback!==null&&P.lane!==0&&(a.flags|=64,pe=k.effects,pe===null?k.effects=[P]:pe.push(P))}else Ie={eventTime:Ie,lane:pe,tag:P.tag,payload:P.payload,callback:P.callback,next:null},me===null?(oe=me=Ie,V=ge):me=me.next=Ie,E|=pe;if(P=P.next,P===null){if(P=k.shared.pending,P===null)break;pe=P,P=pe.next,pe.next=null,k.lastBaseUpdate=pe,k.shared.pending=null}}while(!0);if(me===null&&(V=ge),k.baseState=V,k.firstBaseUpdate=oe,k.lastBaseUpdate=me,c=k.shared.interleaved,c!==null){k=c;do E|=k.lane,k=k.next;while(k!==c)}else I===null&&(k.shared.lanes=0);Oo|=E,a.lanes=E,a.memoizedState=ge}}function Xy(a,c,p){if(a=c.effects,c.effects=null,a!==null)for(c=0;c<a.length;c++){var x=a[c],k=x.callback;if(k!==null){if(x.callback=null,x=p,typeof k!="function")throw Error(t(191,k));k.call(x)}}}var tl={},Js=Hr(tl),nl=Hr(tl),sl=Hr(tl);function Fo(a){if(a===tl)throw Error(t(174));return a}function Up(a,c){switch(xt(sl,c),xt(nl,a),xt(Js,tl),a=c.nodeType,a){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:ds(null,"");break;default:a=a===8?c.parentNode:c,c=a.namespaceURI||null,a=a.tagName,c=ds(c,a)}kt(Js),xt(Js,c)}function Pi(){kt(Js),kt(nl),kt(sl)}function Yy(a){Fo(sl.current);var c=Fo(Js.current),p=ds(c,a.type);c!==p&&(xt(nl,a),xt(Js,p))}function Gp(a){nl.current===a&&(kt(Js),kt(nl))}var Et=Hr(0);function Mc(a){for(var c=a;c!==null;){if(c.tag===13){var p=c.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||p.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if(c.flags&128)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Hp=[];function jp(){for(var a=0;a<Hp.length;a++)Hp[a]._workInProgressVersionPrimary=null;Hp.length=0}var zc=$.ReactCurrentDispatcher,Kp=$.ReactCurrentBatchConfig,_o=0,Rt=null,qt=null,sn=null,Bc=!1,rl=!1,ol=0,MT=0;function wn(){throw Error(t(321))}function qp(a,c){if(c===null)return!1;for(var p=0;p<c.length&&p<a.length;p++)if(!Fs(a[p],c[p]))return!1;return!0}function Xp(a,c,p,x,k,I){if(_o=I,Rt=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,zc.current=a===null||a.memoizedState===null?WT:UT,a=p(x,k),rl){I=0;do{if(rl=!1,ol=0,25<=I)throw Error(t(301));I+=1,sn=qt=null,c.updateQueue=null,zc.current=GT,a=p(x,k)}while(rl)}if(zc.current=Uc,c=qt!==null&&qt.next!==null,_o=0,sn=qt=Rt=null,Bc=!1,c)throw Error(t(300));return a}function Yp(){var a=ol!==0;return ol=0,a}function er(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Rt.memoizedState=sn=a:sn=sn.next=a,sn}function gs(){if(qt===null){var a=Rt.alternate;a=a!==null?a.memoizedState:null}else a=qt.next;var c=sn===null?Rt.memoizedState:sn.next;if(c!==null)sn=c,qt=a;else{if(a===null)throw Error(t(310));qt=a,a={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},sn===null?Rt.memoizedState=sn=a:sn=sn.next=a}return sn}function il(a,c){return typeof c=="function"?c(a):c}function Qp(a){var c=gs(),p=c.queue;if(p===null)throw Error(t(311));p.lastRenderedReducer=a;var x=qt,k=x.baseQueue,I=p.pending;if(I!==null){if(k!==null){var E=k.next;k.next=I.next,I.next=E}x.baseQueue=k=I,p.pending=null}if(k!==null){I=k.next,x=x.baseState;var P=E=null,V=null,oe=I;do{var me=oe.lane;if((_o&me)===me)V!==null&&(V=V.next={lane:0,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),x=oe.hasEagerState?oe.eagerState:a(x,oe.action);else{var ge={lane:me,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null};V===null?(P=V=ge,E=x):V=V.next=ge,Rt.lanes|=me,Oo|=me}oe=oe.next}while(oe!==null&&oe!==I);V===null?E=x:V.next=P,Fs(x,c.memoizedState)||(Wn=!0),c.memoizedState=x,c.baseState=E,c.baseQueue=V,p.lastRenderedState=x}if(a=p.interleaved,a!==null){k=a;do I=k.lane,Rt.lanes|=I,Oo|=I,k=k.next;while(k!==a)}else k===null&&(p.lanes=0);return[c.memoizedState,p.dispatch]}function Zp(a){var c=gs(),p=c.queue;if(p===null)throw Error(t(311));p.lastRenderedReducer=a;var x=p.dispatch,k=p.pending,I=c.memoizedState;if(k!==null){p.pending=null;var E=k=k.next;do I=a(I,E.action),E=E.next;while(E!==k);Fs(I,c.memoizedState)||(Wn=!0),c.memoizedState=I,c.baseQueue===null&&(c.baseState=I),p.lastRenderedState=I}return[I,x]}function Qy(){}function Zy(a,c){var p=Rt,x=gs(),k=c(),I=!Fs(x.memoizedState,k);if(I&&(x.memoizedState=k,Wn=!0),x=x.queue,Jp(tw.bind(null,p,x,a),[a]),x.getSnapshot!==c||I||sn!==null&&sn.memoizedState.tag&1){if(p.flags|=2048,al(9,ew.bind(null,p,x,k,c),void 0,null),rn===null)throw Error(t(349));_o&30||Jy(p,c,k)}return k}function Jy(a,c,p){a.flags|=16384,a={getSnapshot:c,value:p},c=Rt.updateQueue,c===null?(c={lastEffect:null,stores:null},Rt.updateQueue=c,c.stores=[a]):(p=c.stores,p===null?c.stores=[a]:p.push(a))}function ew(a,c,p,x){c.value=p,c.getSnapshot=x,nw(c)&&sw(a)}function tw(a,c,p){return p(function(){nw(c)&&sw(a)})}function nw(a){var c=a.getSnapshot;a=a.value;try{var p=c();return!Fs(a,p)}catch{return!0}}function sw(a){var c=Cr(a,1);c!==null&&Ms(c,a,1,-1)}function rw(a){var c=er();return typeof a=="function"&&(a=a()),c.memoizedState=c.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:il,lastRenderedState:a},c.queue=a,a=a.dispatch=VT.bind(null,Rt,a),[c.memoizedState,a]}function al(a,c,p,x){return a={tag:a,create:c,destroy:p,deps:x,next:null},c=Rt.updateQueue,c===null?(c={lastEffect:null,stores:null},Rt.updateQueue=c,c.lastEffect=a.next=a):(p=c.lastEffect,p===null?c.lastEffect=a.next=a:(x=p.next,p.next=a,a.next=x,c.lastEffect=a)),a}function ow(){return gs().memoizedState}function Vc(a,c,p,x){var k=er();Rt.flags|=a,k.memoizedState=al(1|c,p,void 0,x===void 0?null:x)}function Wc(a,c,p,x){var k=gs();x=x===void 0?null:x;var I=void 0;if(qt!==null){var E=qt.memoizedState;if(I=E.destroy,x!==null&&qp(x,E.deps)){k.memoizedState=al(c,p,I,x);return}}Rt.flags|=a,k.memoizedState=al(1|c,p,I,x)}function iw(a,c){return Vc(8390656,8,a,c)}function Jp(a,c){return Wc(2048,8,a,c)}function aw(a,c){return Wc(4,2,a,c)}function lw(a,c){return Wc(4,4,a,c)}function uw(a,c){if(typeof c=="function")return a=a(),c(a),function(){c(null)};if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function cw(a,c,p){return p=p!=null?p.concat([a]):null,Wc(4,4,uw.bind(null,c,a),p)}function em(){}function hw(a,c){var p=gs();c=c===void 0?null:c;var x=p.memoizedState;return x!==null&&c!==null&&qp(c,x[1])?x[0]:(p.memoizedState=[a,c],a)}function dw(a,c){var p=gs();c=c===void 0?null:c;var x=p.memoizedState;return x!==null&&c!==null&&qp(c,x[1])?x[0]:(a=a(),p.memoizedState=[a,c],a)}function fw(a,c,p){return _o&21?(Fs(p,c)||(p=U1(),Rt.lanes|=p,Oo|=p,a.baseState=!0),c):(a.baseState&&(a.baseState=!1,Wn=!0),a.memoizedState=p)}function zT(a,c){var p=ut;ut=p!==0&&4>p?p:4,a(!0);var x=Kp.transition;Kp.transition={};try{a(!1),c()}finally{ut=p,Kp.transition=x}}function pw(){return gs().memoizedState}function BT(a,c,p){var x=Jr(a);if(p={lane:x,action:p,hasEagerState:!1,eagerState:null,next:null},mw(a))gw(c,p);else if(p=jy(a,c,p,x),p!==null){var k=An();Ms(p,a,x,k),xw(p,c,x)}}function VT(a,c,p){var x=Jr(a),k={lane:x,action:p,hasEagerState:!1,eagerState:null,next:null};if(mw(a))gw(c,k);else{var I=a.alternate;if(a.lanes===0&&(I===null||I.lanes===0)&&(I=c.lastRenderedReducer,I!==null))try{var E=c.lastRenderedState,P=I(E,p);if(k.hasEagerState=!0,k.eagerState=P,Fs(P,E)){var V=c.interleaved;V===null?(k.next=k,Vp(c)):(k.next=V.next,V.next=k),c.interleaved=k;return}}catch{}finally{}p=jy(a,c,k,x),p!==null&&(k=An(),Ms(p,a,x,k),xw(p,c,x))}}function mw(a){var c=a.alternate;return a===Rt||c!==null&&c===Rt}function gw(a,c){rl=Bc=!0;var p=a.pending;p===null?c.next=c:(c.next=p.next,p.next=c),a.pending=c}function xw(a,c,p){if(p&4194240){var x=c.lanes;x&=a.pendingLanes,p|=x,c.lanes=p,np(a,p)}}var Uc={readContext:ms,useCallback:wn,useContext:wn,useEffect:wn,useImperativeHandle:wn,useInsertionEffect:wn,useLayoutEffect:wn,useMemo:wn,useReducer:wn,useRef:wn,useState:wn,useDebugValue:wn,useDeferredValue:wn,useTransition:wn,useMutableSource:wn,useSyncExternalStore:wn,useId:wn,unstable_isNewReconciler:!1},WT={readContext:ms,useCallback:function(a,c){return er().memoizedState=[a,c===void 0?null:c],a},useContext:ms,useEffect:iw,useImperativeHandle:function(a,c,p){return p=p!=null?p.concat([a]):null,Vc(4194308,4,uw.bind(null,c,a),p)},useLayoutEffect:function(a,c){return Vc(4194308,4,a,c)},useInsertionEffect:function(a,c){return Vc(4,2,a,c)},useMemo:function(a,c){var p=er();return c=c===void 0?null:c,a=a(),p.memoizedState=[a,c],a},useReducer:function(a,c,p){var x=er();return c=p!==void 0?p(c):c,x.memoizedState=x.baseState=c,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:c},x.queue=a,a=a.dispatch=BT.bind(null,Rt,a),[x.memoizedState,a]},useRef:function(a){var c=er();return a={current:a},c.memoizedState=a},useState:rw,useDebugValue:em,useDeferredValue:function(a){return er().memoizedState=a},useTransition:function(){var a=rw(!1),c=a[0];return a=zT.bind(null,a[1]),er().memoizedState=a,[c,a]},useMutableSource:function(){},useSyncExternalStore:function(a,c,p){var x=Rt,k=er();if(St){if(p===void 0)throw Error(t(407));p=p()}else{if(p=c(),rn===null)throw Error(t(349));_o&30||Jy(x,c,p)}k.memoizedState=p;var I={value:p,getSnapshot:c};return k.queue=I,iw(tw.bind(null,x,I,a),[a]),x.flags|=2048,al(9,ew.bind(null,x,I,p,c),void 0,null),p},useId:function(){var a=er(),c=rn.identifierPrefix;if(St){var p=kr,x=br;p=(x&~(1<<32-As(x)-1)).toString(32)+p,c=":"+c+"R"+p,p=ol++,0<p&&(c+="H"+p.toString(32)),c+=":"}else p=MT++,c=":"+c+"r"+p.toString(32)+":";return a.memoizedState=c},unstable_isNewReconciler:!1},UT={readContext:ms,useCallback:hw,useContext:ms,useEffect:Jp,useImperativeHandle:cw,useInsertionEffect:aw,useLayoutEffect:lw,useMemo:dw,useReducer:Qp,useRef:ow,useState:function(){return Qp(il)},useDebugValue:em,useDeferredValue:function(a){var c=gs();return fw(c,qt.memoizedState,a)},useTransition:function(){var a=Qp(il)[0],c=gs().memoizedState;return[a,c]},useMutableSource:Qy,useSyncExternalStore:Zy,useId:pw,unstable_isNewReconciler:!1},GT={readContext:ms,useCallback:hw,useContext:ms,useEffect:Jp,useImperativeHandle:cw,useInsertionEffect:aw,useLayoutEffect:lw,useMemo:dw,useReducer:Zp,useRef:ow,useState:function(){return Zp(il)},useDebugValue:em,useDeferredValue:function(a){var c=gs();return qt===null?c.memoizedState=a:fw(c,qt.memoizedState,a)},useTransition:function(){var a=Zp(il)[0],c=gs().memoizedState;return[a,c]},useMutableSource:Qy,useSyncExternalStore:Zy,useId:pw,unstable_isNewReconciler:!1};function Os(a,c){if(a&&a.defaultProps){c=Y({},c),a=a.defaultProps;for(var p in a)c[p]===void 0&&(c[p]=a[p]);return c}return c}function tm(a,c,p,x){c=a.memoizedState,p=p(x,c),p=p==null?c:Y({},c,p),a.memoizedState=p,a.lanes===0&&(a.updateQueue.baseState=p)}var Gc={isMounted:function(a){return(a=a._reactInternals)?No(a)===a:!1},enqueueSetState:function(a,c,p){a=a._reactInternals;var x=An(),k=Jr(a),I=Ir(x,k);I.payload=c,p!=null&&(I.callback=p),c=Xr(a,I,k),c!==null&&(Ms(c,a,k,x),Lc(c,a,k))},enqueueReplaceState:function(a,c,p){a=a._reactInternals;var x=An(),k=Jr(a),I=Ir(x,k);I.tag=1,I.payload=c,p!=null&&(I.callback=p),c=Xr(a,I,k),c!==null&&(Ms(c,a,k,x),Lc(c,a,k))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var p=An(),x=Jr(a),k=Ir(p,x);k.tag=2,c!=null&&(k.callback=c),c=Xr(a,k,x),c!==null&&(Ms(c,a,x,p),Lc(c,a,x))}};function yw(a,c,p,x,k,I,E){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(x,I,E):c.prototype&&c.prototype.isPureReactComponent?!Ka(p,x)||!Ka(k,I):!0}function ww(a,c,p){var x=!1,k=jr,I=c.contextType;return typeof I=="object"&&I!==null?I=ms(I):(k=Vn(c)?Eo:yn.current,x=c.contextTypes,I=(x=x!=null)?Ri(a,k):jr),c=new c(p,I),a.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Gc,a.stateNode=c,c._reactInternals=a,x&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=k,a.__reactInternalMemoizedMaskedChildContext=I),c}function vw(a,c,p,x){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(p,x),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(p,x),c.state!==a&&Gc.enqueueReplaceState(c,c.state,null)}function nm(a,c,p,x){var k=a.stateNode;k.props=p,k.state=a.memoizedState,k.refs={},Wp(a);var I=c.contextType;typeof I=="object"&&I!==null?k.context=ms(I):(I=Vn(c)?Eo:yn.current,k.context=Ri(a,I)),k.state=a.memoizedState,I=c.getDerivedStateFromProps,typeof I=="function"&&(tm(a,c,I,p),k.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(c=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),c!==k.state&&Gc.enqueueReplaceState(k,k.state,null),Pc(a,p,k,x),k.state=a.memoizedState),typeof k.componentDidMount=="function"&&(a.flags|=4194308)}function Mi(a,c){try{var p="",x=c;do p+=he(x),x=x.return;while(x);var k=p}catch(I){k=`
Error generating stack: `+I.message+`
`+I.stack}return{value:a,source:c,stack:k,digest:null}}function sm(a,c,p){return{value:a,source:null,stack:p??null,digest:c??null}}function rm(a,c){try{console.error(c.value)}catch(p){setTimeout(function(){throw p})}}var HT=typeof WeakMap=="function"?WeakMap:Map;function bw(a,c,p){p=Ir(-1,p),p.tag=3,p.payload={element:null};var x=c.value;return p.callback=function(){Qc||(Qc=!0,wm=x),rm(a,c)},p}function kw(a,c,p){p=Ir(-1,p),p.tag=3;var x=a.type.getDerivedStateFromError;if(typeof x=="function"){var k=c.value;p.payload=function(){return x(k)},p.callback=function(){rm(a,c)}}var I=a.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(p.callback=function(){rm(a,c),typeof x!="function"&&(Qr===null?Qr=new Set([this]):Qr.add(this));var E=c.stack;this.componentDidCatch(c.value,{componentStack:E!==null?E:""})}),p}function Cw(a,c,p){var x=a.pingCache;if(x===null){x=a.pingCache=new HT;var k=new Set;x.set(c,k)}else k=x.get(c),k===void 0&&(k=new Set,x.set(c,k));k.has(p)||(k.add(p),a=oE.bind(null,a,c,p),c.then(a,a))}function Iw(a){do{var c;if((c=a.tag===13)&&(c=a.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return a;a=a.return}while(a!==null);return null}function $w(a,c,p,x,k){return a.mode&1?(a.flags|=65536,a.lanes=k,a):(a===c?a.flags|=65536:(a.flags|=128,p.flags|=131072,p.flags&=-52805,p.tag===1&&(p.alternate===null?p.tag=17:(c=Ir(-1,1),c.tag=2,Xr(p,c,1))),p.lanes|=1),a)}var jT=$.ReactCurrentOwner,Wn=!1;function Dn(a,c,p,x){c.child=a===null?Hy(c,null,p,x):_i(c,a.child,p,x)}function Sw(a,c,p,x,k){p=p.render;var I=c.ref;return Li(c,k),x=Xp(a,c,p,x,I,k),p=Yp(),a!==null&&!Wn?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~k,$r(a,c,k)):(St&&p&&Ap(c),c.flags|=1,Dn(a,c,x,k),c.child)}function Nw(a,c,p,x,k){if(a===null){var I=p.type;return typeof I=="function"&&!Sm(I)&&I.defaultProps===void 0&&p.compare===null&&p.defaultProps===void 0?(c.tag=15,c.type=I,Tw(a,c,I,x,k)):(a=sh(p.type,null,x,c,c.mode,k),a.ref=c.ref,a.return=c,c.child=a)}if(I=a.child,!(a.lanes&k)){var E=I.memoizedProps;if(p=p.compare,p=p!==null?p:Ka,p(E,x)&&a.ref===c.ref)return $r(a,c,k)}return c.flags|=1,a=to(I,x),a.ref=c.ref,a.return=c,c.child=a}function Tw(a,c,p,x,k){if(a!==null){var I=a.memoizedProps;if(Ka(I,x)&&a.ref===c.ref)if(Wn=!1,c.pendingProps=x=I,(a.lanes&k)!==0)a.flags&131072&&(Wn=!0);else return c.lanes=a.lanes,$r(a,c,k)}return om(a,c,p,x,k)}function Ew(a,c,p){var x=c.pendingProps,k=x.children,I=a!==null?a.memoizedState:null;if(x.mode==="hidden")if(!(c.mode&1))c.memoizedState={baseLanes:0,cachePool:null,transitions:null},xt(Bi,ss),ss|=p;else{if(!(p&1073741824))return a=I!==null?I.baseLanes|p:p,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:a,cachePool:null,transitions:null},c.updateQueue=null,xt(Bi,ss),ss|=a,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=I!==null?I.baseLanes:p,xt(Bi,ss),ss|=x}else I!==null?(x=I.baseLanes|p,c.memoizedState=null):x=p,xt(Bi,ss),ss|=x;return Dn(a,c,k,p),c.child}function Rw(a,c){var p=c.ref;(a===null&&p!==null||a!==null&&a.ref!==p)&&(c.flags|=512,c.flags|=2097152)}function om(a,c,p,x,k){var I=Vn(p)?Eo:yn.current;return I=Ri(c,I),Li(c,k),p=Xp(a,c,p,x,I,k),x=Yp(),a!==null&&!Wn?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~k,$r(a,c,k)):(St&&x&&Ap(c),c.flags|=1,Dn(a,c,p,k),c.child)}function Dw(a,c,p,x,k){if(Vn(p)){var I=!0;Tc(c)}else I=!1;if(Li(c,k),c.stateNode===null)jc(a,c),ww(c,p,x),nm(c,p,x,k),x=!0;else if(a===null){var E=c.stateNode,P=c.memoizedProps;E.props=P;var V=E.context,oe=p.contextType;typeof oe=="object"&&oe!==null?oe=ms(oe):(oe=Vn(p)?Eo:yn.current,oe=Ri(c,oe));var me=p.getDerivedStateFromProps,ge=typeof me=="function"||typeof E.getSnapshotBeforeUpdate=="function";ge||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(P!==x||V!==oe)&&vw(c,E,x,oe),qr=!1;var pe=c.memoizedState;E.state=pe,Pc(c,x,E,k),V=c.memoizedState,P!==x||pe!==V||Bn.current||qr?(typeof me=="function"&&(tm(c,p,me,x),V=c.memoizedState),(P=qr||yw(c,p,P,x,pe,V,oe))?(ge||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(c.flags|=4194308)):(typeof E.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=x,c.memoizedState=V),E.props=x,E.state=V,E.context=oe,x=P):(typeof E.componentDidMount=="function"&&(c.flags|=4194308),x=!1)}else{E=c.stateNode,Ky(a,c),P=c.memoizedProps,oe=c.type===c.elementType?P:Os(c.type,P),E.props=oe,ge=c.pendingProps,pe=E.context,V=p.contextType,typeof V=="object"&&V!==null?V=ms(V):(V=Vn(p)?Eo:yn.current,V=Ri(c,V));var Ie=p.getDerivedStateFromProps;(me=typeof Ie=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(P!==ge||pe!==V)&&vw(c,E,x,V),qr=!1,pe=c.memoizedState,E.state=pe,Pc(c,x,E,k);var Te=c.memoizedState;P!==ge||pe!==Te||Bn.current||qr?(typeof Ie=="function"&&(tm(c,p,Ie,x),Te=c.memoizedState),(oe=qr||yw(c,p,oe,x,pe,Te,V)||!1)?(me||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(x,Te,V),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(x,Te,V)),typeof E.componentDidUpdate=="function"&&(c.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof E.componentDidUpdate!="function"||P===a.memoizedProps&&pe===a.memoizedState||(c.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===a.memoizedProps&&pe===a.memoizedState||(c.flags|=1024),c.memoizedProps=x,c.memoizedState=Te),E.props=x,E.state=Te,E.context=V,x=oe):(typeof E.componentDidUpdate!="function"||P===a.memoizedProps&&pe===a.memoizedState||(c.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===a.memoizedProps&&pe===a.memoizedState||(c.flags|=1024),x=!1)}return im(a,c,p,x,I,k)}function im(a,c,p,x,k,I){Rw(a,c);var E=(c.flags&128)!==0;if(!x&&!E)return k&&Ly(c,p,!1),$r(a,c,I);x=c.stateNode,jT.current=c;var P=E&&typeof p.getDerivedStateFromError!="function"?null:x.render();return c.flags|=1,a!==null&&E?(c.child=_i(c,a.child,null,I),c.child=_i(c,null,P,I)):Dn(a,c,P,I),c.memoizedState=x.state,k&&Ly(c,p,!0),c.child}function Aw(a){var c=a.stateNode;c.pendingContext?_y(a,c.pendingContext,c.pendingContext!==c.context):c.context&&_y(a,c.context,!1),Up(a,c.containerInfo)}function Fw(a,c,p,x,k){return Fi(),Lp(k),c.flags|=256,Dn(a,c,p,x),c.child}var am={dehydrated:null,treeContext:null,retryLane:0};function lm(a){return{baseLanes:a,cachePool:null,transitions:null}}function _w(a,c,p){var x=c.pendingProps,k=Et.current,I=!1,E=(c.flags&128)!==0,P;if((P=E)||(P=a!==null&&a.memoizedState===null?!1:(k&2)!==0),P?(I=!0,c.flags&=-129):(a===null||a.memoizedState!==null)&&(k|=1),xt(Et,k&1),a===null)return Op(c),a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?(c.mode&1?a.data==="$!"?c.lanes=8:c.lanes=1073741824:c.lanes=1,null):(E=x.children,a=x.fallback,I?(x=c.mode,I=c.child,E={mode:"hidden",children:E},!(x&1)&&I!==null?(I.childLanes=0,I.pendingProps=E):I=rh(E,x,0,null),a=zo(a,x,p,null),I.return=c,a.return=c,I.sibling=a,c.child=I,c.child.memoizedState=lm(p),c.memoizedState=am,a):um(c,E));if(k=a.memoizedState,k!==null&&(P=k.dehydrated,P!==null))return KT(a,c,E,x,P,k,p);if(I){I=x.fallback,E=c.mode,k=a.child,P=k.sibling;var V={mode:"hidden",children:x.children};return!(E&1)&&c.child!==k?(x=c.child,x.childLanes=0,x.pendingProps=V,c.deletions=null):(x=to(k,V),x.subtreeFlags=k.subtreeFlags&14680064),P!==null?I=to(P,I):(I=zo(I,E,p,null),I.flags|=2),I.return=c,x.return=c,x.sibling=I,c.child=x,x=I,I=c.child,E=a.child.memoizedState,E=E===null?lm(p):{baseLanes:E.baseLanes|p,cachePool:null,transitions:E.transitions},I.memoizedState=E,I.childLanes=a.childLanes&~p,c.memoizedState=am,x}return I=a.child,a=I.sibling,x=to(I,{mode:"visible",children:x.children}),!(c.mode&1)&&(x.lanes=p),x.return=c,x.sibling=null,a!==null&&(p=c.deletions,p===null?(c.deletions=[a],c.flags|=16):p.push(a)),c.child=x,c.memoizedState=null,x}function um(a,c){return c=rh({mode:"visible",children:c},a.mode,0,null),c.return=a,a.child=c}function Hc(a,c,p,x){return x!==null&&Lp(x),_i(c,a.child,null,p),a=um(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function KT(a,c,p,x,k,I,E){if(p)return c.flags&256?(c.flags&=-257,x=sm(Error(t(422))),Hc(a,c,E,x)):c.memoizedState!==null?(c.child=a.child,c.flags|=128,null):(I=x.fallback,k=c.mode,x=rh({mode:"visible",children:x.children},k,0,null),I=zo(I,k,E,null),I.flags|=2,x.return=c,I.return=c,x.sibling=I,c.child=x,c.mode&1&&_i(c,a.child,null,E),c.child.memoizedState=lm(E),c.memoizedState=am,I);if(!(c.mode&1))return Hc(a,c,E,null);if(k.data==="$!"){if(x=k.nextSibling&&k.nextSibling.dataset,x)var P=x.dgst;return x=P,I=Error(t(419)),x=sm(I,x,void 0),Hc(a,c,E,x)}if(P=(E&a.childLanes)!==0,Wn||P){if(x=rn,x!==null){switch(E&-E){case 4:k=2;break;case 16:k=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:k=32;break;case 536870912:k=268435456;break;default:k=0}k=k&(x.suspendedLanes|E)?0:k,k!==0&&k!==I.retryLane&&(I.retryLane=k,Cr(a,k),Ms(x,a,k,-1))}return $m(),x=sm(Error(t(421))),Hc(a,c,E,x)}return k.data==="$?"?(c.flags|=128,c.child=a.child,c=iE.bind(null,a),k._reactRetry=c,null):(a=I.treeContext,ns=Gr(k.nextSibling),ts=c,St=!0,_s=null,a!==null&&(fs[ps++]=br,fs[ps++]=kr,fs[ps++]=Ro,br=a.id,kr=a.overflow,Ro=c),c=um(c,x.children),c.flags|=4096,c)}function Ow(a,c,p){a.lanes|=c;var x=a.alternate;x!==null&&(x.lanes|=c),Bp(a.return,c,p)}function cm(a,c,p,x,k){var I=a.memoizedState;I===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:x,tail:p,tailMode:k}:(I.isBackwards=c,I.rendering=null,I.renderingStartTime=0,I.last=x,I.tail=p,I.tailMode=k)}function Lw(a,c,p){var x=c.pendingProps,k=x.revealOrder,I=x.tail;if(Dn(a,c,x.children,p),x=Et.current,x&2)x=x&1|2,c.flags|=128;else{if(a!==null&&a.flags&128)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Ow(a,p,c);else if(a.tag===19)Ow(a,p,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}x&=1}if(xt(Et,x),!(c.mode&1))c.memoizedState=null;else switch(k){case"forwards":for(p=c.child,k=null;p!==null;)a=p.alternate,a!==null&&Mc(a)===null&&(k=p),p=p.sibling;p=k,p===null?(k=c.child,c.child=null):(k=p.sibling,p.sibling=null),cm(c,!1,k,p,I);break;case"backwards":for(p=null,k=c.child,c.child=null;k!==null;){if(a=k.alternate,a!==null&&Mc(a)===null){c.child=k;break}a=k.sibling,k.sibling=p,p=k,k=a}cm(c,!0,p,null,I);break;case"together":cm(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function jc(a,c){!(c.mode&1)&&a!==null&&(a.alternate=null,c.alternate=null,c.flags|=2)}function $r(a,c,p){if(a!==null&&(c.dependencies=a.dependencies),Oo|=c.lanes,!(p&c.childLanes))return null;if(a!==null&&c.child!==a.child)throw Error(t(153));if(c.child!==null){for(a=c.child,p=to(a,a.pendingProps),c.child=p,p.return=c;a.sibling!==null;)a=a.sibling,p=p.sibling=to(a,a.pendingProps),p.return=c;p.sibling=null}return c.child}function qT(a,c,p){switch(c.tag){case 3:Aw(c),Fi();break;case 5:Yy(c);break;case 1:Vn(c.type)&&Tc(c);break;case 4:Up(c,c.stateNode.containerInfo);break;case 10:var x=c.type._context,k=c.memoizedProps.value;xt(_c,x._currentValue),x._currentValue=k;break;case 13:if(x=c.memoizedState,x!==null)return x.dehydrated!==null?(xt(Et,Et.current&1),c.flags|=128,null):p&c.child.childLanes?_w(a,c,p):(xt(Et,Et.current&1),a=$r(a,c,p),a!==null?a.sibling:null);xt(Et,Et.current&1);break;case 19:if(x=(p&c.childLanes)!==0,a.flags&128){if(x)return Lw(a,c,p);c.flags|=128}if(k=c.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),xt(Et,Et.current),x)break;return null;case 22:case 23:return c.lanes=0,Ew(a,c,p)}return $r(a,c,p)}var Pw,hm,Mw,zw;Pw=function(a,c){for(var p=c.child;p!==null;){if(p.tag===5||p.tag===6)a.appendChild(p.stateNode);else if(p.tag!==4&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return;p=p.return}p.sibling.return=p.return,p=p.sibling}},hm=function(){},Mw=function(a,c,p,x){var k=a.memoizedProps;if(k!==x){a=c.stateNode,Fo(Js.current);var I=null;switch(p){case"input":k=it(a,k),x=it(a,x),I=[];break;case"select":k=Y({},k,{value:void 0}),x=Y({},x,{value:void 0}),I=[];break;case"textarea":k=dn(a,k),x=dn(a,x),I=[];break;default:typeof k.onClick!="function"&&typeof x.onClick=="function"&&(a.onclick=$c)}Hf(p,x);var E;p=null;for(oe in k)if(!x.hasOwnProperty(oe)&&k.hasOwnProperty(oe)&&k[oe]!=null)if(oe==="style"){var P=k[oe];for(E in P)P.hasOwnProperty(E)&&(p||(p={}),p[E]="")}else oe!=="dangerouslySetInnerHTML"&&oe!=="children"&&oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&oe!=="autoFocus"&&(r.hasOwnProperty(oe)?I||(I=[]):(I=I||[]).push(oe,null));for(oe in x){var V=x[oe];if(P=k!=null?k[oe]:void 0,x.hasOwnProperty(oe)&&V!==P&&(V!=null||P!=null))if(oe==="style")if(P){for(E in P)!P.hasOwnProperty(E)||V&&V.hasOwnProperty(E)||(p||(p={}),p[E]="");for(E in V)V.hasOwnProperty(E)&&P[E]!==V[E]&&(p||(p={}),p[E]=V[E])}else p||(I||(I=[]),I.push(oe,p)),p=V;else oe==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,P=P?P.__html:void 0,V!=null&&P!==V&&(I=I||[]).push(oe,V)):oe==="children"?typeof V!="string"&&typeof V!="number"||(I=I||[]).push(oe,""+V):oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&(r.hasOwnProperty(oe)?(V!=null&&oe==="onScroll"&&bt("scroll",a),I||P===V||(I=[])):(I=I||[]).push(oe,V))}p&&(I=I||[]).push("style",p);var oe=I;(c.updateQueue=oe)&&(c.flags|=4)}},zw=function(a,c,p,x){p!==x&&(c.flags|=4)};function ll(a,c){if(!St)switch(a.tailMode){case"hidden":c=a.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?a.tail=null:p.sibling=null;break;case"collapsed":p=a.tail;for(var x=null;p!==null;)p.alternate!==null&&(x=p),p=p.sibling;x===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:x.sibling=null}}function vn(a){var c=a.alternate!==null&&a.alternate.child===a.child,p=0,x=0;if(c)for(var k=a.child;k!==null;)p|=k.lanes|k.childLanes,x|=k.subtreeFlags&14680064,x|=k.flags&14680064,k.return=a,k=k.sibling;else for(k=a.child;k!==null;)p|=k.lanes|k.childLanes,x|=k.subtreeFlags,x|=k.flags,k.return=a,k=k.sibling;return a.subtreeFlags|=x,a.childLanes=p,c}function XT(a,c,p){var x=c.pendingProps;switch(Fp(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vn(c),null;case 1:return Vn(c.type)&&Nc(),vn(c),null;case 3:return x=c.stateNode,Pi(),kt(Bn),kt(yn),jp(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(a===null||a.child===null)&&(Ac(c)?c.flags|=4:a===null||a.memoizedState.isDehydrated&&!(c.flags&256)||(c.flags|=1024,_s!==null&&(km(_s),_s=null))),hm(a,c),vn(c),null;case 5:Gp(c);var k=Fo(sl.current);if(p=c.type,a!==null&&c.stateNode!=null)Mw(a,c,p,x,k),a.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!x){if(c.stateNode===null)throw Error(t(166));return vn(c),null}if(a=Fo(Js.current),Ac(c)){x=c.stateNode,p=c.type;var I=c.memoizedProps;switch(x[Zs]=c,x[Za]=I,a=(c.mode&1)!==0,p){case"dialog":bt("cancel",x),bt("close",x);break;case"iframe":case"object":case"embed":bt("load",x);break;case"video":case"audio":for(k=0;k<Xa.length;k++)bt(Xa[k],x);break;case"source":bt("error",x);break;case"img":case"image":case"link":bt("error",x),bt("load",x);break;case"details":bt("toggle",x);break;case"input":ct(x,I),bt("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!I.multiple},bt("invalid",x);break;case"textarea":Ys(x,I),bt("invalid",x)}Hf(p,I),k=null;for(var E in I)if(I.hasOwnProperty(E)){var P=I[E];E==="children"?typeof P=="string"?x.textContent!==P&&(I.suppressHydrationWarning!==!0&&Ic(x.textContent,P,a),k=["children",P]):typeof P=="number"&&x.textContent!==""+P&&(I.suppressHydrationWarning!==!0&&Ic(x.textContent,P,a),k=["children",""+P]):r.hasOwnProperty(E)&&P!=null&&E==="onScroll"&&bt("scroll",x)}switch(p){case"input":We(x),vt(x,I,!0);break;case"textarea":We(x),hs(x);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(x.onclick=$c)}x=k,c.updateQueue=x,x!==null&&(c.flags|=4)}else{E=k.nodeType===9?k:k.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=Ds(p)),a==="http://www.w3.org/1999/xhtml"?p==="script"?(a=E.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof x.is=="string"?a=E.createElement(p,{is:x.is}):(a=E.createElement(p),p==="select"&&(E=a,x.multiple?E.multiple=!0:x.size&&(E.size=x.size))):a=E.createElementNS(a,p),a[Zs]=c,a[Za]=x,Pw(a,c,!1,!1),c.stateNode=a;e:{switch(E=jf(p,x),p){case"dialog":bt("cancel",a),bt("close",a),k=x;break;case"iframe":case"object":case"embed":bt("load",a),k=x;break;case"video":case"audio":for(k=0;k<Xa.length;k++)bt(Xa[k],a);k=x;break;case"source":bt("error",a),k=x;break;case"img":case"image":case"link":bt("error",a),bt("load",a),k=x;break;case"details":bt("toggle",a),k=x;break;case"input":ct(a,x),k=it(a,x),bt("invalid",a);break;case"option":k=x;break;case"select":a._wrapperState={wasMultiple:!!x.multiple},k=Y({},x,{value:void 0}),bt("invalid",a);break;case"textarea":Ys(a,x),k=dn(a,x),bt("invalid",a);break;default:k=x}Hf(p,k),P=k;for(I in P)if(P.hasOwnProperty(I)){var V=P[I];I==="style"?sc(a,V):I==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,V!=null&&Pr(a,V)):I==="children"?typeof V=="string"?(p!=="textarea"||V!=="")&&xr(a,V):typeof V=="number"&&xr(a,""+V):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(r.hasOwnProperty(I)?V!=null&&I==="onScroll"&&bt("scroll",a):V!=null&&S(a,I,V,E))}switch(p){case"input":We(a),vt(a,x,!1);break;case"textarea":We(a),hs(a);break;case"option":x.value!=null&&a.setAttribute("value",""+ve(x.value));break;case"select":a.multiple=!!x.multiple,I=x.value,I!=null?Rn(a,!!x.multiple,I,!1):x.defaultValue!=null&&Rn(a,!!x.multiple,x.defaultValue,!0);break;default:typeof k.onClick=="function"&&(a.onclick=$c)}switch(p){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return vn(c),null;case 6:if(a&&c.stateNode!=null)zw(a,c,a.memoizedProps,x);else{if(typeof x!="string"&&c.stateNode===null)throw Error(t(166));if(p=Fo(sl.current),Fo(Js.current),Ac(c)){if(x=c.stateNode,p=c.memoizedProps,x[Zs]=c,(I=x.nodeValue!==p)&&(a=ts,a!==null))switch(a.tag){case 3:Ic(x.nodeValue,p,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Ic(x.nodeValue,p,(a.mode&1)!==0)}I&&(c.flags|=4)}else x=(p.nodeType===9?p:p.ownerDocument).createTextNode(x),x[Zs]=c,c.stateNode=x}return vn(c),null;case 13:if(kt(Et),x=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(St&&ns!==null&&c.mode&1&&!(c.flags&128))Wy(),Fi(),c.flags|=98560,I=!1;else if(I=Ac(c),x!==null&&x.dehydrated!==null){if(a===null){if(!I)throw Error(t(318));if(I=c.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(t(317));I[Zs]=c}else Fi(),!(c.flags&128)&&(c.memoizedState=null),c.flags|=4;vn(c),I=!1}else _s!==null&&(km(_s),_s=null),I=!0;if(!I)return c.flags&65536?c:null}return c.flags&128?(c.lanes=p,c):(x=x!==null,x!==(a!==null&&a.memoizedState!==null)&&x&&(c.child.flags|=8192,c.mode&1&&(a===null||Et.current&1?Xt===0&&(Xt=3):$m())),c.updateQueue!==null&&(c.flags|=4),vn(c),null);case 4:return Pi(),hm(a,c),a===null&&Ya(c.stateNode.containerInfo),vn(c),null;case 10:return zp(c.type._context),vn(c),null;case 17:return Vn(c.type)&&Nc(),vn(c),null;case 19:if(kt(Et),I=c.memoizedState,I===null)return vn(c),null;if(x=(c.flags&128)!==0,E=I.rendering,E===null)if(x)ll(I,!1);else{if(Xt!==0||a!==null&&a.flags&128)for(a=c.child;a!==null;){if(E=Mc(a),E!==null){for(c.flags|=128,ll(I,!1),x=E.updateQueue,x!==null&&(c.updateQueue=x,c.flags|=4),c.subtreeFlags=0,x=p,p=c.child;p!==null;)I=p,a=x,I.flags&=14680066,E=I.alternate,E===null?(I.childLanes=0,I.lanes=a,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=E.childLanes,I.lanes=E.lanes,I.child=E.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=E.memoizedProps,I.memoizedState=E.memoizedState,I.updateQueue=E.updateQueue,I.type=E.type,a=E.dependencies,I.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),p=p.sibling;return xt(Et,Et.current&1|2),c.child}a=a.sibling}I.tail!==null&&Ot()>Vi&&(c.flags|=128,x=!0,ll(I,!1),c.lanes=4194304)}else{if(!x)if(a=Mc(E),a!==null){if(c.flags|=128,x=!0,p=a.updateQueue,p!==null&&(c.updateQueue=p,c.flags|=4),ll(I,!0),I.tail===null&&I.tailMode==="hidden"&&!E.alternate&&!St)return vn(c),null}else 2*Ot()-I.renderingStartTime>Vi&&p!==1073741824&&(c.flags|=128,x=!0,ll(I,!1),c.lanes=4194304);I.isBackwards?(E.sibling=c.child,c.child=E):(p=I.last,p!==null?p.sibling=E:c.child=E,I.last=E)}return I.tail!==null?(c=I.tail,I.rendering=c,I.tail=c.sibling,I.renderingStartTime=Ot(),c.sibling=null,p=Et.current,xt(Et,x?p&1|2:p&1),c):(vn(c),null);case 22:case 23:return Im(),x=c.memoizedState!==null,a!==null&&a.memoizedState!==null!==x&&(c.flags|=8192),x&&c.mode&1?ss&1073741824&&(vn(c),c.subtreeFlags&6&&(c.flags|=8192)):vn(c),null;case 24:return null;case 25:return null}throw Error(t(156,c.tag))}function YT(a,c){switch(Fp(c),c.tag){case 1:return Vn(c.type)&&Nc(),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return Pi(),kt(Bn),kt(yn),jp(),a=c.flags,a&65536&&!(a&128)?(c.flags=a&-65537|128,c):null;case 5:return Gp(c),null;case 13:if(kt(Et),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(t(340));Fi()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return kt(Et),null;case 4:return Pi(),null;case 10:return zp(c.type._context),null;case 22:case 23:return Im(),null;case 24:return null;default:return null}}var Kc=!1,bn=!1,QT=typeof WeakSet=="function"?WeakSet:Set,$e=null;function zi(a,c){var p=a.ref;if(p!==null)if(typeof p=="function")try{p(null)}catch(x){Dt(a,c,x)}else p.current=null}function dm(a,c,p){try{p()}catch(x){Dt(a,c,x)}}var Bw=!1;function ZT(a,c){if(Ip=fc,a=yy(),gp(a)){if("selectionStart"in a)var p={start:a.selectionStart,end:a.selectionEnd};else e:{p=(p=a.ownerDocument)&&p.defaultView||window;var x=p.getSelection&&p.getSelection();if(x&&x.rangeCount!==0){p=x.anchorNode;var k=x.anchorOffset,I=x.focusNode;x=x.focusOffset;try{p.nodeType,I.nodeType}catch{p=null;break e}var E=0,P=-1,V=-1,oe=0,me=0,ge=a,pe=null;t:for(;;){for(var Ie;ge!==p||k!==0&&ge.nodeType!==3||(P=E+k),ge!==I||x!==0&&ge.nodeType!==3||(V=E+x),ge.nodeType===3&&(E+=ge.nodeValue.length),(Ie=ge.firstChild)!==null;)pe=ge,ge=Ie;for(;;){if(ge===a)break t;if(pe===p&&++oe===k&&(P=E),pe===I&&++me===x&&(V=E),(Ie=ge.nextSibling)!==null)break;ge=pe,pe=ge.parentNode}ge=Ie}p=P===-1||V===-1?null:{start:P,end:V}}else p=null}p=p||{start:0,end:0}}else p=null;for($p={focusedElem:a,selectionRange:p},fc=!1,$e=c;$e!==null;)if(c=$e,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,$e=a;else for(;$e!==null;){c=$e;try{var Te=c.alternate;if(c.flags&1024)switch(c.tag){case 0:case 11:case 15:break;case 1:if(Te!==null){var Ee=Te.memoizedProps,Lt=Te.memoizedState,te=c.stateNode,H=te.getSnapshotBeforeUpdate(c.elementType===c.type?Ee:Os(c.type,Ee),Lt);te.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var se=c.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ye){Dt(c,c.return,ye)}if(a=c.sibling,a!==null){a.return=c.return,$e=a;break}$e=c.return}return Te=Bw,Bw=!1,Te}function ul(a,c,p){var x=c.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var k=x=x.next;do{if((k.tag&a)===a){var I=k.destroy;k.destroy=void 0,I!==void 0&&dm(c,p,I)}k=k.next}while(k!==x)}}function qc(a,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var p=c=c.next;do{if((p.tag&a)===a){var x=p.create;p.destroy=x()}p=p.next}while(p!==c)}}function fm(a){var c=a.ref;if(c!==null){var p=a.stateNode;switch(a.tag){case 5:a=p;break;default:a=p}typeof c=="function"?c(a):c.current=a}}function Vw(a){var c=a.alternate;c!==null&&(a.alternate=null,Vw(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&(delete c[Zs],delete c[Za],delete c[Ep],delete c[_T],delete c[OT])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function Ww(a){return a.tag===5||a.tag===3||a.tag===4}function Uw(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Ww(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function pm(a,c,p){var x=a.tag;if(x===5||x===6)a=a.stateNode,c?p.nodeType===8?p.parentNode.insertBefore(a,c):p.insertBefore(a,c):(p.nodeType===8?(c=p.parentNode,c.insertBefore(a,p)):(c=p,c.appendChild(a)),p=p._reactRootContainer,p!=null||c.onclick!==null||(c.onclick=$c));else if(x!==4&&(a=a.child,a!==null))for(pm(a,c,p),a=a.sibling;a!==null;)pm(a,c,p),a=a.sibling}function mm(a,c,p){var x=a.tag;if(x===5||x===6)a=a.stateNode,c?p.insertBefore(a,c):p.appendChild(a);else if(x!==4&&(a=a.child,a!==null))for(mm(a,c,p),a=a.sibling;a!==null;)mm(a,c,p),a=a.sibling}var fn=null,Ls=!1;function Yr(a,c,p){for(p=p.child;p!==null;)Gw(a,c,p),p=p.sibling}function Gw(a,c,p){if(Qs&&typeof Qs.onCommitFiberUnmount=="function")try{Qs.onCommitFiberUnmount(ac,p)}catch{}switch(p.tag){case 5:bn||zi(p,c);case 6:var x=fn,k=Ls;fn=null,Yr(a,c,p),fn=x,Ls=k,fn!==null&&(Ls?(a=fn,p=p.stateNode,a.nodeType===8?a.parentNode.removeChild(p):a.removeChild(p)):fn.removeChild(p.stateNode));break;case 18:fn!==null&&(Ls?(a=fn,p=p.stateNode,a.nodeType===8?Tp(a.parentNode,p):a.nodeType===1&&Tp(a,p),Va(a)):Tp(fn,p.stateNode));break;case 4:x=fn,k=Ls,fn=p.stateNode.containerInfo,Ls=!0,Yr(a,c,p),fn=x,Ls=k;break;case 0:case 11:case 14:case 15:if(!bn&&(x=p.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){k=x=x.next;do{var I=k,E=I.destroy;I=I.tag,E!==void 0&&(I&2||I&4)&&dm(p,c,E),k=k.next}while(k!==x)}Yr(a,c,p);break;case 1:if(!bn&&(zi(p,c),x=p.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=p.memoizedProps,x.state=p.memoizedState,x.componentWillUnmount()}catch(P){Dt(p,c,P)}Yr(a,c,p);break;case 21:Yr(a,c,p);break;case 22:p.mode&1?(bn=(x=bn)||p.memoizedState!==null,Yr(a,c,p),bn=x):Yr(a,c,p);break;default:Yr(a,c,p)}}function Hw(a){var c=a.updateQueue;if(c!==null){a.updateQueue=null;var p=a.stateNode;p===null&&(p=a.stateNode=new QT),c.forEach(function(x){var k=aE.bind(null,a,x);p.has(x)||(p.add(x),x.then(k,k))})}}function Ps(a,c){var p=c.deletions;if(p!==null)for(var x=0;x<p.length;x++){var k=p[x];try{var I=a,E=c,P=E;e:for(;P!==null;){switch(P.tag){case 5:fn=P.stateNode,Ls=!1;break e;case 3:fn=P.stateNode.containerInfo,Ls=!0;break e;case 4:fn=P.stateNode.containerInfo,Ls=!0;break e}P=P.return}if(fn===null)throw Error(t(160));Gw(I,E,k),fn=null,Ls=!1;var V=k.alternate;V!==null&&(V.return=null),k.return=null}catch(oe){Dt(k,c,oe)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)jw(c,a),c=c.sibling}function jw(a,c){var p=a.alternate,x=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Ps(c,a),tr(a),x&4){try{ul(3,a,a.return),qc(3,a)}catch(Ee){Dt(a,a.return,Ee)}try{ul(5,a,a.return)}catch(Ee){Dt(a,a.return,Ee)}}break;case 1:Ps(c,a),tr(a),x&512&&p!==null&&zi(p,p.return);break;case 5:if(Ps(c,a),tr(a),x&512&&p!==null&&zi(p,p.return),a.flags&32){var k=a.stateNode;try{xr(k,"")}catch(Ee){Dt(a,a.return,Ee)}}if(x&4&&(k=a.stateNode,k!=null)){var I=a.memoizedProps,E=p!==null?p.memoizedProps:I,P=a.type,V=a.updateQueue;if(a.updateQueue=null,V!==null)try{P==="input"&&I.type==="radio"&&I.name!=null&&tt(k,I),jf(P,E);var oe=jf(P,I);for(E=0;E<V.length;E+=2){var me=V[E],ge=V[E+1];me==="style"?sc(k,ge):me==="dangerouslySetInnerHTML"?Pr(k,ge):me==="children"?xr(k,ge):S(k,me,ge,oe)}switch(P){case"input":dt(k,I);break;case"textarea":zn(k,I);break;case"select":var pe=k._wrapperState.wasMultiple;k._wrapperState.wasMultiple=!!I.multiple;var Ie=I.value;Ie!=null?Rn(k,!!I.multiple,Ie,!1):pe!==!!I.multiple&&(I.defaultValue!=null?Rn(k,!!I.multiple,I.defaultValue,!0):Rn(k,!!I.multiple,I.multiple?[]:"",!1))}k[Za]=I}catch(Ee){Dt(a,a.return,Ee)}}break;case 6:if(Ps(c,a),tr(a),x&4){if(a.stateNode===null)throw Error(t(162));k=a.stateNode,I=a.memoizedProps;try{k.nodeValue=I}catch(Ee){Dt(a,a.return,Ee)}}break;case 3:if(Ps(c,a),tr(a),x&4&&p!==null&&p.memoizedState.isDehydrated)try{Va(c.containerInfo)}catch(Ee){Dt(a,a.return,Ee)}break;case 4:Ps(c,a),tr(a);break;case 13:Ps(c,a),tr(a),k=a.child,k.flags&8192&&(I=k.memoizedState!==null,k.stateNode.isHidden=I,!I||k.alternate!==null&&k.alternate.memoizedState!==null||(ym=Ot())),x&4&&Hw(a);break;case 22:if(me=p!==null&&p.memoizedState!==null,a.mode&1?(bn=(oe=bn)||me,Ps(c,a),bn=oe):Ps(c,a),tr(a),x&8192){if(oe=a.memoizedState!==null,(a.stateNode.isHidden=oe)&&!me&&a.mode&1)for($e=a,me=a.child;me!==null;){for(ge=$e=me;$e!==null;){switch(pe=$e,Ie=pe.child,pe.tag){case 0:case 11:case 14:case 15:ul(4,pe,pe.return);break;case 1:zi(pe,pe.return);var Te=pe.stateNode;if(typeof Te.componentWillUnmount=="function"){x=pe,p=pe.return;try{c=x,Te.props=c.memoizedProps,Te.state=c.memoizedState,Te.componentWillUnmount()}catch(Ee){Dt(x,p,Ee)}}break;case 5:zi(pe,pe.return);break;case 22:if(pe.memoizedState!==null){Xw(ge);continue}}Ie!==null?(Ie.return=pe,$e=Ie):Xw(ge)}me=me.sibling}e:for(me=null,ge=a;;){if(ge.tag===5){if(me===null){me=ge;try{k=ge.stateNode,oe?(I=k.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(P=ge.stateNode,V=ge.memoizedProps.style,E=V!=null&&V.hasOwnProperty("display")?V.display:null,P.style.display=So("display",E))}catch(Ee){Dt(a,a.return,Ee)}}}else if(ge.tag===6){if(me===null)try{ge.stateNode.nodeValue=oe?"":ge.memoizedProps}catch(Ee){Dt(a,a.return,Ee)}}else if((ge.tag!==22&&ge.tag!==23||ge.memoizedState===null||ge===a)&&ge.child!==null){ge.child.return=ge,ge=ge.child;continue}if(ge===a)break e;for(;ge.sibling===null;){if(ge.return===null||ge.return===a)break e;me===ge&&(me=null),ge=ge.return}me===ge&&(me=null),ge.sibling.return=ge.return,ge=ge.sibling}}break;case 19:Ps(c,a),tr(a),x&4&&Hw(a);break;case 21:break;default:Ps(c,a),tr(a)}}function tr(a){var c=a.flags;if(c&2){try{e:{for(var p=a.return;p!==null;){if(Ww(p)){var x=p;break e}p=p.return}throw Error(t(160))}switch(x.tag){case 5:var k=x.stateNode;x.flags&32&&(xr(k,""),x.flags&=-33);var I=Uw(a);mm(a,I,k);break;case 3:case 4:var E=x.stateNode.containerInfo,P=Uw(a);pm(a,P,E);break;default:throw Error(t(161))}}catch(V){Dt(a,a.return,V)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function JT(a,c,p){$e=a,Kw(a)}function Kw(a,c,p){for(var x=(a.mode&1)!==0;$e!==null;){var k=$e,I=k.child;if(k.tag===22&&x){var E=k.memoizedState!==null||Kc;if(!E){var P=k.alternate,V=P!==null&&P.memoizedState!==null||bn;P=Kc;var oe=bn;if(Kc=E,(bn=V)&&!oe)for($e=k;$e!==null;)E=$e,V=E.child,E.tag===22&&E.memoizedState!==null?Yw(k):V!==null?(V.return=E,$e=V):Yw(k);for(;I!==null;)$e=I,Kw(I),I=I.sibling;$e=k,Kc=P,bn=oe}qw(a)}else k.subtreeFlags&8772&&I!==null?(I.return=k,$e=I):qw(a)}}function qw(a){for(;$e!==null;){var c=$e;if(c.flags&8772){var p=c.alternate;try{if(c.flags&8772)switch(c.tag){case 0:case 11:case 15:bn||qc(5,c);break;case 1:var x=c.stateNode;if(c.flags&4&&!bn)if(p===null)x.componentDidMount();else{var k=c.elementType===c.type?p.memoizedProps:Os(c.type,p.memoizedProps);x.componentDidUpdate(k,p.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var I=c.updateQueue;I!==null&&Xy(c,I,x);break;case 3:var E=c.updateQueue;if(E!==null){if(p=null,c.child!==null)switch(c.child.tag){case 5:p=c.child.stateNode;break;case 1:p=c.child.stateNode}Xy(c,E,p)}break;case 5:var P=c.stateNode;if(p===null&&c.flags&4){p=P;var V=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":V.autoFocus&&p.focus();break;case"img":V.src&&(p.src=V.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var oe=c.alternate;if(oe!==null){var me=oe.memoizedState;if(me!==null){var ge=me.dehydrated;ge!==null&&Va(ge)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}bn||c.flags&512&&fm(c)}catch(pe){Dt(c,c.return,pe)}}if(c===a){$e=null;break}if(p=c.sibling,p!==null){p.return=c.return,$e=p;break}$e=c.return}}function Xw(a){for(;$e!==null;){var c=$e;if(c===a){$e=null;break}var p=c.sibling;if(p!==null){p.return=c.return,$e=p;break}$e=c.return}}function Yw(a){for(;$e!==null;){var c=$e;try{switch(c.tag){case 0:case 11:case 15:var p=c.return;try{qc(4,c)}catch(V){Dt(c,p,V)}break;case 1:var x=c.stateNode;if(typeof x.componentDidMount=="function"){var k=c.return;try{x.componentDidMount()}catch(V){Dt(c,k,V)}}var I=c.return;try{fm(c)}catch(V){Dt(c,I,V)}break;case 5:var E=c.return;try{fm(c)}catch(V){Dt(c,E,V)}}}catch(V){Dt(c,c.return,V)}if(c===a){$e=null;break}var P=c.sibling;if(P!==null){P.return=c.return,$e=P;break}$e=c.return}}var eE=Math.ceil,Xc=$.ReactCurrentDispatcher,gm=$.ReactCurrentOwner,xs=$.ReactCurrentBatchConfig,Je=0,rn=null,Wt=null,pn=0,ss=0,Bi=Hr(0),Xt=0,cl=null,Oo=0,Yc=0,xm=0,hl=null,Un=null,ym=0,Vi=1/0,Sr=null,Qc=!1,wm=null,Qr=null,Zc=!1,Zr=null,Jc=0,dl=0,vm=null,eh=-1,th=0;function An(){return Je&6?Ot():eh!==-1?eh:eh=Ot()}function Jr(a){return a.mode&1?Je&2&&pn!==0?pn&-pn:PT.transition!==null?(th===0&&(th=U1()),th):(a=ut,a!==0||(a=window.event,a=a===void 0?16:Z1(a.type)),a):1}function Ms(a,c,p,x){if(50<dl)throw dl=0,vm=null,Error(t(185));La(a,p,x),(!(Je&2)||a!==rn)&&(a===rn&&(!(Je&2)&&(Yc|=p),Xt===4&&eo(a,pn)),Gn(a,x),p===1&&Je===0&&!(c.mode&1)&&(Vi=Ot()+500,Ec&&Kr()))}function Gn(a,c){var p=a.callbackNode;PN(a,c);var x=cc(a,a===rn?pn:0);if(x===0)p!==null&&B1(p),a.callbackNode=null,a.callbackPriority=0;else if(c=x&-x,a.callbackPriority!==c){if(p!=null&&B1(p),c===1)a.tag===0?LT(Zw.bind(null,a)):Py(Zw.bind(null,a)),AT(function(){!(Je&6)&&Kr()}),p=null;else{switch(G1(x)){case 1:p=Jf;break;case 4:p=V1;break;case 16:p=ic;break;case 536870912:p=W1;break;default:p=ic}p=iv(p,Qw.bind(null,a))}a.callbackPriority=c,a.callbackNode=p}}function Qw(a,c){if(eh=-1,th=0,Je&6)throw Error(t(327));var p=a.callbackNode;if(Wi()&&a.callbackNode!==p)return null;var x=cc(a,a===rn?pn:0);if(x===0)return null;if(x&30||x&a.expiredLanes||c)c=nh(a,x);else{c=x;var k=Je;Je|=2;var I=ev();(rn!==a||pn!==c)&&(Sr=null,Vi=Ot()+500,Po(a,c));do try{sE();break}catch(P){Jw(a,P)}while(!0);Mp(),Xc.current=I,Je=k,Wt!==null?c=0:(rn=null,pn=0,c=Xt)}if(c!==0){if(c===2&&(k=ep(a),k!==0&&(x=k,c=bm(a,k))),c===1)throw p=cl,Po(a,0),eo(a,x),Gn(a,Ot()),p;if(c===6)eo(a,x);else{if(k=a.current.alternate,!(x&30)&&!tE(k)&&(c=nh(a,x),c===2&&(I=ep(a),I!==0&&(x=I,c=bm(a,I))),c===1))throw p=cl,Po(a,0),eo(a,x),Gn(a,Ot()),p;switch(a.finishedWork=k,a.finishedLanes=x,c){case 0:case 1:throw Error(t(345));case 2:Mo(a,Un,Sr);break;case 3:if(eo(a,x),(x&130023424)===x&&(c=ym+500-Ot(),10<c)){if(cc(a,0)!==0)break;if(k=a.suspendedLanes,(k&x)!==x){An(),a.pingedLanes|=a.suspendedLanes&k;break}a.timeoutHandle=Np(Mo.bind(null,a,Un,Sr),c);break}Mo(a,Un,Sr);break;case 4:if(eo(a,x),(x&4194240)===x)break;for(c=a.eventTimes,k=-1;0<x;){var E=31-As(x);I=1<<E,E=c[E],E>k&&(k=E),x&=~I}if(x=k,x=Ot()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*eE(x/1960))-x,10<x){a.timeoutHandle=Np(Mo.bind(null,a,Un,Sr),x);break}Mo(a,Un,Sr);break;case 5:Mo(a,Un,Sr);break;default:throw Error(t(329))}}}return Gn(a,Ot()),a.callbackNode===p?Qw.bind(null,a):null}function bm(a,c){var p=hl;return a.current.memoizedState.isDehydrated&&(Po(a,c).flags|=256),a=nh(a,c),a!==2&&(c=Un,Un=p,c!==null&&km(c)),a}function km(a){Un===null?Un=a:Un.push.apply(Un,a)}function tE(a){for(var c=a;;){if(c.flags&16384){var p=c.updateQueue;if(p!==null&&(p=p.stores,p!==null))for(var x=0;x<p.length;x++){var k=p[x],I=k.getSnapshot;k=k.value;try{if(!Fs(I(),k))return!1}catch{return!1}}}if(p=c.child,c.subtreeFlags&16384&&p!==null)p.return=c,c=p;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function eo(a,c){for(c&=~xm,c&=~Yc,a.suspendedLanes|=c,a.pingedLanes&=~c,a=a.expirationTimes;0<c;){var p=31-As(c),x=1<<p;a[p]=-1,c&=~x}}function Zw(a){if(Je&6)throw Error(t(327));Wi();var c=cc(a,0);if(!(c&1))return Gn(a,Ot()),null;var p=nh(a,c);if(a.tag!==0&&p===2){var x=ep(a);x!==0&&(c=x,p=bm(a,x))}if(p===1)throw p=cl,Po(a,0),eo(a,c),Gn(a,Ot()),p;if(p===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=c,Mo(a,Un,Sr),Gn(a,Ot()),null}function Cm(a,c){var p=Je;Je|=1;try{return a(c)}finally{Je=p,Je===0&&(Vi=Ot()+500,Ec&&Kr())}}function Lo(a){Zr!==null&&Zr.tag===0&&!(Je&6)&&Wi();var c=Je;Je|=1;var p=xs.transition,x=ut;try{if(xs.transition=null,ut=1,a)return a()}finally{ut=x,xs.transition=p,Je=c,!(Je&6)&&Kr()}}function Im(){ss=Bi.current,kt(Bi)}function Po(a,c){a.finishedWork=null,a.finishedLanes=0;var p=a.timeoutHandle;if(p!==-1&&(a.timeoutHandle=-1,DT(p)),Wt!==null)for(p=Wt.return;p!==null;){var x=p;switch(Fp(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&Nc();break;case 3:Pi(),kt(Bn),kt(yn),jp();break;case 5:Gp(x);break;case 4:Pi();break;case 13:kt(Et);break;case 19:kt(Et);break;case 10:zp(x.type._context);break;case 22:case 23:Im()}p=p.return}if(rn=a,Wt=a=to(a.current,null),pn=ss=c,Xt=0,cl=null,xm=Yc=Oo=0,Un=hl=null,Ao!==null){for(c=0;c<Ao.length;c++)if(p=Ao[c],x=p.interleaved,x!==null){p.interleaved=null;var k=x.next,I=p.pending;if(I!==null){var E=I.next;I.next=k,x.next=E}p.pending=x}Ao=null}return a}function Jw(a,c){do{var p=Wt;try{if(Mp(),zc.current=Uc,Bc){for(var x=Rt.memoizedState;x!==null;){var k=x.queue;k!==null&&(k.pending=null),x=x.next}Bc=!1}if(_o=0,sn=qt=Rt=null,rl=!1,ol=0,gm.current=null,p===null||p.return===null){Xt=1,cl=c,Wt=null;break}e:{var I=a,E=p.return,P=p,V=c;if(c=pn,P.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){var oe=V,me=P,ge=me.tag;if(!(me.mode&1)&&(ge===0||ge===11||ge===15)){var pe=me.alternate;pe?(me.updateQueue=pe.updateQueue,me.memoizedState=pe.memoizedState,me.lanes=pe.lanes):(me.updateQueue=null,me.memoizedState=null)}var Ie=Iw(E);if(Ie!==null){Ie.flags&=-257,$w(Ie,E,P,I,c),Ie.mode&1&&Cw(I,oe,c),c=Ie,V=oe;var Te=c.updateQueue;if(Te===null){var Ee=new Set;Ee.add(V),c.updateQueue=Ee}else Te.add(V);break e}else{if(!(c&1)){Cw(I,oe,c),$m();break e}V=Error(t(426))}}else if(St&&P.mode&1){var Lt=Iw(E);if(Lt!==null){!(Lt.flags&65536)&&(Lt.flags|=256),$w(Lt,E,P,I,c),Lp(Mi(V,P));break e}}I=V=Mi(V,P),Xt!==4&&(Xt=2),hl===null?hl=[I]:hl.push(I),I=E;do{switch(I.tag){case 3:I.flags|=65536,c&=-c,I.lanes|=c;var te=bw(I,V,c);qy(I,te);break e;case 1:P=V;var H=I.type,se=I.stateNode;if(!(I.flags&128)&&(typeof H.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(Qr===null||!Qr.has(se)))){I.flags|=65536,c&=-c,I.lanes|=c;var ye=kw(I,P,c);qy(I,ye);break e}}I=I.return}while(I!==null)}nv(p)}catch(De){c=De,Wt===p&&p!==null&&(Wt=p=p.return);continue}break}while(!0)}function ev(){var a=Xc.current;return Xc.current=Uc,a===null?Uc:a}function $m(){(Xt===0||Xt===3||Xt===2)&&(Xt=4),rn===null||!(Oo&268435455)&&!(Yc&268435455)||eo(rn,pn)}function nh(a,c){var p=Je;Je|=2;var x=ev();(rn!==a||pn!==c)&&(Sr=null,Po(a,c));do try{nE();break}catch(k){Jw(a,k)}while(!0);if(Mp(),Je=p,Xc.current=x,Wt!==null)throw Error(t(261));return rn=null,pn=0,Xt}function nE(){for(;Wt!==null;)tv(Wt)}function sE(){for(;Wt!==null&&!TN();)tv(Wt)}function tv(a){var c=ov(a.alternate,a,ss);a.memoizedProps=a.pendingProps,c===null?nv(a):Wt=c,gm.current=null}function nv(a){var c=a;do{var p=c.alternate;if(a=c.return,c.flags&32768){if(p=YT(p,c),p!==null){p.flags&=32767,Wt=p;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Xt=6,Wt=null;return}}else if(p=XT(p,c,ss),p!==null){Wt=p;return}if(c=c.sibling,c!==null){Wt=c;return}Wt=c=a}while(c!==null);Xt===0&&(Xt=5)}function Mo(a,c,p){var x=ut,k=xs.transition;try{xs.transition=null,ut=1,rE(a,c,p,x)}finally{xs.transition=k,ut=x}return null}function rE(a,c,p,x){do Wi();while(Zr!==null);if(Je&6)throw Error(t(327));p=a.finishedWork;var k=a.finishedLanes;if(p===null)return null;if(a.finishedWork=null,a.finishedLanes=0,p===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var I=p.lanes|p.childLanes;if(MN(a,I),a===rn&&(Wt=rn=null,pn=0),!(p.subtreeFlags&2064)&&!(p.flags&2064)||Zc||(Zc=!0,iv(ic,function(){return Wi(),null})),I=(p.flags&15990)!==0,p.subtreeFlags&15990||I){I=xs.transition,xs.transition=null;var E=ut;ut=1;var P=Je;Je|=4,gm.current=null,ZT(a,p),jw(p,a),IT($p),fc=!!Ip,$p=Ip=null,a.current=p,JT(p),EN(),Je=P,ut=E,xs.transition=I}else a.current=p;if(Zc&&(Zc=!1,Zr=a,Jc=k),I=a.pendingLanes,I===0&&(Qr=null),AN(p.stateNode),Gn(a,Ot()),c!==null)for(x=a.onRecoverableError,p=0;p<c.length;p++)k=c[p],x(k.value,{componentStack:k.stack,digest:k.digest});if(Qc)throw Qc=!1,a=wm,wm=null,a;return Jc&1&&a.tag!==0&&Wi(),I=a.pendingLanes,I&1?a===vm?dl++:(dl=0,vm=a):dl=0,Kr(),null}function Wi(){if(Zr!==null){var a=G1(Jc),c=xs.transition,p=ut;try{if(xs.transition=null,ut=16>a?16:a,Zr===null)var x=!1;else{if(a=Zr,Zr=null,Jc=0,Je&6)throw Error(t(331));var k=Je;for(Je|=4,$e=a.current;$e!==null;){var I=$e,E=I.child;if($e.flags&16){var P=I.deletions;if(P!==null){for(var V=0;V<P.length;V++){var oe=P[V];for($e=oe;$e!==null;){var me=$e;switch(me.tag){case 0:case 11:case 15:ul(8,me,I)}var ge=me.child;if(ge!==null)ge.return=me,$e=ge;else for(;$e!==null;){me=$e;var pe=me.sibling,Ie=me.return;if(Vw(me),me===oe){$e=null;break}if(pe!==null){pe.return=Ie,$e=pe;break}$e=Ie}}}var Te=I.alternate;if(Te!==null){var Ee=Te.child;if(Ee!==null){Te.child=null;do{var Lt=Ee.sibling;Ee.sibling=null,Ee=Lt}while(Ee!==null)}}$e=I}}if(I.subtreeFlags&2064&&E!==null)E.return=I,$e=E;else e:for(;$e!==null;){if(I=$e,I.flags&2048)switch(I.tag){case 0:case 11:case 15:ul(9,I,I.return)}var te=I.sibling;if(te!==null){te.return=I.return,$e=te;break e}$e=I.return}}var H=a.current;for($e=H;$e!==null;){E=$e;var se=E.child;if(E.subtreeFlags&2064&&se!==null)se.return=E,$e=se;else e:for(E=H;$e!==null;){if(P=$e,P.flags&2048)try{switch(P.tag){case 0:case 11:case 15:qc(9,P)}}catch(De){Dt(P,P.return,De)}if(P===E){$e=null;break e}var ye=P.sibling;if(ye!==null){ye.return=P.return,$e=ye;break e}$e=P.return}}if(Je=k,Kr(),Qs&&typeof Qs.onPostCommitFiberRoot=="function")try{Qs.onPostCommitFiberRoot(ac,a)}catch{}x=!0}return x}finally{ut=p,xs.transition=c}}return!1}function sv(a,c,p){c=Mi(p,c),c=bw(a,c,1),a=Xr(a,c,1),c=An(),a!==null&&(La(a,1,c),Gn(a,c))}function Dt(a,c,p){if(a.tag===3)sv(a,a,p);else for(;c!==null;){if(c.tag===3){sv(c,a,p);break}else if(c.tag===1){var x=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Qr===null||!Qr.has(x))){a=Mi(p,a),a=kw(c,a,1),c=Xr(c,a,1),a=An(),c!==null&&(La(c,1,a),Gn(c,a));break}}c=c.return}}function oE(a,c,p){var x=a.pingCache;x!==null&&x.delete(c),c=An(),a.pingedLanes|=a.suspendedLanes&p,rn===a&&(pn&p)===p&&(Xt===4||Xt===3&&(pn&130023424)===pn&&500>Ot()-ym?Po(a,0):xm|=p),Gn(a,c)}function rv(a,c){c===0&&(a.mode&1?(c=uc,uc<<=1,!(uc&130023424)&&(uc=4194304)):c=1);var p=An();a=Cr(a,c),a!==null&&(La(a,c,p),Gn(a,p))}function iE(a){var c=a.memoizedState,p=0;c!==null&&(p=c.retryLane),rv(a,p)}function aE(a,c){var p=0;switch(a.tag){case 13:var x=a.stateNode,k=a.memoizedState;k!==null&&(p=k.retryLane);break;case 19:x=a.stateNode;break;default:throw Error(t(314))}x!==null&&x.delete(c),rv(a,p)}var ov;ov=function(a,c,p){if(a!==null)if(a.memoizedProps!==c.pendingProps||Bn.current)Wn=!0;else{if(!(a.lanes&p)&&!(c.flags&128))return Wn=!1,qT(a,c,p);Wn=!!(a.flags&131072)}else Wn=!1,St&&c.flags&1048576&&My(c,Dc,c.index);switch(c.lanes=0,c.tag){case 2:var x=c.type;jc(a,c),a=c.pendingProps;var k=Ri(c,yn.current);Li(c,p),k=Xp(null,c,x,a,k,p);var I=Yp();return c.flags|=1,typeof k=="object"&&k!==null&&typeof k.render=="function"&&k.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,Vn(x)?(I=!0,Tc(c)):I=!1,c.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,Wp(c),k.updater=Gc,c.stateNode=k,k._reactInternals=c,nm(c,x,a,p),c=im(null,c,x,!0,I,p)):(c.tag=0,St&&I&&Ap(c),Dn(null,c,k,p),c=c.child),c;case 16:x=c.elementType;e:{switch(jc(a,c),a=c.pendingProps,k=x._init,x=k(x._payload),c.type=x,k=c.tag=uE(x),a=Os(x,a),k){case 0:c=om(null,c,x,a,p);break e;case 1:c=Dw(null,c,x,a,p);break e;case 11:c=Sw(null,c,x,a,p);break e;case 14:c=Nw(null,c,x,Os(x.type,a),p);break e}throw Error(t(306,x,""))}return c;case 0:return x=c.type,k=c.pendingProps,k=c.elementType===x?k:Os(x,k),om(a,c,x,k,p);case 1:return x=c.type,k=c.pendingProps,k=c.elementType===x?k:Os(x,k),Dw(a,c,x,k,p);case 3:e:{if(Aw(c),a===null)throw Error(t(387));x=c.pendingProps,I=c.memoizedState,k=I.element,Ky(a,c),Pc(c,x,null,p);var E=c.memoizedState;if(x=E.element,I.isDehydrated)if(I={element:x,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},c.updateQueue.baseState=I,c.memoizedState=I,c.flags&256){k=Mi(Error(t(423)),c),c=Fw(a,c,x,p,k);break e}else if(x!==k){k=Mi(Error(t(424)),c),c=Fw(a,c,x,p,k);break e}else for(ns=Gr(c.stateNode.containerInfo.firstChild),ts=c,St=!0,_s=null,p=Hy(c,null,x,p),c.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(Fi(),x===k){c=$r(a,c,p);break e}Dn(a,c,x,p)}c=c.child}return c;case 5:return Yy(c),a===null&&Op(c),x=c.type,k=c.pendingProps,I=a!==null?a.memoizedProps:null,E=k.children,Sp(x,k)?E=null:I!==null&&Sp(x,I)&&(c.flags|=32),Rw(a,c),Dn(a,c,E,p),c.child;case 6:return a===null&&Op(c),null;case 13:return _w(a,c,p);case 4:return Up(c,c.stateNode.containerInfo),x=c.pendingProps,a===null?c.child=_i(c,null,x,p):Dn(a,c,x,p),c.child;case 11:return x=c.type,k=c.pendingProps,k=c.elementType===x?k:Os(x,k),Sw(a,c,x,k,p);case 7:return Dn(a,c,c.pendingProps,p),c.child;case 8:return Dn(a,c,c.pendingProps.children,p),c.child;case 12:return Dn(a,c,c.pendingProps.children,p),c.child;case 10:e:{if(x=c.type._context,k=c.pendingProps,I=c.memoizedProps,E=k.value,xt(_c,x._currentValue),x._currentValue=E,I!==null)if(Fs(I.value,E)){if(I.children===k.children&&!Bn.current){c=$r(a,c,p);break e}}else for(I=c.child,I!==null&&(I.return=c);I!==null;){var P=I.dependencies;if(P!==null){E=I.child;for(var V=P.firstContext;V!==null;){if(V.context===x){if(I.tag===1){V=Ir(-1,p&-p),V.tag=2;var oe=I.updateQueue;if(oe!==null){oe=oe.shared;var me=oe.pending;me===null?V.next=V:(V.next=me.next,me.next=V),oe.pending=V}}I.lanes|=p,V=I.alternate,V!==null&&(V.lanes|=p),Bp(I.return,p,c),P.lanes|=p;break}V=V.next}}else if(I.tag===10)E=I.type===c.type?null:I.child;else if(I.tag===18){if(E=I.return,E===null)throw Error(t(341));E.lanes|=p,P=E.alternate,P!==null&&(P.lanes|=p),Bp(E,p,c),E=I.sibling}else E=I.child;if(E!==null)E.return=I;else for(E=I;E!==null;){if(E===c){E=null;break}if(I=E.sibling,I!==null){I.return=E.return,E=I;break}E=E.return}I=E}Dn(a,c,k.children,p),c=c.child}return c;case 9:return k=c.type,x=c.pendingProps.children,Li(c,p),k=ms(k),x=x(k),c.flags|=1,Dn(a,c,x,p),c.child;case 14:return x=c.type,k=Os(x,c.pendingProps),k=Os(x.type,k),Nw(a,c,x,k,p);case 15:return Tw(a,c,c.type,c.pendingProps,p);case 17:return x=c.type,k=c.pendingProps,k=c.elementType===x?k:Os(x,k),jc(a,c),c.tag=1,Vn(x)?(a=!0,Tc(c)):a=!1,Li(c,p),ww(c,x,k),nm(c,x,k,p),im(null,c,x,!0,a,p);case 19:return Lw(a,c,p);case 22:return Ew(a,c,p)}throw Error(t(156,c.tag))};function iv(a,c){return z1(a,c)}function lE(a,c,p,x){this.tag=a,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ys(a,c,p,x){return new lE(a,c,p,x)}function Sm(a){return a=a.prototype,!(!a||!a.isReactComponent)}function uE(a){if(typeof a=="function")return Sm(a)?1:0;if(a!=null){if(a=a.$$typeof,a===z)return 11;if(a===q)return 14}return 2}function to(a,c){var p=a.alternate;return p===null?(p=ys(a.tag,c,a.key,a.mode),p.elementType=a.elementType,p.type=a.type,p.stateNode=a.stateNode,p.alternate=a,a.alternate=p):(p.pendingProps=c,p.type=a.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=a.flags&14680064,p.childLanes=a.childLanes,p.lanes=a.lanes,p.child=a.child,p.memoizedProps=a.memoizedProps,p.memoizedState=a.memoizedState,p.updateQueue=a.updateQueue,c=a.dependencies,p.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},p.sibling=a.sibling,p.index=a.index,p.ref=a.ref,p}function sh(a,c,p,x,k,I){var E=2;if(x=a,typeof a=="function")Sm(a)&&(E=1);else if(typeof a=="string")E=5;else e:switch(a){case O:return zo(p.children,k,I,c);case F:E=8,k|=8;break;case A:return a=ys(12,p,c,k|2),a.elementType=A,a.lanes=I,a;case U:return a=ys(13,p,c,k),a.elementType=U,a.lanes=I,a;case Q:return a=ys(19,p,c,k),a.elementType=Q,a.lanes=I,a;case ne:return rh(p,k,I,c);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case D:E=10;break e;case T:E=9;break e;case z:E=11;break e;case q:E=14;break e;case J:E=16,x=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return c=ys(E,p,c,k),c.elementType=a,c.type=x,c.lanes=I,c}function zo(a,c,p,x){return a=ys(7,a,x,c),a.lanes=p,a}function rh(a,c,p,x){return a=ys(22,a,x,c),a.elementType=ne,a.lanes=p,a.stateNode={isHidden:!1},a}function Nm(a,c,p){return a=ys(6,a,null,c),a.lanes=p,a}function Tm(a,c,p){return c=ys(4,a.children!==null?a.children:[],a.key,c),c.lanes=p,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}function cE(a,c,p,x,k){this.tag=c,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tp(0),this.expirationTimes=tp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tp(0),this.identifierPrefix=x,this.onRecoverableError=k,this.mutableSourceEagerHydrationData=null}function Em(a,c,p,x,k,I,E,P,V){return a=new cE(a,c,p,P,V),c===1?(c=1,I===!0&&(c|=8)):c=0,I=ys(3,null,null,c),a.current=I,I.stateNode=a,I.memoizedState={element:x,isDehydrated:p,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wp(I),a}function hE(a,c,p){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:x==null?null:""+x,children:a,containerInfo:c,implementation:p}}function av(a){if(!a)return jr;a=a._reactInternals;e:{if(No(a)!==a||a.tag!==1)throw Error(t(170));var c=a;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(Vn(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(t(171))}if(a.tag===1){var p=a.type;if(Vn(p))return Oy(a,p,c)}return c}function lv(a,c,p,x,k,I,E,P,V){return a=Em(p,x,!0,a,k,I,E,P,V),a.context=av(null),p=a.current,x=An(),k=Jr(p),I=Ir(x,k),I.callback=c??null,Xr(p,I,k),a.current.lanes=k,La(a,k,x),Gn(a,x),a}function oh(a,c,p,x){var k=c.current,I=An(),E=Jr(k);return p=av(p),c.context===null?c.context=p:c.pendingContext=p,c=Ir(I,E),c.payload={element:a},x=x===void 0?null:x,x!==null&&(c.callback=x),a=Xr(k,c,E),a!==null&&(Ms(a,k,E,I),Lc(a,k,E)),E}function ih(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function uv(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var p=a.retryLane;a.retryLane=p!==0&&p<c?p:c}}function Rm(a,c){uv(a,c),(a=a.alternate)&&uv(a,c)}function dE(){return null}var cv=typeof reportError=="function"?reportError:function(a){console.error(a)};function Dm(a){this._internalRoot=a}ah.prototype.render=Dm.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(t(409));oh(a,c,null,null)},ah.prototype.unmount=Dm.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;Lo(function(){oh(null,a,null,null)}),c[wr]=null}};function ah(a){this._internalRoot=a}ah.prototype.unstable_scheduleHydration=function(a){if(a){var c=K1();a={blockedOn:null,target:a,priority:c};for(var p=0;p<Vr.length&&c!==0&&c<Vr[p].priority;p++);Vr.splice(p,0,a),p===0&&Y1(a)}};function Am(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function lh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function hv(){}function fE(a,c,p,x,k){if(k){if(typeof x=="function"){var I=x;x=function(){var oe=ih(E);I.call(oe)}}var E=lv(c,x,a,0,null,!1,!1,"",hv);return a._reactRootContainer=E,a[wr]=E.current,Ya(a.nodeType===8?a.parentNode:a),Lo(),E}for(;k=a.lastChild;)a.removeChild(k);if(typeof x=="function"){var P=x;x=function(){var oe=ih(V);P.call(oe)}}var V=Em(a,0,!1,null,null,!1,!1,"",hv);return a._reactRootContainer=V,a[wr]=V.current,Ya(a.nodeType===8?a.parentNode:a),Lo(function(){oh(c,V,p,x)}),V}function uh(a,c,p,x,k){var I=p._reactRootContainer;if(I){var E=I;if(typeof k=="function"){var P=k;k=function(){var V=ih(E);P.call(V)}}oh(c,E,a,k)}else E=fE(p,c,a,k,x);return ih(E)}H1=function(a){switch(a.tag){case 3:var c=a.stateNode;if(c.current.memoizedState.isDehydrated){var p=Oa(c.pendingLanes);p!==0&&(np(c,p|1),Gn(c,Ot()),!(Je&6)&&(Vi=Ot()+500,Kr()))}break;case 13:Lo(function(){var x=Cr(a,1);if(x!==null){var k=An();Ms(x,a,1,k)}}),Rm(a,1)}},sp=function(a){if(a.tag===13){var c=Cr(a,134217728);if(c!==null){var p=An();Ms(c,a,134217728,p)}Rm(a,134217728)}},j1=function(a){if(a.tag===13){var c=Jr(a),p=Cr(a,c);if(p!==null){var x=An();Ms(p,a,c,x)}Rm(a,c)}},K1=function(){return ut},q1=function(a,c){var p=ut;try{return ut=a,c()}finally{ut=p}},Xf=function(a,c,p){switch(c){case"input":if(dt(a,p),c=p.name,p.type==="radio"&&c!=null){for(p=a;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<p.length;c++){var x=p[c];if(x!==a&&x.form===a.form){var k=Sc(x);if(!k)throw Error(t(90));Ze(x),dt(x,k)}}}break;case"textarea":zn(a,p);break;case"select":c=p.value,c!=null&&Rn(a,!!p.multiple,c,!1)}},A1=Cm,F1=Lo;var pE={usingClientEntryPoint:!1,Events:[Ja,Ti,Sc,R1,D1,Cm]},fl={findFiberByHostInstance:To,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mE={bundleType:fl.bundleType,version:fl.version,rendererPackageName:fl.rendererPackageName,rendererConfig:fl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=P1(a),a===null?null:a.stateNode},findFiberByHostInstance:fl.findFiberByHostInstance||dE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ch=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ch.isDisabled&&ch.supportsFiber)try{ac=ch.inject(mE),Qs=ch}catch{}}return Hn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pE,Hn.createPortal=function(a,c){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Am(c))throw Error(t(200));return hE(a,c,null,p)},Hn.createRoot=function(a,c){if(!Am(a))throw Error(t(299));var p=!1,x="",k=cv;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onRecoverableError!==void 0&&(k=c.onRecoverableError)),c=Em(a,1,!1,null,null,p,!1,x,k),a[wr]=c.current,Ya(a.nodeType===8?a.parentNode:a),new Dm(c)},Hn.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=P1(c),a=a===null?null:a.stateNode,a},Hn.flushSync=function(a){return Lo(a)},Hn.hydrate=function(a,c,p){if(!lh(c))throw Error(t(200));return uh(null,a,c,!0,p)},Hn.hydrateRoot=function(a,c,p){if(!Am(a))throw Error(t(405));var x=p!=null&&p.hydratedSources||null,k=!1,I="",E=cv;if(p!=null&&(p.unstable_strictMode===!0&&(k=!0),p.identifierPrefix!==void 0&&(I=p.identifierPrefix),p.onRecoverableError!==void 0&&(E=p.onRecoverableError)),c=lv(c,null,a,1,p??null,k,!1,I,E),a[wr]=c.current,Ya(a),x)for(a=0;a<x.length;a++)p=x[a],k=p._getVersion,k=k(p._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[p,k]:c.mutableSourceEagerHydrationData.push(p,k);return new ah(c)},Hn.render=function(a,c,p){if(!lh(c))throw Error(t(200));return uh(null,a,c,!1,p)},Hn.unmountComponentAtNode=function(a){if(!lh(a))throw Error(t(40));return a._reactRootContainer?(Lo(function(){uh(null,null,a,!1,function(){a._reactRootContainer=null,a[wr]=null})}),!0):!1},Hn.unstable_batchedUpdates=Cm,Hn.unstable_renderSubtreeIntoContainer=function(a,c,p,x){if(!lh(p))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return uh(a,c,p,!1,x)},Hn.version="18.3.1-next-f1338f8080-20240426",Hn}var wv;function SE(){if(wv)return Om.exports;wv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Om.exports=$E(),Om.exports}var vv;function NE(){if(vv)return hh;vv=1;var n=SE();return hh.createRoot=n.createRoot,hh.hydrateRoot=n.hydrateRoot,hh}var TE=NE();const EE=({text:n,sender:e,timestamp:t})=>{const s=e==="user";return kn.jsx("div",{className:`chat-message ${s?"user":"bot"}`,children:kn.jsxs("div",{className:"message-bubble",children:[kn.jsx("p",{children:n}),kn.jsxs("span",{className:"message-timestamp",children:[e+": ",t]})]})})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RE=1e-7,DE=1e-4;class ok{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Ug{refCount(e){return rs("refCount")}incRef(e){return rs("incRef")}timerAvailable(){return!0}time(e){return rs("time")}read(e){return rs("read")}readSync(e){return rs("readSync")}readToGPU(e,t){return rs("readToGPU")}numDataIds(){return rs("numDataIds")}disposeData(e,t){return rs("disposeData")}write(e,t,s){return rs("write")}move(e,t,s,r,o){return rs("move")}memory(){return rs("memory")}floatPrecision(){return rs("floatPrecision")}epsilon(){return this.floatPrecision()===32?RE:DE}dispose(){return rs("dispose")}}function rs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Ki(n,e,t)}function Jo(n,e,t){return Math.max(n,Math.min(e,t))}function Gg(n){return n%2===0?n:n+1}function Ki(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function FE(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function _(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Hg(n,e,t=""){_(ot(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function ik(n){_(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function na(n,e=[],t=!1){if(e==null&&(e=[]),Array.isArray(n)||dr(n)&&!t)for(let s=0;s<n.length;++s)na(n[s],e,t);else e.push(n);return e}function ue(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function ot(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function sa(n){return n%1===0}function sg(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Qi(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function bv(n,e=r=>0,t,s=setTimeout){return new Promise((r,o)=>{let i=0;const l=()=>{if(n()){r();return}i++;const u=e(i);if(t!=null&&i>=t){o();return}s(l,u)};l()})}function ak(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function je(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),_(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),_(n.every(s=>sa(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function xo(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:je(e,n).sort();let i=0;for(let l=0;l<n.length;++l){if(o!=null){if(o[i]===l&&n[l]!==1)throw new Error(`Can't squeeze axis ${l} since its dim '${n[l]}' is not 1`);(o[i]==null||o[i]>l)&&n[l]===1&&(t.push(n[l]),s.push(l)),o[i]<=l&&i++}n[l]!==1&&(t.push(n[l]),s.push(l))}return{newShape:t,keptDims:s}}function ln(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error(`Unknown data type ${n}`);return t}function Jt(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function _E(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function OE(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function lk(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function dr(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}function rg(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function LE(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Ol(n){return typeof n=="string"||n instanceof String}function PE(n){return typeof n=="boolean"}function og(n){return typeof n=="number"}function Ll(n){return Array.isArray(n)?Ll(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":og(n)?"float32":Ol(n)?"string":PE(n)?"bool":"float32"}function ig(n){return!!(n&&n.constructor&&n.call&&n.apply)}function ag(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Ae(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function uk(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=t[n+i]}else{const o=e[0],i=e.slice(1),l=i.reduce((u,h)=>u*h)*(s?2:1);for(let u=0;u<o;u++)r[u]=uk(n+u*l,i,t,s)}return r}function Gs(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return uk(0,n,e,t)}function jg(n,e){const t=gn(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function gn(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function ck(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Gs(n,new Float32Array(t));if(e==="int32")return Gs(n,new Int32Array(t));if(e==="bool")return Gs(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function hk(n){n.forEach(e=>{_(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function ar(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function ga(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function dk(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kv="tfjsflags";class ME{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=zE,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(dk(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);kv in e&&e[kv].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=VE(r,o)})}}function zE(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(BE(e,s[0],s[1]),s.join("="))),e}function BE(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function VE(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${n}.`)}function ae(){return fk}let fk=null;function WE(n){fk=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Mm;function pk(){if(Mm==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Mm=n}return Mm}function UE(){const n=pk();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Kg(n,e){const t=UE();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const hd="Abs",Pl="Acos",Ml="Acosh",xa="Add",qg="AddN",Xg="All",Yg="Any",dd="ArgMax",fd="ArgMin",zl="Asin",Bl="Asinh",Vl="Atan",Wl="Atanh",Ul="Atan2",pd="AvgPool",Qg="AvgPoolGrad",md="AvgPool3D",Zg="AvgPool3DGrad",gd="BatchMatMul",xd="BatchToSpaceND",Jg="Bincount",GE="BroadcastTo",mk="BroadcastArgs",Gl="Cast",Hl="Ceil",jl="ClipByValue",ex="Complex",yd="ComplexAbs",wd="Concat",vd="Conv2D",tx="Conv2DBackpropFilter",bd="Conv2DBackpropInput",kd="Conv3D",nx="Conv3DBackpropFilterV2",sx="Conv3DBackpropInputV2",Kl="Cos",ql="Cosh",rx="Cumprod",Cd="Cumsum",ox="CropAndResize",gk="DenseBincount",ix="DepthToSpace",Id="DepthwiseConv2dNative",ax="DepthwiseConv2dNativeBackpropFilter",lx="DepthwiseConv2dNativeBackpropInput",xk="Diag",$d="Dilation2D",lg="Dilation2DBackpropInput",ug="Dilation2DBackpropFilter",Xl="RealDiv",yk="Einsum",Yl="Elu",ux="EluGrad",Ql="Erf",Sd="Equal",Zl="Exp",Nd="ExpandDims",Jl="Expm1",cx="FFT",hx="Fill",dx="FlipLeftRight",eu="Floor",tu="FloorDiv",Td="FusedBatchNorm",Ed="GatherV2",wk="GatherNd",Rd="Greater",nu="GreaterEqual",su="Identity",fx="IFFT",px="Imag",ru="IsFinite",ou="IsInf",iu="IsNan",Dd="LeakyRelu",Ad="Less",Fd="LessEqual",vk="LinSpace",au="Log",lu="Log1p",_d="LogicalAnd",Od="LogicalNot",Ld="LogicalOr",HE="LogSoftmax",Pd="LRN",mx="LRNGrad",Md="Max",uu="Maximum",zd="MaxPool",gx="MaxPoolGrad",Bd="MaxPool3D",xx="MaxPool3DGrad",bk="MaxPoolWithArgmax",Vd="Mean",Wd="Min",cu="Minimum",Ud="MirrorPad",hu="Mod",kk="Multinomial",du="Multiply",Gd="Neg",Hd="NotEqual",yx="NonMaxSuppressionV3",wx="NonMaxSuppressionV4",vx="NonMaxSuppressionV5",jd="OnesLike",Kd="OneHot",qd="Pack",Xd="PadV2",fu="Pow",Yd="Prelu",Qd="Prod",Ck="RaggedGather",Ik="RaggedTensorToTensor",bx="Range",kx="Real",pu="Reciprocal",mu="Relu",Zd="Reshape",Jd="ResizeNearestNeighbor",Cx="ResizeNearestNeighborGrad",ef="ResizeBilinear",Ix="ResizeBilinearGrad",gu="Relu6",tf="Reverse",xu="Round",yu="Rsqrt",$k="ScatterNd",Sk="SearchSorted",nf="Select",wu="Selu",sf="Slice",vu="Sin",bu="Sinh",ku="Sign",Cu="Sigmoid",Iu="Softplus",$u="Sqrt",rf="Sum",of="SpaceToBatchND",af="SplitV",lf="Softmax",Nk="SparseFillEmptyRows",Tk="SparseReshape",Ek="SparseSegmentMean",Rk="SparseSegmentSum",Dk="SparseToDense",Su="SquaredDifference",$x="Square",Sx="StridedSlice",Ak="StringNGrams",Fk="StringSplit",_k="StringToHashBucketFast",Nu="Sub",Tu="Tan",Eu="Tanh",Ru="Tile",Nx="TopK",Tx="Transform",Zi="Transpose",Ex="Unique",uf="Unpack",cf="UnsortedSegmentSum",hf="ZerosLike",Du="Step",jE="FromPixels",Rx="RotateWithOffset",Lh="_FusedMatMul",Ph="FusedConv2D",Ok="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function os(...n){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(...n)}function KE(...n){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mh=Kg("kernelRegistry",()=>new Map),cg=Kg("gradRegistry",()=>new Map);function Cv(n,e){const t=Pk(n,e);return Mh.get(t)}function Iv(n){return cg.get(n)}function $v(n){const e=Mh.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[l]=o.split("_");l===n&&t.push(i)}return t}function Lk(n){const{kernelName:e,backendName:t}=n,s=Pk(e,t);Mh.has(s)&&os(`The kernel '${e}' for backend '${t}' is already registered`),Mh.set(s,n)}function qE(n){const{kernelName:e}=n;cg.has(e)&&ae().getBool("DEBUG")&&os(`Overriding the gradient for '${e}'`),cg.set(e,n)}function Pk(n,e){return`${e}_${n}`}var zm,Sv;function XE(){if(Sv)return zm;Sv=1,zm=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,T,z){this.low=D|0,this.high=T|0,this.unsigned=!!z}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var s={},r={};function o(D,T){var z,U,Q;return T?(D>>>=0,(Q=0<=D&&D<256)&&(U=r[D],U)?U:(z=l(D,(D|0)<0?-1:0,!0),Q&&(r[D]=z),z)):(D|=0,(Q=-128<=D&&D<128)&&(U=s[D],U)?U:(z=l(D,D<0?-1:0,!1),Q&&(s[D]=z),z))}e.fromInt=o;function i(D,T){if(isNaN(D))return T?C:b;if(T){if(D<0)return C;if(D>=y)return O}else{if(D<=-w)return F;if(D+1>=w)return R}return D<0?i(-D,T).neg():l(D%g|0,D/g|0,T)}e.fromNumber=i;function l(D,T,z){return new e(D,T,z)}e.fromBits=l;var u=Math.pow;function h(D,T,z){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return b;if(typeof T=="number"?(z=T,T=!1):T=!!T,z=z||10,z<2||36<z)throw RangeError("radix");var U;if((U=D.indexOf("-"))>0)throw Error("interior hyphen");if(U===0)return h(D.substring(1),T,z).neg();for(var Q=i(u(z,8)),q=b,J=0;J<D.length;J+=8){var ne=Math.min(8,D.length-J),B=parseInt(D.substring(J,J+ne),z);if(ne<8){var X=i(u(z,ne));q=q.mul(X).add(i(B))}else q=q.mul(Q),q=q.add(i(B))}return q.unsigned=T,q}e.fromString=h;function d(D,T){return typeof D=="number"?i(D,T):typeof D=="string"?h(D,T):l(D.low,D.high,typeof T=="boolean"?T:D.unsigned)}e.fromValue=d;var f=65536,m=1<<24,g=f*f,y=g*g,w=y/2,v=o(m),b=o(0);e.ZERO=b;var C=o(0,!0);e.UZERO=C;var S=o(1);e.ONE=S;var $=o(1,!0);e.UONE=$;var N=o(-1);e.NEG_ONE=N;var R=l(-1,2147483647,!1);e.MAX_VALUE=R;var O=l(-1,-1,!0);e.MAX_UNSIGNED_VALUE=O;var F=l(0,-2147483648,!1);e.MIN_VALUE=F;var A=e.prototype;return A.toInt=function(){return this.unsigned?this.low>>>0:this.low},A.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},A.toString=function(T){if(T=T||10,T<2||36<T)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(F)){var z=i(T),U=this.div(z),Q=U.mul(z).sub(this);return U.toString(T)+Q.toInt().toString(T)}else return"-"+this.neg().toString(T);for(var q=i(u(T,6),this.unsigned),J=this,ne="";;){var B=J.div(q),X=J.sub(B.mul(q)).toInt()>>>0,Y=X.toString(T);if(J=B,J.isZero())return Y+ne;for(;Y.length<6;)Y="0"+Y;ne=""+Y+ne}},A.getHighBits=function(){return this.high},A.getHighBitsUnsigned=function(){return this.high>>>0},A.getLowBits=function(){return this.low},A.getLowBitsUnsigned=function(){return this.low>>>0},A.getNumBitsAbs=function(){if(this.isNegative())return this.eq(F)?64:this.neg().getNumBitsAbs();for(var T=this.high!=0?this.high:this.low,z=31;z>0&&!(T&1<<z);z--);return this.high!=0?z+33:z+1},A.isZero=function(){return this.high===0&&this.low===0},A.eqz=A.isZero,A.isNegative=function(){return!this.unsigned&&this.high<0},A.isPositive=function(){return this.unsigned||this.high>=0},A.isOdd=function(){return(this.low&1)===1},A.isEven=function(){return(this.low&1)===0},A.equals=function(T){return t(T)||(T=d(T)),this.unsigned!==T.unsigned&&this.high>>>31===1&&T.high>>>31===1?!1:this.high===T.high&&this.low===T.low},A.eq=A.equals,A.notEquals=function(T){return!this.eq(T)},A.neq=A.notEquals,A.ne=A.notEquals,A.lessThan=function(T){return this.comp(T)<0},A.lt=A.lessThan,A.lessThanOrEqual=function(T){return this.comp(T)<=0},A.lte=A.lessThanOrEqual,A.le=A.lessThanOrEqual,A.greaterThan=function(T){return this.comp(T)>0},A.gt=A.greaterThan,A.greaterThanOrEqual=function(T){return this.comp(T)>=0},A.gte=A.greaterThanOrEqual,A.ge=A.greaterThanOrEqual,A.compare=function(T){if(t(T)||(T=d(T)),this.eq(T))return 0;var z=this.isNegative(),U=T.isNegative();return z&&!U?-1:!z&&U?1:this.unsigned?T.high>>>0>this.high>>>0||T.high===this.high&&T.low>>>0>this.low>>>0?-1:1:this.sub(T).isNegative()?-1:1},A.comp=A.compare,A.negate=function(){return!this.unsigned&&this.eq(F)?F:this.not().add(S)},A.neg=A.negate,A.add=function(T){t(T)||(T=d(T));var z=this.high>>>16,U=this.high&65535,Q=this.low>>>16,q=this.low&65535,J=T.high>>>16,ne=T.high&65535,B=T.low>>>16,X=T.low&65535,Y=0,L=0,W=0,ie=0;return ie+=q+X,W+=ie>>>16,ie&=65535,W+=Q+B,L+=W>>>16,W&=65535,L+=U+ne,Y+=L>>>16,L&=65535,Y+=z+J,Y&=65535,l(W<<16|ie,Y<<16|L,this.unsigned)},A.subtract=function(T){return t(T)||(T=d(T)),this.add(T.neg())},A.sub=A.subtract,A.multiply=function(T){if(this.isZero())return b;if(t(T)||(T=d(T)),n){var z=n.mul(this.low,this.high,T.low,T.high);return l(z,n.get_high(),this.unsigned)}if(T.isZero())return b;if(this.eq(F))return T.isOdd()?F:b;if(T.eq(F))return this.isOdd()?F:b;if(this.isNegative())return T.isNegative()?this.neg().mul(T.neg()):this.neg().mul(T).neg();if(T.isNegative())return this.mul(T.neg()).neg();if(this.lt(v)&&T.lt(v))return i(this.toNumber()*T.toNumber(),this.unsigned);var U=this.high>>>16,Q=this.high&65535,q=this.low>>>16,J=this.low&65535,ne=T.high>>>16,B=T.high&65535,X=T.low>>>16,Y=T.low&65535,L=0,W=0,ie=0,ce=0;return ce+=J*Y,ie+=ce>>>16,ce&=65535,ie+=q*Y,W+=ie>>>16,ie&=65535,ie+=J*X,W+=ie>>>16,ie&=65535,W+=Q*Y,L+=W>>>16,W&=65535,W+=q*X,L+=W>>>16,W&=65535,W+=J*B,L+=W>>>16,W&=65535,L+=U*Y+Q*X+q*B+J*ne,L&=65535,l(ie<<16|ce,L<<16|W,this.unsigned)},A.mul=A.multiply,A.divide=function(T){if(t(T)||(T=d(T)),T.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&T.low===-1&&T.high===-1)return this;var z=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,T.low,T.high);return l(z,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:b;var U,Q,q;if(this.unsigned){if(T.unsigned||(T=T.toUnsigned()),T.gt(this))return C;if(T.gt(this.shru(1)))return $;q=C}else{if(this.eq(F)){if(T.eq(S)||T.eq(N))return F;if(T.eq(F))return S;var J=this.shr(1);return U=J.div(T).shl(1),U.eq(b)?T.isNegative()?S:N:(Q=this.sub(T.mul(U)),q=U.add(Q.div(T)),q)}else if(T.eq(F))return this.unsigned?C:b;if(this.isNegative())return T.isNegative()?this.neg().div(T.neg()):this.neg().div(T).neg();if(T.isNegative())return this.div(T.neg()).neg();q=b}for(Q=this;Q.gte(T);){U=Math.max(1,Math.floor(Q.toNumber()/T.toNumber()));for(var ne=Math.ceil(Math.log(U)/Math.LN2),B=ne<=48?1:u(2,ne-48),X=i(U),Y=X.mul(T);Y.isNegative()||Y.gt(Q);)U-=B,X=i(U,this.unsigned),Y=X.mul(T);X.isZero()&&(X=S),q=q.add(X),Q=Q.sub(Y)}return q},A.div=A.divide,A.modulo=function(T){if(t(T)||(T=d(T)),n){var z=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,T.low,T.high);return l(z,n.get_high(),this.unsigned)}return this.sub(this.div(T).mul(T))},A.mod=A.modulo,A.rem=A.modulo,A.not=function(){return l(~this.low,~this.high,this.unsigned)},A.and=function(T){return t(T)||(T=d(T)),l(this.low&T.low,this.high&T.high,this.unsigned)},A.or=function(T){return t(T)||(T=d(T)),l(this.low|T.low,this.high|T.high,this.unsigned)},A.xor=function(T){return t(T)||(T=d(T)),l(this.low^T.low,this.high^T.high,this.unsigned)},A.shiftLeft=function(T){return t(T)&&(T=T.toInt()),(T&=63)===0?this:T<32?l(this.low<<T,this.high<<T|this.low>>>32-T,this.unsigned):l(0,this.low<<T-32,this.unsigned)},A.shl=A.shiftLeft,A.shiftRight=function(T){return t(T)&&(T=T.toInt()),(T&=63)===0?this:T<32?l(this.low>>>T|this.high<<32-T,this.high>>T,this.unsigned):l(this.high>>T-32,this.high>=0?0:-1,this.unsigned)},A.shr=A.shiftRight,A.shiftRightUnsigned=function(T){if(t(T)&&(T=T.toInt()),T&=63,T===0)return this;var z=this.high;if(T<32){var U=this.low;return l(U>>>T|z<<32-T,z>>>T,this.unsigned)}else return T===32?l(z,0,this.unsigned):l(z>>>T-32,0,this.unsigned)},A.shru=A.shiftRightUnsigned,A.shr_u=A.shiftRightUnsigned,A.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},A.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},A.toBytes=function(T){return T?this.toBytesLE():this.toBytesBE()},A.toBytesLE=function(){var T=this.high,z=this.low;return[z&255,z>>>8&255,z>>>16&255,z>>>24,T&255,T>>>8&255,T>>>16&255,T>>>24]},A.toBytesBE=function(){var T=this.high,z=this.low;return[T>>>24,T>>>16&255,T>>>8&255,T&255,z>>>24,z>>>16&255,z>>>8&255,z&255]},e.fromBytes=function(T,z,U){return U?e.fromBytesLE(T,z):e.fromBytesBE(T,z)},e.fromBytesLE=function(T,z){return new e(T[0]|T[1]<<8|T[2]<<16|T[3]<<24,T[4]|T[5]<<8|T[6]<<16|T[7]<<24,z)},e.fromBytesBE=function(T,z){return new e(T[4]<<24|T[5]<<16|T[6]<<8|T[7],T[0]<<24|T[1]<<16|T[2]<<8|T[3],z)},zm}var Mk=XE();const zk=yE(Mk),YE=xE({__proto__:null,default:zk},[Mk]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Go=zk||YE;function df(n){return Go.fromString(n,!0,16)}const Bk=df("c3a5c85c97cb3127"),Uo=df("b492b66fbe98f273"),In=df("9ae16a3b2f90404f");function hg(n){return n.xor(n.shru(47))}function Vk(n,e,t){const s=n.slice(e,e+t);return Go.fromBytes(Array.from(s),!0,!0)}function ft(n,e){return Vk(n,e,8)}function Nv(n,e){return Vk(n,e,4)}function Qt(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function io(n,e,t=df("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function QE(n,e,t,s,r,o){r=r.add(n),o=Qt(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(t),o=o.add(Qt(r,44)),[r.add(s),o.add(i)]}function dh(n,e,t,s){return QE(ft(n,e),ft(n,e+8),ft(n,e+16),ft(n,e+24),t,s)}function ZE(n,e=n.length){if(e>=8){const t=In.add(e*2),s=ft(n,0).add(In),r=ft(n,e-8),o=Qt(r,37).mul(t).add(s),i=Qt(s,25).add(r).mul(t);return io(o,i,t)}if(e>=4){const t=In.add(e*2),s=Nv(n,0);return io(s.shl(3).add(e),Nv(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),i=e+(r<<2);return hg(In.mul(o).xor(Bk.mul(i))).mul(In)}return In}function JE(n,e=n.length){const t=In.add(e*2),s=ft(n,0).mul(Uo),r=ft(n,8),o=ft(n,e-8).mul(t),i=ft(n,e-16).mul(In);return io(Qt(s.add(r),43).add(Qt(o,30)).add(i),s.add(Qt(r.add(In),18)).add(o),t)}function eR(n,e=n.length){const t=In.add(e*2),s=ft(n,0).mul(In),r=ft(n,8),o=ft(n,e-8).mul(t),i=ft(n,e-16).mul(In),l=Qt(s.add(r),43).add(Qt(o,30)).add(i),u=io(l,s.add(Qt(r.add(In),18)).add(o),t),h=ft(n,16).mul(t),d=ft(n,24),f=l.add(ft(n,e-32)).mul(t),m=u.add(ft(n,e-24)).mul(t);return io(Qt(h.add(d),43).add(Qt(f,30)).add(m),h.add(Qt(d.add(s),18)).add(f),t)}function tR(n,e=n.length){const t=Go.fromNumber(81,!0);if(e<=32)return e<=16?ZE(n,e):JE(n,e);if(e<=64)return eR(n,e);let s=t,r=t.mul(Uo).add(113),o=hg(r.mul(In).add(113)).mul(In),i=[Go.UZERO,Go.UZERO],l=[Go.UZERO,Go.UZERO];s=s.mul(In).add(ft(n,0));let u=0;const h=(e-1>>6)*64,d=h+(e-1&63)-63;do s=Qt(s.add(r).add(i[0]).add(ft(n,u+8)),37).mul(Uo),r=Qt(r.add(i[1]).add(ft(n,u+48)),42).mul(Uo),s=s.xor(l[1]),r=r.add(i[0]).add(ft(n,u+40)),o=Qt(o.add(l[0]),33).mul(Uo),i=dh(n,u,i[1].mul(Uo),s.add(l[0])),l=dh(n,u+32,o.add(l[1]),r.add(ft(n,u+16))),[o,s]=[s,o],u+=64;while(u!==h);const f=Uo.add(o.and(255).shl(1));return u=d,l[0]=l[0].add(e-1&63),i[0]=i[0].add(l[0]),l[0]=l[0].add(i[0]),s=Qt(s.add(r).add(i[0]).add(ft(n,u+8)),37).mul(f),r=Qt(r.add(i[1]).add(ft(n,u+48)),42).mul(f),s=s.xor(l[1].mul(9)),r=r.add(i[0].mul(9).add(ft(n,u+40))),o=Qt(o.add(l[0]),33).mul(f),i=dh(n,u,i[1].mul(f),s.add(l[0])),l=dh(n,u+32,o.add(l[1]),r.add(ft(n,u+16))),[o,s]=[s,o],io(io(i[0],l[0],f).add(hg(r).mul(Bk)).add(o),io(i[1],l[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yo(n,e){return e==="string"?ao(n):hi([n],e)}function nR(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function hi(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=na(n)),ae().getBool("DEBUG")&&_E(n,e),nR(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Fn(){return ae().platform.now()}function ao(n,e="utf-8"){return e=e||"utf-8",ae().platform.encode(n,e)}function co(n,e="utf-8"){return e=e||"utf-8",ae().platform.decode(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sR{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new oR)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let i;const l=Fn();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const h of r)h.dataSync();i=Promise.resolve({kernelMs:Fn()-l})}if(ae().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let h=0;h<r.length;h++){const d=r[h];d.data().then(f=>{rR(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(h=>h.kernelMs),extraInfo:i.then(h=>h.getExtraProfileInfo!=null?h.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(l=>{Promise.all([l.data(),r,i]).then(u=>{this.logger.logKernelProfile(t,l,u[0],u[1],o,u[2])})})}}function rR(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class oR{logKernelProfile(e,t,s,r,o,i){const l=typeof r=="number"?Qi(`${r}ms`,9):r.error,u=Qi(e,25),h=t.rank,d=t.size,f=Qi(t.shape.toString(),14);let m="";for(const g in o){const y=o[g];if(y!=null){const w=y.shape||t.shape,v=w.length;m+=`${g}: ${v}D ${v>0?w:""} `}}console.log(`%c${u}	%c${l}	%c${h}D ${f}	%c${d}	%c${m}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iR(n,e,t){const s={},r={};for(let u=0;u<e.length;u++)s[e[u].id]=!0;for(let u=0;u<n.length;u++){const h=n[u],d=h.inputs;for(const f in d){const m=d[f];let g=!1;for(let y=0;y<e.length;y++)if(s[m.id]){h.outputs.forEach(w=>s[w.id]=!0),g=!0,r[h.id]=!0;break}if(g)break}}const o={};o[t.id]=!0;const i={};for(let u=n.length-1;u>=0;u--){const h=n[u],d=h.inputs;for(let f=0;f<h.outputs.length;f++)if(o[h.outputs[f].id]){for(const m in d)o[d[m].id]=!0,i[h.id]=!0;break}}const l=[];for(let u=0;u<n.length;u++){const h=n[u];if(r[h.id]&&i[h.id]){const d={};for(const m in h.inputs){const g=h.inputs[m];s[g.id]&&(d[m]=g)}const f=Object.assign({},h);f.inputs=d,f.outputs=h.outputs,l.push(f)}}return l}function aR(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(u=>{const h=n[u.id];h!=null?i.push(h):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const l=o.gradient(i);for(const u in o.inputs){if(!(u in l))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(l)}.`);const h=t(()=>l[u]());if(h.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${h.dtype}'`);const d=o.inputs[u];if(!ot(h.shape,d.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${u}' has shape '${h.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=h;else{const f=n[d.id];n[d.id]=s(f,h),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tv=20,ml=3,Bm=7;function lR(n,e,t,s){const r=Ae(e),o=uR(n,e,t,r),i=e.length,l=$h(n,e,t,r,o),u=["Tensor"];return s&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(l.map(h=>"    "+h).join(`
`)),u.join(`
`)}function uR(n,e,t,s){const r=ue(e),o=s[s.length-1],i=new Array(o).fill(0),l=e.length,u=t==="complex64"?yl(n):n;if(l>1)for(let h=0;h<r/o;h++){const d=h*o;for(let f=0;f<o;f++)i[f]=Math.max(i[f],xl(u[d+f],0,t).length)}return i}function xl(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Bm))} + ${parseFloat(n[1].toFixed(Bm))}j`:Ol(n)?s=`'${n}'`:t==="bool"?s=Wk(n):s=parseFloat(n.toFixed(Bm)).toString(),Qi(s,e)}function Wk(n){return n===0?"false":"true"}function $h(n,e,t,s,r,o=!0){const i=t==="complex64"?2:1,l=e[0],u=e.length;if(u===0){if(t==="complex64"){const w=yl(n);return[xl(w[0],0,t)]}return t==="bool"?[Wk(n[0])]:[n[0].toString()]}if(u===1){if(l>Tv){const v=ml*i;let b=Array.from(n.slice(0,v)),C=Array.from(n.slice((l-ml)*i,l*i));return t==="complex64"&&(b=yl(b),C=yl(C)),["["+b.map((S,$)=>xl(S,r[$],t)).join(", ")+", ..., "+C.map((S,$)=>xl(S,r[l-ml+$],t)).join(", ")+"]"]}return["["+(t==="complex64"?yl(n):Array.from(n)).map((v,b)=>xl(v,r[b],t)).join(", ")+"]"]}const h=e.slice(1),d=s.slice(1),f=s[0]*i,m=[];if(l>Tv){for(let w=0;w<ml;w++){const v=w*f,b=v+f;m.push(...$h(n.slice(v,b),h,t,d,r,!1))}m.push("...");for(let w=l-ml;w<l;w++){const v=w*f,b=v+f;m.push(...$h(n.slice(v,b),h,t,d,r,w===l-1))}}else for(let w=0;w<l;w++){const v=w*f,b=v+f;m.push(...$h(n.slice(v,b),h,t,d,r,w===l-1))}const g=u===2?",":"";m[0]="["+m[0]+g;for(let w=1;w<m.length-1;w++)m[w]=" "+m[w]+g;let y=`,
`;for(let w=2;w<u;w++)y+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":y),m}function yl(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=ue(e),s!=null){const r=s.length;_(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Jt(t,this.size),this.strides=Ae(e)}set(e,...t){t.length===0&&(t=[0]),_(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Bs().makeTensor(this.values,this.shape,this.dtype)}}let Bs=null,qi=null;function cR(n){Bs=n}function hR(n){qi=n}class Pt{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ue(e),this.strides=Ae(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return qi.buffer(this.shape,this.dtype,e)}bufferSync(){return qi.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Gs(this.shape,e,this.dtype==="complex64")}arraySync(){return Gs(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Bs().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>co(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Bs().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Bs().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>co(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Bs().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Bs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return qi.print(this,e)}clone(){return this.throwIfDisposed(),qi.clone(this)}toString(e=!1){const t=this.dataSync();return lR(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),qi.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Bs().makeVariable(this,e,t,s)}}Object.defineProperty(Pt,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function le(){return Kg("Tensor",()=>Pt)}le();class zh extends Pt{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ot(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Bs().disposeTensor(this),this.dataId=e.dataId,Bs().incRef(this,null)}dispose(){Bs().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(zh,Symbol.hasInstance,{value:n=>n instanceof Pt&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ev;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Ev||(Ev={}));var dg;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(dg||(dg={}));var fg;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(fg||(fg={}));var pg;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(pg||(pg={}));var mg;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(mg||(mg={}));const dR={float32:pg,int32:dg,bool:fg,complex64:mg};function Kn(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return dR[n][e]}function Dx(n){return Kn(n,"int32")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function At(n,e){if(n.dtype===e.dtype)return[n,e];const t=Kn(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Uk(n){const e=[];return Gk(n,e,new Set),e}function Gk(n,e,t){if(n==null)return;if(n instanceof Pt){e.push(n);return}if(!fR(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),Gk(o,e,t))}}function fR(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vm(n){return n.kernelName!=null}class Rv{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ra{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Rv}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(os(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new sR(this.backendInstance),!0}setupRegisteredKernels(){$v(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){$v(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof Ug)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,os(`Initialization of backend ${e} failed`),os(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return os(`Initialization of backend ${e} failed`),os(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return ra.nextTensorId++}nextVariableId(){return ra.nextVariableId++}clone(e){const t=K.runKernel(su,{x:e}),s={x:e},r=i=>({x:()=>{const l="float32",u={x:i},h={dtype:l};return K.runKernel(Gl,u,h)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(Cv(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(u=>{o+=u.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=r-t-o-i;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let u;const h=Vm(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Vm(e)){const{kernelName:y,inputs:w,attrs:v}=e;this.backendName==null&&this.backend;const b=Cv(y,this.backendName);_(b!=null,()=>`Cannot find registered kernel '${y}' for backend '${this.backendName}'`),l=()=>{const C=this.backend.numDataIds();u=b.kernelFunc({inputs:w,attrs:v,backend:this.backend});const S=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(y,C,S);const $=S.map(N=>N.rank!=null?N:this.makeTensorFromTensorInfo(N));if(r){const N=this.getTensorsForGradient(y,w,$);s=this.saveTensorsForBackwardMode(N)}return $}}else{const{forwardFunc:y}=e,w=v=>{r&&(s=v.map(b=>this.keep(this.clone(b))))};l=()=>{const v=this.backend.numDataIds();u=this.tidy(()=>y(this.backend,w));const b=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,v,b),b}}const{inputs:d,attrs:f}=e,m=Vm(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=l():(g=this.profiler.profileKernel(h,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(h,d,t,m,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:h,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(y=>d[y]!=null?d[y].shape:null),outputShapes:t.map(y=>y.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=Iv(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let l;r.saveAllInputs?(_(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(t).map(h=>t[h])):l=o.map(h=>t[h]);const u=s.filter((h,d)=>i[d]);return l.concat(u)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&Ol(e[0])&&(o=e.map(u=>ao(u)));const i=r.write(o,t,s),l=new Pt(t,s,i,this.nextTensorId());if(this.trackTensor(l,r),s==="string"){const u=this.state.tensorInfo.get(i),h=LE(o);this.state.numBytes+=h-u.bytes,u.bytes=h}return l}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,i=new Pt(r,o,s,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new zh(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*rg(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof zh||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*rg(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,i){const l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},u=Iv(e);u!=null&&(r=u.gradFunc),r!=null&&(l.gradient=h=>(h=h.map((d,f)=>{if(d==null){const m=s[f],g=gn(m.size,m.dtype);return this.makeTensor(g,m.shape,m.dtype)}return d}),r(h.length>1?h:h[0],o,i))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Uk(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(_(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));_(o instanceof Pt,()=>"The result y returned by f() must be a tensor.");const i=iR(this.state.activeTape,t,o);if(!r&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const l={};l[o.id]=s??pR(o.shape),aR(l,i,h=>this.tidy(h),mR);const u=t.map(h=>l[h.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(h=>{for(const d of h.saved)d.dispose()}),this.state.activeTape=null),{value:o,grads:u}})}customGrad(e){return _(ig(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{_(t.every(l=>l instanceof Pt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((l,u)=>{r[u]=l});const o=(l,u)=>(s=e(...t,u),_(s.value instanceof Pt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),_(ig(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(l,u)=>{const h=s.gradFunc(l,u),d=Array.isArray(h)?h:[h];_(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),_(d.every(m=>m instanceof Pt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((m,g)=>{f[g]=()=>m}),f};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Fn(),s=await this.backend.time(e);return s.wallMs=Fn()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Rv;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ra.nextTensorId=0;ra.nextVariableId=0;function pR(n){const e=jg(ue(n),"float32");return K.makeTensor(e,n,"float32")}function Hk(){const n=pk();if(n._tfengine==null){const e=new ME(n);n._tfengine=new ra(e)}return WE(n._tfengine.ENV),cR(()=>n._tfengine),n._tfengine}const K=Hk();function mR(n,e){const t={a:n,b:e};return K.runKernel(xa,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gR(){return typeof navigator<"u"&&navigator!=null}function jk(n){if(n||gR()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Kk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qn=ae();qn.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});qn.registerFlag("IS_BROWSER",()=>Kk());qn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");qn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));qn.registerFlag("PROD",()=>!1);qn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>qn.getBool("DEBUG"));qn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);qn.registerFlag("IS_TEST",()=>!1);qn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);qn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);qn.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);qn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);qn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ff(n,e){let t=n;if(dr(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||dr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&ae().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&qk(n,s,[]),s}function qk(n,e,t){if(t=t||[],!Array.isArray(n)&&!dr(n)){_(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}_(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),_(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)qk(n[r],s,t.concat(r))}function Dv(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function M(n,e,t,s="numeric"){if(n instanceof Pt)return Dv(s,n.dtype,e,t),n;let r=Ll(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),Dv(s,r,e,t),n==null||!dr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const u=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}const o=ff(n,r);!dr(n)&&!Array.isArray(n)&&(n=[n]);const l=r!=="string"?hi(n,r):na(n,[],!0);return K.makeTensor(l,o,r)}function Xk(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>M(o,`${e}[${i}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xR="__op";function ee(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+xR;const r=(...o)=>{K.startScope(t);try{const i=s(...o);return dk(i)&&console.error("Cannot return a Promise inside of tidy."),K.endScope(i),i}catch(i){throw K.endScope(null),i}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yR(n,e){const t=M(n,"real","complex"),s=M(e,"imag","complex");Hg(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return K.runKernel(ex,r)}const ei=ee({complex_:yR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pf(n,e,t,s){if(s==null&&(s=Ll(n)),s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!dr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){hk(e);const r=ue(e),o=ue(t);_(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<t.length;++i){const l=t[i],u=i===t.length-1?l!==ue(e.slice(i)):!0;_(t[i]===e[i]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!dr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?hi(n,s):na(n,[],!0),K.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sh(n,e,t){const s=ff(n,t);return pf(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Av={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bh=4;async function Fv(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const l=r[i],u=Array.isArray(n)?n[i].tensor:n[l];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${l}': ${u.dtype}`);const h={name:l,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const d=new Promise(async f=>{const m=await u.bytes(),g=m.reduce((v,b)=>v+b.length,0)+Bh*m.length,y=new Uint8Array(g);let w=0;for(let v=0;v<m.length;v++){const b=m[v],C=new Uint8Array(new Uint32Array([b.length]).buffer);y.set(C,w),w+=Bh,y.set(b,w),w+=b.length}f(y)});s.push(d)}else s.push(u.data());e!=null&&(h.group=e),t.push(h)}const o=await Promise.all(s);return{data:vR(o),specs:t}}function wR(n,e){const t={};let s,r=0;for(const o of e){const i=o.name,l=o.dtype,u=o.shape,h=ue(u);let d;if("quantization"in o){const f=o.quantization;if(f.dtype==="uint8"||f.dtype==="uint16"){if(!("min"in f&&"scale"in f))throw new Error(`Weight ${o.name} with quantization ${f.dtype} doesn't have corresponding metadata min and scale.`)}else if(f.dtype==="float16"){if(l!=="float32")throw new Error(`Weight ${o.name} is quantized with ${f.dtype} which only supports weights of type float32 not ${l}.`)}else throw new Error(`Weight ${o.name} has unknown quantization dtype ${f.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const m=Av[f.dtype],g=n.slice(r,r+h*m),y=f.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(l==="float32")if(f.dtype==="uint8"||f.dtype==="uint16"){d=new Float32Array(y.length);for(let w=0;w<y.length;w++){const v=y[w];d[w]=v*f.scale+f.min}}else if(f.dtype==="float16")s===void 0&&(s=RR()),d=s(y);else throw new Error(`Unsupported quantization type ${f.dtype} for weight type float32.`);else if(l==="int32"){if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error(`Unsupported quantization type ${f.dtype} for weight type int32.`);d=new Int32Array(y.length);for(let w=0;w<y.length;w++){const v=y[w];d[w]=Math.round(v*f.scale+f.min)}}else throw new Error(`Unsupported dtype in weight '${i}': ${l}`);r+=h*m}else if(l==="string"){const f=ue(o.shape);d=[];for(let m=0;m<f;m++){const g=new Uint32Array(n.slice(r,r+Bh))[0];r+=Bh;const y=new Uint8Array(n.slice(r,r+g));d.push(y),r+=g}}else{const f=Av[l],m=n.slice(r,r+h*f);if(l==="float32")d=new Float32Array(m);else if(l==="int32")d=new Int32Array(m);else if(l==="bool")d=new Uint8Array(m);else if(l==="complex64"){d=new Float32Array(m);const g=new Float32Array(d.length/2),y=new Float32Array(d.length/2);for(let b=0;b<g.length;b++)g[b]=d[b*2],y[b]=d[b*2+1];const w=Sh(g,u,"float32"),v=Sh(y,u,"float32");t[i]=ei(w,v),w.dispose(),v.dispose()}else throw new Error(`Unsupported dtype in weight '${i}': ${l}`);r+=h*f}l!=="complex64"&&(t[i]=Sh(d,u,l))}return t}function vR(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const Ax=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function _v(n){return Ax?Buffer.byteLength(n):new Blob([n]).size}function bR(n){if(Ax)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function kR(n){if(Ax){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function Yk(n){if(n.length===1)return n[0];let e=0;n.forEach(r=>{e+=r.byteLength});const t=new Uint8Array(e);let s=0;return n.forEach(r=>{t.set(new Uint8Array(r),s),s+=r.byteLength}),t.buffer}function CR(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function IR(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),s}async function $R(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),IR(n,t,s)}function Fx(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:_v(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:_v(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function SR(n){const e=[];for(const t of n)e.push(...t.weights);return e}function NR(){const n=t=>{let s=t<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function TR(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function ER(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function RR(){const n=NR(),e=TR(),t=ER();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const l=s[i],u=n[t[l>>10]+(l&1023)]+e[l>>10];o[i]=u}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yt{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Yt.instance==null&&(Yt.instance=new Yt),Yt.instance}static registerSaveRouter(e){Yt.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Yt.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Yt.getHandlers(e,"save")}static getLoadHandlers(e,t){return Yt.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Yt.getInstance().loadRouters:Yt.getInstance().saveRouters).forEach(i=>{const l=i(e,s);l!==null&&r.push(l)}),r}}const DR=n=>Yt.getSaveHandlers(n),AR=(n,e)=>Yt.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gg="tensorflowjs",xg=1,Ko="models_store",ro="model_info_store";function Qk(){if(!ae().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function yg(n){const e=n.result;e.createObjectStore(Ko,{keyPath:"modelPath"}),e.createObjectStore(ro,{keyPath:"modelPath"})}class ti{constructor(e){if(this.indexedDB=Qk(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open(gg,xg);o.onupgradeneeded=()=>yg(o),o.onsuccess=()=>{const i=o.result;if(t==null){const l=i.transaction(Ko,"readonly"),h=l.objectStore(Ko).get(this.modelPath);h.onsuccess=()=>{if(h.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(h.result.modelArtifacts)},h.onerror=d=>(i.close(),r(h.error)),l.oncomplete=()=>i.close()}else{const l=Fx(t),u=i.transaction(ro,"readwrite");let h=u.objectStore(ro);const d=h.put({modelPath:this.modelPath,modelArtifactsInfo:l});let f;d.onsuccess=()=>{f=i.transaction(Ko,"readwrite");const g=f.objectStore(Ko).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:l});g.onsuccess=()=>s({modelArtifactsInfo:l}),g.onerror=y=>{h=u.objectStore(ro);const w=h.delete(this.modelPath);w.onsuccess=()=>(i.close(),r(g.error)),w.onerror=v=>(i.close(),r(g.error))}},d.onerror=m=>(i.close(),r(d.error)),u.oncomplete=()=>{f==null?i.close():f.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}ti.URL_SCHEME="indexeddb://";const Zk=n=>ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ti.URL_SCHEME)?FR(n.slice(ti.URL_SCHEME.length)):null;Yt.registerSaveRouter(Zk);Yt.registerLoadRouter(Zk);function FR(n){return new ti(n)}function _R(n){return n.startsWith(ti.URL_SCHEME)?n.slice(ti.URL_SCHEME.length):n}class OR{constructor(){this.indexedDB=Qk()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(gg,xg);s.onupgradeneeded=()=>yg(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(ro,"readonly"),l=o.objectStore(ro).getAll();l.onsuccess=()=>{const u={};for(const h of l.result)u[h.modelPath]=h.modelArtifactsInfo;e(u)},l.onerror=u=>(r.close(),t(l.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=_R(e),new Promise((t,s)=>{const r=this.indexedDB.open(gg,xg);r.onupgradeneeded=()=>yg(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(ro,"readwrite"),l=i.objectStore(ro),u=l.get(e);let h;u.onsuccess=()=>{if(u.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=l.delete(e),f=()=>{h=o.transaction(Ko,"readwrite");const g=h.objectStore(Ko).delete(e);g.onsuccess=()=>t(u.result.modelArtifactsInfo),g.onerror=y=>s(u.error)};d.onsuccess=f,d.onerror=m=>(f(),o.close(),s(u.error))}},u.onerror=d=>(o.close(),s(u.error)),i.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Er="/",Xi="tensorflowjs_models",Jk="info",LR="model_topology",PR="weight_specs",MR="weight_data",zR="model_metadata";function eC(n){return{info:[Xi,n,Jk].join(Er),topology:[Xi,n,LR].join(Er),weightSpecs:[Xi,n,PR].join(Er),weightData:[Xi,n,MR].join(Er),modelMetadata:[Xi,n,zR].join(Er)}}function tC(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function BR(n){const e=n.split(Er);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Er)}function VR(n){return n.startsWith(ni.URL_SCHEME)?n.slice(ni.URL_SCHEME.length):n}class ni{constructor(e){if(!ae().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=eC(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=Fx(e);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,bR(e.weightData));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw tC(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const l=JSON.parse(o);t.format=l.format,t.generatedBy=l.generatedBy,t.convertedBy=l.convertedBy,l.signature!=null&&(t.signature=l.signature),l.userDefinedMetadata!=null&&(t.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(t.modelInitializer=l.modelInitializer),l.trainingConfig!=null&&(t.trainingConfig=l.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=kR(i),t}}ni.URL_SCHEME="localstorage://";const nC=n=>ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ni.URL_SCHEME)?WR(n.slice(ni.URL_SCHEME.length)):null;Yt.registerSaveRouter(nC);Yt.registerLoadRouter(nC);function WR(n){return new ni(n)}class UR{constructor(){_(ae().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),_(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Xi+Er,s=Er+Jk;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const i=BR(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=VR(e);const t=eC(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return tC(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ov="://";class nr{constructor(){this.managers={}}static getInstance(){return nr.instance==null&&(nr.instance=new nr),nr.instance}static registerManager(e,t){_(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Ov)&&(e=e.slice(0,e.indexOf(Ov))),_(e.length>0,()=>"scheme must not be an empty string.");const s=nr.getInstance();_(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=nr.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(nr.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GR{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(!window||!ae().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}}if(ae().get("IS_BROWSER")){ae().setPlatform("browser",new GR);try{nr.registerManager(ni.URL_SCHEME,new UR)}catch{}try{nr.registerManager(ti.URL_SCHEME,new OR)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HR={importFetch:()=>require("node-fetch")};let Wm;class jR{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ae().global.fetch!=null?ae().global.fetch(e,t):(Wm==null&&(Wm=HR.importFetch()),Wm(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}}ae().get("IS_NODE")&&!ae().get("IS_BROWSER")&&ae().setPlatform("node",new jR);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function He(n,e="float32",t){return e=e||"float32",hk(n),new mn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KR(n,e){const t=M(n,"x","cast");if(!OE(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return K.runKernel(Gl,s,r)}const Ce=ee({cast_:KR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n){const t={x:M(n,"x","clone","string_or_numeric")};return K.runKernel(su,t)}const Xo=ee({clone_:qR});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XR(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Hk();const YR={buffer:He,cast:Ce,clone:Xo,print:XR};hR(YR);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lv(n,e,t,s){i(n),t=t??0,s=s??1,l(t,s);let r=0;const o=u=>(u.then(h=>{const d=t+ ++r/n.length*(s-t);return e(d),h}),u);function i(u){_(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function l(u,h){_(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),_(h>=0&&h<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${h}`),_(h>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${h}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function QR(n,e){e==null&&(e={});const t=e.fetchFunc==null?ae().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),l=(e.onProgress==null?await Promise.all(s):await Lv(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(l):await Lv(l,e.onProgress,.5,1)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZR="application/octet-stream",JR="application/json";class _x{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(_(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=ae().platform.fetch,_(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&_(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=CR(e,s);t.body.append("model.json",new Blob([JSON.stringify(r)],{type:JR}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:ZR}),"model.weights.bin");const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:Fx(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return $R(t,o=>this.loadWeights(o))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=eD(t),o=this.weightPathPrefix||s,i=SR(e),l=[],u=[];for(const d of e)for(const f of d.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):l.push(o+f+r);this.weightUrlConverter&&l.push(...await Promise.all(u));const h=await QR(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[i,Yk(h)]}}_x.URL_SCHEME_REGEX=/^https?:\/\//;function eD(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function Pv(n){return n.match(_x.URL_SCHEME_REGEX)!=null}const sC=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>Pv(s)):t=Pv(n),t)return rC(n,e)}return null};Yt.registerSaveRouter(sC);Yt.registerLoadRouter(sC);function rC(n,e){return new _x(n,e)}function tD(n,e){return rC(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Um{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class nD{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function sD(n,e,t,s){const r=arguments;return new nD(rD(...r))}function rD(n,e,t,s){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new Um(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Um({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Um({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:s}))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD(n,e,t=!1,s=!1){let r=M(n,"a","matMul"),o=M(e,"b","matMul");[r,o]=At(r,o);const i={a:r,b:o},l={transposeA:t,transposeB:s};return K.runKernel(gd,i,l)}const st=ee({matMul_:oD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:M(n,"indices","oneHot","int32")},l={dtype:r,depth:e,onValue:t,offValue:s};return K.runKernel(Kd,i,l)}const oC=ee({oneHot_:iD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(){return K}function Mv(){return K.memory()}function re(n,e){return K.tidy(n,e)}function Ge(n){Uk(n).forEach(t=>t.dispose())}function fr(n){return K.keep(n)}function iC(n,e,t=1){return K.registerBackend(n,e,t)}function aD(){return K.backend}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lD(n){const t={input:M(n,"input","imag")};return K.runKernel(px,t)}const Ox=ee({imag_:lD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(n){const t={x:M(n,"x","neg")};return K.runKernel(Gd,t)}const zt=ee({neg_:uD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cD(n){const t={input:M(n,"input","real")};return K.runKernel(kx,t)}const Vh=ee({real_:cD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hD(n,e,t){const s=M(n,"x","transpose");if(e==null&&(e=s.shape.map((i,l)=>l).reverse()),_(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{_(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?re(()=>{let i=Vh(s),l=Ox(s);return i=K.runKernel(Zi,{x:i},o),l=K.runKernel(Zi,{x:l},o),t&&(l=zt(l)),ei(i,l)}):K.runKernel(Zi,r,o)}const qe=ee({transpose_:hD});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oa(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,i=n[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function Kt(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&t.unshift(o)}return t}function Be(n,e){const t=[],s=Math.max(n.length,e.length);for(let r=0;r<s;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)t.unshift(i);else if(i===1)t.unshift(o);else if(o!==i){const l=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(l)}else t.unshift(o)}return t}function Lx(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(ue(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let f=0;f<r.length-1;++f)i*=r[f];const l=n.shape,u=r.slice();u.pop();let h=1;for(let f=o;f<t;++f)h*=l[f],u.push(l[f]);const d=[...Ae(n.shape).map(f=>f/h),1].slice(0,o);return[u,i,h,d]}function aC(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-r;++i)if(t.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${t.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function dD(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}aC(t,e,n)}function Au(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let i=1;for(let f=r;f<o;++f)i*=t[f];const l=r<1?1:r,u=ue(e.shape)/l,h=[...Ae(t.slice(0,r)),1],d=ue(t);return{sliceRank:r,numUpdates:u,sliceSize:i,strides:h,outputSize:d}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wg=-2,fD=-1;function Px(n,e,t){const s=n.shape.length;_(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),_(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)_(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function pD(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Mx(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function lC(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function uC(n,e,t){return t<=n?t:t-(e-1)}function cC(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function mD(n,e,t,s,r,o,i,l,u){const h=n.length;let d=new Array(h),f=new Array(h),m=new Array(h);if(e.length&&t>0){const g=e[0],y=t+1;d=hC(i,g,y,s,n),f=dC(l,g,y,r,n),m=lC(o,g,y,n)}else for(let g=0;g<h;g++)d[g]=pC(i,s,o,n,g,u),f[g]=mC(l,r,o,n,g,u),m[g]=fC(o,g,u);return{begin:d,end:f,strides:m}}function hC(n,e,t,s,r){const o=[...r],i=cC(t,e);for(let l=0;l<o.length;l++)if(i.indexOf(l)>-1)o[l]=0;else{const u=uC(e,t,l);let h=s[u];n&1<<u&&(h=0),o[l]=h}return o}function dC(n,e,t,s,r){const o=[...r],i=cC(t,e);for(let l=0;l<o.length;l++)if(i.indexOf(l)>-1)o[l]=Number.MAX_SAFE_INTEGER;else{const u=uC(e,t,l);let h=s[u];n&1<<u&&(h=Number.MAX_SAFE_INTEGER),o[l]=h}for(let l=0;l<o.length;l++){const u=r[l];o[l]<0&&(o[l]+=u),o[l]=Jo(0,o[l],r[l])}return o}function fC(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function pC(n,e,t,s,r,o){let i=e[r];const l=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(l>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const u=s[r];return i<0&&(i+=u),i=Jo(0,i,u-1),i}function mC(n,e,t,s,r,o){let i=e[r];const l=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(l>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const u=s[r];return i<0&&(i+=u),l>0?i=Jo(0,i,u):i=Jo(-1,i,u-1),i}function zx(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function Bx(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function mf(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{_(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((i,l)=>i>=0?i:(_(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${l}.`),n.shape[l]-s[l])),[s,o]}function Vx(n,e,t,s,r,o,i,l,u){let h;if(s==null?(h=new Array(e.length),h.fill(1)):h=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:h.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:h.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:l,shrinkAxisMask:u};for(let S=0;S<f.dims;S++)d&&1<<S&l&&f.numAddAxisAfterEllipsis++,1<<S&i&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};gD(f,m);let g=!0,y=!0,w=!0;const v=[],b=[];for(let S=0;S<n.length;++S){if(m.strides[S]===0)throw Error(`strides[${S}] must be non-zero`);const $=!!(m.shrinkAxisMask&1<<S),N=n[S];if(N===-1){v.push($?1:-1);continue}const R=[m.beginMask&1<<S,m.endMask&1<<S],O=[m.strides[S]>0?0:-1,m.strides[S]>0?N:N-1];if($&&m.strides[S]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&m.strides[S]===1;const F=!!(m.beginMask&1<<S&&m.endMask&1<<S);if(m.beginValid&&m.endValid){if($){const z=m.begin[S]<0?N+m.begin[S]:m.begin[S];if(m.begin[S]=z,m.end[S]=m.begin[S]+1,z<0||z>=N)throw Error(`slice index ${m.begin[S]} of dimension ${S} out of bounds.`)}else m.begin[S]=zv(m.begin[S],0,m.strides[S],N,R,O),m.end[S]=zv(m.end[S],1,m.strides[S],N,R,O);const T=m.strides[S]===1&&m.begin[S]===0&&m.end[S]===N;g=g&&T,y=y&&(S===0&&m.strides[S]===1||T)}else g=g&&m.strides[S]===1&&F,y=y&&(S===0&&m.strides[S]===1||F);let A,D=!1;if(m.beginValid&&m.endValid?(A=m.end[S]-m.begin[S],D=!0):$?(A=1,D=!0):F&&N>=0&&(m.strides[S]<0?A=-N:A=N,D=!0),D){let T;A===0||A<0!=m.strides[S]<0?T=0:T=Math.trunc(A/m.strides[S])+(A%m.strides[S]!==0?1:0),v.push(T)}else v.push(-1)}for(let S=0;S<m.finalShapeGatherIndices.length;++S){const $=m.finalShapeGatherIndices[S];$>=0?b.push(v[$]):$===wg&&b.push(1)}return{finalShapeSparse:b.filter((S,$)=>m.finalShapeGatherIndices[$]!==wg),finalShape:b,isIdentity:g,sliceDim0:y,isSimpleSlice:w,begin:m.begin,end:m.end,strides:m.strides}}function gD(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(wg),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(fD),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function zv(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const xD=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Px,computeFlatOffset:Bx,computeOutShape:Mx,getNormalizedAxes:mD,isSliceContinous:zx,maskToAxes:pD,parseSliceParams:mf,sliceInfo:Vx,startForAxis:pC,startIndicesWithElidedDims:hC,stopForAxis:mC,stopIndicesWithElidedDims:dC,stridesForAxis:fC,stridesWithElidedDims:lC},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ya{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Cs{constructor(){this.classNameMap={}}static getMap(){return Cs.instance==null&&(Cs.instance=new Cs),Cs.instance}static register(e){Cs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function de(n){_(n.className!=null,()=>"Class being registered does not have the static className property defined."),_(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),_(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Cs.register(n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yD(n,e){let t=M(n,"a","add"),s=M(e,"b","add");[t,s]=At(t,s);const r={a:t,b:s};return K.runKernel(xa,r)}const xe=ee({add_:yD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wD(n,e){let t=M(n,"a","floorDiv"),s=M(e,"b","floorDiv");[t,s]=At(t,s);const r={a:t,b:s};return K.runKernel(tu,r)}const gC=ee({floorDiv_:wD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vD(n,e){let t=M(n,"a","div"),s=M(e,"b","div");if([t,s]=At(t,s),t.dtype==="int32"&&s.dtype==="int32")return gC(t,s);const r={a:t,b:s},o={};return K.runKernel(Xl,r,o)}const Oe=ee({div_:vD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n,e){let t=M(n,"a","mul"),s=M(e,"b","mul");[t,s]=At(t,s);const r={a:t,b:s};return K.runKernel(du,r)}const j=ee({mul_:bD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kD(n){const e=M(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return K.runKernel(yd,t)}else{const t={x:e};return K.runKernel(hd,t)}}const Cn=ee({abs_:kD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CD(n){const t={x:M(n,"x","acos")};return K.runKernel(Pl,t)}const ID=ee({acos_:CD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $D(n){const t={x:M(n,"x","acosh")};return K.runKernel(Ml,t)}const SD=ee({acosh_:$D});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ND(n,e=null,t=!1){const r={x:M(n,"x","all","bool")},o={axis:e,keepDims:t};return K.runKernel(Xg,r,o)}const xC=ee({all_:ND});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TD(n,e=null,t=!1){const r={x:M(n,"x","any","bool")},o={axis:e,keepDims:t};return K.runKernel(Yg,r,o)}const vg=ee({any_:TD});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,e=0){const s={x:M(n,"x","argMax")},r={axis:e};return K.runKernel(dd,s,r)}const Sl=ee({argMax_:ED});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n,e=0){const s={x:M(n,"x","argMin")},r={axis:e};return K.runKernel(fd,s,r)}const DD=ee({argMin_:RD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AD(n){const t={x:M(n,"x","asin")};return K.runKernel(zl,t)}const FD=ee({asin_:AD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(n){const t={x:M(n,"x","asinh")};return K.runKernel(Bl,t)}const OD=ee({asinh_:_D});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LD(n){const t={x:M(n,"x","atan")};return K.runKernel(Vl,t)}const PD=ee({atan_:LD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n,e){let t=M(n,"a","atan2"),s=M(e,"b","atan2");[t,s]=At(t,s);const r={a:t,b:s};return K.runKernel(Ul,r)}const zD=ee({atan2_:MD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BD(n){const t={x:M(n,"x","atanh")};return K.runKernel(Wl,t)}const VD=ee({atanh_:BD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fu(n,e,t,s,r="NHWC",o){const i=n[3],l=[...e,i],u=Or(r);return un(n,l,t,o,s,null,null,u)}function Ns(n,e,t,s,r,o,i="channelsLast"){const[l,u]=Wh(e);let h;if(i==="channelsLast")h=[l,u,n[3],n[3]];else if(i==="channelsFirst")h=[l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return un(n,h,t,s,r,o,!1,i)}function _r(n,e,t,s,r,o,i="NDHWC"){const[l,u,h]=bg(e);let d,f;if(i==="NDHWC")f="channelsLast",d=[l,u,h,n[4],n[4]];else if(i==="NCDHW")f="channelsFirst",d=[l,u,h,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return wo(n,d,t,s,r,!1,f,o)}function un(n,e,t,s,r,o,i=!1,l="channelsLast"){let[u,h,d,f]=[-1,-1,-1,-1];if(l==="channelsLast")[u,h,d,f]=n;else if(l==="channelsFirst")[u,f,h,d]=n;else throw new Error(`Unknown dataFormat ${l}`);const[m,g,,y]=e,[w,v]=Wh(t),[b,C]=Wh(s),S=Ji(m,b),$=Ji(g,C),{padInfo:N,outHeight:R,outWidth:O}=GD(r,h,d,w,v,S,$,o,l),F=i?y*f:y;let A;return l==="channelsFirst"?A=[u,F,R,O]:l==="channelsLast"&&(A=[u,R,O,F]),{batchSize:u,dataFormat:l,inHeight:h,inWidth:d,inChannels:f,outHeight:R,outWidth:O,outChannels:F,padInfo:N,strideHeight:w,strideWidth:v,filterHeight:m,filterWidth:g,effectiveFilterHeight:S,effectiveFilterWidth:$,dilationHeight:b,dilationWidth:C,inShape:n,outShape:A,filterShape:e}}function wo(n,e,t,s,r,o=!1,i="channelsLast",l){let[u,h,d,f,m]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[u,h,d,f,m]=n;else if(i==="channelsFirst")[u,m,h,d,f]=n;else throw new Error(`Unknown dataFormat ${i}`);const[g,y,w,,v]=e,[b,C,S]=bg(t),[$,N,R]=bg(s),O=Ji(g,$),F=Ji(y,N),A=Ji(w,R),{padInfo:D,outDepth:T,outHeight:z,outWidth:U}=HD(r,h,d,f,b,C,S,O,F,A,l),Q=o?v*m:v;let q;return i==="channelsFirst"?q=[u,Q,T,z,U]:i==="channelsLast"&&(q=[u,T,z,U,Q]),{batchSize:u,dataFormat:i,inDepth:h,inHeight:d,inWidth:f,inChannels:m,outDepth:T,outHeight:z,outWidth:U,outChannels:Q,padInfo:D,strideDepth:b,strideHeight:C,strideWidth:S,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:O,effectiveFilterHeight:F,effectiveFilterWidth:A,dilationDepth:$,dilationHeight:N,dilationWidth:R,inShape:n,outShape:q,filterShape:e}}function WD(n,e,t,s,r){s==null&&(s=Wx(n,e,t));const o=n[0],i=n[1],l=Yo((o-e+2*s)/t+1,r),u=Yo((i-e+2*s)/t+1,r);return[l,u]}function UD(n,e,t,s,r,o){r==null&&(r=Wx(n,e,s));const i=n[0],l=n[1],u=n[2],h=Yo((i-e+2*r)/s+1,o),d=Yo((l-e+2*r)/s+1,o),f=Yo((u-e+2*r)/s+1,o);return[h,d,f,t]}function Wx(n,e,t,s=1){const r=Ji(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Wh(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function bg(n){return typeof n=="number"?[n,n,n]:n}function Ji(n,e){return e<=1?n:n+(n-1)*(e-1)}function GD(n,e,t,s,r,o,i,l,u){let h,d,f;if(typeof n=="number"){h={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=WD([e,t],o,s,n,l);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const m=Math.max(0,(d-1)*s+o-e),g=Math.max(0,(f-1)*r+i-t),y=Math.floor(m/2),w=m-y,v=Math.floor(g/2),b=g-v;h={top:y,bottom:w,left:v,right:b,type:"SAME"}}else if(n==="valid")h={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-o+1)/s),f=Math.ceil((t-i+1)/r);else if(typeof n=="object"){const m=u==="channelsLast"?n[1][0]:n[2][0],g=u==="channelsLast"?n[1][1]:n[2][1],y=u==="channelsLast"?n[2][0]:n[3][0],w=u==="channelsLast"?n[2][1]:n[3][1];h={top:m,bottom:g,left:y,right:w,type:m===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT"},d=Yo((e-o+m+g)/s+1,l),f=Yo((t-i+y+w)/r+1,l)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outHeight:d,outWidth:f}}function HD(n,e,t,s,r,o,i,l,u,h,d){let f,m,g,y;if(typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const v=UD([e,t,s,1],l,1,r,n,d);m=v[0],g=v[1],y=v[2]}else if(n==="same"){m=Math.ceil(e/r),g=Math.ceil(t/o),y=Math.ceil(s/i);const w=(m-1)*r+l-e,v=(g-1)*o+u-t,b=(y-1)*i+h-s,C=Math.floor(w/2),S=w-C,$=Math.floor(v/2),N=v-$,R=Math.floor(b/2),O=b-R;f={top:$,bottom:N,left:R,right:O,front:C,back:S,type:"SAME"}}else if(n==="valid")f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},m=Math.ceil((e-l+1)/r),g=Math.ceil((t-u+1)/o),y=Math.ceil((s-h+1)/i);else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:m,outHeight:g,outWidth:y}}function Yo(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function si(n){const[e,t,s]=Wh(n);return e===1&&t===1&&s===1}function xn(n,e){return si(n)||si(e)}function Or(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Pn(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")_(sa(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{_(sa(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jD(n,e){const s={x:M(n,"x","reshape","string_or_numeric")},r={shape:e};return K.runKernel(Zd,s,r)}const Z=ee({reshape_:jD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KD(n,e,t,s,r){const o=M(n,"x","avgPool","float32"),i=1;_(xn(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let l=o,u=!1;o.rank===3&&(u=!0,l=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]])),_(l.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${l.rank}.`),Pn("avgPool",s,r);const h={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=K.runKernel(pd,h,d);return f=Ce(f,o.dtype),u?Z(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Ux=ee({avgPool_:KD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qD(n,e,t,s,r,o="NDHWC"){const i=M(n,"x","avgPool3d","float32");let l=i,u=!1;i.rank===4&&(u=!0,l=Z(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),_(l.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),_(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Pn("avgPool3d",s,r);const h={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let f=K.runKernel(md,h,d);return f=Ce(f,l.dtype),u?Z(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const XD=ee({avgPool3d_:qD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YD(n,e=0){_(n.length>=1,()=>"Pass at least one tensor to concat");const t=Xk(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return Xo(t[0]);const s=t,r={axis:e};return K.runKernel(wd,s,r)}const On=ee({concat_:YD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QD(n){const t={x:M(n,"x","sigmoid","float32")};return K.runKernel(Cu,t)}const wa=ee({sigmoid_:QD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZD(n,e,t){const s=M(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return K.runKernel(sf,r,o)}const pt=ee({slice_:ZD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JD(n){const t={x:M(n,"x","tanh","float32")};return K.runKernel(Eu,t)}const Gx=ee({tanh_:JD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eA(n,e,t){const s=M(n,"x","batchToSpaceND"),r=e.reduce((l,u)=>l*u);_(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),_(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),_(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:t};return K.runKernel(xd,o,i)}const Hx=ee({batchToSpaceND_:eA});function tA(n){let e;return n.rank===0||n.rank===1?e=Z(n,[1,1,1,n.size]):n.rank===2?e=Z(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=Z(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(n,e,t,s,r,o){o==null&&(o=.001);const i=M(n,"x","batchNorm"),l=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm");let h;r!=null&&(h=M(r,"scale","batchNorm"));let d;s!=null&&(d=M(s,"offset","batchNorm")),_(l.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),_(d==null||l.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),_(h==null||l.rank===h.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:tA(i),scale:h,offset:d,mean:l,variance:u},g={varianceEpsilon:o},y=K.runKernel(Td,m,g);return Z(y,i.shape)}const gf=ee({batchNorm_:nA});function sA(n,e,t,s,r,o){const i=M(n,"x","batchNorm"),l=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm");let h;r!=null&&(h=M(r,"scale","batchNorm"));let d;return s!=null&&(d=M(s,"offset","batchNorm")),_(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),_(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${l.rank}.`),_(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&_(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${h.rank}.`),d!=null&&_(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),gf(i,l,u,d,h,o)}const rA=ee({batchNorm2d_:sA});function oA(n,e,t,s,r,o){const i=M(n,"x","batchNorm"),l=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm");let h;r!=null&&(h=M(r,"scale","batchNorm"));let d;return s!=null&&(d=M(s,"offset","batchNorm")),_(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),_(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${l.rank}.`),_(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&_(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${h.rank}.`),d!=null&&_(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),gf(i,l,u,d,h,o)}const iA=ee({batchNorm3d_:oA});function aA(n,e,t,s,r,o){const i=M(n,"x","batchNorm"),l=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm");let h;r!=null&&(h=M(r,"scale","batchNorm"));let d;return s!=null&&(d=M(s,"offset","batchNorm")),_(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),_(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${l.rank}.`),_(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&_(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${h.rank}.`),d!=null&&_(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),gf(i,l,u,d,h,o)}const lA=ee({batchNorm4d_:aA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uA(n,e,t){const s=M(n,"x","bincount"),r=M(e,"weights","bincount");_(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),_(t>=0,()=>`size must be non-negative, but got ${t}.`),_(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:t};return K.runKernel(Jg,o,i)}const cA=ee({bincount_:uA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hA(n,e){let t=M(n,"broadcastTo","x");const s=t.shape;if(e.some(h=>!(h>0)||h%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const h=t.shape.slice();for(;h.length<e.length;)h.unshift(1);t=Z(t,h)}const r=t.shape,o=Array.from(e);for(let h=e.length-1;h>=0;h--)if(r[h]===e[h])o[h]=1;else if(t.shape[h]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((h,d)=>h>1?d:-1).filter(h=>h>=0).length===0)return Xo(t);const l={x:t},u={reps:o};return K.runKernel(Ru,l,u)}const Il=ee({broadcastTo_:hA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(n){const t={x:M(n,"x","ceil","float32")};return K.runKernel(Hl,t)}const fA=ee({ceil_:dA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xf(n,e,t){const s={shape:n,value:e,dtype:t};return K.runKernel(hx,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(n,e,t){const s=M(n,"x","clipByValue");if(_(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return xf(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return K.runKernel(jl,r,o)}const us=ee({clipByValue_:pA});function mA(n){return On(n,0)}const gA=ee({concat1d_:mA});function xA(n,e){return On(n,e)}const yA=ee({concat2d_:xA});function wA(n,e){return On(n,e)}const vA=ee({concat3d_:wA});function bA(n,e){return On(n,e)}const kA=ee({concat4d_:bA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CA(n,e,t,s,r="NHWC",o=[1,1],i){const l=M(n,"x","conv2d","float32"),u=M(e,"filter","conv2d","float32");let h=l,d=!1;l.rank===3&&(d=!0,h=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),_(h.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${h.rank}.`),_(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Pn("conv2d",s,i);const f=r==="NHWC"?h.shape[3]:h.shape[1];_(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),_(xn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const m={x:h,filter:u},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},y=K.runKernel(vd,m,g);return d?Z(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const ri=ee({conv2d_:CA});function IA(n,e,t,s,r="NWC",o=1,i){const l=M(n,"x","conv1d"),u=M(e,"filter","conv1d");let h=l,d=!1;l.rank===2&&(d=!0,h=Z(l,[1,l.shape[0],l.shape[1]])),_(h.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${h.rank}.`),_(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Pn("conv1d",s,i),_(h.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${h.shape[2]}) must match input depth for filter ${u.shape[1]}.`),_(xn(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),_(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=Z(u,[1,u.shape[0],u.shape[1],u.shape[2]]),m=Z(h,[h.shape[0],1,h.shape[1],h.shape[2]]),v=ri(m,f,[1,t],s,"NHWC",[1,o],i);return d?Z(v,[v.shape[2],v.shape[3]]):Z(v,[v.shape[0],v.shape[2],v.shape[3]])}const yC=ee({conv1d_:IA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n,e,t,s,r,o="NHWC",i){_(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let l=n,u=e,h=!1;e.rank===3&&(h=!0,u=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]),l=[1,n[0],n[1],n[2]]),_(l.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${l.length}.`),_(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),_(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=o==="NHWC"?l[3]:l[1],f=o==="NHWC"?u.shape[3]:u.shape[1];_(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),_(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Pn("conv2dDerInput",r,i);const m={dy:u,filter:t},g={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:l},y=K.runKernel(bd,m,g);return h?Z(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const jx=ee({conv2DBackpropInput_:$A});function SA(n,e,t,s,r,o){const i=M(n,"x","conv2dTranspose"),l=M(e,"filter","conv2dTranspose");return jx(t,i,l,s,r,"NHWC",o)}const wC=ee({conv2dTranspose_:SA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n,e,t,s,r="NDHWC",o=[1,1,1]){const i=M(n,"x","conv3d"),l=M(e,"filter","conv3d");let u=i,h=!1;i.rank===4&&(h=!0,u=Z(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),_(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),_(l.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${l.rank}.`),_(u.shape[4]===l.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${l.shape[3]}.`),_(xn(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),_(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`);const d={x:u,filter:l},f={strides:t,pad:s,dataFormat:r,dilations:o},m=K.runKernel(kd,d,f);return h?Z(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const TA=ee({conv3d_:NA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n,e,t,s,r){_(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,l=!1;e.rank===4&&(l=!0,i=Z(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const u=o[4],h=i.shape[4];_(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),_(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),_(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),_(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),_(h===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[4]}.`);const d={dy:i,filter:t},f={pad:r,strides:s,inputShape:o},m=K.runKernel(sx,d,f);return l?Z(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const vC=ee({conv3DBackpropInput_:EA});function RA(n,e,t,s,r){const o=M(n,"x","conv3dTranspose"),i=M(e,"filter","conv3dTranspose");return vC(t,o,i,s,r)}const DA=ee({conv3dTranspose_:RA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AA(n){const t={x:M(n,"x","cos","float32")};return K.runKernel(Kl,t)}const Kx=ee({cos_:AA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FA(n){const t={x:M(n,"x","cosh","float32")};return K.runKernel(ql,t)}const bC=ee({cosh_:FA});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _A(n,e=0,t=!1,s=!1){const o={x:M(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:s};return K.runKernel(rx,o,i)}const kg=ee({cumprod_:_A});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(n,e=0,t=!1,s=!1){const o={x:M(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:s};return K.runKernel(Cd,o,i)}const kC=ee({cumsum_:OA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(n,e,t="NHWC"){const s=M(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],i=t==="NHWC"?s.shape[3]:s.shape[1];_(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),_(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),_(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),_(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const l={x:s},u={blockSize:e,dataFormat:t};return K.runKernel(ix,l,u)}const PA=ee({depthToSpace_:LA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(n,e,t,s,r="NHWC",o=[1,1],i){const l=M(n,"x","depthwiseConv2d","float32"),u=M(e,"filter","depthwiseConv2d","float32");let h=l,d=!1;l.rank===3&&(d=!0,h=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),_(h.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),_(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const f=r==="NHWC"?h.shape[3]:h.shape[1];_(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Pn("depthwiseConv2d",s,i);const m={x:h,filter:u},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},y=K.runKernel(Id,m,g);return d?Z(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const qx=ee({depthwiseConv2d_:MA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n,e,t,s,r=[1,1],o="NHWC"){const i=M(n,"x","dilation2d"),l=M(e,"filter","dilation2d");_(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),_(l.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${l.rank}.`),_(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let u=i,h=!1;i.rank===3&&(u=Z(i,[1,i.shape[0],i.shape[1],i.shape[2]]),h=!0);const d={x:u,filter:l},f={strides:t,pad:s,dilations:r},m=K.runKernel($d,d,f);return h?Z(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const BA=ee({dilation2d_:zA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VA(n,e){let t=M(n,"a","equal","string_or_numeric"),s=M(e,"b","equal","string_or_numeric");[t,s]=At(t,s),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(Sd,r)}const pr=ee({equal_:VA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WA(n,e,t){const s=M(e,"a","where"),r=M(t,"b","where"),o=M(n,"condition","where","bool"),i=Be(Be(o.shape,s.shape),r.shape),l=Il(o,i),u=Il(s,i),h=Il(r,i),d={condition:l,t:u,e:h};return K.runKernel(nf,d)}const Xn=ee({where_:WA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UA(n){const t={x:M(n,"x","zerosLike")};return K.runKernel(hf,t)}const Ye=ee({zerosLike_:UA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GA(n,e){let t=M(n,"a","div"),s=M(e,"b","div");[t,s]=At(t,s);const r=Oe(t,s),o=Ye(r),i=pr(s,o);return Xn(i,o,r)}const HA=ee({divNoNan_:GA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jA(n,e){const t=M(n,"t1","dot"),s=M(e,"t2","dot");_((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(_(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const i=Z(t,[1,-1]),l=Z(s,[-1,1]),u=st(i,l);return Z(u,[])}else if(t.rank===1&&s.rank===2){const i=Z(t,[1,-1]),l=Z(s,[s.shape[0],s.shape[1]]),u=st(i,l);return Z(u,[u.size])}else if(t.rank===2&&s.rank===1){const i=Z(s,[-1,1]),l=st(t,i);return Z(l,[l.size])}else{const i=Z(s,[s.shape[0],s.shape[1]]);return st(t,i)}}const KA=ee({dot_:jA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qA(n){const t={x:M(n,"x","elu","float32")};return K.runKernel(Yl,t)}const yf=ee({elu_:qA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XA(n){let e=M(n,"x","erf");_(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ce(e,"float32"));const t={x:e};return K.runKernel(Ql,t)}const YA=ee({erf_:XA});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xx(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function CC(n,e,t){const s=n.length+e.length,r=[];let o=0,i=0;for(let l=0;l<s;l++)t.indexOf(l)===-1?r.push(n[o++]):r.push(e[i++]);return r}function tn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function Bt(n,e){const t=e.map(s=>1);return CC(n,t,e)}function cn(n,e,t){_(Xx(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Tt(n,e){if(Xx(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function vo(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Ft(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QA(n,e=null,t=!1){const r={x:M(n,"x","max")},o={reductionIndices:e,keepDims:t};return K.runKernel(Md,r,o)}const lr=ee({max_:QA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZA(n,e=null,t=!1){const r={x:M(n,"x","min")},o={axis:e,keepDims:t};return K.runKernel(Wd,r,o)}const Cg=ee({min_:ZA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JA(n,e){let t=M(n,"base","pow"),s=M(e,"exp","pow");[t,s]=At(t,s);const r={a:t,b:s};return K.runKernel(fu,r)}const ia=ee({pow_:JA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rt(n,e){if((dr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&dr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return pf(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eF(n){const t={x:M(n,"x","sqrt","float32")};return K.runKernel($u,t)}const Sn=ee({sqrt_:eF});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tF(n){const e=M(n,"x","square"),t={};return K.runKernel("Square",{x:e},t)}const wt=ee({square_:tF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nF(n,e=null,t=!1){let s=M(n,"x","sum");s.dtype==="bool"&&(s=Ce(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return K.runKernel(rf,r,o)}const _e=ee({sum_:nF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sF(n,e="euclidean",t=null,s=!1){n=M(n,"x","norm");const r=IC(n,e,t);let o=r.shape;if(s){const i=je(t,n.shape);o=Bt(r.shape,i)}return Z(r,o)}function IC(n,e,t=null){if(n.rank===0)return Cn(n);if(n.rank!==1&&t===null)return IC(Z(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return _e(Cn(n),t);if(e===1/0)return lr(Cn(n),t);if(e===-1/0)return Cg(Cn(n),t);if(e==="euclidean"||e===2)return Sn(_e(ia(Cn(n),rt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return lr(_e(Cn(n),t[0]),t[1]-1);if(e===1/0)return lr(_e(Cn(n),t[1]),t[0]);if(e===-1/0)return Cg(_e(Cn(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Sn(_e(wt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const wf=ee({norm_:sF});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rF(n,e=null,t=!1){return wf(n,"euclidean",e,t)}const oF=ee({euclideanNorm_:rF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iF(n){const t={x:M(n,"x","exp")};return K.runKernel(Zl,t)}const Dr=ee({exp_:iF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aF(n,e=0){const t=M(n,"x","expandDims","string_or_numeric");_(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return K.runKernel(Nd,s,r)}const ks=ee({expandDims_:aF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lF(n){const t={x:M(n,"x","expm1")};return K.runKernel(Jl,t)}const uF=ee({expm1_:lF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cF(n,e){const t=M(n,"x","tile","string_or_numeric");_(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return K.runKernel(Ru,s,r)}const Us=ee({tile_:cF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hF(n,e,t,s="float32"){e==null&&(e=n);const r=He([n,e],s),o=n<=e?n:e;for(let l=0;l<o;++l)r.set(1,l,l);const i=Z(r.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return Us(ks(i,0),[t[0],1,1]);if(t.length===2)return Us(ks(ks(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return Us(ks(ks(ks(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const $C=ee({eye_:hF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dF(n){const t={x:M(n,"x","floor","float32")};return K.runKernel(eu,t)}const vf=ee({floor_:dF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fF(n,e,t=0,s=0){const r=M(n,"x","gather"),o=M(e,"indices","gather","int32"),i={x:r,indices:o},l={axis:t,batchDims:s};return K.runKernel(Ed,i,l)}const Yx=ee({gather_:fF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pF(n,e){let t=M(n,"a","greater","string_or_numeric"),s=M(e,"b","greater","string_or_numeric");[t,s]=At(t,s),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(Rd,r)}const Ts=ee({greater_:pF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mF(n,e){let t=M(n,"a","greaterEqual","string_or_numeric"),s=M(e,"b","greaterEqual","string_or_numeric");[t,s]=At(t,s),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(nu,r)}const va=ee({greaterEqual_:mF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gF(n){const t={x:M(n,"x","isFinite")};return K.runKernel(ru,t)}const xF=ee({isFinite_:gF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yF(n){const t={x:M(n,"x","isInf")};return K.runKernel(ou,t)}const wF=ee({isInf_:yF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vF(n){const t={x:M(n,"x","isNaN")};return K.runKernel(iu,t)}const bF=ee({isNaN_:vF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kF(n,e=.2){const s={x:M(n,"x","leakyRelu")},r={alpha:e};return K.runKernel(Dd,s,r)}const Qx=ee({leakyRelu_:kF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CF(n,e){let t=M(n,"a","less","string_or_numeric"),s=M(e,"b","less","string_or_numeric");[t,s]=At(t,s),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(Ad,r)}const SC=ee({less_:CF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IF(n,e){let t=M(n,"a","lessEqual","string_or_numeric"),s=M(e,"b","lessEqual","string_or_numeric");[t,s]=At(t,s),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(Fd,r)}const ba=ee({lessEqual_:IF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $F(n,e=5,t=1,s=1,r=.5){const o=M(n,"x","localResponseNormalization");_(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),_(sa(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,l=!1;o.rank===3&&(l=!0,i=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},h={depthRadius:e,bias:t,alpha:s,beta:r},d=K.runKernel(Pd,u,h);return l?Z(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const SF=ee({localResponseNormalization_:$F});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NF(n){const t={x:M(n,"x","log","float32")};return K.runKernel(au,t)}const mr=ee({log_:NF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TF(n){const t={x:M(n,"x","log1p")};return K.runKernel(lu,t)}const NC=ee({log1p_:TF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EF(n,e){_(ig(n),()=>"The f passed in variableGrads(f) must be a function"),_(e==null||Array.isArray(e)&&e.every(h=>h instanceof zh),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const h in K.registeredVariables)e.push(K.registeredVariables[h])}const s=t?e.filter(h=>!h.trainable):null,r=e.length;e=e.filter(h=>h.trainable),_(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:l}=K.gradients(n,e,null,o);_(l.some(h=>h!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),_(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const u={};return e.forEach((h,d)=>{l[d]!=null&&(u[h.name]=l[d])}),s!=null&&s.forEach(h=>u[h.name]=null),{value:i,grads:u}}function aa(n){return K.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RF(n){const t={x:M(n,"x","softplus")};return K.runKernel(Iu,t)}const _u=ee({softplus_:RF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DF(n){const e=M(n,"x","logSigmoid");return aa(s=>({value:zt(_u(zt(s))),gradFunc:i=>j(i,wa(zt(s)))}))(e)}const AF=ee({logSigmoid_:DF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FF(n,e){let t=M(n,"a","sub"),s=M(e,"b","sub");[t,s]=At(t,s);const r={a:t,b:s};return K.runKernel(Nu,r)}const Me=ee({sub_:FF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _F(n,e=-1){const t=M(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return aa((r,o)=>{const l=lr(r,e,!0),u=Me(r,l),h=Me(Ce(u,"float32"),mr(_e(Dr(u),e,!0)));return o([h]),{value:h,gradFunc:(f,m)=>{const[g]=m,y=!0,w=Dr(g);return Me(f,j(_e(f,e,y),w))}}})(t)}const TC=ee({logSoftmax_:_F});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OF(n,e=null,t=!1){const s=M(n,"x","logSumExp"),r=je(e,s.shape),o=lr(s,r,!0),i=Me(s,o),l=Dr(i),u=_e(l,r),h=mr(u),d=xe(Z(o,h.shape),h);if(t){const f=Bt(d.shape,r);return Z(d,f)}return d}const LF=ee({logSumExp_:OF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PF(n,e){const t=M(n,"a","logicalAnd","bool"),s=M(e,"b","logicalAnd","bool");Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(_d,r)}const Ar=ee({logicalAnd_:PF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MF(n){const t={x:M(n,"x","logicalNot","bool")};return K.runKernel(Od,t)}const Zx=ee({logicalNot_:MF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(n,e){const t=M(n,"a","logicalOr","bool"),s=M(e,"b","logicalOr","bool");Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(Ld,r)}const EC=ee({logicalOr_:zF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BF(n,e){const t=M(n,"a","logicalXor","bool"),s=M(e,"b","logicalXor","bool");return Be(t.shape,s.shape),Ar(EC(n,e),Zx(Ar(n,e)))}const VF=ee({logicalXor_:BF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WF(n,e,t,s,r){const o=M(n,"x","maxPool"),i=1;let l=o,u=!1;o.rank===3&&(u=!0,l=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]])),_(l.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.rank}.`),_(xn(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Pn("maxPool",s,r);const h={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=K.runKernel(zd,h,d);return u?Z(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Jx=ee({maxPool_:WF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UF(n,e=[1,1,1],t,s,r,o="NDHWC"){const i=M(n,"x","maxPool3d");let l=i,u=!1;i.rank===4&&(u=!0,l=Z(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),_(l.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),_(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Pn("maxPool3d",s,r);const h={x:l},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},f=K.runKernel(Bd,h,d);return u?Z(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const GF=ee({maxPool3d_:UF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HF(n,e){let t=M(n,"a","maximum"),s=M(e,"b","maximum");[t,s]=At(t,s),t.dtype==="bool"&&(t=Ce(t,"int32"),s=Ce(s,"int32")),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(uu,r)}const bo=ee({maximum_:HF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jF(n,e=null,t=!1){const r={x:M(n,"x","mean")},o={axis:e,keepDims:t};return K.runKernel(Vd,r,o)}const Mt=ee({mean_:jF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zt(n,e="float32"){if(e==="complex64"){const s=Zt(n,"float32"),r=Zt(n,"float32");return ei(s,r)}const t=gn(ue(n),e);return K.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function di(n,e="float32"){if(e==="complex64"){const s=di(n,"float32"),r=Zt(n,"float32");return ei(s,r)}const t=jg(ue(n),e);return K.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KF(n,e){let t=M(n,"a","minimum"),s=M(e,"b","minimum");[t,s]=At(t,s),t.dtype==="bool"&&(t=Ce(t,"int32"),s=Ce(s,"int32")),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(cu,r)}const e0=ee({minimum_:KF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qF(n,e,t){_(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=M(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");_(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let l=0;l<s.rank;l++)_(e[l].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),_(e[l][0]>=0&&e[l][0]<=s.shape[l]-r&&e[l][1]>=0&&e[l][1]<=s.shape[l]-r,()=>`Padding in dimension ${l} cannot be greater than or equal to ${s.shape[l]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},i={x:s};return K.runKernel(Ud,i,o)}const XF=ee({mirrorPad_:qF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YF(n,e){let t=M(n,"a","mod"),s=M(e,"b","mod");[t,s]=At(t,s);const r={a:t,b:s};return K.runKernel(hu,r)}const QF=ee({mod_:YF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZF(n,e=null,t=!1){n=M(n,"x","moments");const s=je(e,n.shape),r=Mt(n,s,t);let o=r.shape;t||(o=Bt(r.shape,s));const i=wt(Me(Ce(n,"float32"),Z(r,o))),l=Mt(i,s,t);return{mean:r,variance:l}}const t0=ee({moments_:ZF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(n,e){let t=M(n,"a","notEqual","string_or_numeric"),s=M(e,"b","notEqual","string_or_numeric");[t,s]=At(t,s),Be(t.shape,s.shape);const r={a:t,b:s};return K.runKernel(Hd,r)}const Uh=ee({notEqual_:JF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e_(n){const t={x:M(n,"x","onesLike")};return K.runKernel(jd,t)}const Ss=ee({onesLike_:e_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_(n,e,t=0){const s=M(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return K.runKernel(Xd,o,r)}const n0=ee({pad_:t_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_(n,e,t){const s=M(n,"x","spaceToBatchND");_(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),_(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),_(s.shape.reduce((i,l,u)=>u>0&&u<=e.length?i&&(l+t[u-1][0]+t[u-1][1])%e[u-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return K.runKernel(of,r,o)}const s0=ee({spaceToBatchND_:n_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s_(n,e,t,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const l=M(n,"x","maxPool");let u=l,h=!1;l.rank===3&&(h=!0,u=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),_(xn(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const d=Ns(u.shape,e,o,r,s),f=[d.dilationHeight,d.dilationWidth];let m;s==="same"?m=o_([d.filterHeight,d.filterWidth],f):m=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[y,w]=r_([d.inHeight,d.inWidth],f,m),v=g?s:"valid",b=g?u:s0(u,f,y),S=(t==="avg"?()=>Ux(b,e,o,v,i):()=>Jx(b,e,o,v,i))(),$=g?S:Hx(S,f,w);return h?Z($,[$.shape[1],$.shape[2],$.shape[3]]):$}function r_(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),o=n.concat(s,r),i=e.map((d,f)=>(d-o[f]%d)%d),l=r.map((d,f)=>d+i[f]),u=e.map((d,f)=>[s[f],l[f]]),h=e.map((d,f)=>[0,i[f]]);return[u,h]}function o_(n,e){const s=n.map((i,l)=>i+(i-1)*(e[l]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,l)=>i-r[l]);return s.map((i,l)=>[r[l],o[l]])}const i_=ee({pool_:s_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a_(n,e){const t=M(n,"x","prelu"),s=M(e,"alpha","prelu"),r={x:t,alpha:s};return K.runKernel(Yd,r)}const r0=ee({prelu_:a_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_(n,e=null,t=!1){let s=M(n,"x","prod");s.dtype==="bool"&&(s=Ce(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return K.runKernel(Qd,r,o)}const u_=ee({prod_:l_});var Nh={exports:{}},c_=Nh.exports,Bv;function h_(){return Bv||(Bv=1,function(n){(function(e,t,s){function r(u){var h=this,d=l();h.next=function(){var f=2091639*h.s0+h.c*23283064365386963e-26;return h.s0=h.s1,h.s1=h.s2,h.s2=f-(h.c=f|0)},h.c=1,h.s0=d(" "),h.s1=d(" "),h.s2=d(" "),h.s0-=d(u),h.s0<0&&(h.s0+=1),h.s1-=d(u),h.s1<0&&(h.s1+=1),h.s2-=d(u),h.s2<0&&(h.s2+=1),d=null}function o(u,h){return h.c=u.c,h.s0=u.s0,h.s1=u.s1,h.s2=u.s2,h}function i(u,h){var d=new r(u),f=h&&h.state,m=d.next;return m.int32=function(){return d.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,f&&(typeof f=="object"&&o(f,d),m.state=function(){return o(d,{})}),m}function l(){var u=4022871197,h=function(d){d=String(d);for(var f=0;f<d.length;f++){u+=d.charCodeAt(f);var m=.02519603282416938*u;u=m>>>0,m-=u,m*=u,u=m>>>0,m-=u,u+=m*4294967296}return(u>>>0)*23283064365386963e-26};return h}t&&t.exports?t.exports=i:this.alea=i})(c_,n)}(Nh)),Nh.exports}var Th={exports:{}},d_=Th.exports,Vv;function f_(){return Vv||(Vv=1,function(n){(function(e,t,s){function r(l){var u=this,h="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},l===(l|0)?u.x=l:h+=l;for(var d=0;d<h.length+64;d++)u.x^=h.charCodeAt(d)|0,u.next()}function o(l,u){return u.x=l.x,u.y=l.y,u.z=l.z,u.w=l.w,u}function i(l,u){var h=new r(l),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var m=h.next()>>>11,g=(h.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=h.next,f.quick=f,d&&(typeof d=="object"&&o(d,h),f.state=function(){return o(h,{})}),f}t&&t.exports?t.exports=i:this.xor128=i})(d_,n)}(Th)),Th.exports}var Eh={exports:{}},p_=Eh.exports,Wv;function m_(){return Wv||(Wv=1,function(n){(function(e,t,s){function r(l){var u=this,h="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,l===(l|0)?u.x=l:h+=l;for(var d=0;d<h.length+64;d++)u.x^=h.charCodeAt(d)|0,d==h.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(l,u){return u.x=l.x,u.y=l.y,u.z=l.z,u.w=l.w,u.v=l.v,u.d=l.d,u}function i(l,u){var h=new r(l),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var m=h.next()>>>11,g=(h.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=h.next,f.quick=f,d&&(typeof d=="object"&&o(d,h),f.state=function(){return o(h,{})}),f}t&&t.exports?t.exports=i:this.xorwow=i})(p_,n)}(Eh)),Eh.exports}var Rh={exports:{}},g_=Rh.exports,Uv;function x_(){return Uv||(Uv=1,function(n){(function(e,t,s){function r(l){var u=this;u.next=function(){var d=u.x,f=u.i,m,g;return m=d[f],m^=m>>>7,g=m^m<<24,m=d[f+1&7],g^=m^m>>>10,m=d[f+3&7],g^=m^m>>>3,m=d[f+4&7],g^=m^m<<7,m=d[f+7&7],m=m^m<<13,g^=m^m<<9,d[f]=g,u.i=f+1&7,g};function h(d,f){var m,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,m=0;m<f.length;++m)g[m&7]=g[m&7]<<15^f.charCodeAt(m)+g[m+1&7]<<13;for(;g.length<8;)g.push(0);for(m=0;m<8&&g[m]===0;++m);for(m==8?g[7]=-1:g[m],d.x=g,d.i=0,m=256;m>0;--m)d.next()}h(u,l)}function o(l,u){return u.x=l.x.slice(),u.i=l.i,u}function i(l,u){l==null&&(l=+new Date);var h=new r(l),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var m=h.next()>>>11,g=(h.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=h.next,f.quick=f,d&&(d.x&&o(d,h),f.state=function(){return o(h,{})}),f}t&&t.exports?t.exports=i:this.xorshift7=i})(g_,n)}(Rh)),Rh.exports}var Dh={exports:{}},y_=Dh.exports,Gv;function w_(){return Gv||(Gv=1,function(n){(function(e,t,s){function r(l){var u=this;u.next=function(){var d=u.w,f=u.X,m=u.i,g,y;return u.w=d=d+1640531527|0,y=f[m+34&127],g=f[m=m+1&127],y^=y<<13,g^=g<<17,y^=y>>>15,g^=g>>>12,y=f[m]=y^g,u.i=m,y+(d^d>>>16)|0};function h(d,f){var m,g,y,w,v,b=[],C=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,C=Math.max(C,f.length)),y=0,w=-32;w<C;++w)f&&(g^=f.charCodeAt((w+32)%f.length)),w===0&&(v=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,w>=0&&(v=v+1640531527|0,m=b[w&127]^=g+v,y=m==0?y+1:0);for(y>=128&&(b[(f&&f.length||0)&127]=-1),y=127,w=4*128;w>0;--w)g=b[y+34&127],m=b[y=y+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,b[y]=g^m;d.w=v,d.X=b,d.i=y}h(u,l)}function o(l,u){return u.i=l.i,u.w=l.w,u.X=l.X.slice(),u}function i(l,u){l==null&&(l=+new Date);var h=new r(l),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var m=h.next()>>>11,g=(h.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=h.next,f.quick=f,d&&(d.X&&o(d,h),f.state=function(){return o(h,{})}),f}t&&t.exports?t.exports=i:this.xor4096=i})(y_,n)}(Dh)),Dh.exports}var Ah={exports:{}},v_=Ah.exports,Hv;function b_(){return Hv||(Hv=1,function(n){(function(e,t,s){function r(l){var u=this,h="";u.next=function(){var f=u.b,m=u.c,g=u.d,y=u.a;return f=f<<25^f>>>7^m,m=m-g|0,g=g<<24^g>>>8^y,y=y-f|0,u.b=f=f<<20^f>>>12^m,u.c=m=m-g|0,u.d=g<<16^m>>>16^y,u.a=y-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,l===Math.floor(l)?(u.a=l/4294967296|0,u.b=l|0):h+=l;for(var d=0;d<h.length+20;d++)u.b^=h.charCodeAt(d)|0,u.next()}function o(l,u){return u.a=l.a,u.b=l.b,u.c=l.c,u.d=l.d,u}function i(l,u){var h=new r(l),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var m=h.next()>>>11,g=(h.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=h.next,f.quick=f,d&&(typeof d=="object"&&o(d,h),f.state=function(){return o(h,{})}),f}t&&t.exports?t.exports=i:this.tychei=i})(v_,n)}(Ah)),Ah.exports}var Fh={exports:{}};const k_={},C_=Object.freeze(Object.defineProperty({__proto__:null,default:k_},Symbol.toStringTag,{value:"Module"})),I_=wE(C_);var $_=Fh.exports,jv;function S_(){return jv||(jv=1,function(n){(function(e,t,s){var r=256,o=6,i=52,l="random",u=s.pow(r,o),h=s.pow(2,i),d=h*2,f=r-1,m;function g($,N,R){var O=[];N=N==!0?{entropy:!0}:N||{};var F=b(v(N.entropy?[$,S(t)]:$??C(),3),O),A=new y(O),D=function(){for(var T=A.g(o),z=u,U=0;T<h;)T=(T+U)*r,z*=r,U=A.g(1);for(;T>=d;)T/=2,z/=2,U>>>=1;return(T+U)/z};return D.int32=function(){return A.g(4)|0},D.quick=function(){return A.g(4)/4294967296},D.double=D,b(S(A.S),t),(N.pass||R||function(T,z,U,Q){return Q&&(Q.S&&w(Q,A),T.state=function(){return w(A,{})}),U?(s[l]=T,z):T})(D,F,"global"in N?N.global:this==s,N.state)}function y($){var N,R=$.length,O=this,F=0,A=O.i=O.j=0,D=O.S=[];for(R||($=[R++]);F<r;)D[F]=F++;for(F=0;F<r;F++)D[F]=D[A=f&A+$[F%R]+(N=D[F])],D[A]=N;(O.g=function(T){for(var z,U=0,Q=O.i,q=O.j,J=O.S;T--;)z=J[Q=f&Q+1],U=U*r+J[f&(J[Q]=J[q=f&q+z])+(J[q]=z)];return O.i=Q,O.j=q,U})(r)}function w($,N){return N.i=$.i,N.j=$.j,N.S=$.S.slice(),N}function v($,N){var R=[],O=typeof $,F;if(N&&O=="object")for(F in $)try{R.push(v($[F],N-1))}catch{}return R.length?R:O=="string"?$:$+"\0"}function b($,N){for(var R=$+"",O,F=0;F<R.length;)N[f&F]=f&(O^=N[f&F]*19)+R.charCodeAt(F++);return S(N)}function C(){try{var $;return m&&($=m.randomBytes)?$=$(r):($=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues($)),S($)}catch{var N=e.navigator,R=N&&N.plugins;return[+new Date,e,R,e.screen,S(t)]}}function S($){return String.fromCharCode.apply(0,$)}if(b(s.random(),t),n.exports){n.exports=g;try{m=I_}catch{}}else s["seed"+l]=g})(typeof self<"u"?self:$_,[],Math)}(Fh)),Fh.exports}var Gm,Kv;function N_(){if(Kv)return Gm;Kv=1;var n=h_(),e=f_(),t=m_(),s=x_(),r=w_(),o=b_(),i=S_();return i.alea=n,i.xor128=e,i.xorwow=t,i.xorshift7=s,i.xor4096=r,i.tychei=o,Gm=i,Gm}var o0=N_();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RC{constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=o0.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const l=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*l,t=this.mean+this.stdDev*o*l,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class T_{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=o0.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E_(n,e=0,t=1,s,r){if(s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new RC(e,t,s,!1,r),i=He(n,s);for(let l=0;l<i.values.length;l++)i.values[l]=o.nextValue();return i.toTensor()}const R_=ee({randomNormal_:E_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_(n,e=0,t=1,s="float32",r){const o=He(n,s),i=new T_(e,t,null,r);for(let l=0;l<o.values.length;l++)o.values[l]=i.nextValue();return o.toTensor()}const bf=ee({randomUniform_:D_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gh(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return K.runKernel(bx,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(n){const t={x:M(n,"x","reciprocal")};return K.runKernel(pu,t)}const F_=ee({reciprocal_:A_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __(n){const t={x:M(n,"x","relu")};return K.runKernel(mu,t)}const fi=ee({relu_:__});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_(n){const t={x:M(n,"x","relu6")};return K.runKernel(gu,t)}const DC=ee({relu6_:O_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_(n,e){const s={x:M(n,"x","reverse")},r={dims:e};return K.runKernel(tf,s,r)}const oi=ee({reverse_:L_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_(n){const t={x:M(n,"x","round")};return K.runKernel(xu,t)}const AC=ee({round_:P_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_(n){const t={x:M(n,"x","rsqrt","float32")};return K.runKernel(yu,t)}const FC=ee({rsqrt_:M_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_(n){const t={x:M(n,"x","selu")};return K.runKernel(wu,t)}const _C=ee({selu_:z_});function B_(n,e,t,s,r,o=[1,1],i="NHWC"){const l=M(n,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),h=M(t,"pointwiseFilter","separableConv2d");let d=l,f=!1;if(l.rank===3&&(f=!0,d=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");_(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),_(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),_(h.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),_(h.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${h.shape[0]}.`),_(h.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${h.shape[1]}.`);const m=u.shape[2],g=u.shape[3];_(h.shape[2]===m*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*g}, but got ${h.shape[2]}.`);const y=qx(d,u,s,r,i,o),v=ri(y,h,1,"valid",i);return f?Z(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const OC=ee({separableConv2d_:B_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_(n){const t={x:M(n,"x","sign")};return K.runKernel(ku,t)}const W_=ee({sign_:V_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_(n){const t={x:M(n,"x","sin","float32")};return K.runKernel(vu,t)}const LC=ee({sin_:U_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_(n){const t={x:M(n,"x","sinh")};return K.runKernel(bu,t)}const PC=ee({sinh_:G_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_(n,e,t){const s=M(n,"x","slice1d");return _(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),pt(s,[e],[t])}const i0=ee({slice1d_:H_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_(n,e,t){const s=M(n,"x","slice2d");return _(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),pt(s,e,t)}const MC=ee({slice2d_:j_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_(n,e,t){const s=M(n,"x","slice3d");return _(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),pt(s,e,t)}const a0=ee({slice3d_:K_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_(n,e,t){const s=M(n,"x","slice4d");return _(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),pt(s,e,t)}const Hh=ee({slice4d_:q_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X_(n,e=-1){const t=M(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return K.runKernel(lf,s,r)}const l0=ee({softmax_:X_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_(n){_(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return K.runKernel(cx,e)}const zC=ee({fft_:Y_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_(n){_(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return K.runKernel(fx,e)}const Ig=ee({ifft_:Q_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=Z(n,[t,e]);s=Ig(r)}else{const r=[t,2*(e-1)],o=Z(Vh(n),[t,e]),i=Z(Ox(n),[t,e]),l=oi(pt(o,[0,1],[t,e-2]),1),u=j(oi(pt(i,[0,1],[t,e-2]),1),rt(-1)),h=On([o,l],1),d=On([i,u],1),f=Z(ei(h,d),[r[0],r[1]]);s=Ig(f)}if(s=Vh(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=Z(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const J_=ee({irfft_:Z_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eO(n,e,t=0){const r={x:M(n,"x","split")},o={numOrSizeSplits:e,axis:t};return K.runKernel(af,r,o)}const ls=ee({split_:eO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tO(n,e){_(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const y=n.shape.map(v=>0),w=n.shape.map(v=>v);w[n.shape.length-1]=e,r=pt(n,y,w),t=e}else if(e!=null&&e>t){const y=n.shape.map(w=>w);y[n.shape.length-1]=e-t,r=On([n,Zt(y)],n.shape.length-1),t=e}else r=n;const o=Ye(r),i=Z(ei(r,o),[s,t]),l=zC(i),u=Math.floor(t/2)+1,h=Vh(l),d=Ox(l),f=ls(h,[u,t-u],h.shape.length-1),m=ls(d,[u,t-u],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=u,Z(ei(f[0],m[0]),g)}const nO=ee({rfft_:tO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sO(n,e){let t=M(n,"a","squaredDifference"),s=M(e,"b","squaredDifference");[t,s]=At(t,s),Be(t.shape,s.shape);const r={a:t,b:s},o={};return K.runKernel(Su,r,o)}const rO=ee({squaredDifference_:sO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oO(n,e){const t=M(n,"x","squeeze","string_or_numeric");return Z(t,xo(t.shape,e).newShape)}const Ou=ee({squeeze_:oO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iO(n,e=0){const t=Xk(n,"tensors","stack","string_or_numeric");_(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&_(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return K.runKernel(qd,s,r)}const ii=ee({stack_:iO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aO(n,e=0){const s={x:M(n,"x","step")},r={alpha:e};return K.runKernel(Du,s,r)}const Lu=ee({step_:aO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lO(n,e,t,s,r=0,o=0,i=0,l=0,u=0){const d={x:M(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:l,shrinkAxisMask:u};return K.runKernel(Sx,d,f)}const uO=ee({stridedSlice_:lO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cO(n){const t={x:M(n,"x","tan","float32")};return K.runKernel(Tu,t)}const hO=ee({tan_:cO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function is(n,e){ik(n);const t=ff(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return pf(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _h(n,e,t){if(ik(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=ff(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return pf(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dO(n,e=1,t=!0){const s=M(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:t},[l,u]=K.runKernel(Nx,o,i);return{values:l,indices:u}}const fO=ee({topk_:dO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pO(n,e=0,t=1,s,r){if(s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new RC(e,t,s,!0,r),i=He(n,s);for(let l=0;l<i.values.length;l++)i.values[l]=o.nextValue();return i.toTensor()}const BC=ee({truncatedNormal_:pO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mO(n,e=0){const t=M(n,"x","unique","string_or_numeric");_(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,i]=K.runKernel(Ex,s,r);return{values:o,indices:i}}const gO=ee({unique_:mO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xO(n,e,t){const s=M(n,"x","unsortedSegmentSum"),r=M(e,"segmentIds","unsortedSegmentSum","int32");_(sa(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:t};return K.runKernel(cf,o,i)}const VC=ee({unsortedSegmentSum_:xO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yO(n,e=0){const t=M(n,"x","unstack","string_or_numeric");_(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return K.runKernel(uf,s,r)}const la=ee({unstack_:yO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wO(n,e=!0,t,s){return K.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WC(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=He(n,"int32"),r=He([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=s.indexToLoc(t[o]),l=o*n.length;r.values.set(i,l)}return r.toTensor()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vO(n,e){if(e==null)return n.shape.slice();if(ot(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bO(n,e,t,s){const r=M(n,"x","dropout");if(_(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),_(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Pt?r.clone():r;const o=vO(r,t),i=1-e,l=Oe(vf(xe(bf(o,0,1,"float32",s),i)),i);return j(r,l)}const kO=ee({dropout_:bO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CO(n,e,t,s,r,o="NHWC",i){let l=n;n.rank===3&&(l=Z(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]])),_(l.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${l.shape}.`),_(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),_(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const h=o==="NHWC"?l.shape[3]:l.shape[1],d=o==="NHWC"?u.shape[3]:u.shape[1];_(h===t[2],()=>`Error in conv2dDerFilter: depth of input ${h}) must match input depth in filter (${t[2]}.`),_(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),Pn("conv2dDerFilter",r,i);const f={x:l,dy:u},m={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:t};return K.runKernel(tx,f,m)}const u0=ee({conv2DBackpropFilter_:CO});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return j(n,Lu(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function h0(n,e){let t=e;const s=Kt(n.shape,e.shape);return s.length>0&&(t=_e(t,s)),Z(t,n.shape)}function d0(n,e,t,s){if(e==="linear")return n;if(e==="relu")return fi(n);if(e==="elu")return yf(n);if(e==="relu6")return DC(n);if(e==="prelu")return r0(n,t);if(e==="leakyrelu")return Qx(n,s);if(e==="sigmoid")return wa(n);throw new Error(`Unknown fused activation ${e}.`)}const f0=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IO({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:l,activation:u="linear",preluActivationWeights:h,leakyreluAlpha:d}){if(u=u||"linear",f0(K.state.gradientDepth,u)===!1){_(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let R=ri(n,e,t,s,r,o,i);return l!=null&&(R=xe(R,l)),d0(R,u,h,d)}const f=M(n,"x","conv2d","float32"),m=M(e,"filter","conv2d","float32");let g=f,y=!1;f.rank===3&&(y=!0,g=Z(f,[1,f.shape[0],f.shape[1],f.shape[2]])),_(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),_(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),Pn("fused conv2d",s,i);const w=r==="NHWC"?g.shape[3]:g.shape[1];_(m.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${m.shape[2]}.`),_(xn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const v=un(g.shape,m.shape,t,o,s,i);let b;l!=null&&(b=M(l,"bias","fused conv2d"),[b]=At(b,f),r==="NHWC"?Be(v.outShape,b.shape):(_(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),_(b.shape.length===0||b.shape[0]===v.outChannels||b.shape[0]===1,()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let C;if(h!=null){const R=h.shape;if(_(R.length<=1||R.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${R.length}.`),R.length===1)_(R[0]===1||R[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the number of output channels (${v.outChannels}).`);else if(R.length===3)try{Be(R,v.outShape)}catch{const F=`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(F)}C=M(h,"prelu weights","fused conv2d")}const S=(R,O)=>{_(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[F,A,D,T]=O,z=c0(R,D,u);_(si(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const U=jx(A.shape,z,F,t,s),Q=u0(A,z,F.shape,t,s),q=[U,Q];if(T!=null){const J=h0(T,z);q.push(J)}return q},$={x:g,filter:m,bias:b,preluActivationWeights:C},N={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:d};return l==null?aa((O,F,A)=>{let D=K.runKernel(Ph,$,N);return A([F,O,D]),y&&(D=Z(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:S}})(g,m):aa((O,F,A,D)=>{let T=K.runKernel(Ph,$,N);return D([F,O,T,A]),y&&(T=Z(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:S}})(g,m,b)}const $O=ee({fusedConv2d_:IO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SO(n,e,t,s,r,o=[1,1],i){let l=n;n.rank===3&&(l=Z(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const h={x:l,dy:u},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:t};return K.runKernel(ax,h,d)}const NO=ee({depthwiseConv2dNativeBackpropFilter_:SO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TO(n,e,t,s,r,o=[1,1],i){let l=e,u=!1;e.rank===3&&(u=!0,l=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const h={dy:l,filter:t},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},f=K.runKernel(lx,h,d);return u?Z(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const EO=ee({depthwiseConv2dNativeBackpropInput_:TO});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RO({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:l=.2}){if(f0(K.state.gradientDepth,o)===!1){let T=st(n,e,t,s);return r!=null&&(T=xe(T,r)),d0(T,o,i,l)}let u=M(n,"a","fused matMul"),h=M(e,"b","fused matMul");[u,h]=At(u,h);const d=t?u.shape[u.rank-2]:u.shape[u.rank-1],f=s?h.shape[h.rank-1]:h.shape[h.rank-2],m=t?u.shape[u.rank-1]:u.shape[u.rank-2],g=s?h.shape[h.rank-2]:h.shape[h.rank-1],y=u.shape.slice(0,-2),w=h.shape.slice(0,-2),v=ue(y),b=ue(w);_(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${u.shape} and ${h.shape} and transposeA=${t} and transposeB=${s} must match.`);const S=Be(u.shape.slice(0,-2),h.shape.slice(0,-2)).concat([m,g]),$=t?Z(u,[v,d,m]):Z(u,[v,m,d]),N=s?Z(h,[b,g,f]):Z(h,[b,f,g]);let R;r!=null&&(R=M(r,"bias","fused matMul"),[R]=At(R,u),Be(S,R.shape));let O;i!=null&&(O=M(i,"prelu weights","fused matMul"));const F=(T,z)=>{const[U,Q,q,J]=z,ne=c0(Z(T,q.shape),q,o);let B,X;if(!t&&!s?(B=st(ne,Q,!1,!0),X=st(U,ne,!0,!1)):!t&&s?(B=st(ne,Q,!1,!1),X=st(ne,U,!0,!1)):t&&!s?(B=st(Q,ne,!1,!0),X=st(U,ne,!1,!1)):(B=st(Q,ne,!0,!0),X=st(ne,U,!0,!0)),r!=null){const Y=h0(J,ne);return[B,X,Y]}else return[B,X]},A={a:$,b:N,bias:R,preluActivationWeights:O},D={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:l};return r==null?aa((z,U,Q)=>{const q=K.runKernel(Lh,A,D);return Q([z,U,q]),{value:Z(q,S),gradFunc:F}})($,N):aa((z,U,Q,q)=>{const J=K.runKernel(Lh,A,D);return q([z,U,J,Q]),{value:Z(J,S),gradFunc:F}})($,N,R)}const qv=ee({fusedMatMul_:RO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DO(n,e,t,s,r="bilinear",o=0){const i=M(n,"image","cropAndResize"),l=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32"),h=l.shape[0];_(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),_(l.rank===2&&l.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${h},4] but had shape ${l.shape}.`),_(u.rank===1&&u.shape[0]===h,()=>`Error in cropAndResize: boxInd must be have size [${h}] but had shape ${l.shape}.`),_(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),_(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),_(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:i,boxes:l,boxInd:u},f={method:r,extrapolationValue:o,cropSize:s};return K.runKernel(ox,d,f)}const AO=ee({cropAndResize_:DO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FO(n){const e=M(n,"image","flipLeftRight","float32");_(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return K.runKernel(dx,t,{})}const _O=ee({flipLeftRight_:FO});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OO(n){const e=M(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];_(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),_(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Us(e,r)}const LO=ee({grayscaleToRGB_:OO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PO(n,e,t=0,s=.5){const r=M(n,"image","rotateWithOffset","float32");_(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:t,center:s};return K.runKernel(Rx,o,i)}const MO=ee({rotateWithOffset_:PO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ka(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),_(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),_(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),_(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),_(e.rank===1,()=>"scores must be a 1D tensor"),_(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),_(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zO(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=M(n,"boxes","nonMaxSuppression","float32"),i=M(e,"scores","nonMaxSuppression","float32"),l=ka(o,i,t,s,r);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold;const u={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return K.runKernel(yx,{boxes:o,scores:i},u)}const BO=ee({nonMaxSuppression_:zO});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VO(n,e,t){const s=WO(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function WO(n,e,t){return GO(n,e,t||UO)}function UO(n,e){return n>e?1:n<e?-1:0}function GO(n,e,t){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const l=t(e,n[o]);l>0?s=o+1:(r=o,i=!l)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0(n,e,t,s,r){return x0(n,e,t,s,r,0)}function m0(n,e,t,s,r,o){return x0(n,e,t,s,r,0,!1,o,!0)}function g0(n,e,t,s,r,o){return x0(n,e,t,s,r,o,!0)}function x0(n,e,t,s,r,o,i=!1,l=!1,u=!1){const h=[];for(let v=0;v<e.length;v++)e[v]>r&&h.push({score:e[v],boxIndex:v,suppressBeginIndex:0});h.sort(Xv);const d=o>0?-.5/o:0,f=[],m=[];for(;f.length<t&&h.length>0;){const v=h.pop(),{score:b,boxIndex:C,suppressBeginIndex:S}=v;if(b<r)break;let $=!1;for(let N=f.length-1;N>=S;--N){const R=HO(n,C,f[N]);if(R>=s){$=!0;break}if(v.score=v.score*jO(s,d,R),v.score<=r)break}v.suppressBeginIndex=f.length,$||(v.score===b?(f.push(C),m.push(v.score)):v.score>r&&VO(h,v,Xv))}const g=f.length,y=t-g;l&&y>0&&(f.push(...new Array(y).fill(0)),m.push(...new Array(y).fill(0)));const w={selectedIndices:f};return i&&(w.selectedScores=m),u&&(w.validOutputs=g),w}function HO(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),l=Math.max(s[0],s[2]),u=Math.max(s[1],s[3]),h=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),g=(l-o)*(u-i),y=(f-h)*(m-d);if(g<=0||y<=0)return 0;const w=Math.max(o,h),v=Math.max(i,d),b=Math.min(l,f),C=Math.min(u,m),S=Math.max(b-w,0)*Math.max(C-v,0);return S/(g+y-S)}function jO(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function Xv(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function KO(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=M(n,"boxes","nonMaxSuppressionAsync"),i=M(e,"scores","nonMaxSuppressionAsync"),l=ka(o,i,t,s,r);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),h=u[0],d=u[1],{selectedIndices:f}=p0(h,d,t,s,r);return o!==n&&o.dispose(),i!==e&&i.dispose(),is(f,"int32")}const qO=KO;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XO(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=M(n,"boxes","nonMaxSuppression"),l=M(e,"scores","nonMaxSuppression"),u=ka(i,l,t,s,r,o);t=u.maxOutputSize,s=u.iouThreshold,r=u.scoreThreshold,o=u.softNmsSigma;const h={boxes:i,scores:l},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},f=K.runKernel(vx,h,d);return{selectedIndices:f[0],selectedScores:f[1]}}const YO=ee({nonMaxSuppressionWithScore_:XO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function QO(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=M(n,"boxes","nonMaxSuppressionAsync"),l=M(e,"scores","nonMaxSuppressionAsync"),u=ka(i,l,t,s,r,o);t=u.maxOutputSize,s=u.iouThreshold,r=u.scoreThreshold,o=u.softNmsSigma;const h=await Promise.all([i.data(),l.data()]),d=h[0],f=h[1],{selectedIndices:m,selectedScores:g}=g0(d,f,t,s,r,o);return i!==n&&i.dispose(),l!==e&&l.dispose(),{selectedIndices:is(m,"int32"),selectedScores:is(g)}}const ZO=QO;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JO(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=M(n,"boxes","nonMaxSuppression"),l=M(e,"scores","nonMaxSuppression"),u=ka(i,l,t,s,r,null),h=u.maxOutputSize,d=u.iouThreshold,f=u.scoreThreshold,m={boxes:i,scores:l},g={maxOutputSize:h,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:o},y=K.runKernel(wx,m,g);return{selectedIndices:y[0],validOutputs:y[1]}}const e3=ee({nonMaxSuppressionPadded_:JO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function t3(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=M(n,"boxes","nonMaxSuppressionAsync"),l=M(e,"scores","nonMaxSuppressionAsync"),u=ka(i,l,t,s,r,null),h=u.maxOutputSize,d=u.iouThreshold,f=u.scoreThreshold,[m,g]=await Promise.all([i.data(),l.data()]),{selectedIndices:y,validOutputs:w}=m0(m,g,h,d,f,o);return i!==n&&i.dispose(),l!==e&&l.dispose(),{selectedIndices:is(y,"int32"),validOutputs:rt(w,"int32")}}const n3=t3;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s3(n,e,t=!1,s=!1){const r=M(n,"images","resizeBilinear");_(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),_(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),_(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=Z(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:o},u={alignCorners:t,halfPixelCenters:s,size:e},h=K.runKernel(ef,l,u);return i?Z(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const UC=ee({resizeBilinear_:s3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r3(n,e,t=!1,s=!1){const r=M(n,"images","resizeNearestNeighbor");_(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),_(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),_(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),_(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=Z(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:o},u={alignCorners:t,halfPixelCenters:s,size:e},h=K.runKernel(Jd,l,u);return i?Z(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const GC=ee({resizeNearestNeighbor_:r3});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3(n,e="binary",t=!1,s=.5){const r=M(n,"image","threshold"),o=.2989,i=.587,l=.114,u=r.shape[0]*r.shape[1];let h=j(is([s]),255),d,f,m,g;if(_(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),_(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),_(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),_(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,m]=ls(r,[1,1,1],-1);const v=j(d,o),b=j(f,i),C=j(m,l);g=xe(xe(v,b),C)}else g=n;if(e==="otsu"){const v=cA(Ce(AC(g),"int32"),Sh([]),256);h=i3(v,u)}const y=t?ba(g,h):Ts(g,h);return Ce(j(y,255),"int32")}function i3(n,e){let t=is([-1]),s=is([0]),r=is([0]),o,i,l,u,h,d;for(let f=0;f<n.size-1;f++){o=pt(n,0,f+1),i=pt(n,f+1),h=Oe(_e(o),e),d=Oe(_e(i),e);const m=_e(j(o,Gh(0,o.size)));l=Oe(m,_e(o));const g=xf(i.shape,o.size),y=xe(Gh(0,i.size),g),w=j(i,y);u=Oe(_e(w),_e(i));const v=Me(l,u),b=Me(l,u),C=j(h,d);r=j(j(C,v),b);const S=Ts(r,s);s=Xn(S,r,s),t=Xn(S,is([f]),t)}return t}const a3=ee({threshold_:o3});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l3(n,e,t="nearest",s="constant",r=0,o){const i=M(n,"image","transform","float32"),l=M(e,"transforms","transform","float32");_(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),_(l.rank===2&&(l.shape[0]===i.shape[0]||l.shape[0]===1)&&l.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),_(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const u={image:i,transforms:l},h={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return K.runKernel(Tx,u,h)}const u3=ee({transform_:l3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c3(n,e,t){_(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),_(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`);const s=M(n,"a","bandPart");_(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(t<=i))throw new Error(`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),t<0&&(t=i);const l=Z(Gh(0,o,1,"int32"),[-1,1]),u=Gh(0,i,1,"int32"),h=Me(l,u),d=Ar(ba(h,rt(+e,"int32")),va(h,rt(-t,"int32"))),f=Zt([o,i],s.dtype);return Z(ii(la(Z(s,[-1,o,i])).map(m=>Xn(d,m,f))),r)}const h3=ee({bandPart_:c3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d3(n){let e;if(Array.isArray(n)){e=!1,_(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)_(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=ls(n,n.shape[0],0).map(r=>Ou(r,[0]));_(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(K.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const l=j(_e(j(t[i],o)),t[i]);o=Me(o,l)}return Oe(o,wf(o,"euclidean"))}));return e?ii(t,0):t}const f3=ee({gramSchmidt_:d3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p3(n,e=!1){if(_(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return Yv(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((u,h)=>u*h),s=la(Z(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(u=>{const[h,d]=Yv(u,e);r.push(h),o.push(d)});const i=Z(ii(r,0),n.shape),l=Z(ii(o,0),n.shape);return[i,l]}}function Yv(n,e=!1){return K.tidy(()=>{_(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=$C(t),o=Xo(n);const i=_h([[1]],[1,1]);let l=Xo(i);const u=t>=s?s:t;for(let h=0;h<u;++h){const d=o,f=l,m=r;[l,o,r]=K.tidy(()=>{const g=pt(o,[h,h],[t-h,1]),y=wf(g),w=pt(o,[h,h],[1,1]),v=Xn(Ts(w,0),_h([[-1]]),_h([[1]])),b=Me(w,j(v,y)),C=Oe(g,b);C.shape[0]===1?l=Xo(i):l=On([i,pt(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const S=zt(Oe(st(v,b),y)),$=pt(o,[h,0],[t-h,s]),N=j(S,l),R=qe(l);if(h===0)o=Me($,st(N,st(R,$)));else{const A=Me($,st(N,st(R,$)));o=On([pt(o,[0,0],[h,s]),A],0)}const O=qe(N),F=pt(r,[0,h],[t,r.shape[1]-h]);if(h===0)r=Me(F,st(st(F,l),O));else{const A=Me(F,st(st(F,l),O));r=On([pt(r,[0,0],[t,h]),A],1)}return[l,o,r]}),Ge([d,f,m])}return!e&&t>s&&(r=pt(r,[0,0],[t,s]),o=pt(o,[0,0],[s,s])),[r,o]})}const m3=ee({qr_:p3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fh={flipLeftRight:_O,grayscaleToRGB:LO,resizeNearestNeighbor:GC,resizeBilinear:UC,rotateWithOffset:MO,cropAndResize:AO,nonMaxSuppression:BO,nonMaxSuppressionAsync:qO,nonMaxSuppressionWithScore:YO,nonMaxSuppressionWithScoreAsync:ZO,nonMaxSuppressionPadded:e3,nonMaxSuppressionPaddedAsync:n3,threshold:a3,transform:u3},g3={bandPart:h3,gramSchmidt:f3,qr:m3};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ko extends ya{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(l=>({name:l.name,tensor:o[l.name]}));this.applyGradients(i)}else this.applyGradients(o);return Ge(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return EF(e,t)}dispose(){this.iterations_!=null&&Ge(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:rt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(ko,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y0 extends ko{constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:re(()=>Ye(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:re(()=>Ye(o).variable(i))});const l=Array.isArray(e)?e[r].tensor:e[s];if(l==null)return;const u=this.accumulatedGrads[r].variable,h=this.accumulatedUpdates[r].variable;re(()=>{const d=xe(j(u,this.rho),j(wt(l),1-this.rho)),f=j(Oe(Sn(xe(h,this.epsilon)),Sn(xe(u,this.epsilon))),l),m=xe(j(h,this.rho),j(wt(f),1-this.rho));u.assign(d),h.assign(m);const g=xe(j(f,-this.learningRate),o);o.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ge(this.accumulatedGrads.map(e=>e.variable)),Ge(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}y0.className="Adadelta";de(y0);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w0 extends ko{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:re(()=>xf(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const l=this.accumulatedGrads[r].variable;re(()=>{const u=xe(l,wt(i));l.assign(u);const h=xe(j(Oe(i,Sn(xe(u,K.backend.epsilon()))),-this.learningRate),o);o.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ge(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}w0.className="Adagrad";de(w0);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v0 extends ko{constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],re(()=>{this.accBeta1=rt(t).variable(),this.accBeta2=rt(s).variable()}),r==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);re(()=>{const s=Me(1,this.accBeta1),r=Me(1,this.accBeta2);t.forEach((o,i)=>{const l=K.registeredVariables[o],u=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:re(()=>Ye(l).variable(u))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:re(()=>Ye(l).variable(u))});const h=Array.isArray(e)?e[i].tensor:e[o];if(h==null)return;const d=this.accumulatedFirstMoment[i].variable,f=this.accumulatedSecondMoment[i].variable,m=xe(j(d,this.beta1),j(h,1-this.beta1)),g=xe(j(f,this.beta2),j(wt(h),1-this.beta2)),y=Oe(m,s),w=Oe(g,r);d.assign(m),f.assign(g);const v=xe(j(Oe(y,xe(Sn(w),this.epsilon)),-this.learningRate),l);l.assign(v)}),this.accBeta1.assign(j(this.accBeta1,this.beta1)),this.accBeta2.assign(j(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ge(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ge(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),re(()=>{this.accBeta1.assign(ia(this.beta1,this.iterations_+1)),this.accBeta2.assign(ia(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}v0.className="Adam";de(v0);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b0 extends ko{constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],re(()=>{this.iteration=rt(0).variable(),this.accBeta1=rt(t).variable()}),r==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);re(()=>{const s=Me(1,this.accBeta1),r=Oe(-this.learningRate,xe(j(this.iteration,this.decay),1));t.forEach((o,i)=>{const l=K.registeredVariables[o],u=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Ye(l).variable(u)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Ye(l).variable(u)});const h=Array.isArray(e)?e[i].tensor:e[o];if(h==null)return;const d=this.accumulatedFirstMoment[i].variable,f=this.accumulatedWeightedInfNorm[i].variable,m=xe(j(d,this.beta1),j(h,1-this.beta1)),g=j(f,this.beta2),y=Cn(h),w=bo(g,y);d.assign(m),f.assign(w);const v=xe(j(Oe(r,s),Oe(m,xe(w,this.epsilon))),l);l.assign(v)}),this.iteration.assign(xe(this.iteration,1)),this.accBeta1.assign(j(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ge(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ge(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}b0.className="Adamax";de(b0);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kf extends ko{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=K.registeredVariables[s];re(()=>{const l=xe(j(this.c,o),i);i.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=fr(rt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}kf.className="SGD";de(kf);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k0 extends kf{constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=rt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:re(()=>Ye(o).variable(!1))});const i=this.accumulations[r].variable,l=Array.isArray(e)?e[r].tensor:e[s];l!=null&&re(()=>{let u;const h=xe(j(this.m,i),l);this.useNesterov?u=xe(j(this.c,xe(l,j(h,this.m))),o):u=xe(j(this.c,h),o),i.assign(h),o.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ge(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}k0.className="Momentum";de(k0);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C0 extends ko{constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=K.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:re(()=>Ye(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:re(()=>Ye(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:re(()=>Ye(o).variable(i))});const l=Array.isArray(e)?e[r].tensor:e[s];if(l==null)return;const u=this.accumulatedMeanSquares[r].variable,h=this.accumulatedMoments[r].variable;re(()=>{const d=xe(j(u,this.decay),j(wt(l),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,m=xe(j(f,this.decay),j(l,1-this.decay)),g=Oe(j(l,this.learningRate),Sn(Me(d,xe(wt(m),this.epsilon)))),y=xe(j(h,this.momentum),g);u.assign(d),f.assign(m),h.assign(y);const w=Me(o,y);o.assign(w)}else{const f=xe(j(u,this.decay),j(wt(l),1-this.decay)),m=xe(j(h,this.momentum),Oe(j(l,this.learningRate),Sn(xe(f,this.epsilon))));u.assign(f),h.assign(m);const g=Me(o,m);o.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ge(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ge(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ge(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}C0.className="RMSProp";de(C0);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bo{static sgd(e){return new kf(e)}static momentum(e,t,s=!1){return new k0(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new C0(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new v0(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new y0(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new b0(e,t,s,r,o)}static adagrad(e,t=.1){return new w0(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ui={sgd:Bo.sgd,momentum:Bo.momentum,adadelta:Bo.adadelta,adagrad:Bo.adagrad,rmsprop:Bo.rmsprop,adamax:Bo.adamax,adam:Bo.adam};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x3=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function HC(){return new Promise(n=>x3(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0(n,e){const t=n[0].length;n.forEach((r,o)=>{_(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),_(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<t;i++)_(i===e||r[i]===s[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function ur(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Vs;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Vs||(Vs={}));function jC(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],i=s[s.length-t.length+r],l=s[i];if(o>=0)if(l>=0){if(l!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${l}`)}else s[i]=o}return s}function KC(n){const e={FIRST_DIM_SIZE:Vs.FIRST_DIM_SIZE,VALUE_ROWIDS:Vs.VALUE_ROWIDS,ROW_LENGTHS:Vs.ROW_LENGTHS,ROW_SPLITS:Vs.ROW_SPLITS,ROW_LIMITS:Vs.ROW_LIMITS,ROW_STARTS:Vs.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function qC(n){return n.length===0?0:n[0]===Vs.FIRST_DIM_SIZE?n.length-1:n.length}function XC(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $0=30;function Cf(n){return n<=$0?n:ag(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pu(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/e[i],e[i]]);r=r.concat(n.slice(o+1))}return r}function Mu(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function zu(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function N0(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function T0(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const If=1.7580993408473768,$f=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E0=.3275911,R0=.254829592,D0=-.284496736,A0=1.421413741,F0=-1.453152027,_0=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fr(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function YC(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function QC(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function ZC(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function O0(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function JC(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function eI(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function tI(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hm="->",y3=/->/g,Qv=",",Zv="...";function L0(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(y3,"").length)/Hm.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Hm}").`);const[s,r]=n.split(Hm);_(s.indexOf(Zv)===-1,()=>`The ellipsis notation ("${Zv}") is not supported yet.`);const o=s.split(Qv),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const l=[];for(let m=0;m<r.length;++m){const g=r[m];if(!o.some(y=>y.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);l.indexOf(g)===-1&&l.push(g)}for(let m=0;m<s.length;++m){const g=s[m];l.indexOf(g)===-1&&g!==Qv&&l.push(g)}const u=new Array(o.length);for(let m=0;m<i;++m){if(new Set(o[m].split("")).size!==o[m].length)throw new Error(`Found duplicate axes in input component ${o[m]}. Support for duplicate axes in input is not implemented yet.`);u[m]=[];for(let g=0;g<o[m].length;++g)u[m].push(l.indexOf(o[m][g]))}const h=l.length,d=r.length,f=[];for(let m=d;m<h;++m)f.push(m);return{allDims:l,summedDims:f,idDims:u}}function P0(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function M0(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:_(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function z0(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<t.length;++i){const l=t[i],u=w3(e,l);for(const h of u)o.indexOf(h)===-1&&(s[i].push(h),o.push(h))}return{path:t,steps:s}}function B0(n){return n.every((e,t)=>e===t)}function w3(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function V0(n,e,t=0){let s=[];if(typeof e=="number")_(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((i,l)=>(l===-1&&(i+=1),i),0);_(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((l,u)=>u>0?l+u:l);e[o]=n.shape[t]-i}_(n.shape[t]===e.reduce((i,l)=>i+l),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nI(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function sI(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function rI(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oI(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function iI(n,e){return`size ${n} must be non-negative, not ${e}`}function aI(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function lI(n,e){const t=ue(n),s=ue(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function uI(n,e){const t=ue(n),s=ue(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $g(){return"segment ids must be >= 0"}function cI(){return"segment ids are not increasing"}function hI(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function dI(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fI(n,e){let t=!1,s;for(n<=$0?(s=n,t=!0):s=ag(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=ag(n,s+1);return s}function pI(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function W0(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const i=n.shape[t],l=[];let u=1,h=1,d=1;for(let f=0;f<s;++f)l.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<t;f++)l.push(n.shape[f]),h*=n.shape[f];for(let f=s;f<r;f++)l.push(e.shape[f]);for(let f=t+1;f<o;f++)l.push(n.shape[f]),d*=n.shape[f];return{batchSize:u,sliceSize:d,outerSize:h,dimSize:i,outputShape:l}}const v3=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:W0,computeOutShape:pI,segOpComputeOptimalWindowSize:fI},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ai(n){try{return n.map(e=>co(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function mI(n){return n.map(e=>ao(e))}const b3=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:R0,ERF_A2:D0,ERF_A3:A0,ERF_A4:F0,ERF_A5:_0,ERF_P:E0,PARALLELIZE_THRESHOLD:$0,get RowPartitionType(){return Vs},SELU_SCALE:$f,SELU_SCALEALPHA:If,applyActivation:d0,assertAndGetBroadcastShape:Be,assertAxesAreInnerMostDims:cn,assertParamsConsistent:I0,assignToTypedArray:JC,axesAreInnerMostDims:Xx,calculateShapes:Au,checkEinsumDimSizes:M0,checkPadOnDimRoundingMode:Pn,combineLocations:CC,combineRaggedTensorToTensorShapes:jC,complexWithEvenIndex:QC,complexWithOddIndex:ZC,computeConv2DInfo:un,computeConv3DInfo:wo,computeDefaultPad:Wx,computeDilation2DInfo:Fu,computeOptimalWindowSize:Cf,computeOutAndReduceShapes:tn,computeOutShape:ur,computePool2DInfo:Ns,computePool3DInfo:_r,convertConv2DDataFormat:Or,decodeEinsumEquation:L0,eitherStridesOrDilationsAreOne:xn,expandShapeToKeepDim:Bt,exponent:tI,exponents:eI,fromStringArrayToUint8:mI,fromUint8ToStringArray:ai,getAxesPermutation:Tt,getBroadcastDims:oa,getComplexWithIndex:O0,getEinsumComputePath:z0,getEinsumPermutation:P0,getFusedBiasGradient:h0,getFusedDyActivation:c0,getImageCenter:S0,getInnerMostAxes:Ft,getPermuted:Mu,getRaggedRank:qC,getReductionAxes:Kt,getReshaped:Pu,getReshapedPermuted:zu,getRowPartitionTypesHelper:KC,getSliceBeginCoords:N0,getSliceSize:T0,getSparseFillEmptyRowsIndicesDenseShapeMismatch:nI,getSparseFillEmptyRowsNegativeIndexErrorMessage:sI,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:rI,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:aI,getSparseReshapeInputOutputMismatchErrorMessage:uI,getSparseReshapeInputOutputMultipleErrorMessage:lI,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:oI,getSparseReshapeNegativeOutputDimErrorMessage:iI,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:dI,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:$g,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:cI,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:hI,getUndoAxesPermutation:vo,isIdentityPermutation:B0,log:KE,mergeRealAndImagArrays:Fr,prepareAndValidate:Lx,prepareSplitSize:V0,segment_util:v3,shouldFuse:f0,slice_util:xD,splitRealAndImagArrays:YC,tupleValuesAreOne:si,upcastType:Kn,validateDefaultValueShape:XC,validateInput:dD,validateUpdateShape:aC,warn:os},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gI={kernelName:hd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,Lu(Ce(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k3={kernelName:Pl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=wt(Ce(t,"float32")),r=Sn(Me(rt(1),s));return zt(Oe(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C3={kernelName:Ml,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Sn(Me(wt(Ce(t,"float32")),1));return Oe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I3={kernelName:xa,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Be(t.shape,s.shape);return{a:()=>{let l=n;const u=Kt(t.shape,r);return u.length>0&&(l=_e(l,u)),Z(l,t.shape)},b:()=>{let l=n;const u=Kt(s.shape,r);return u.length>0&&(l=_e(l,u)),Z(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $3={kernelName:qg,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S3={kernelName:dd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ye(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N3={kernelName:fd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ye(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3={kernelName:zl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,Sn(Me(rt(1),wt(Ce(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E3={kernelName:Bl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Sn(xe(rt(1),wt(Ce(t,"float32"))));return Oe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R3={kernelName:Ul,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Be(t.shape,s.shape);return{a:()=>{const l=xe(wt(t),wt(s));let u=j(n,Oe(s,l));const h=Kt(t.shape,r);return h.length>0&&(u=_e(u,h)),Z(u,t.shape)},b:()=>{const l=xe(wt(t),wt(s));let u=zt(j(n,Oe(t,l)));const h=Kt(s.shape,r);return h.length>0&&(u=_e(u,h)),Z(u,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D3={kernelName:Vl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,xe(wt(Ce(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A3={kernelName:Wl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,Me(rt(1),wt(Ce(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F3(n,e,t,s,r,o){const i=M(n,"dy","avgPool3dGrad"),l=M(e,"input","avgPool3dGrad");let u=i,h=l,d=!1;l.rank===4&&(d=!0,u=Z(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),h=Z(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),_(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),_(h.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),Pn("avgPool3dGrad",r,o);const f={dy:u,input:h},m={filterSize:t,strides:s,pad:r,dimRoundingMode:o},g=K.runKernel(Zg,f,m);return d?Z(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const _3=ee({avgPool3dGrad_:F3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O3={kernelName:md,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:l}=t;return{x:()=>_3(n,s,r,o,i,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3(n,e,t,s,r){const o=M(n,"dy","avgPoolGrad"),i=M(e,"input","avgPoolGrad");_(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let l=i,u=o,h=!1;i.rank===3&&(h=!0,l=Z(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]])),_(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),_(l.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${l.rank}.`);const d={dy:u,input:l},f={filterSize:t,strides:s,pad:r},m=K.runKernel(Qg,d,f);return h?Z(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const P3=ee({avgPoolGrad_:L3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M3={kernelName:pd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=t;return{x:()=>P3(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z3={kernelName:gd,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>st(n,r,!1,!0),b:()=>st(s,n,!0,!1)}:!o&&i?{a:()=>st(n,r,!1,!1),b:()=>st(n,s,!0,!1)}:o&&!i?{a:()=>st(r,n,!1,!0),b:()=>st(s,n,!1,!1)}:{a:()=>st(r,n,!0,!0),b:()=>st(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B3={kernelName:xd,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>s0(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V3={kernelName:GE,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,i=Array.from(o);for(let u=r.length-1;u>=0;u--)if(r[u]===o[u])i[u]=1;else if(r[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const l=[];for(let u=0;u<i.length;u++)i[u]>1&&l.push(u);return{x:()=>_e(n,l,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W3={kernelName:Gl,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U3={kernelName:Hl,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G3={kernelName:jl,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>Xn(Ar(va(s,r),ba(s,o)),n,Ye(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H3={kernelName:yd,inputsToSave:["x"],gradFunc:gI.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j3={kernelName:wd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(u=>u.shape),{axis:r}=t,o=je(r,e[0].shape)[0],i=s.map(u=>u[o]);return ls(n,i,o).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K3={kernelName:vd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:i,pad:l,dataFormat:u}=t;return _(si(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>jx(s.shape,n,r,i,l,u),filter:()=>u0(s,n,r.shape,i,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q3={kernelName:bd,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:l,dimRoundingMode:u}=t;return{dy:()=>ri(n,r,o,i,l,1,u),filter:()=>u0(n,s,r.shape,o,i,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X3(n,e,t,s,r){let o=n;n.rank===4&&(o=Z(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=Z(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),_(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),_(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),_(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),_(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),_(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const l={x:o,dy:i},u={strides:s,pad:r,filterShape:t};return K.runKernel(nx,l,u)}const Y3=ee({conv3DBackpropFilter_:X3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3={kernelName:kd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;_(si(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,l]=e;return{x:()=>vC(i.shape,n,l,r,o),filter:()=>Y3(i,n,l.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z3={kernelName:Kl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(zt(LC(Ce(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J3={kernelName:ql,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(PC(Ce(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eL={kernelName:Cd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=t;return{x:()=>{const l=Tt([r],s.rank);let u=kC(n,r,o,!i);return l!=null&&(u=qe(u,l)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tL={kernelName:Id,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=t,l=s??[1,1];_(si(l),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`);const[u,h]=e;return _(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),_(h.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${h.rank}.`),_(u.shape[3]===h.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),_(xn(r,l),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${l}'.`),Pn("depthwiseConv2d",o,i),{x:()=>EO(u.shape,n,h,r,o,l,i),filter:()=>NO(u,n,h.shape,r,o,l,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nL={kernelName:$d,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>K.runKernel(lg,o,t),filter:()=>K.runKernel(ug,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sL={kernelName:Yl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>K.runKernel(ux,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rL={kernelName:Ql,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=j(Dr(zt(wt(t))),2/Math.sqrt(Math.PI));return{x:()=>j(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oL={kernelName:Zl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iL={kernelName:Nd,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>Z(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aL={kernelName:Jl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,Dr(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lL={kernelName:eu,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uL={kernelName:tu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Be(t.shape,s.shape);return{a:()=>{const l=Oe(n,Ce(s,"float32")),u=Kt(t.shape,r);return u.length>0?Z(_e(l,u),t.shape):l},b:()=>{let l=j(n,Ce(t,"float32"));const u=Kt(s.shape,r);u.length>0&&(l=Z(_e(l,u),s.shape));const h=wt(s);return zt(Oe(l,Ce(h,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cL={kernelName:Td,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,i,l]=e,u=l??rt(1),h=Kt(o.shape,r.shape),d=[];if(o.rank===1){for(let $=0;$<r.shape.length-1;++$)d.push(r.shape[$]);d.push(1)}const f=Me(r,o),m=j(n,u),g=FC(xe(i,rt(s))),y=j(j(j(g,g),g),rt(-.5));return{x:()=>o.rank===1?Z(j(j(n,Us(Z(g,[1,1,1,o.shape[0]]),d)),u),r.shape):Z(j(j(n,g),u),r.shape),mean:()=>{let $=j(j(g,rt(-1)),m);return o.rank===1&&($=_e($,h)),Z($,o.shape)},variance:()=>{let $=j(j(y,f),m);return o.rank===1&&($=_e($,h)),Z($,o.shape)},scale:()=>{const $=j(f,g);let N=j(n,$);return o.rank===1&&(N=_e(N,h)),Z(N,o.shape)},offset:()=>{let $=n;return o.rank===1&&($=_e($,h)),Z($,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hL={kernelName:Ed,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o}=t,i=je(o,s.shape)[0];return{x:()=>{const u=s.shape,h=r.size,d=u.slice(0,i),f=d.length,m=u.slice(o,u.length).slice(1),g=m.length,y=Jv(0,f),w=Jv(f+1,f+1+g),v=eb([d,[h],m]),b=Z(n,v),C=Z(r,[h]),S=eb([[f],y,w]),$=qe(b,S);let N=VC($,C,s.shape[i]);const R=vo(S);return N=qe(N,R),N},indices:()=>r}}};function Jv(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function eb(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dL={kernelName:nu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Ye(t),b:()=>Ye(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fL={kernelName:su,gradFunc:n=>({x:()=>Ce(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pL={kernelName:ru,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mL={kernelName:ou,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gL={kernelName:iu,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xL={kernelName:Dd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=Ts(s,0);return{x:()=>Xn(o,n,j(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yL={kernelName:lu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,xe(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wL={kernelName:au,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,Ce(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vL={kernelName:HE,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const i=Dr(s);return Me(n,j(_e(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(n,e,t,s=5,r=1,o=1,i=.5){const l={x:n,y:e,dy:t},u={depthRadius:s,bias:r,alpha:o,beta:i};return K.runKernel(mx,l,u)}const kL=ee({localResponseNormalizationBackprop_:bL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CL={kernelName:Pd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:l,beta:u}=t;return{x:()=>kL(s,r,n,o,i,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xI(n,e,t,s){return e.rank<t.rank&&(e=Z(e,Bt(e.shape,s))),n.rank<t.rank&&(n=Z(n,Bt(n.shape,s))),{x:()=>j(n,Ce(pr(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tb={kernelName:Md,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],i=e[1],l=je(r,o.shape),u=xI(n,i,o,l);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IL={kernelName:uu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>j(n,Ce(va(t,s),"float32")),b:()=>j(n,Ce(SC(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $L(n,e,t,s,r,o,i){const l=M(n,"dy","maxPool3dGrad"),u=M(e,"input","maxPool3dGrad"),h=M(t,"output","maxPool3dGrad");let d=l,f=u,m=h,g=!1;u.rank===4&&(g=!0,d=Z(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=Z(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),m=Z(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),_(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),_(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),_(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),Pn("maxPool3dGrad",o,i);const y={dy:d,input:f,output:m},w={filterSize:s,strides:r,pad:o,dimRoundingMode:i},v=K.runKernel(xx,y,w);return g?Z(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const SL=ee({maxPool3dGrad_:$L});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NL={kernelName:Bd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:l,dimRoundingMode:u}=t;return{x:()=>SL(n,s,r,o,i,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TL(n,e,t,s,r,o,i){const l=M(n,"dy","maxPoolGrad"),u=M(e,"input","maxPoolGrad"),h=M(t,"output","maxPoolGrad");_(u.rank===l.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${l.rank})`),_(l.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),_(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Pn("maxPoolGrad",o,i);const d={dy:l,input:u,output:h},f={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return K.runKernel(gx,d,f)}const EL=ee({maxPoolGrad_:TL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RL={kernelName:zd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:l}=t;return{x:()=>EL(n,s,r,o,i,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DL={kernelName:Vd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=je(r,s.shape),l=tn(s.shape,o)[1],u=ue(l);return{x:()=>{const d=s.shape.slice();o.forEach(g=>{d[g]=1});const f=Z(n,d);return Oe(j(f,di(s.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AL={kernelName:Wd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,i]=e,l=je(r,o.shape),u=xI(n,i,o,l);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FL={kernelName:cu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>j(n,Ce(ba(t,s),"float32")),b:()=>j(n,Ce(Ts(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _L={kernelName:Ud,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>pt(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OL={kernelName:hu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Be(t.shape,s.shape);return{a:()=>{const l=Kt(t.shape,r);return l.length>0?Z(_e(n,l),t.shape):n},b:()=>{const l=j(n,zt(vf(Oe(t,s)))),u=Kt(s.shape,r);return u.length>0?Z(_e(l,u),s.shape):l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LL={kernelName:du,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Be(t.shape,s.shape);return{a:()=>{const l=j(n,Ce(s,"float32")),u=Kt(t.shape,r);return u.length>0?Z(_e(l,u),t.shape):l},b:()=>{const l=j(n,Ce(t,"float32")),u=Kt(s.shape,r);return u.length>0?Z(_e(l,u),s.shape):l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PL={kernelName:Gd,gradFunc:n=>({x:()=>zt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ML={kernelName:Kd,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Zt(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zL={kernelName:jd,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BL={kernelName:qd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return la(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nb={kernelName:Xd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>pt(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VL={kernelName:fu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,i=s,l=Be(o.shape,i.shape);return{a:()=>{const d=Ce(i,"float32");let f=j(n,j(d,ia(o,Me(d,rt(1)))));const m=Kt(o.shape,l);return m.length>0&&(f=_e(f,m)),Z(f,o.shape)},b:()=>{const d=Ts(o,0),f=Xn(d,mr(o),Ye(o));let m=j(n,j(r,f));const g=Kt(i.shape,l);return g.length>0&&(m=_e(m,g)),Z(m,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WL={kernelName:Yd,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=Ts(t,0);return{x:()=>Xn(r,n,j(n,s)),alpha:()=>{let o=Xn(r,Ye(n),j(n,t));const i=Kt(s.shape,n.shape);return i.length>0&&(o=_e(o,i)),Z(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(n,e,t){const s=n.shape.slice();s[t]=1;const r=Z(e,s),o=kg(n,t,!0,!1),i=kg(n,t,!0,!0),l=j(o,i);return j(r,l)}function GL(n,e,t){const s=n.shape.length,r=s-t.length,o=Tt(t,s);let i=n;o!=null&&(i=qe(n,o));const l=i.shape.slice(),h=l.splice(s-t.length,t.length).reduce((m,g)=>m*g,1);l.push(h);const d=i.reshape(l);let f=UL(d,e,r);if(f=f.reshape(i.shape),o!=null){const m=vo(o);f=qe(f,m)}return f}const HL={kernelName:Qd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((i,l)=>l):typeof r=="number"?o=[r]:o=r,{x:()=>GL(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL={kernelName:Xl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Be(t.shape,s.shape);return{a:()=>{const l=Oe(n,Ce(s,"float32")),u=Kt(t.shape,r);return u.length>0?Z(_e(l,u),t.shape):l},b:()=>{let l=j(n,Ce(t,"float32"));const u=Kt(s.shape,r);u.length>0&&(l=Z(_e(l,u),s.shape));const h=wt(s);return zt(Oe(l,Ce(h,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KL={kernelName:pu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,zt(wt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qL={kernelName:gu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=j(ba(t,6),Lu(t));return{x:()=>j(n,Ce(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XL={kernelName:mu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,Ce(Lu(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YL={kernelName:Zd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Z(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QL={kernelName:ef,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>K.runKernel(Ix,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZL={kernelName:Jd,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>K.runKernel(Cx,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JL={kernelName:tf,gradFunc:(n,e,t)=>{const{dims:s}=t,r=je(s,n.shape);return{x:()=>oi(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP={kernelName:xu,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP={kernelName:yu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>zt(Oe(n,j(ia(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP={kernelName:nf,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Ce(Ye(t),"float32"),t:()=>j(n,Ce(t,n.dtype)),e:()=>j(n,Ce(Zx(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP={kernelName:wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Ts(t,rt(0)),r=rt(If),o=rt($f),i=j(n,o),l=j(j(n,r),Dr(Ce(t,"float32")));return Xn(s,i,l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP={kernelName:Cu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,j(t,Me(rt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP={kernelName:ku,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iP={kernelName:vu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(Kx(Ce(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP={kernelName:bu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(bC(Ce(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP={kernelName:sf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,i=s.shape,[l,u]=mf(s,r,o),h=[];for(let d=0;d<n.rank;d++)h.push([l[d],i[d]-l[d]-u[d]]);return{x:()=>n0(n,h)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uP={kernelName:lf,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,i=j(n,s);return{logits:()=>Me(i,j(_e(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP={kernelName:Iu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,wa(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sb={kernelName:of,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>Hx(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rb={kernelName:af,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>On(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP={kernelName:$u,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,j(Sn(Ce(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP={kernelName:$x,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,j(Ce(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fP={kernelName:Su,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=rt(2);return{a:()=>j(n,j(r,Me(t,s))),b:()=>j(n,j(r,Me(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pP={kernelName:Du,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP={kernelName:Nu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Be(t.shape,s.shape);return{a:()=>{let l=n;const u=Kt(t.shape,r);return u.length>0&&(l=_e(l,u)),Z(l,t.shape)},b:()=>{let l=n;const u=Kt(s.shape,r);return u.length>0&&(l=_e(l,u)),Z(zt(l),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP={kernelName:rf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;je(o,s.shape).forEach(h=>{r[h]=1});const l=Z(n,r),u=j(l,di(s.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP={kernelName:Tu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Oe(n,wt(Kx(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP={kernelName:Eu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(Me(rt(1),wt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP={kernelName:Ru,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let i=Ye(s);if(s.rank===1)for(let l=0;l<r[0];++l)i=xe(i,pt(n,[l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let l=0;l<r[0];++l)for(let u=0;u<r[1];++u)i=xe(i,pt(n,[l*s.shape[0],u*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let l=0;l<r[0];++l)for(let u=0;u<r[1];++u)for(let h=0;h<r[2];++h)i=xe(i,pt(n,[l*s.shape[0],u*s.shape[1],h*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let l=0;l<r[0];++l)for(let u=0;u<r[1];++u)for(let h=0;h<r[2];++h)for(let d=0;d<r[3];++d)i=xe(i,pt(n,[l*s.shape[0],u*s.shape[1],h*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP={kernelName:Zi,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=vo(r);return{x:()=>qe(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP={kernelName:uf,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>ii(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kP={kernelName:cf,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>CP(n,t)}}};function CP(n,e){const t=bo(e,Ye(e)),s=Yx(n,t);let r=va(e,rt(0,"int32"));const o=s.rank-r.rank;for(let l=0;l<o;++l)r=ks(r,l+1);r=Ar(r,di(s.shape,"bool"));const i=Ye(s);return Xn(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IP={kernelName:hf,gradFunc:n=>({x:()=>Ye(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $P=[gI,k3,C3,I3,$3,S3,N3,T3,E3,R3,D3,A3,O3,M3,z3,B3,V3,W3,U3,G3,H3,j3,q3,K3,Q3,Z3,J3,eL,tL,nL,jL,sL,rL,oL,iL,aL,uL,lL,cL,hL,dL,fL,pL,mL,gL,xL,yL,wL,vL,CL,tb,tb,IL,NL,RL,DL,AL,FL,_L,OL,LL,PL,ML,zL,BL,nb,nb,VL,WL,HL,KL,qL,XL,YL,QL,ZL,JL,eP,tP,nP,sP,rP,oP,iP,aP,lP,uP,cP,sb,sb,rb,rb,hP,fP,dP,pP,mP,gP,xP,yP,wP,vP,bP,kP,IP];for(const n of $P)qE(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.abs=function(){return this.throwIfDisposed(),Cn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.acos=function(){return this.throwIfDisposed(),ID(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.acosh=function(){return this.throwIfDisposed(),SD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.add=function(n){return this.throwIfDisposed(),xe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.all=function(n,e){return this.throwIfDisposed(),xC(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.any=function(n,e){return this.throwIfDisposed(),vg(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.argMax=function(n){return this.throwIfDisposed(),Sl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.argMin=function(n){return this.throwIfDisposed(),DD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asScalar=function(){return this.throwIfDisposed(),_(this.size===1,()=>"The array must have only 1 element."),Z(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asType=function(n){return this.throwIfDisposed(),Ce(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as1D=function(){return this.throwIfDisposed(),Z(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as2D=function(n,e){return this.throwIfDisposed(),Z(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),Z(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),Z(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),Z(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asin=function(){return this.throwIfDisposed(),FD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asinh=function(){return this.throwIfDisposed(),OD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.atan=function(){return this.throwIfDisposed(),PD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.atan2=function(n){return this.throwIfDisposed(),zD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.atanh=function(){return this.throwIfDisposed(),VD(this)};le().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),Ux(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Hx(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),gf(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Il(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cast=function(n){return this.throwIfDisposed(),Ce(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.ceil=function(){return this.throwIfDisposed(),fA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),us(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Pt&&(n=[n]),On([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),yC(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),wC(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),ri(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cos=function(){return this.throwIfDisposed(),Kx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cosh=function(){return this.throwIfDisposed(),bC(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),kg(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),kC(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),PA(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),qx(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),BA(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.divNoNan=function(n){return this.throwIfDisposed(),HA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.div=function(n){return this.throwIfDisposed(),Oe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.dot=function(n){return this.throwIfDisposed(),KA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.elu=function(){return this.throwIfDisposed(),yf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.equal=function(n){return this.throwIfDisposed(),pr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.erf=function(){return this.throwIfDisposed(),YA(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),oF(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.exp=function(){return this.throwIfDisposed(),Dr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.expandDims=function(n){return this.throwIfDisposed(),ks(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.expm1=function(){return this.throwIfDisposed(),uF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.fft=function(){return this.throwIfDisposed(),zC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.flatten=function(){return this.throwIfDisposed(),Z(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.floor=function(){return this.throwIfDisposed(),vf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.floorDiv=function(n){return this.throwIfDisposed(),gC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.gather=function(n,e){return this.throwIfDisposed(),Yx(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.greaterEqual=function(n){return this.throwIfDisposed(),va(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.greater=function(n){return this.throwIfDisposed(),Ts(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.ifft=function(){return this.throwIfDisposed(),Ig(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.irfft=function(){return this.throwIfDisposed(),J_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.isFinite=function(){return this.throwIfDisposed(),xF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.isInf=function(){return this.throwIfDisposed(),wF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.isNaN=function(){return this.throwIfDisposed(),bF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.leakyRelu=function(n){return this.throwIfDisposed(),Qx(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.lessEqual=function(n){return this.throwIfDisposed(),ba(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.less=function(n){return this.throwIfDisposed(),SC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),SF(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logSigmoid=function(){return this.throwIfDisposed(),AF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logSoftmax=function(n){return this.throwIfDisposed(),TC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),LF(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.log=function(){return this.throwIfDisposed(),mr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.log1p=function(){return this.throwIfDisposed(),NC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Ar(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalNot=function(){return this.throwIfDisposed(),Zx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalOr=function(n){return this.throwIfDisposed(),EC(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalXor=function(n){return this.throwIfDisposed(),VF(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),st(this,n,e,t)};le().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),Jx(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.max=function(n,e){return this.throwIfDisposed(),lr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.maximum=function(n){return this.throwIfDisposed(),bo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mean=function(n,e){return this.throwIfDisposed(),Mt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.min=function(n,e){return this.throwIfDisposed(),Cg(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.minimum=function(n){return this.throwIfDisposed(),e0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),XF(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mod=function(n){return this.throwIfDisposed(),QF(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mul=function(n){return this.throwIfDisposed(),j(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.neg=function(){return this.throwIfDisposed(),zt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.norm=function(n,e,t){return this.throwIfDisposed(),wf(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.notEqual=function(n){return this.throwIfDisposed(),Uh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),oC(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.onesLike=function(){return this.throwIfDisposed(),Ss(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.pad=function(n,e){return this.throwIfDisposed(),n0(this,n,e)};le().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),i_(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.pow=function(n){return this.throwIfDisposed(),ia(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.prelu=function(n){return this.throwIfDisposed(),r0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.prod=function(n,e){return this.throwIfDisposed(),u_(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reciprocal=function(){return this.throwIfDisposed(),F_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.relu=function(){return this.throwIfDisposed(),fi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.relu6=function(){return this.throwIfDisposed(),DC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reshapeAs=function(n){return this.throwIfDisposed(),Z(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reshape=function(n){return this.throwIfDisposed(),Z(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),UC(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),GC(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reverse=function(n){return this.throwIfDisposed(),oi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.rfft=function(){return this.throwIfDisposed(),nO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.round=function(){return this.throwIfDisposed(),AC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.rsqrt=function(){return this.throwIfDisposed(),FC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.selu=function(){return this.throwIfDisposed(),_C(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),OC(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sigmoid=function(){return this.throwIfDisposed(),wa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sign=function(){return this.throwIfDisposed(),W_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sin=function(){return this.throwIfDisposed(),LC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sinh=function(){return this.throwIfDisposed(),PC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.slice=function(n,e){return this.throwIfDisposed(),pt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.softmax=function(n){return this.throwIfDisposed(),l0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.softplus=function(){return this.throwIfDisposed(),_u(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),s0(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.split=function(n,e){return this.throwIfDisposed(),ls(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sqrt=function(){return this.throwIfDisposed(),Sn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.square=function(){return this.throwIfDisposed(),wt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.squaredDifference=function(n){return this.throwIfDisposed(),rO(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.squeeze=function(n){return this.throwIfDisposed(),Ou(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Pt?[this,n]:[this,...n];return ii(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.step=function(n){return this.throwIfDisposed(),Lu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.stridedSlice=function(n,e,t,s,r,o,i,l){return this.throwIfDisposed(),uO(this,n,e,t,s,r,o,i,l)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sub=function(n){return this.throwIfDisposed(),Me(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sum=function(n,e){return this.throwIfDisposed(),_e(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.tan=function(){return this.throwIfDisposed(),hO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.tanh=function(){return this.throwIfDisposed(),Gx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.tile=function(n){return this.throwIfDisposed(),Us(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.toBool=function(){return this.throwIfDisposed(),Ce(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.toFloat=function(){return this.throwIfDisposed(),Ce(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.toInt=function(){return this.throwIfDisposed(),Ce(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.topk=function(n,e){return this.throwIfDisposed(),fO(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.transpose=function(n){return this.throwIfDisposed(),qe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.unique=function(n){return this.throwIfDisposed(),gO(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),VC(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.unstack=function(n){return this.throwIfDisposed(),la(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.where=function(n,e){return this.throwIfDisposed(),Xn(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.zerosLike=function(){return this.throwIfDisposed(),Ye(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class sr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,sr.prototype)}}class Is extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Is.prototype)}}class G extends Error{constructor(e){super(e),Object.setPrototypeOf(this,G.prototype)}}class Ue extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ue.prototype)}}class U0 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,U0.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yI{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function li(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function rr(n,e){if(!n)throw new U0(e)}function ob(n,e){let t=0;for(const s of n)s===e&&t++;return t}function _n(n){return n.length===1?n[0]:n}function yt(n){return Array.isArray(n)?n:[n]}function Tr(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ho(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ws={};function G0(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Sg(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Sg(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Sg(s))}}}function Bu(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in ws)i=ws[o];else if(i=e[o],i==null)throw new G(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new G(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let l,u;if(i in t?[l,u]=t[i]:i in ws?[l,u]=ws.className:i in e&&([l,u]=e[i]),l==null)throw new G(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const h={};for(const g of Object.keys(ws))h[g]=ws[g];for(const g of Object.keys(t))h[g]=t[g];const d=o.config;d.customObjects=h;const f=Object.assign({},ws);for(const g of Object.keys(t))ws[g]=t[g];Sg(o.config);const m=u(l,o.config,t,r);return ws=Object.assign({},f),m}else{const h=Object.assign({},ws);for(const f of Object.keys(t))ws[f]=t[f];const d=new l(o.config);return ws=Object.assign({},h),d}}}function SP(n,e){return n<e?-1:n>e?1:0}function ph(n,e){return-1*SP(n,e)}function lo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function NP(n){if(n==null)throw new G(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function pi(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new G(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function H0(n,e,t=0,s=1/0){return rr(t>=0),rr(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function en(n,e){Array.isArray(n)?(_(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>en(t,`element ${s+1} of ${e}`))):_(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${wI(n)}.`)}function wI(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>wI(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function TP(n,e,t){let s=t!=null?t():Fn(),r;return(...i)=>{const l=t!=null?t():Fn();return l-s<e||(s=l,r=n(...i)),r}}function vI(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let EP=0;function bI(){return EP++}const mh={};function Sf(n=""){return n in mh||(mh[n]=0),mh[n]+=1,n+mh[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const RP=["channelsFirst","channelsLast"],DP=["nearest","bilinear"],AP=["valid","same","causal"],FP=["max","avg"],_P=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Gi=new Map;function _t(n){pi(RP,"DataFormat",n)}function OP(n){pi(DP,"InterpolationFormat",n)}function cs(n){pi(AP,"PaddingMode",n)}function kI(n){pi(FP,"PoolMode",n)}const $l=[],ib="/";function Qo(n,e){$l.push(n);try{const t=e();return $l.pop(),t}catch(t){throw $l.pop(),t}}function LP(){return $l.length===0?"":$l.join(ib)+ib}function CI(n){if(!$I(n))throw new Error("Not a valid tensor name: '"+n+"'");return LP()+n}function II(n){if(!$I(n))throw new Error("Not a valid tensor name: '"+n+"'");Gi.has(n)||Gi.set(n,0);const e=Gi.get(n);if(Gi.set(n,Gi.get(n)+1),e>0){const t=`${n}_${e}`;return Gi.set(t,1),t}else return n}const PP=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function $I(n){return!!n.match(PP)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MP(n){return n===parseInt(n.toString(),10)}function uo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function ua(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function ho(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function js(n,e){if(e<n)throw new G(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let jm;function Ut(){return jm==null&&(jm=aD().epsilon()),jm}function Ks(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vu(n,e){return Ce(n,e)}function Wu(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),Z(n,t)}function zP(n,e){return re(()=>{if(n.shape.length!==2)throw new G(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Wu(n,1);return Ng(t,[1,e,1])})}function BP(n){const e=[uo(n.shape)];return Z(n,e)}function VP(n){if(n.rank<=1)throw new G(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],uo(n.shape,1)];return Z(n,e)}function Zo(n,e,t){return re(()=>{switch(n.rank){case 1:return i0(n,e,t);case 2:return MC(n,[e,0],[t,n.shape[1]]);case 3:return a0(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Hh(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return pt(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return pt(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new G(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Km(n,e,t){return re(()=>{switch(n.rank){case 1:return i0(n,e,t);case 2:return MC(n,[0,e],[n.shape[0],t]);case 3:return a0(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Hh(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function gh(n,e,t,s){return re(()=>{switch(n.rank){case 1:return i0(n,e,t);case 2:switch(s){case 1:return Zo(n,e,t);case 2:return Km(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Zo(n,e,t);case 2:return a0(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Km(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Zo(n,e,t);case 2:return Hh(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Hh(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Km(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${s}`)}default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function j0(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),On(n,e)}function ab(n,e){switch(n.rank){case 1:return gA([n,e]);case 2:return yA([n,e],0);case 3:return vA([n,e],0);case 4:return kA([n,e],0);default:throw new G(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Ng(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new G(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Us(n,e)}function Nf(n,e=0,t=1,s,r){return R_(n,e,t,s,r)}function cr(n,e,t,s){if(n.rank<2||e.rank<2)throw new Ue(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new Ue(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return qv({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Tg(n.rank,s,Ks()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=Z(n,[-1,o]);const i=e.shape.slice(),l=i.pop(),u=i.pop(),h=[...i,l],d=Array.from({length:e.rank},(y,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=Z(qe(e,d),[u,-1]);const f=[...r,...h];return Z(qv({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Tg(n.rank,s,Ks()):null,activation:t}),f)}}function SI(n,e,t){return re(()=>(Array.isArray(e)?e=is(e,"int32"):e=Ce(e,"int32"),Yx(n,e,t)))}function Uu(n){return j(n,n)}function Tg(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new G(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?Z(e,[1,s[0],1,1,1]):Z(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?Z(e,[1,1,1,1,s[0]]):Z(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?Z(e,[1,s[0],1,1]):Z(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?Z(e,[1,1,1,s[0]]):Z(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?Z(e,[1,s[0],1]):Z(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?Z(e,[1,1,s[0]]):Z(e,[1].concat(s))}else if(n<3)return e;throw new G(`Unsupported input rank by biasAdd: ${e.rank}`)}function Xs(n,e,t){return re(()=>(t==null&&(t=Ks()),_t(t),xe(n,Tg(n.rank,e,t))))}function WP(n,e=1){if(e!==1)throw new Ue(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return yf(n)}function UP(n){return re(()=>Oe(n,xe(Cn(n),1)))}function NI(n,e,t,s){return re(()=>kO(n,e,t,s))}function GP(n){return re(()=>{const e=xe(.5,j(.2,n));return us(e,0,1)})}function Gu(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const HP=["fanIn","fanOut","fanAvg"],jP=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KP(n){pi(HP,"FanMode",n)}function qP(n){pi(jP,"Distribution",n)}class Es extends ya{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class TI extends Es{apply(e,t){return Zt(e,t)}}TI.className="Zeros";de(TI);class K0 extends Es{apply(e,t){return di(e,t)}}K0.className="Ones";de(K0);class EI extends Es{constructor(e){if(super(),typeof e!="object")throw new G(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new G(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return re(()=>j(rt(this.value),di(e,t)))}getConfig(){return{value:this.value}}}EI.className="Constant";de(EI);class RI extends Es{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return bf(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}RI.className="RandomUniform";de(RI);class DI extends Es{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ue(`randomNormal does not support dType ${t}.`);return Nf(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}DI.className="RandomNormal";de(DI);class AI extends Es{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ue(`truncatedNormal does not support dType ${t}.`);return BC(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}AI.className="TruncatedNormal";de(AI);class FI extends Es{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return re(()=>{if(e.length!==2||e[0]!==e[1])throw new G("Identity matrix initializer can only be used for 2D square matrices.");return j(this.gain,$C(e[0]))})}getConfig(){return{gain:this.gain}}}FI.className="Identity";de(FI);function XP(n,e="channelsLast"){let t,s;if(_t(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=uo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=uo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=uo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Yn extends Es{constructor(e){if(super(),e.scale<0)throw new G(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,KP(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,qP(this.distribution),this.seed=e.seed}apply(e,t){const s=XP(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const l=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ue(`${this.getClassName()} does not support dType ${t}.`);return BC(e,0,l,t,this.seed)}else{const l=Math.sqrt(3*i);return bf(e,-l,l,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Yn.className="VarianceScaling";de(Yn);class q0 extends Yn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Yn.className}}q0.className="GlorotUniform";de(q0);class X0 extends Yn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Yn.className}}X0.className="GlorotNormal";de(X0);class Y0 extends Yn{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Yn.className}}Y0.className="HeNormal";de(Y0);class Q0 extends Yn{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Yn.className}}Q0.className="HeUniform";de(Q0);class Z0 extends Yn{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Yn.className}}Z0.className="LeCunNormal";de(Z0);class J0 extends Yn{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Yn.className}}J0.className="LeCunNormal";de(J0);class _I extends Es{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new Ue("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return re(()=>{if(e.length<2)throw new Ue("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const s=e[0]>e[1]?[e[1],e[0]]:e,r=Nf(s,0,1,"float32");let o=g3.gramSchmidt(r);return e[0]>e[1]&&(o=qe(o)),j(this.gain,o)})}getConfig(){return{gain:this.gain,seed:this.seed}}}_I.className="Orthogonal";de(_I);const lb={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ub(n,e={}){return Bu(n,Cs.getMap().classNameMap,e,"initializer")}function Nt(n){return G0(n)}function Ct(n){if(typeof n=="string"){const e=n in lb?lb[n]:n;if(e==="GlorotNormal")return new X0;if(e==="GlorotUniform")return new q0;if(e==="HeNormal")return new Y0;if(e==="HeUniform")return new Q0;if(e==="LeCunNormal")return new Z0;if(e==="LeCunUniform")return new J0;{const t={};return t.className=e,t.config={},ub(t)}}else return n instanceof Es?n:ub(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eg(n){return Array.isArray(n)&&Array.isArray(n[0])}function jh(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Ve(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new G(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function at(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new G(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kh(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const cb="Variable";class YP{constructor(e,t="float32",s=cb,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=bI(),s=s??cb,this.originalName=CI(s),this.name=II(this.originalName),this.trainable_=r,this.constraint=o,this.val=wO(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),QP(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function QP(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Rg(n){return n.map(e=>e.read())}function e1(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Gt{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class ir{constructor(e,t,s,r,o,i,l){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=l,this.id=bI(),i!=null&&(this.originalName=CI(i),this.name=II(this.originalName)),this.rank=t.length}}let ZP=0;class Tf{constructor(e,t){this.callArgs=t,this.id=ZP++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let JP=0;class Xe extends ya{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=JP++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Tr(s)+"_"+Sf(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Is(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new G(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return _n(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return _n(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new sr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new sr(`Layer ${this.name} is not connected, no input to return.`);return _n(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new sr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new sr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return _n(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=yt(e),this.inputSpec==null||this.inputSpec.length===0)return;const t=yt(this.inputSpec);if(e.length!==t.length)throw new G(`Layer ${this.name} expects ${t.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let s=0;s<e.length;s++){const r=e[s],o=t[s];if(o==null)continue;const i=r.rank;if(o.ndim!=null&&i!==o.ndim)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${i}`);if(o.maxNDim!=null&&i>o.maxNDim)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${i}`);if(o.minNDim!=null&&i<o.minNDim)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${i}.`);if(o.dtype!=null&&r.dtype!==o.dtype)throw new G(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${r.dtype}.`);if(o.axes){const l=r.shape;for(const u in o.axes){const h=Number(u),d=o.axes[u],f=h>=0?l[h]:l[l.length+h];if(d!=null&&[d,null].indexOf(f)===-1)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${d} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],h=r.shape[l];if(u!=null&&h!=null&&u!==h)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${r.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=yt(e);let r=!0;for(const i of s)if(!(i instanceof ir)){r=!1;break}let o=!0;for(const i of s)if(i instanceof ir){o=!1;break}if(r===o)throw new G("Arguments to apply() must be all SymbolicTensors or all Tensors");return Qo(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const l of yt(e))i.push(l.shape);this.build(_n(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);const l=yt(i),u=[];for(let h of l)s.indexOf(h)!==-1&&(h=h.clone()),u.push(h);if(i=_n(u),this.activityRegularizer!=null)throw new Ue("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=eM(e),l=this.computeOutputShape(i);let u;const h=tM(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),l!=null&&l.length>0&&Array.isArray(l[0])?u=l.map((d,f)=>new ir(h,d,this,yt(e),t,this.name,f)):u=new ir(h,l,this,yt(e),t,this.name),this.addInboundNode(e,u,null,null,i,l,t),this._refCount++,this.activityRegularizer!=null)throw new Ue("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new sr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new sr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Is(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Kh(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Rg(e?this.trainableWeights:this.weights)}setWeights(e){re(()=>{const t=this.weights;if(t.length!==e.length)throw new G(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Rg(t);for(let o=0;o<r.length;++o){const i=r[o],l=t[o],u=e[o];if(!ot(i.shape,u.shape))throw new G(`Layer weight shape ${i.shape} not compatible with provided weight shape ${u.shape}`);s.push([l,u])}e1(s)})}addWeight(e,t,s,r,o,i,l,u){if(this._addedWeightNames.indexOf(e)!==-1)throw new G(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=u!=null?u():Ct("zeros"));const h=r.apply(t,s),d=new YP(h,s,e,i,l);return h.dispose(),o!=null&&this.addLoss(()=>o.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=yt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}addInboundNode(e,t,s,r,o,i,l=null){const u=yt(e);t=yt(t),s=yt(s),r=yt(r),o=jh(o),i=jh(i);const h=[],d=[],f=[];for(const m of u)h.push(m.sourceLayer),d.push(m.nodeIndex),f.push(m.tensorIndex);new Tf({outboundLayer:this,inboundLayers:h,nodeIndices:d,tensorIndices:f,inputTensors:u,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},l);for(let m=0;m<t.length;m++)t[m].sourceLayer=this,t[m].nodeIndex=this.inboundNodes.length-1,t[m].tensorIndex=m}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function eM(n){n=yt(n);const e=[];for(const t of n)e.push(t.shape);return _n(e)}function tM(n){return"float32"}function OI(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],l=s.inboundLayers[o],u=s.nodeIndices[o],h=OI(i,l,u);for(const d of h)r.indexOf(d)===-1&&r.push(d)}return r}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Hu extends Xe{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Sf("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new G("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new G("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new G("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new ir(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Tf({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new G(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Hu.className="InputLayer";de(Hu);function nM(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new G("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Hu({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sM(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Ce(e,n.dtype)}catch{throw new G(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class oo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof oo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=sM(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new G(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof ir){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof ir){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Ge(this.id2Mask)}}const qh=new yI,Xh=new yI;function rM(n){qh!=null&&qh.setMaxEntries(n),Xh!=null&&Xh.setMaxEntries(n)}function wl(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],l=i.map(y=>y.name),u=[],h=e.names();for(const y of l)h.indexOf(y)!==-1?u.push(e.getValue(y)):u.push(null);const d=l.join(",")+"|"+e.names().sort().join(",");let f=qh.get(d),m;if(f==null){const y=oM(i,e);f=y.sorted,m=y.recipientCounts,qh.put(d,f),Xh.put(d,m)}m={},r||Object.assign(m,Xh.get(d));const g=new oo(e);for(let y=0;y<f.length;++y){const w=f[y],v=w.sourceLayer;if(v instanceof Hu)continue;const b=[],C=[],S=[];let $=!1;for(const A of w.inputs){const D=g.getValue(A),T=g.getMask(A);b.push(D),C.push(T),T!=null&&($=!0),r||(m[A.name]--,m[A.name]===0&&!e.hasKey(A)&&l.indexOf(A.name)===-1&&!D.isDisposed&&A.sourceLayer.stateful!==!0&&S.push(D))}$&&(t=t||{},t.mask=C[0]);const N=yt(v.apply(b,t));let R=null;v.supportsMasking&&(R=v.computeMask(b,C));const O=aM(w),F=Array.isArray(O)?O:[O];for(let A=0;A<F.length;++A){g.hasKey(F[A])||g.add(F[A],N[A],Array.isArray(R)?R[0]:R);const D=l.indexOf(F[A].name);D!==-1&&(u[D]=N[A])}r||Ge(S)}return g.disposeMasks(),o?u:u[0]}function oM(n,e){_(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=hb(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:l}=hb(o,e);for(const u of i)r.has(u.name)||(t.push(u),r.add(u.name));for(const u in l)s[u]==null&&(s[u]=new Set),l[u].forEach(h=>s[u].add(h))}}return{sorted:t,recipientCounts:iM(s)}}function iM(n){const e={};for(const t in n)e[t]=n[t].size;return e}function hb(n,e){const t=new Set,s=[],r={};for(const l of e.names())t.add(l);const o=[],i=[];for(o.push(n);o.length>0;){const l=o[o.length-1];if(t.has(l.name)){o.pop();continue}const u=i[i.length-1]===o.length-1;if(l.inputs.length===0||u)o.pop(),s.push(l),t.add(l.name),u&&i.pop();else{i.push(o.length-1);for(const h of l.inputs)r[h.name]==null&&(r[h.name]=new Set),r[h.name].add(l.name),!t.has(h.name)&&o.push(h)}}return{sorted:s,recipientMap:r}}function aM(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lM=ae();lM.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,rM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function t1(n,e){return re(()=>Sn(_e(j(n,n),e,!0)))}class ju extends ya{getConfig(){return{}}}class LI extends ju{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return re(()=>{const t=t1(e,this.axis),s=us(t,0,this.maxValue);return j(e,Oe(s,xe(Ut(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}LI.className="MaxNorm";de(LI);class PI extends ju{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return re(()=>Oe(e,xe(Ut(),t1(e,this.axis))))}getConfig(){return{axis:this.axis}}}PI.className="UnitNorm";de(PI);class MI extends ju{apply(e){return fi(e)}}MI.className="NonNeg";de(MI);class zI extends ju{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return re(()=>{const t=t1(e,this.axis),s=xe(j(this.rate,us(t,this.minValue,this.maxValue)),j(1-this.rate,t));return j(e,Oe(s,xe(Ut(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}zI.className="MinMaxNorm";de(zI);const db={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ht(n){return G0(n)}function fb(n,e={}){return Bu(n,Cs.getMap().classNameMap,e,"constraint")}function jt(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in db?db[n]:n,config:{}};return fb(t)}else return n instanceof ju?n:fb(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Vo(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];Ge(s)}}function BI(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var pb;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(pb||(pb={}));const uM=125;class Nl{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class cM{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class hM extends Nl{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const l=re(()=>xe(this.totals[r],j(o,s)));this.totals[r]=l,i!=null&&i.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:re(()=>{const r=j(Oe(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),fr(t[s])}))}}class dM extends Nl{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const i=this.history[o];for(let l=0;l<i.length;++l)if(typeof i[l]!="number"){const u=i[l];e.push(u.data()),t.push(o),s.push(l)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}}class fM extends Nl{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||HC,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=uM),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");og(this.yieldEvery)&&(this.maybeWait=TP(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Vo(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Vo(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Vo(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Vo(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Vo(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):og(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Vo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Vo(e),await this.trainEnd(e))}}function VI(n,e){return n==null&&(n={}),n instanceof Nl?[n]:Array.isArray(n)&&n[0]instanceof Nl?n:yt(n).map(s=>new fM(s,e))}class bs{constructor(){}static registerCallbackConstructor(e,t){_(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),bs.checkForDuplicate(t),bs.constructors[e]==null&&(bs.constructors[e]=[]),bs.constructors[e].push(t)}static checkForDuplicate(e){for(const t in bs.constructors)bs.constructors[+t].forEach(r=>{if(r===e)throw new G("Duplicate callback constructor.")})}static clear(){bs.constructors={}}static createCallbacks(e){const t=[];for(const s in bs.constructors){const r=+s;e>=r&&t.push(...bs.constructors[r])}return t.map(s=>new s)}}bs.constructors={};function WI(n,e,t,s,r,o,i,l,u){const h=new dM,d=[new hM,...bs.createCallbacks(e)];n!=null&&d.push(...n),d.push(h);const f=new cM(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:l,metrics:u}),{callbackList:f,history:h}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hr(n,e={},t=!1){return Bu(n,Cs.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yh(n,e){return re(()=>{n.dtype!=="float32"&&(n=Ce(n,"float32"));const t=_e(Uu(n),e,!0),s=xf(t.shape,Ut()),r=Sn(bo(t,s));return Oe(n,r)})}function Ef(n,e){return re(()=>Mt(Uu(Me(e,n)),-1))}function n1(n,e){return re(()=>Mt(Cn(Me(e,n)),-1))}function s1(n,e){return re(()=>{const t=Me(n,e),s=us(Cn(n),Ut(),Number.MAX_VALUE),r=Cn(Oe(t,s));return j(100,Mt(r,-1))})}function pM(n,e){return re(()=>{const t=us(e,Ut(),Number.MAX_VALUE),s=mr(xe(1,t)),r=us(n,Ut(),Number.MAX_VALUE),o=mr(xe(1,r));return Mt(Uu(Me(s,o)),-1)})}function mM(n,e){return re(()=>{const t=bo(0,Me(1,j(n,e)));return Mt(Uu(t),-1)})}function gM(n,e){return re(()=>{const t=bo(0,Me(1,j(n,e)));return Mt(t,-1)})}function xM(n,e){return re(()=>{const t=_e(j(n,e),-1),s=lr(j(Me(1,n),e),-1);return bo(0,xe(1,Me(s,t)))})}function yM(n,e){return re(()=>{const t=Math.log(2),s=Me(e,n),r=Me(xe(s,_u(j(-2,s))),t);return Mt(r,-1)})}function Tl(n,e,t=!1){return re(()=>{if(t)e=l0(e);else{const s=_e(e,e.shape.length-1,!0);e=Oe(e,s)}return e=us(e,Ut(),1-Ut()),zt(_e(j(Ce(n,"float32"),mr(e)),e.shape.length-1))})}function Qh(n,e,t=!1){return re(()=>{const s=Ce(vf(BP(n)),"int32");e=us(e,Ut(),1-Ut());const r=e.shape,o=Z(oC(s,r[r.length-1]),r);return Tl(o,e,t)})}function wM(n,e){if(!ot(n.shape,e.shape))throw new G(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return re(()=>{const t=fi(e),s=zt(Cn(e));return xe(Me(t,j(e,n)),NC(Dr(s)))})}function Rf(n,e){return re(()=>{let t;return t=us(e,Ut(),1-Ut()),t=mr(Oe(t,Me(1,t))),Mt(wM(n,t),-1)})}function vM(n,e){return re(()=>{const t=us(n,Ut(),1),s=us(e,Ut(),1);return _e(j(n,mr(Oe(t,s))),-1)})}function bM(n,e){return re(()=>{const t=mr(xe(Ut(),e));return Mt(Me(e,j(n,t)),-1)})}function UI(n,e){return re(()=>{const t=Yh(n,-1),s=Yh(e,-1),r=j(t,s);return zt(_e(r,-1))})}const Zh={meanSquaredError:Ef,meanAbsoluteError:n1,meanAbsolutePercentageError:s1,meanSquaredLogarithmicError:pM,squaredHinge:mM,hinge:gM,categoricalHinge:xM,logcosh:yM,categoricalCrossentropy:Tl,sparseCategoricalCrossentropy:Qh,binaryCrossentropy:Rf,kullbackLeiblerDivergence:vM,poisson:bM,cosineProximity:UI};function qm(n){if(typeof n=="string"){if(n in Zh)return Zh[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new G(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GI(n,e){return re(()=>{const t=j(.5,Ss(e)),s=Vu(Ts(e,t),n.dtype);return Mt(pr(n,s),-1)})}function HI(n,e){return re(()=>Vu(pr(Sl(n,-1),Sl(e,-1)),"float32"))}function kM(n,e){return re(()=>Ce(_e(Ar(pr(n,1),pr(e,1))),"float32"))}function CM(n,e){return re(()=>Ce(_e(Ar(pr(n,0),pr(e,1))),"float32"))}function IM(n,e){return re(()=>{const t=kM(n,e),s=CM(n,e),r=xe(t,s);return Ce(Xn(Ts(r,0),Oe(t,r),0),"float32")})}function $M(n,e){return Rf(n,e)}function SM(n,e){return n.rank===e.rank&&(n=Ou(n,[n.rank-1])),e=Sl(e,-1),e.dtype!==n.dtype&&(e=Ce(e,n.dtype)),Ce(pr(n,e),"float32")}const NM=Ef,TM=Ef,EM=n1,RM=n1,DM=s1,AM=s1,jI=Tl,FM=UI,KI=Qh,Jh={binaryAccuracy:GI,categoricalAccuracy:HI,precision:IM,categoricalCrossentropy:jI,sparseCategoricalCrossentropy:KI,mse:NM,MSE:TM,mae:EM,MAE:RM,mape:DM,MAPE:AM,cosine:FM};function _M(n){if(typeof n=="string"&&n in Jh)return Jh[n];if(typeof n!="string"&&n!=null)return n;throw new G(`Unknown metric ${n}`)}function xh(n){if(rr(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Zh))if(Zh[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Jh))if(Jh[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function OM(n){const e={Adagrad:()=>Ui.adagrad(.01),Adadelta:()=>Ui.adadelta(1,.95,Ut()),Adam:()=>Ui.adam(.001,.9,.999,Ut()),Adamax:()=>Ui.adamax(.002,.9,.999,Ut(),0),RMSProp:()=>Ui.rmsprop(.001,.9,0,Ut()),SGD:()=>Ui.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new G(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mb=1*1024*1024;function gb(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Dg(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>mb&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${mb}.`)}}function Dg(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Dg(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Dg(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LM(n,e,t,s=console.log){const r=MM(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let i;if(!r){o.push("Receives inputs"),i=[];for(const d in n.nodesByDepth)i.push(...n.nodesByDepth[d])}s("_".repeat(e)),ed(o,t,s),s("=".repeat(e));const l=n.layers;for(let d=0;d<l.length;++d)r?zM(l[d],t,s):BM(l[d],t,i,s),s((d===l.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const u=PM(n),h=Kh(n.nonTrainableWeights);s(`Total params: ${u+h}`),s(`Trainable params: ${u}`),s(`Non-trainable params: ${h}`),s("_".repeat(e))}function PM(n){let e;return n.collectedTrainableWeights!=null?e=Kh(n.collectedTrainableWeights):e=Kh(n.trainableWeights),e}function MM(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function ed(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function zM(n,e,t){let s,r;try{r=n.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),l=[`${o} (${i})`,r,s,n.countParams().toString()];ed(l,e,t)}function BM(n,e,t,s){let r,o;try{o=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let m=0;m<f.inboundLayers.length;++m){const g=f.inboundLayers[m].name,y=f.nodeIndices[m],w=f.tensorIndices[m];i.push(`${g}[${y}][${w}]`)}const l=n.name,u=n.getClassName(),h=i.length===0?"":i[0],d=[`${l} (${u})`,o,r,n.countParams().toString(),h];ed(d,e,s);for(let f=1;f<i.length;++f)ed(["","","","",i[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qI(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function td(n,e){if(n===null)return null;if(typeof n=="string")return Ho(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];qI(e,r,o)?t.push(o):t.push(td(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=Ho(s);t[o]=td(r,o)}}return t}}function Ag(n,e){if(n==null)return null;if(typeof n=="string")return Tr(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];qI(e,r,o)?t.push(o):t.push(Ag(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=Tr(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=Ag(r,s)}return t}}/** @license See the LICENSE file. */const XI="3.21.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zs extends Xe{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=Sf(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],lo(this.inputs).length!==this.inputs.length)throw new G(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);lo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const S=C.sourceLayer,$=C.nodeIndex,N=C.tensorIndex;this.outputLayers.push(S),this.outputLayersNodeIndices.push($),this.outputLayersTensorIndices.push(N)}for(const C of this.inputs){const S=C.sourceLayer,$=C.nodeIndex,N=C.tensorIndex;rr($===0,"input layer has >1 nodes"),rr(N===0,"input layer has >1 tensors"),this.inputLayers.push(S),this.inputLayersNodeIndices.push($),this.inputLayersTensorIndices.push(N)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const S=this.inputLayers[C];if(!(S instanceof Hu))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${S.getClassName()}.`);this.inputNames.push(S.name),this.feedInputShapes.push(S.batchInputShape),this.feedInputNames.push(S.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},s={},r={},o={},i={},l=[],u=(C,S,$,N,R,O)=>{(N==null||R==null||O==null)&&(N=C.sourceLayer,R=C.nodeIndex,O=C.tensorIndex);const F=N.inboundNodes[R];if($.indexOf(F)!==-1)throw new Is(`The tensor ${C.name} at layer "${N.name}" is part of a cycle.`);if(S.indexOf(F)!==-1)return;this.containerNodes.add(zs.nodeKey(N,R)),N.id in i||(i[N.id]=Object.keys(i).length),$.indexOf(F)===-1&&$.push(F);const A=F.inboundLayers.length;for(let D=0;D<A;D++){const T=F.inputTensors[D],z=F.inboundLayers[D],U=F.nodeIndices[D],Q=F.tensorIndices[D];u(T,S,$,z,U,Q)}for(S.push(F);$.indexOf(F)>=0;)$.splice($.indexOf(F),1);l.push(F)},h=[],d=[];for(const C of this.outputs)u(C,h,d);const f=l.slice().reverse();for(const C of f){s[C.id]=C,C.id in t||(t[C.id]=0);let S=t[C.id];const $=r[C.outboundLayer.id]==null?0:r[C.outboundLayer.id];S=Math.max(S,$),r[C.outboundLayer.id]=S,o[C.outboundLayer.id]=C.outboundLayer,t[C.id]=S;for(let N=0;N<C.inboundLayers.length;N++){const R=C.inboundLayers[N],O=C.nodeIndices[N],F=R.inboundNodes[O],A=t[F.id]==null?0:t[F.id];t[F.id]=Math.max(S+1,A),s[F.id]=F}}const m={};for(const C in t){const S=t[C];S in m||(m[S]=[]),m[S].push(s[C])}const g={};for(const C in r){const S=r[C];S in g||(g[S]=[]),g[S].push(o[C])}let y=Object.keys(g).map(C=>parseInt(C,10)).sort(ph);this.layers=[];for(const C of y){const S=g[C];S.sort(($,N)=>{const R=i[$.id],O=i[N.id];return R<O?-1:R>O?1:0});for(const $ of S)$ instanceof zs&&this.internalContainerRefs.push($),this.layers.push($)}this.layersByDepth=g,y=Object.keys(m).map(C=>parseInt(C,10)).sort(ph);const w=this.inputs.slice(),v=[];for(const C of y)for(const S of m[C]){const $=S.outboundLayer;if($!=null){for(const N of S.inputTensors)if(w.indexOf(N)===-1)throw new Is(`Graph disconnected: cannot obtain value for tensor ${N} at layer "${$.name}". The following previous layers were accessed without issue: ${v}`);for(const N of S.outputTensors)w.push(N);v.push($.name)}}this.nodesByDepth=m;const b=this.layers.map(C=>C.name);for(const C of b){const S=b.filter($=>$===C).length;if(S!==1)throw new Is(`The name "${C}" is used ${S} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(b))}this.outboundNodes=[],this.inboundNodes=[],new Tf({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new G("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;for(const i of this.layers)for(const l of i.weights){if(s[l.originalName]!=null)throw new G(`Duplicate weight name: ${l.originalName}`);s[l.originalName]=l,r++}const o=[];for(const i in e){let l=i;if(s[i]==null){const u=i.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[i]]);else if(t)throw new G(`Provided weight data has no target variable: ${i}`);delete s[l]}if(t){const i=[];for(const l in s)i.push(l);if(i.length>0)throw new G(`${i.length} of ${r} weights are not set: ${i}`)}e1(o)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${XI}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Ag(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return re(()=>{e=yt(e);const s=new oo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return wl(this.outputs,s,t)})}computeMask(e,t){return re(()=>{e=yt(e);let s;return t==null?s=li(null,e.length):s=yt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=jh(e);if(t.length!==this.inputLayers.length)throw new G(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let l=0;l<t.length;l++){const u=this.inputLayers[l],h=t[l],d=u.name+"_0_0";s[d]=h}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(ph);if(r.length>1)for(const l of r){const u=this.nodesByDepth[l];for(const h of u){const d=h.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(d.id)!==-1)continue;const f=[];for(let w=0;w<h.inboundLayers.length;w++){const v=h.inboundLayers[w],b=h.nodeIndices[w],C=h.tensorIndices[w],S=`${v.name}_${b}_${C}`,$=s[S];f.push($)}const m=d.computeOutputShape(_n(f)),g=jh(m),y=d.inboundNodes.indexOf(h);for(let w=0;w<g.length;w++){const v=`${d.name}_${y}_${w}`;s[v]=g[w]}}}const o=[],i=[];for(let l=0;l<this.outputLayers.length;l++){const u=this.outputLayers[l],h=this.outputLayersNodeIndices[l],d=this.outputLayersTensorIndices[l],f=`${u.name}_${h}_${d}`;i.push(f)}for(let l=0;l<i.length;l++){const u=i[l];rr(u in s),o.push(s[u])}return _n(o)}runInternalGraph(e,t){t==null&&(t=li(null,e.length));const s={};for(let u=0;u<this.inputs.length;++u){const h=this.inputs[u],d=e[u],f=t[u];s[h.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(ph);for(const u of r){const h=this.nodesByDepth[u];for(const d of h){const f=d.outboundLayer,m=d.inputTensors,g=d.outputTensors,y=new Array;for(const w of m)w.id in s&&y.push(s[w.id]);if(y.length===m.length){let w={},v,b,C,S;if(d.callArgs!=null&&(w=d.callArgs),y.length===1){const[$,N]=y[0];w.mask==null&&(w.mask=N),C=yt(f.call($,w)),S=yt(f.computeMask($,N)),v=[$],b=[N]}else v=y.map($=>$[0]),b=y.map($=>$[1]),w.mask==null&&(w.mask=b),C=yt(f.call(v,w)),S=yt(f.computeMask(v,b));if(f.activityRegularizer)throw new Ue("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let $=0;$<g.length;++$){const N=g[$],R=C[$],O=S[$];s[N.id]=[R,O]}}}}const o=[],i=[],l=[];for(const u of this.outputs){rr(u.id in s,`Could not compute output ${u.name} : ${u.id}`);const[h,d]=s[u.id];l.push(h.shape),o.push(h),i.push(d)}return[o,i,l]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof zs?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=zs.nodeKey(r,o);this.containerNodes.has(i)&&(t[i]=s,s+=1)}}return t}getLayer(e,t){if(t!=null){if(this.layers.length<=t)throw new G(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}else if(e==null)throw new G("Provide either a layer name or layer index");for(const s of this.layers)if(s.name===e)return s;throw new G(`No such layer: ${e}`)}calculateLosses(){return re(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=zs.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const l=i.getClassName(),u=i.getConfig(),h=[];for(let f=0;f<i.inboundNodes.length;f++){const m=i.inboundNodes[f],g=zs.nodeKey(i,f);let y={};if(this.containerNodes.has(g)){if(m.callArgs)try{JSON.stringify(m.callArgs),y=m.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),y={}}if(m.inboundLayers.length>0){const w=[];for(let v=0;v<m.inboundLayers.length;v++){const b=m.inboundLayers[v],C=m.nodeIndices[v],S=m.tensorIndices[v],$=zs.nodeKey(b,C);let N=t[$];N==null&&(N=0),w.push([b.name,N,S,y])}h.push(w)}}}const d={};d.name=i.name,d.className=l,d.config=u,d.inboundNodes=h,s.push(d)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const l=this.inputLayers[i],u=this.inputLayersNodeIndices[i],h=zs.nodeKey(l,u);if(!this.containerNodes.has(h))continue;let d=t[h];d==null&&(d=0);const f=this.inputLayersTensorIndices[i];r.push([l.name,d,f])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const l=this.outputLayers[i],u=this.outputLayersNodeIndices[i],h=zs.nodeKey(l,u);if(!this.containerNodes.has(h))continue;let d=t[h];d==null&&(d=0);const f=this.outputLayersTensorIndices[i];o.push([l.name,d,f])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},i={};function l(v,b){v.name in i?i[v.name].push(b):i[v.name]=[b]}function u(v,b){const C=[];let S;for(const $ of b){const N=$[0],R=$[1],O=$[2];if(S=$[3]==null?{}:$[3],!(N in o)){l(v,b);return}const F=o[N];if(F.inboundNodes.length<=R){l(v,b);return}const A=F.inboundNodes[R];C.push(A.outputTensors[O])}C.length>0&&v.apply(_n(C),S)}function h(v){const b=v.name,C=hr(v,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(r),o[b]=C,v.inboundNodes.forEach($=>{if(!($ instanceof Array))throw new G(`Corrupted configuration, expected array for nodeData: ${$}`);l(C,$)})}const d=t.name,f=t.layers;for(const v of f)h(v);for(;!NP(i);)for(const v of f){const b=o[v.name];if(b.name in i){const C=i[b.name];delete i[b.name];for(const S of C)u(b,S)}}const m=[],g=[],y=t.inputLayers;for(const v of y){const b=v[0],C=v[1],S=v[2];rr(b in o);const N=o[b].inboundNodes[C].outputTensors;m.push(N[S])}const w=t.outputLayers;for(const v of w){const b=v[0],C=v[1],S=v[2];rr(b in o);const N=o[b].inboundNodes[C].outputTensors;g.push(N[S])}return new e({inputs:m,outputs:g,name:d})}get stateful(){if(this._stateful)throw new G("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){re(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VM(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function YI(n,e){return VM(n,e,"classWeight")}async function QI(n,e,t,s){if(t!=null){const r=re(()=>{if(n.shape.length===1)return Xo(n);if(n.shape.length===2){if(n.shape[1]>1)return Sl(n,1);if(n.shape[1]===1)return Z(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Ge(r);const i=[];return o.forEach(l=>{if(t[l]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${l} exists in the data but not in classWeight`);i.push(t[l])}),is(i,"float32")}else return null}function WM(n,e){return j(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const UM=32;function ZI(n,e){let t,s;const r=e;t=r.xs,s=r.ys,_(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=xb("input",n.inputNames,t),i=xb("output",n.outputNames,s),l=o[0].shape[0];_(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),_(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let u=0;u<o.length;u++)_(o[u].shape[0]===l,()=>`Batch size mismatch: input ${n.inputNames[u]} has ${o[u].shape[0]}; expected  ${l} based on input ${n.inputNames[0]}.`);for(let u=0;u<i.length;u++)_(i[u].shape[0]===l,()=>`Batch size mismatch: output ${n.outputNames[u]} has ${i[u].shape[0]}; expected  ${l} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function xb(n,e,t){if(t instanceof Pt)return[t];if(Array.isArray(t))return _(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new G(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function GM(n){if(n.length===3)throw new Ue("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function HM(n,e,t){const s=t.batchesPerEpoch!=null;if(_(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),_(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),_(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),_(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),_(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,i;if(r)if(yb(t.validationData))_(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const v=GM(t.validationData);o=v.xs,i=v.ys}const l=n.makeTrainFunction(),u=n.getDedupedMetricsNames();let h;r?h=u.slice().concat(u.map(v=>"val_"+v)):h=u.slice();const d=VI(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:m,history:g}=WI(d,f,t.epochs,null,null,jM(e,t),null,r,h);m.setModel(n),n.history=g,await m.onTrainBegin(),n.stopTraining_=!1;let y=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;y<t.epochs;){const v={};await m.onEpochBegin(y);let b=0,C=0;for(s||(w=await e.iterator());!s||b<t.batchesPerEpoch;){const S=await w.next();if(s&&S.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${b} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(S.value!=null){const{xs:$,ys:N}=ZI(n,S.value),R={};R.batch=C,R.size=$[0].shape[0],await m.onBatchBegin(C,R);const O=[];if(t.classWeight!=null){const D=YI(t.classWeight,n.outputNames);for(let T=0;T<D.length;++T)O.push(await QI(N[T],null,D[T]))}const F=$.concat(N).concat(O),A=l(F);Ge(F);for(let D=0;D<u.length;++D){const T=u[D],z=A[D];R[T]=z,fr(z)}await m.onBatchEnd(C,R),BI(R),C++,b++}if(s?b>=t.batchesPerEpoch:S.done){if(r){let $;yb(t.validationData)?$=yt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):$=yt(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?UM:t.validationBatchSize,verbose:0}));for(let N=0;N<n.metricsNames.length;++N)v[`val_${n.metricsNames[N]}`]=$[N]}break}if(n.stopTraining_)break}if(await m.onEpochEnd(y,v),y++,n.stopTraining_)break}return await m.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function jM(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function yb(n){return typeof n.iterator=="function"}function KM(n){return typeof n.next=="function"}async function qM(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new Ue("Verbose mode is not implemented yet.");_(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=KM(e)?e:await e.iterator();let l=0,u=0;for(;!s||u<t.batches;){const h=await i.next();if(o=re(()=>{if(h.value){const{xs:d,ys:f}=ZI(n,h.value),m=d.concat(f),g=re(()=>r(m));if(Ge(m),u===0)for(let w=0;w<g.length;++w)o.push(rt(0));const y=m[0].shape[0];for(let w=0;w<g.length;++w){const v=g[w],b=o[w];o[w]=re(()=>xe(o[w],j(y,v))),u>0&&Ge(b)}Ge(g),l+=y,++u}return o}),h.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let h=0;h<o.length;++h){const d=o[h];o[h]=Oe(o[h],l),Ge(d)}return _n(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fg(n){_(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function vl(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Zo(s,e,t-e)):Zo(n,e,t-e)}function r1(n,e){return re(()=>n==null?null:Array.isArray(n)?n.map(t=>r1(t,e)):SI(n,e.dtype==="int32"?e:Ce(e,"int32")))}function _g(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}async function XM(n,e,t,s,r,o,i,l,u,h,d,f,m,g,y){r==null&&(r=32),o==null&&(o=1),d==null&&(d=!0),m==null&&(m=0);let w=!1;u!=null&&h!=null&&(w=!0);const v=n.checkNumSamples(t,r,g,"steps_per_epoch");let b;v!=null&&(b=js(0,v)),i==null&&(i=1);const{callbackList:C,history:S}=WI(l,i,o,m,v,g,r,w,f);C.setModel(n),n.history=S,await C.onTrainBegin(),n.stopTraining_=!1;for(let $=m;$<o;++$){await C.onEpochBegin($);const N={};{if(d==="batch")throw new Ue("batch shuffling is not implemneted yet");d&&AE(b);const R=is(b),O=_g(v,r);for(let F=0;F<O.length;++F){const A={};if(await C.onBatchBegin(F,A),re(()=>{const D=O[F][0],T=O[F][1],z=Zo(R,D,T-D);A.batch=F,A.size=T-D;const U=r1(t,z),Q=e(U);for(let q=0;q<s.length;++q){const J=s[q],ne=Q[q];A[J]=ne,fr(ne)}if(F===O.length-1&&w){const q=n.testLoop(u,h,r);for(let J=0;J<s.length;++J){const ne=s[J],B=q[J];fr(B),N["val_"+ne]=B}}}),await C.onBatchEnd(F,A),BI(A),n.stopTraining_)break}R.dispose()}if(await C.onEpochEnd($,N),n.stopTraining_)break}return await C.onTrainEnd(),await n.history.syncData(),n.history}async function YM(n,e,t,s={}){if(n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;let r,o,i,l,u,h,d,f,m;try{const g=s.batchSize==null?32:s.batchSize;Fg(g);const w=await n.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=w[0],o=w[1],m=w[2];let v=!1,b;if(s.validationData!=null&&s.validationData.length>0){if(v=!0,s.validationData.length===2)u=s.validationData[0],h=s.validationData[1];else throw s.validationData.length===3?new Ue("validationData including sample weights is not supported yet."):new G(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const D=await n.standardizeUserData(u,h,null,null,!0,g);d=D[0],f=D[1],b=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){v=!0;const A=Math.floor(r[0].shape[0]*(1-s.validationSplit)),D=r[0].shape[0];d=vl(r,A,D),i=r,r=vl(r,0,A),f=vl(o,A,D),l=o,o=vl(o,0,A),b=d.concat(f)}else s.validationSteps!=null&&(v=!0);const C=r.concat(o).concat(m);n.checkTrainableWeightsConsistency();const S=n.makeTrainFunction(),$=n.getDedupedMetricsNames();let N,R;v?(n.makeTestFunction(),N=n.testFunction,R=$.slice().concat($.map(A=>"val_"+A))):(N=null,b=[],R=$.slice());const O=VI(s.callbacks,s.yieldEvery);return await XM(n,S,C,$,g,s.epochs,s.verbose,O,N,b,s.shuffle,R,s.initialEpoch,null,null)}finally{n.isTraining=!1,Ws(r,e),Ws(o,t),Ws(i,e),Ws(l,t),Ws(d,u),Ws(f,h),m!=null&&Ge(m)}}function JI(n){const e=[];n instanceof Pt&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Wu(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Ws(n,e){if(n==null)return;const t=[];if(e instanceof Pt)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof Pt)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QM(n){return n instanceof Pt}function Og(n){return Array.isArray(n)}function wb(n){return!QM(n)&&!Og(n)}function vb(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(Og(n)&&n.length>0)i=!0;else if(wb(n)){for(const l in n)if(n.hasOwnProperty(l)){i=!0;break}}else i=!0;if(i)throw new G(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(wb(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new G(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(Og(n)){if(n=n,n.length!==e.length)throw new G(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new G(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=JI(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const l=o[i];if(l.shape.length!==t[i].length)throw new G(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${l.shape}`);for(let u=0;u<t[i].length;++u){if(u===0&&!s)continue;const h=l.shape[u],d=t[i][u];if(d!=null&&d>=0&&h!==d)throw new G(`${r} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${r} received an input with ${l.shape[0]} examples, each with shape [${l.shape.slice(1,l.shape.length)}] (tensor shape [${l.shape}])`)}}return o}function ZM(n,e,t){const s=lo(n.map(o=>o.shape[0]));s.sort();const r=lo(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new G(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new G(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!ot(s,r))throw new G(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function JM(n,e,t){const s=[Ef,Rf,Tl];for(let r=0;r<n.length;++r){const o=n[r],i=e[r],l=t[r];if(i!=null){if(i===Tl&&o.shape[o.shape.length-1]===1)throw new G(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const u=o.shape.slice(1),h=l.slice(1);for(let d=0;d<u.length;++d){const f=u[d],m=h[d];if(m!=null&&f!==m)throw new G(`A target Tensor with shape ${o.shape} was passed for an output of shape ${l}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function bb(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new G(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new G(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const l=o[i];if(l.shape.length!==t[i].length)throw new G(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(l.shape)}`);for(let u=0;u<t[i].length;++u){if(u===0&&!s)continue;const h=l.shape[u],d=t[i][u];if(d!=null&&d!==h)throw new G(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(l.shape)}.`)}}}function ez(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const tz="layers-model";class ea extends zs{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new G("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");LM(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=OM(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ko))throw new G("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new G(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(qm(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new G(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(l=>qm(l))}else{const i=qm(e.loss);this.outputs.forEach(l=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const l=this.internalOutputShapes[i],u=this.outputNames[i];this.feedOutputNames.push(u),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Qo("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const l=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([l,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=ez(e.metrics,this.outputNames),o=(i,l,u)=>{this.outputNames.length>1&&(l=this.outputNames[i]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([u,i])};Qo("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const l=r[i];(h=>{const d="";let f,m,g;for(const y of h){if(typeof y=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(y)!==-1){const v=this.internalOutputShapes[i];v[v.length-1]===1||this.lossFunctions[i]===Rf?["accuracy","acc"].indexOf(y)!==-1?m=GI:["crossentropy","ce"].indexOf(y)!==-1&&(m=$M):this.lossFunctions[i]===Qh?["accuracy","acc"].indexOf(y)!==-1?m=SM:["crossentropy","ce"].indexOf(y)!==-1&&(m=KI):["accuracy","acc"].indexOf(y)!==-1?m=HI:["crossentropy","ce"].indexOf(y)!==-1&&(m=jI);let b;["accuracy","acc"].indexOf(y)!==-1?b="acc":["crossentropy","ce"].indexOf(y)!==-1&&(b="ce"),g=m,f=d+b}else g=_M(y),f=d+xh(y);let w;Qo(f,()=>{w=g}),o(i,f,w)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;Fg(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const l=i[0].concat(i[1]);this.makeTestFunction();const u=this.testFunction,h=this.testLoop(u,l,r,s.verbose,s.steps);return _n(h)}finally{Ws(i[0],e),Ws(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),qM(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new G(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new G(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new G("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),i=new oo;if(e instanceof Pt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new G(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)i.add(this.inputs[u],e[u])}else for(const u of this.inputs){const h=e[u.name];if(h==null)throw new G(`No value is provided for the model's input ${u.name}`);i.add(u,h)}const l=wl(o,i);return s?l:l[0]}retrieveSymbolicTensors(e){const t=li(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(l=>l.name);for(let l=0;l<e.length;++l){const u=i.indexOf(e[l]);if(u!==-1&&(t[l]=o[u],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,i)=>{o==null&&r.push(e[i])}),new G(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return re(()=>{const r=this.checkNumSamples(e);if(s)throw new Ue("Verbose predictLoop() is not implemented yet.");const o=_g(r,t),i=this.outputs.map(l=>[]);for(let l=0;l<o.length;++l)re(()=>{const h=o[l][0],d=o[l][1],f=vl(e,h,d),m=[];if(Array.isArray(f))for(let y=0;y<f.length;++y)m.push({key:this.inputs[y],value:f[y]});else m.push({key:this.inputs[0],value:f});const g=new oo(m);return wl(this.outputs,g)}).forEach((h,d)=>i[d].push(h));return _n(i.map(l=>On(l,0)))})}predict(e,t={}){const s=JI(e);bb(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return Fg(r),this.predictLoop(s,r)}finally{Ws(s,e)}}predictOnBatch(e){bb(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Is("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const l=this.feedOutputShapes[i];this.feedLossFns[i]===Qh?o.push(l.slice(0,l.length-1).concat([1])):o.push(l)}if(e=vb(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=vb(t,this.feedOutputNames,o,!1,"target"),ZM(e,t),JM(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new G(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,i){const[l,u]=this.standardizeUserDataXY(e,t,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let h=null;if(r!=null){const d=YI(r,this.outputNames);h=[];for(let f=0;f<d.length;++f)h.push(await QI(u[f],null,d[f]))}return[l,u,h]}testLoop(e,t,s,r=0,o){return re(()=>{const i=this.checkNumSamples(t,s,o,"steps"),l=[];if(r>0)throw new Ue("Verbose mode is not implemented yet.");if(o!=null)throw new Ue("steps mode in testLoop() is not implemented yet");{const u=_g(i,s),h=is(js(0,i));for(let d=0;d<u.length;++d){const f=u[d][0],m=u[d][1],g=Zo(h,f,m-f),y=r1(t,g),w=e(y);if(d===0)for(let v=0;v<w.length;++v)l.push(rt(0));for(let v=0;v<w.length;++v){const b=w[v];l[v]=xe(l[v],j(m-f,b))}}for(let d=0;d<l.length;++d)l[d]=Oe(l[d],i)}return l})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(ob(e,r)>1){const i=ob(e.slice(0,s),r);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],l=()=>{const f=[];for(let w=0;w<this.inputs.length;++w)f.push({key:this.inputs[w],value:s[w]});const m=new oo(f),g=wl(this.outputs,m,{training:!0});let y;for(let w=0;w<this.lossFunctions.length;++w){const v=this.lossFunctions[w];let b=v(r[w],g[w]);o[w]!=null&&(b=WM(b,o[w]));const C=Mt(b);t.push(C),w===0?y=b:y=xe(y,b)}for(let w=0;w<this.metricsTensors.length;++w){let v;if(this.outputs.length>1&&w<this.outputs.length)v=t[w];else{const b=this.metricsTensors[w][0],C=this.metricsTensors[w][1];v=Mt(b(r[C],g[C]))}fr(v),i.push(v)}return y=Mt(y),this.calculateLosses().forEach(w=>{y=xe(y,w)}),y},u=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(l,!0,u)].concat(i)}}makeTestFunction(){this.testFunction=e=>re(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let h=0;h<this.inputs.length;++h)i.push({key:this.inputs[h],value:r[h]});const l=new oo(i),u=wl(this.outputs,l);for(let h=0;h<this.lossFunctions.length;++h){const d=this.lossFunctions[h],f=Mt(d(o[h],u[h]));h===0?s=f:s=xe(s,f),t.push(s)}for(let h=0;h<this.metricsTensors.length;++h){const d=this.metricsTensors[h][0],f=this.metricsTensors[h][1],m=Mt(d(o[f],u[f]));t.push(m)}return t})}async fit(e,t,s={}){return YM(this,e,t,s)}async fitDataset(e,t){return HM(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],l=this.makeTrainFunction()(r.concat(o)),u=[];for(const h of l){const d=await h.data();u.push(d[0])}return Ge(l),Ws(s[0],e),Ws(s[1],t),_n(u)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||t.push({name:r[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=Mv().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Mv().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Tr(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Tr(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Tr(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Tr(xh(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Tr(xh(e)));{const e={};for(const t in this.metrics)e[t]=Tr(xh(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=td(e.optimizer_config),s=hr(t);let r;if(typeof e.loss=="string")r=Ho(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>Ho(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=Ho(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>Ho(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=Ho(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const h=DR(e);if(h.length===0)throw new G(`Cannot find any save handlers for URL '${e}'`);if(h.length>1)throw new G(`Found more than one (${h.length}) save handlers for URL '${e}'`);e=h[0]}if(e.save==null)throw new G("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Fv(this.getNamedWeights(t)),l={modelTopology:this.toJSON(null,!1),format:tz,generatedBy:`TensorFlow.js tfjs-layers v${XI}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();const h="optimizer",{data:d,specs:f}=await Fv(await this.optimizer.getWeights(),h);s.specs.push(...f),s.data=Yk([s.data,d])}return this.userDefinedMetadata!=null&&(gb(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=s.data,l.weightSpecs=s.specs,e.save(l)}setUserDefinedMetadata(e){gb(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ea.className="Model";de(ea);class e$ extends ea{}e$.className="Functional";de(e$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function nz(n,e){if(e==null&&(e={}),typeof n=="string"){const t=AR(n,e);if(t.length===0)t.push(tD(n,e));else if(t.length>1)throw new G(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return sz(n,void 0,e)}async function sz(n,e,t){if(t==null&&(t={}),n.load==null)throw new G("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,l=hr(td(r),e,i),u=s.trainingConfig;if(u!=null&&l.loadTrainingConfig(u),s.userDefinedMetadata!=null&&l.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new G("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:h,optimizerWeights:d}=rz(s.weightData,s.weightSpecs);l.loadWeights(h,o),l.optimizer!=null&&d.length>0&&await l.optimizer.setWeights(d),Ge(h),Ge(d.map(f=>f.tensor))}return l}function rz(n,e){const t=wR(n,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):s[o.name]=t[o.name]}),{modelWeights:s,optimizerWeights:r}}class El extends ea{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Sf("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new G(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof El||e instanceof ea;let s;if(t){if(s=e,s.outputs.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new G("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new G("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=nM({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new G(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=OI(this.outputs[0])}this.inboundNodes=[],new Tf({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:li(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(at(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ea({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Is("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Is("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Is("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Is("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new G("Legacy serialization format not supported yet.");o=t}else _(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const l=new e(i);if(!(l instanceof El))throw new Ue(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(const u of o){const d=hr(u,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new G("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new G("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}El.className="Sequential";de(El);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oz(n,e){return e==null&&(e={}),nz(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Mn=class extends ya{getConfig(){return{}}};class t$ extends Mn{apply(e,t=1){return WP(e,t)}}t$.className="elu";de(t$);class n$ extends Mn{apply(e){return _C(e)}}n$.className="selu";de(n$);class s$ extends Mn{apply(e){return fi(e)}}s$.className="relu";de(s$);class r$ extends Mn{apply(e){return re(()=>e0(6,fi(e)))}}r$.className="relu6";de(r$);class o$ extends Mn{apply(e){return e}}o$.className="linear";de(o$);class i$ extends Mn{apply(e){return wa(e)}}i$.className="sigmoid";de(i$);class a$ extends Mn{apply(e){return GP(e)}}a$.className="hardSigmoid";de(a$);class l$ extends Mn{apply(e){return _u(e)}}l$.className="softplus";de(l$);class u$ extends Mn{apply(e){return UP(e)}}u$.className="softsign";de(u$);class c$ extends Mn{apply(e){return Gx(e)}}c$.className="tanh";de(c$);let o1=class extends Mn{apply(e,t=-1){return l0(e,t)}};o1.className="softmax";de(o1);class h$ extends Mn{apply(e,t=-1){return TC(e,t)}}h$.className="logSoftmax";de(h$);class d$ extends Mn{apply(e,t=1){return re(()=>j(wa(j(e,t)),e))}}d$.className="swish";de(d$);class f$ extends Mn{apply(e){return re(()=>j(e,Gx(_u(e))))}}f$.className="mish";de(f$);function fo(n){return n.getClassName()}function Xm(n,e={}){return Bu(n,Cs.getMap().classNameMap,e,"activation")}function po(n){if(n==null){const e={};return e.className="linear",e.config={},Xm(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},Xm(e)}else return n instanceof Mn?n:Xm(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iz(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class p$ extends ya{}class m$ extends p${constructor(e){super(),iz(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return re(()=>{let t=Zt([1]);return this.hasL1&&(t=xe(t,_e(j(this.l1,Cn(e))))),this.hasL2&&(t=xe(t,_e(j(this.l2,Uu(e))))),Z(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}m$.className="L1L2";de(m$);const kb={l1l2:"L1L2"};function ht(n){return G0(n)}function Cb(n,e={}){return Bu(n,Cs.getMap().classNameMap,e,"regularizer")}function It(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in kb?kb[n]:n,config:{}};return Cb(t)}else return n instanceof p$?n:Cb(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class g$ extends Xe{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Ve(e);let s=fi(e);return this.maxValue!=null&&(s=us(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}g$.className="ReLU";de(g$);class x$ extends Xe{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Ve(e);return Qx(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}x$.className="LeakyReLU";de(x$);class y$ extends Xe{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Ct(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=It(e.alphaRegularizer),this.alphaConstraint=jt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new G(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=at(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Gt({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=Ve(e),r0(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Nt(this.alphaInitializer),alphaRegularizer:ht(this.alphaRegularizer),alphaConstraint:Ht(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}y$.className="PReLU";de(y$);let w$=class extends Xe{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ue(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Ve(e);return yf(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};w$.className="ELU";de(w$);class v$ extends Xe{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=Ve(e);return j(s,Ce(Ts(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}v$.className="ThresholdedReLU";de(v$);class b$ extends Xe{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new o1().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){const s=Ve(e);return this.softmax(s,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}b$.className="Softmax";de(b$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ta(n,e,t){if(typeof n=="number")return li(n,e);if(n.length!==e)throw new G(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!MP(r))throw new G(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Hs(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function or(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+ho([t-e,0]);else if(s==="same")n=n*e;else throw new G(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function i1(n,e){return re(()=>(_t(e),e==="channelsFirst"?qe(n,[0,2,3,1]):n))}function k$(n,e){return re(()=>(_t(e),e==="channelsFirst"?qe(n,[0,2,3,4,1]):n))}function az(n,e,t,s=1,r="valid",o,i=1){return re(()=>{if(o==null&&(o=Ks()),_t(o),n.shape.length!==3)throw new G(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new G(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new G(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(o==="channelsFirst"&&(n=qe(n,[0,2,1])),r==="causal")throw new Ue("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let l=yC(n,e,s,r==="same"?"same":"valid","NWC",i);return t!=null&&(l=Xs(l,t)),l})}function Ib(n,e,t,s=[1,1],r="valid",o,i,l=null){return re(()=>{if(o==null&&(o=Ks()),_t(o),n.rank!==3&&n.rank!==4)throw new G(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new G(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let u=i1(n,o);if(r==="causal")throw new Ue("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=$O({x:u,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:l}),o==="channelsFirst"&&(u=qe(u,[0,3,1,2])),u})}function lz(n,e,t,s=[1,1,1],r="valid",o,i){return re(()=>{if(o==null&&(o=Ks()),_t(o),n.rank!==4&&n.rank!==5)throw new G(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new G(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let l=k$(n,o);if(r==="causal")throw new Ue("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return l=TA(l,e,s,r==="same"?"same":"valid","NDHWC",i),t!=null&&(l=Xs(l,t)),o==="channelsFirst"&&(l=qe(l,[0,4,1,2,3])),l})}class Df extends Xe{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Df.verifyArgs(t),this.rank=e,en(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ue(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=ta(t.kernelSize,e,"kernelSize"),this.strides=ta(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,cs(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_t(this.dataFormat),this.activation=po(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Ct(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=jt(t.biasConstraint),this.biasRegularizer=It(t.biasRegularizer),this.activityRegularizer=It(t.activityRegularizer),this.dilationRate=ta(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new G(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new G(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new G(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(rr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!H0(e.kernelSize,"number",1,3))throw new G(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fo(this.activation),useBias:this.useBias,biasInitializer:Nt(this.biasInitializer),biasRegularizer:ht(this.biasRegularizer),activityRegularizer:ht(this.activityRegularizer),biasConstraint:Ht(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Ca extends Df{constructor(e,t){super(e,t),this.kernel=null,Ca.verifyArgs(t),this.filters=t.filters,en(this.filters,"filters"),this.kernelInitializer=Ct(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=jt(t.kernelConstraint),this.kernelRegularizer=It(t.kernelRegularizer)}build(e){e=at(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return re(()=>{e=Ve(e);let s;const r=this.bias==null?null:this.bias.read(),o=vI(this.activation.getClassName());if(o!=null&&this.rank===2)s=Ib(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=az(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=Ib(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=lz(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ue("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=at(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=Hs(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Nt(this.kernelInitializer),kernelRegularizer:ht(this.kernelRegularizer),kernelConstraint:Ht(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new G(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Ku extends Ca{constructor(e){super(2,e),Ku.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!H0(e.kernelSize,"number",1,2))throw new G(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Ku.className="Conv2D";de(Ku);class qu extends Ca{constructor(e){super(3,e),qu.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new G(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}qu.className="Conv3D";de(qu);class C$ extends Ku{constructor(e){if(super(e),this.inputSpec=[new Gt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=at(e),e.length!==4)throw new G("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Gt({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return re(()=>{let s=Ve(e);if(s.shape.length!==4)throw new G(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,l;this.dataFormat==="channelsFirst"?(i=2,l=3):(i=1,l=2);const u=r[i],h=r[l],d=this.kernelSize[0],f=this.kernelSize[1],m=this.strides[0],g=this.strides[1],y=or(u,m,d,this.padding),w=or(h,g,f,this.padding),v=[o,y,w,this.filters];this.dataFormat!=="channelsLast"&&(s=qe(s,[0,2,3,1]));let b=wC(s,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=qe(b,[0,3,1,2])),this.bias!=null&&(b=Xs(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=at(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],l=this.kernelSize[1],u=this.strides[0],h=this.strides[1];return t[s]=this.filters,t[r]=or(t[r],u,i,this.padding),t[o]=or(t[o],h,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}C$.className="Conv2DTranspose";de(C$);class I$ extends qu{constructor(e){if(super(e),this.inputSpec=[new Gt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=at(e),e.length!==5)throw new G("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Gt({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return re(()=>{let s=Ve(e);if(s.shape.length!==5)throw new G(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,l,u;this.dataFormat==="channelsFirst"?(u=2,i=3,l=4):(u=1,i=2,l=3);const h=r[u],d=r[i],f=r[l],m=this.kernelSize[0],g=this.kernelSize[1],y=this.kernelSize[2],w=this.strides[0],v=this.strides[1],b=this.strides[2],C=or(h,w,m,this.padding),S=or(d,v,g,this.padding),$=or(f,b,y,this.padding),N=[o,C,S,$,this.filters];this.dataFormat!=="channelsLast"&&(s=qe(s,[0,2,3,4,1]));let R=DA(s,this.kernel.read(),N,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(R=qe(R,[0,4,1,2,3])),this.bias!==null&&(R=Xs(R,this.bias.read(),this.dataFormat)),this.activation!==null&&(R=this.activation.apply(R)),R})}computeOutputShape(e){e=at(e);const t=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const l=this.kernelSize[0],u=this.kernelSize[1],h=this.kernelSize[2],d=this.strides[0],f=this.strides[1],m=this.strides[2];return t[s]=this.filters,t[r]=or(t[r],d,l,this.padding),t[o]=or(t[o],f,u,this.padding),t[i]=or(t[i],m,h,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}I$.className="Conv3DTranspose";de(I$);class $$ extends Ca{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new G("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new G("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new G(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Ct(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=It(t.depthwiseRegularizer),this.depthwiseConstraint=jt(t.depthwiseConstraint),this.pointwiseInitializer=Ct(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=It(t.pointwiseRegularizer),this.pointwiseConstraint=jt(t.pointwiseConstraint)}build(e){if(e=at(e),e.length<this.rank+2)throw new G(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new G(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let l=0;l<this.rank;++l)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Gt({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return re(()=>{e=Ve(e);let s;if(this.rank===1)throw new Ue("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=qe(e,[0,2,3,1])),s=OC(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Xs(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=qe(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Nt(this.depthwiseInitializer),e.pointwiseInitializer=Nt(this.pointwiseInitializer),e.depthwiseRegularizer=ht(this.depthwiseRegularizer),e.pointwiseRegularizer=ht(this.pointwiseRegularizer),e.depthwiseConstraint=Ht(this.depthwiseConstraint),e.pointwiseConstraint=Ht(this.pointwiseConstraint),e}}$$.className="SeparableConv";class S$ extends $${constructor(e){super(2,e)}}S$.className="SeparableConv2D";de(S$);class Af extends Ca{constructor(e){super(1,e),Af.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!H0(e.kernelSize,"number",1,1))throw new G(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Af.className="Conv1D";de(Af);class N$ extends Xe{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return re(()=>{if(e=Ve(e),this.dataFormat==="channelsLast"){const s=gh(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return gh(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=gh(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return gh(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}N$.className="Cropping2D";de(N$);class T$ extends Xe{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,OP(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return re(()=>{let s=Ve(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=qe(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],l=this.interpolation==="nearest"?fh.resizeNearestNeighbor(s,[o,i]):fh.resizeBilinear(s,[o,i]);return qe(l,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?fh.resizeNearestNeighbor(s,[o,i]):fh.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}T$.className="UpSampling2D";de(T$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uz(n,e,t=[1,1],s="valid",r,o){return re(()=>{r==null&&(r=Ks()),_t(r);let i=i1(n,r);if(n.rank!==4)throw new G(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new G(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=qx(i,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=qe(i,[0,3,1,2])),i})}class E$ extends Df{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Ct(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=jt(e.depthwiseConstraint),this.depthwiseRegularizer=It(e.depthwiseRegularizer)}build(e){if(e=at(e),e.length<4)throw new G(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new G(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return re(()=>{e=Ve(e);let s=uz(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Xs(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=at(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Hs(t,this.kernelSize[0],this.padding,this.strides[0]),i=Hs(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Nt(this.depthwiseInitializer),e.depthwiseRegularizer=ht(this.depthwiseRegularizer),e.depthwiseConstraint=Ht(this.depthwiseRegularizer),e}}E$.className="DepthwiseConv2D";de(E$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function R$(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new G("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function D$(n,e,t,s=!1,r,o,i=!1,l=!1){return re(()=>{const u=e.shape.length;if(u<3)throw new G(`Input should be at least 3D, but is ${u}D.`);const h=[1,0].concat(js(2,u));e=qe(e,h),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Ce(Ce(r,"bool"),"float32"),r.rank===u-1&&(r=ks(r,-1)),r=qe(r,h)),s&&(e=oi(e,0),r!=null&&(r=oi(r,0)));const d=[];let f,m=t;const g=e.shape[0],y=la(e);let w;r!=null&&(w=la(r));for(let b=0;b<g;++b){const C=y[b],S=re(()=>n(C,m));if(r==null)f=S[0],m=S[1];else{const $=re(()=>{const N=w[b],R=Me(Ss(N),N),O=xe(j(S[0],N),j(m[0],R)),F=m.map((A,D)=>xe(j(S[1][D],N),j(A,R)));return{output:O,newStates:F}});f=$.output,m=$.newStates}l&&d.push(f)}let v;return l&&(v=ii(d,1)),[f,v,m]})}class Co extends Xe{constructor(e){super(e);let t;if(e.cell==null)throw new G("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new u1({cells:e.cell}):t=e.cell,t.stateSize==null)throw new G("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Gt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return js(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Eg(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,t){return re(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ue("Constants support is not implemented in RNN yet.");Eg(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Gt({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!ot(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new G(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Gt({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){re(()=>{if(!this.stateful)throw new sr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Zt([s,r])):this.states_=[Zt([s,this.cell.stateSize])];else if(e==null)Ge(this.states_),this.keptStates!=null&&(Ge(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Zt([s,r])):this.states_[0]=Zt([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Ge(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,l=[s,i];if(!ot(o.shape,l))throw new G(`State ${r} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>fr(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=R$(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],l=[];if(s!=null){t.initialState=s,i=i.concat(s),this.stateSpec=[];for(const h of s)this.stateSpec.push(new Gt({shape:h.shape}));l=l.concat(this.stateSpec)}if(r!=null&&(t.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof ir){const h=[e].concat(i),d=this.inputSpec.concat(l),f=this.inputSpec;this.inputSpec=d;const m=super.apply(h,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return re(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=Ve(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new G(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const l={training:r},h=D$((y,w)=>{const v=this.cell.call([y].concat(w),l);return[v[0],v.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),d=h[0],f=h[1],m=h[2];this.stateful&&this.resetStates(m,r);const g=this.returnSequences?f:d;return this.returnState?[g].concat(m):g})}getInitialState(e){return re(()=>{let t=Zt(e.shape);return t=_e(t,[1,2]),t=Wu(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Ng(t,[1,s]):t):this.cell.stateSize>1?[Ng(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Co.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign({},s,e,t)}static fromConfig(e,t,s={}){const r=t.cell,o=hr(r,s);return new e(Object.assign(t,{cell:o}))}}Co.className="RNN";de(Co);class Ff extends Xe{}class a1 extends Ff{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,en(this.units,"units"),this.activation=po(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ct(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ct(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ct(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=It(e.kernelRegularizer),this.recurrentRegularizer=It(e.recurrentRegularizer),this.biasRegularizer=It(e.biasRegularizer),this.kernelConstraint=jt(e.kernelConstraint),this.recurrentConstraint=jt(e.recurrentConstraint),this.biasConstraint=jt(e.biasConstraint),this.dropout=ua([1,ho([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ua([1,ho([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=at(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return re(()=>{if(e=e,e.length!==2)throw new G(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=mo({ones:()=>Ss(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=mo({ones:()=>Ss(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,l=this.recurrentDropoutMask;i!=null?o=cr(j(e,i),this.kernel.read()):o=cr(e,this.kernel.read()),this.bias!=null&&(o=Xs(o,this.bias.read())),l!=null&&(s=j(s,l));let u=xe(o,cr(s,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:fo(this.activation),useBias:this.useBias,kernelInitializer:Nt(this.kernelInitializer),recurrentInitializer:Nt(this.recurrentInitializer),biasInitializer:Nt(this.biasInitializer),kernelRegularizer:ht(this.kernelRegularizer),recurrentRegularizer:ht(this.recurrentRegularizer),biasRegularizer:ht(this.biasRegularizer),activityRegularizer:ht(this.activityRegularizer),kernelConstraint:Ht(this.kernelConstraint),recurrentConstraint:Ht(this.recurrentConstraint),biasConstraint:Ht(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}a1.className="SimpleRNNCell";de(a1);class A$ extends Co{constructor(e){e.cell=new a1(e),super(e)}call(e,t){return re(()=>{this.cell.dropoutMask!=null&&(Ge(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ge(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}A$.className="SimpleRNN";de(A$);class l1 extends Ff{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new G("GRUCell does not support reset_after parameter set to true.");this.units=e.units,en(this.units,"units"),this.activation=po(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=po(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ct(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ct(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ct(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=It(e.kernelRegularizer),this.recurrentRegularizer=It(e.recurrentRegularizer),this.biasRegularizer=It(e.biasRegularizer),this.kernelConstraint=jt(e.kernelConstraint),this.recurrentConstraint=jt(e.recurrentConstraint),this.biasConstraint=jt(e.biasConstraint),this.dropout=ua([1,ho([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ua([1,ho([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=at(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return re(()=>{if(e=e,e.length!==2)throw new G(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=mo({ones:()=>Ss(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=mo({ones:()=>Ss(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let l,u,h;0<this.dropout&&this.dropout<1&&(e=j(e,o[0]));let d=cr(e,this.kernel.read());this.useBias&&(d=Xs(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=j(r,i[0]));const f=this.recurrentKernel.read(),[m,g]=ls(f,[2*this.units,this.units],f.rank-1),y=cr(r,m),[w,v,b]=ls(d,3,d.rank-1),[C,S]=ls(y,2,y.rank-1);l=this.recurrentActivation.apply(xe(w,C)),u=this.recurrentActivation.apply(xe(v,S));const $=cr(j(u,r),g);h=this.activation.apply(xe(b,$));const N=xe(j(l,r),j(xe(1,zt(l)),h));return[N,N]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:fo(this.activation),recurrentActivation:fo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Nt(this.kernelInitializer),recurrentInitializer:Nt(this.recurrentInitializer),biasInitializer:Nt(this.biasInitializer),kernelRegularizer:ht(this.kernelRegularizer),recurrentRegularizer:ht(this.recurrentRegularizer),biasRegularizer:ht(this.biasRegularizer),activityRegularizer:ht(this.activityRegularizer),kernelConstraint:Ht(this.kernelConstraint),recurrentConstraint:Ht(this.recurrentConstraint),biasConstraint:Ht(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}l1.className="GRUCell";de(l1);class F$ extends Co{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new l1(e),super(e)}call(e,t){return re(()=>{this.cell.dropoutMask!=null&&(Ge(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ge(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}F$.className="GRU";de(F$);class _f extends Ff{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,en(this.units,"units"),this.activation=po(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=po(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ct(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ct(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ct(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=It(e.kernelRegularizer),this.recurrentRegularizer=It(e.recurrentRegularizer),this.biasRegularizer=It(e.biasRegularizer),this.kernelConstraint=jt(e.kernelConstraint),this.recurrentConstraint=jt(e.recurrentConstraint),this.biasConstraint=jt(e.biasConstraint),this.dropout=ua([1,ho([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ua([1,ho([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=at(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(t=class extends Es{apply(u,h){const d=o.apply([i]),f=new K0().apply([i]),m=o.apply([i*2]);return ab(ab(d,f),m)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return re(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new G(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=mo({ones:()=>Ss(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=mo({ones:()=>Ss(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,l=this.recurrentDropoutMask;let u,h,d,f;0<this.dropout&&this.dropout<1&&(e=j(e,i[0]));let m=cr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=j(r,l[0])),m=xe(m,cr(r,this.recurrentKernel.read())),this.useBias&&(m=Xs(m,this.bias.read()));const[g,y,w,v]=ls(m,4,m.rank-1);u=this.recurrentActivation.apply(g),h=this.recurrentActivation.apply(y),d=xe(j(h,o),j(u,this.activation.apply(w))),f=this.recurrentActivation.apply(v);const b=j(f,this.activation.apply(d));return[b,b,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:fo(this.activation),recurrentActivation:fo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Nt(this.kernelInitializer),recurrentInitializer:Nt(this.recurrentInitializer),biasInitializer:Nt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ht(this.kernelRegularizer),recurrentRegularizer:ht(this.recurrentRegularizer),biasRegularizer:ht(this.biasRegularizer),activityRegularizer:ht(this.activityRegularizer),kernelConstraint:Ht(this.kernelConstraint),recurrentConstraint:Ht(this.recurrentConstraint),biasConstraint:Ht(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}_f.className="LSTMCell";de(_f);class _$ extends Co{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new _f(e),super(e)}call(e,t){return re(()=>{this.cell.dropoutMask!=null&&(Ge(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ge(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}_$.className="LSTM";de(_$);class u1 extends Ff{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return re(()=>{e=e;let s=e.slice(1);const r=[];for(const l of this.cells.slice().reverse())Array.isArray(l.stateSize)?r.push(s.splice(0,l.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let l=0;l<this.cells.length;++l){const u=this.cells[l];s=r[l],l===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=u.call(i,t),o.push(i.slice(1))}s=[];for(const l of o.slice().reverse())s.push(...l);return[i[0]].concat(s)})}build(e){Eg(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Qo(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign({},e,r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(hr(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Rg(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)t.push([s.weights[i],o[i]])}e1(t)}}u1.className="StackedRNNCells";de(u1);function mo(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):NI(e(),t),l=()=>Gu(i,e,s);return!r||r<=1?fr(l().clone()):Array(r).fill(void 0).map(l).map(h=>fr(h.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var cz=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class O$ extends Co{constructor(e){if(e.unroll)throw new Ue("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ue("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Gt({ndim:5})]}call(e,t){return re(()=>{if(this.cell.dropoutMask!=null&&(Ge(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ge(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new G("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return re(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Zt(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){re(()=>{if(!this.stateful)throw new sr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Zt(o)):this.states_=[Zt(o)];else if(e==null)Ge(this.states_),this.keptStates!=null&&(Ge(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Zt(o)):this.states_[0]=Zt(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Ge(this.states_);for(let l=0;l<this.states_.length;++l){const u=e[l],h=o;if(!ot(u.shape,h))throw new G(`State ${l} is incompatible with layer ${this.name}: expected shape=${h}, received shape=${u.shape}`);this.states_[l]=u}}this.states_=this.states_.map(l=>fr(l.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:l}=this.cell,u=t==="channelsFirst",h=e[u?3:2],d=e[u?4:3],f=Hs(h,r[0],o,i[0],l[0]),m=Hs(d,r[1],o,i[1],l[1]);return[...e.slice(0,2),...u?[s,f,m]:[f,m,s]]}}O$.className="ConvRNN2D";class c1 extends _f{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:l}=e;super(Object.assign({},e,{units:t})),this.filters=t,en(this.filters,"filters"),this.kernelSize=ta(s,2,"kernelSize"),this.kernelSize.forEach(u=>en(u,"kernelSize")),this.strides=ta(r||1,2,"strides"),this.strides.forEach(u=>en(u,"strides")),this.padding=o||"valid",cs(this.padding),this.dataFormat=i||"channelsLast",_t(this.dataFormat),this.dilationRate=ta(l||1,2,"dilationRate"),this.dilationRate.forEach(u=>en(u,"dilationRate"))}build(e){var t;e=at(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const l=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const h=this.biasInitializer,d=this.filters;u=new(t=class extends Es{apply(m,g){const y=h.apply([d]),w=di([d]),v=h.apply([d*2]);return j0([y,w,v])}},t.className="CustomInit",t)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return re(()=>{if(e.length!==3)throw new G(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],i=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=mo({ones:()=>Ss(r),rate:this.dropout,training:s,count:l,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,h=(Y,L,W)=>!L||!L[W]?Y:j(L[W],Y);let d=h(r,u,0),f=h(r,u,1),m=h(r,u,2),g=h(r,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=mo({ones:()=>Ss(o),rate:this.recurrentDropout,training:s,count:l,dropoutFunc:this.dropoutFunc}));const y=this.recurrentDropoutMask;let w=h(o,y,0),v=h(o,y,1),b=h(o,y,2),C=h(o,y,3);const S=3,[$,N,R,O]=ls(this.kernel.read(),l,S),[F,A,D,T]=this.useBias?ls(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,$,F,this.padding),f=this.inputConv(f,N,A,this.padding),m=this.inputConv(m,R,D,this.padding),g=this.inputConv(g,O,T,this.padding);const[z,U,Q,q]=ls(this.recurrentKernel.read(),l,S);w=this.recurrentConv(w,z),v=this.recurrentConv(v,U),b=this.recurrentConv(b,Q),C=this.recurrentConv(C,q);const J=this.recurrentActivation.apply(xe(d,w)),ne=this.recurrentActivation.apply(xe(f,v)),B=xe(j(ne,i),j(J,this.activation.apply(xe(m,b)))),X=j(this.recurrentActivation.apply(xe(g,C)),this.activation.apply(B));return[X,X,B]})}getConfig(){const e=super.getConfig(),t=cz(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,s)}inputConv(e,t,s,r){const o=ri(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Xs(o,s,this.dataFormat):o}recurrentConv(e,t){return ri(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}c1.className="ConvLSTM2DCell";de(c1);class L$ extends O${constructor(e){const t=new c1(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}L$.className="ConvLSTM2D";de(L$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class h1 extends Xe{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ve(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return Gu(()=>NI(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}h1.className="Dropout";de(h1);class P$ extends h1{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}P$.className="SpatialDropout1D";de(P$);class M$ extends Xe{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,en(this.units,"units"),this.activation=po(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Ct(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ct(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=jt(e.kernelConstraint),this.biasConstraint=jt(e.biasConstraint),this.kernelRegularizer=It(e.kernelRegularizer),this.biasRegularizer=It(e.biasRegularizer),this.activityRegularizer=It(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=at(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=at(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ve(e),r=vI(this.activation.getClassName());let o;return r!=null?o=cr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=cr(s,this.kernel.read()),this.bias!=null&&(o=Xs(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:fo(this.activation),useBias:this.useBias,kernelInitializer:Nt(this.kernelInitializer),biasInitializer:Nt(this.biasInitializer),kernelRegularizer:ht(this.kernelRegularizer),biasRegularizer:ht(this.biasRegularizer),activityRegularizer:ht(this.activityRegularizer),kernelConstraint:Ht(this.kernelConstraint),biasConstraint:Ht(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}M$.className="Dense";de(M$);class z$ extends Xe{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=at(e);for(const t of e.slice(1))if(t==null)throw new G(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],uo(e,1)]}call(e,t){return re(()=>{this.invokeCallHook(e,t);let s=Ve(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=qe(s,r)}return VP(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}z$.className="Flatten";de(z$);class B$ extends Xe{constructor(e){super(e),this.supportsMasking=!0,this.activation=po(e.activation)}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ve(e);return this.activation.apply(s)})}getConfig(){const e={activation:fo(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}B$.className="Activation";de(B$);class V$ extends Xe{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return re(()=>(e=Ve(e),zP(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}V$.className="RepeatVector";de(V$);class W$ extends Xe{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,i=null;for(let u=0;u<r.length;++u){const h=r[u];if(this.isUnknown(h))if(i===null)i=u;else throw new G("Can only specifiy one unknown dimension.");else o*=h}const l=uo(e);if(i!==null){if(o===0||l%o!==0)throw new G(s);r[i]=l/o}else if(l!==o)throw new G(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ve(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return Z(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}W$.className="Reshape";de(W$);class U$ extends Xe{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=js(1,e.dims.length+1);if(!ot(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Gt({ndim:this.dims.length+1})]}computeOutputShape(e){e=at(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return qe(Ve(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}U$.className="Permute";de(U$);class G$ extends Xe{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=Ve(e);return vg(Uh(s,this.maskValue),-1)}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ve(e),i=vg(Uh(s,this.maskValue),-1,!0);return j(s,Ce(i,s.dtype))})}}G$.className="Masking";de(G$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class H$ extends Xe{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(yt(e.inputLength))}this.inputDim=e.inputDim,en(this.inputDim,"inputDim"),this.outputDim=e.outputDim,en(this.outputDim,"outputDim"),this.embeddingsInitializer=Ct(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=It(e.embeddingsRegularizer),this.activityRegularizer=It(e.activityRegularizer),this.embeddingsConstraint=jt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return re(()=>this.maskZero?(e=Ve(e),Uh(e,Ye(e))):null)}computeOutputShape(e){if(e=at(e),this.inputLength==null)return[...e,this.outputDim];const t=yt(this.inputLength);if(t.length!==e.length-1)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=i),s++}}return[e[0],...t,this.outputDim]}call(e,t){return re(()=>{this.invokeCallHook(e,t);let s=Ve(e);s.dtype!=="int32"&&(s=Vu(s,"int32"));const r=SI(this.embeddings.read(),Z(s,[s.size]));return Z(r,at(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Nt(this.embeddingsInitializer),embeddingsRegularizer:ht(this.embeddingsRegularizer),activityRegularizer:ht(this.activityRegularizer),embeddingsConstraint:Ht(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}H$.className="Embedding";de(H$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mi extends Xe{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ue}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],i=t[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new G("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[at(e)]),e=e,e.length<2)throw new G(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=lo(t),t.length>1)throw new G(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&lo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return re(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=ho(r);for(let i of e){const l=i.rank;for(let u=0;u<o-l;++u)i=Wu(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const u of e){const h=u.rank;if(h==null){const d=u.shape,f=d[0],m=d.slice(1).concat([f]);let g=Z(u,[f].concat(uo(d.slice(1))));g=qe(g,[1,0]),g=Z(g,m),s.push(g),o=!0}else if(h>1){const d=js(1,h).concat([0]);s.push(qe(u,d)),o=!0}else s.push(u)}let i=this.mergeFunction(s);const l=i.rank;if(o){if(l==null){const u=i.shape,h=u.length,d=u[h-1],f=[d].concat(u.slice(0,u.length-1));i=Z(qe(Z(i,[-1,d]),[1,0]),f)}else if(l>1){const u=[l-1].concat(js(0,l-1));i=qe(i,u)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=lo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return re(()=>{if(t==null)return null;if(!Array.isArray(t))throw new G("`mask` should be an Array");if(!Array.isArray(e))throw new G("`inputs` should be an Array");if(t.length!==e.length)throw new G(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:ks(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=Ar(s,t[r]);return s})}}class j$ extends mi{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=xe(t,e[s]);return t})}}j$.className="Add";de(j$);class K$ extends mi{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=j(t,e[s]);return t})}}K$.className="Multiply";de(K$);class q$ extends mi{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=xe(t,e[s]);return j(1/e.length,t)})}}q$.className="Average";de(q$);class X$ extends mi{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=bo(t,e[s]);return t})}}X$.className="Maximum";de(X$);class Y$ extends mi{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=e0(t,e[s]);return t})}}Y$.className="Minimum";de(Y$);class Q$ extends mi{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new G("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const l of s)if(ot(l,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new G("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return re(()=>j0(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new G("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new G("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new G("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new G(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return re(()=>{let s=!0;if(t.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)t[i]==null?r.push(Ce(Ss(e[i]),"bool")):t[i].rank<e[i].rank?r.push(ks(t[i],-1)):r.push(t[i]);const o=On(r,this.axis);return xC(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Q$.className="Concatenate";de(Q$);function gl(n,e){for(;n<0;)n+=e;return n}function hz(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Ue("batchDot is not implemented for tensors of 4D or higher rank yet");if(_(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),_(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Ue("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return re(()=>{let i;if(s>r){i=s-r;const u=[];for(let h=0;h<i;++h)u.push(1);e=Z(e,e.shape.concat(u))}else if(r>s){i=r-s;const u=[];for(let h=0;h<i;++h)u.push(1);n=Z(n,n.shape.concat(u))}else i=0;let l;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?l=_e(j(n,e),o[0]):l=_e(j(qe(n,[1,0]),e),o[1]);else{const u=o[0]!==n.shape.length-1,h=o[1]===e.shape.length-1;l=st(n,e,u,h)}if(i>0){let u;s>r?u=s+r-3:u=s-1;const h=[];for(let d=u;d<u+i;++d)h.push(d);l=Ou(l,h)}return l.shape.length===1&&(l=ks(l,1)),l})}class Z$ extends mi{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){_(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new Ue("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new G(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new G(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>gl(o,e[i].shape.length)):r=[gl(this.axes,t.shape.length),gl(this.axes,s.shape.length)],this.normalize&&(t=Yh(t,r[0]),s=Yh(s,r[1])),hz(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[gl(this.axes,e.length),gl(this.axes,t.length)],s}computeOutputShape(e){_(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new Ue("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}Z$.className="Dot";de(Z$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class J$ extends Xe{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ve(e);return Gu(()=>xe(Nf(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}J$.className="GaussianNoise";de(J$);class eS extends Xe{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ve(e);return this.rate>0&&this.rate<1?Gu(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return j(s,Nf(s.shape,1,o))},()=>s,t.training||!1):s})}}eS.className="GaussianDropout";de(eS);class tS extends Xe{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ve(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return re(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Gu(()=>{const o=Ve(e),u=-1.6732632423543772*1.0507009873554805;let h=va(bf(s),this.rate);h=Vu(h,"float32");const d=((1-this.rate)*(1+this.rate*u**2))**-.5,f=-d*u*this.rate,m=xe(j(o,h),j(xe(h,-1),u));return xe(j(m,d),f)},()=>Ve(e),t.training||!1)}return e})}}tS.className="AlphaDropout";de(tS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rl(n,e,t,s,r,o=.001){let i;if(n.rank===2)i=rA(n,e,t,s,r,o);else if(n.rank===3)i=iA(n,e,t,s,r,o);else if(n.rank===4)i=lA(n,e,t,s,r,o);else throw new Ue(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function dz(n,e,t,s,r=.001){return re(()=>{const o=t0(n,s),i=o.mean,l=o.variance;return[Rl(n,i,l,t,e,r),i,l]})}function fz(n,e,t,s,r=.001){return re(()=>{const o=t0(n,s),i=o.mean,l=o.variance,u=[];for(const y of js(0,n.rank))s.indexOf(y)!==-1?u.push(1):u.push(n.shape[y]);const h=Z(i,u),d=Z(l,u),f=e==null?null:Z(e,u),m=t==null?null:Z(t,u);return[Rl(n,h,d,m,f,r),i,l]})}function pz(n,e,t,s,r=.001){return ot(s.slice().sort(),js(0,n.rank-1))?dz(n,e,t,s,r):fz(n,e,t,s,r)}class nS extends Xe{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ct(e.betaInitializer||"zeros"),this.gammaInitializer=Ct(e.gammaInitializer||"ones"),this.movingMeanInitializer=Ct(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ct(e.movingVarianceInitializer||"ones"),this.betaConstraint=jt(e.betaConstraint),this.gammaConstraint=jt(e.gammaConstraint),this.betaRegularizer=It(e.betaRegularizer),this.gammaRegularizer=It(e.gammaRegularizer)}build(e){e=at(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new G(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Gt({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return re(()=>{const s=t.training==null?!1:t.training,r=Ve(e),o=r.shape,i=o.length,l=js(0,i),u=this.axis>=0?this.axis:this.axis+i;l.splice(u,1);const h=li(1,i);h[u]=o[u];const d=l.slice();d.sort();const f=!ot(d,js(0,i).slice(0,i-1)),m=()=>{if(f){const C=Z(this.movingMean.read(),h),S=Z(this.movingVariance.read(),h),$=this.center?Z(this.beta.read(),h):null,N=this.scale?Z(this.gamma.read(),h):null;return Rl(r,C,S,$,N,this.epsilon)}else return Rl(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return m();const[g,y,w]=pz(r,this.gamma.read(),this.beta.read(),l,this.epsilon),v=(C,S,$)=>{re(()=>{const N=1-$,R=C.read(),O=j(Me(R,S),N);C.write(Me(R,O))})};return(()=>{v(this.movingMean,y,this.momentum),v(this.movingVariance,w,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Nt(this.betaInitializer),gammaInitializer:Nt(this.gammaInitializer),movingMeanInitializer:Nt(this.movingMeanInitializer),movingVarianceInitializer:Nt(this.movingVarianceInitializer),betaRegularizer:ht(this.betaRegularizer),gammaRegularizer:ht(this.gammaRegularizer),betaConstraint:Ht(this.betaConstraint),gammaConstraint:Ht(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}nS.className="BatchNormalization";de(nS);class sS extends Xe{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ct(e.betaInitializer||"zeros"),this.gammaInitializer=Ct(e.gammaInitializer||"ones"),this.betaRegularizer=It(e.betaRegularizer),this.gammaRegularizer=It(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=at(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==lo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=Ve(e),r=s.shape,o=r.length;return re(()=>{let{mean:l,variance:u}=t0(s,this.axis,!0);const h=li(1,o);for(const w of this.axis)h[w]=r[w];const d=w=>w!=null&&w.shape.length!==o?Z(w,h):w;let f=this.scale?d(this.gamma.read()):null,m=this.center?d(this.beta.read()):null;const g=[],y=[];for(let w=0;w<o;++w)this.axis.indexOf(w)!==-1?(g.push(r[w]),y.push(1)):(g.push(1),y.push(r[w]));return l=Us(l,g),u=Us(u,g),f!=null&&(f=Us(f,y)),m!=null&&(m=Us(m,y)),Rl(s,l,u,m,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Nt(this.betaInitializer),gammaInitializer:Nt(this.gammaInitializer),betaRegularizer:ht(this.betaRegularizer),gammaRegularizer:ht(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}sS.className="LayerNormalization";de(sS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mz(n,e,t){return re(()=>{if(n.rank!==4)throw new G(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new G("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Ks()),t!=="channelsLast"&&t!=="channelsFirst")throw new G(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],n0(n,s)})}class rS extends Xe{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Ks():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new G(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new G(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new G(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Gt({ndim:4})]}computeOutputShape(e){e=at(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return re(()=>mz(Ve(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}rS.className="ZeroPadding2D";de(rS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Of(n,e,t,s,r,o){return re(()=>{_t(r),kI(o),cs(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=Ks()),o==null&&(o="max"),n=i1(n,r);let i;const l=s==="same"?"same":"valid";return o==="max"?i=Jx(n,e,t,l):i=Ux(n,e,t,l),r==="channelsFirst"&&(i=qe(i,[0,3,1,2])),i})}function oS(n,e,t,s,r,o){return re(()=>{_t(r),kI(o),cs(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Ks()),o==null&&(o="max"),n=k$(n,r);let i;const l=s==="same"?"same":"valid";return o==="max"?i=GF(n,e,t,l):i=XD(n,e,t,l),r==="channelsFirst"&&(i=qe(i,[0,4,1,2,3])),i})}class iS extends Xe{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new G(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(en(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new G(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);en(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,cs(this.padding),this.inputSpec=[new Gt({ndim:3})]}computeOutputShape(e){e=at(e);const t=Hs(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return re(()=>{this.invokeCallHook(e,t),e=Wu(Ve(e),2);const s=this.poolingFunction(Ve(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ou(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class aS extends iS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return _t(o),cs(r),Of(e,t,s,r,o,"max")}}aS.className="MaxPooling1D";de(aS);class lS extends iS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return _t(o),cs(r),Of(e,t,s,r,o,"avg")}}lS.className="AveragePooling1D";de(lS);class uS extends Xe{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new G(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];en(this.poolSize,"poolSize"),en(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),cs(this.padding),this.inputSpec=[new Gt({ndim:4})]}computeOutputShape(e){e=at(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Hs(t,this.poolSize[0],this.padding,this.strides[0]),s=Hs(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return re(()=>(this.invokeCallHook(e,t),this.poolingFunction(Ve(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class cS extends uS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return _t(o),cs(r),Of(e,t,s,r,o,"max")}}cS.className="MaxPooling2D";de(cS);class hS extends uS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return _t(o),cs(r),Of(e,t,s,r,o,"avg")}}hS.className="AveragePooling2D";de(hS);class dS extends Xe{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new G(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];en(this.poolSize,"poolSize"),en(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),cs(this.padding),this.inputSpec=[new Gt({ndim:5})]}computeOutputShape(e){e=at(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Hs(t,this.poolSize[0],this.padding,this.strides[0]),s=Hs(s,this.poolSize[1],this.padding,this.strides[1]),r=Hs(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return re(()=>(this.invokeCallHook(e,t),this.poolingFunction(Ve(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class fS extends dS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return _t(o),cs(r),oS(e,t,s,r,o,"max")}}fS.className="MaxPooling3D";de(fS);class pS extends dS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return _t(o),cs(r),oS(e,t,s,r,o,"avg")}}pS.className="AveragePooling3D";de(pS);class mS extends Xe{constructor(e){super(e),this.inputSpec=[new Gt({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Ue}}class gS extends mS{constructor(e){super(e||{})}call(e,t){return re(()=>{const s=Ve(e);return Mt(s,1)})}}gS.className="GlobalAveragePooling1D";de(gS);class xS extends mS{constructor(e){super(e||{})}call(e,t){return re(()=>{const s=Ve(e);return lr(s,1)})}}xS.className="GlobalMaxPooling1D";de(xS);class yS extends Xe{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,_t(this.dataFormat),this.inputSpec=[new Gt({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Ue}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class wS extends yS{call(e,t){return re(()=>{const s=Ve(e);return this.dataFormat==="channelsLast"?Mt(s,[1,2]):Mt(s,[2,3])})}}wS.className="GlobalAveragePooling2D";de(wS);class vS extends yS{call(e,t){return re(()=>{const s=Ve(e);return this.dataFormat==="channelsLast"?lr(s,[1,2]):lr(s,[2,3])})}}vS.className="GlobalMaxPooling2D";de(vS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bS extends Xe{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=hr(r,s);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class kS extends bS{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=at(e),e.length<3)throw new G(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=at(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return re(()=>(e=Ve(e),D$((i,l)=>[Ve(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}kS.className="TimeDistributed";de(kS);function gz(n){pi(_P,"BidirectionalMergeMode",n)}const xz="concat";class CS extends bS{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=hr(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=hr(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?xz:e.mergeMode,gz(this.mergeMode),e.weights)throw new Ue("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):_n(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=R$(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const i=[],l=[];if(s!=null){const h=s.length;if(h%2>0)throw new G("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,i.push(...s);const d=s.map(f=>new Gt({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,h/2),this.backwardLayer.stateSpec=d.slice(h/2),l.push(...d)}if(r!=null)throw new Ue("Support for constants in Bidirectional layers is not implemented yet.");const u=i[0]instanceof ir;for(const h of i)if(h instanceof ir!==u)throw new G("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const h=[e].concat(i),d=this.inputSpec.concat(l),f=this.inputSpec;this.inputSpec=d;const m=super.apply(h,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return re(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const u=s.slice(0,s.length/2),h=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:u})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:h}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=oi(o,1));let l;return this.mergeMode==="concat"?l=j0([r,o]):this.mergeMode==="sum"?l=xe(r,o):this.mergeMode==="ave"?l=j(.5,xe(r,o)):this.mergeMode==="mul"?l=j(r,o):this.mergeMode==null&&(l=[r,o]),this.returnState?this.mergeMode==null?l.concat(i):[l].concat(i):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Qo(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Qo(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=hr(t.layer);if(delete t.layer,t.numConstants!=null)throw new Ue("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}CS.className="Bidirectional";de(CS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class IS extends Xe{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return re(()=>(e=Ve(e),e.dtype!=="float32"&&(e=Vu(e,"float32")),xe(j(e,this.scale),this.offset)))}}IS.className="Rescaling";de(IS);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yz=ae();yz.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var $b;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})($b||($b={}));var Sb;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(Sb||(Sb={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Nb;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Nb||(Nb={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Se(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&_(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wz=WC;class Lf extends Ug{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new ok(this,so())}nextDataId(){return Lf.nextDataId++}write(e,t,s){this.firstUse&&(this.firstUse=!1,ae().get("IS_NODE")&&os(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Ol(s[0])){const o=s.map(i=>ao(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return Fr(r,o)}return this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>co(r));return He(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return He(e.shape,e.dtype,t)}makeOutput(e,t,s){return so().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Fn();return e(),{kernelMs:Fn()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Se([e],"where");const t=this.readSync(e.dataId);return wz(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Lf.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $S(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const vz=n=>{const{x:e}=n.inputs,t=n.backend;Se(e,"abs");let s=new Float32Array(ue(e.shape));const r=t.data.get(e.dataId).values;return s=$S(r),t.makeOutput(s,e.shape,e.dtype)},bz={kernelName:hd,backendName:"cpu",kernelFunc:vz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vt(n){return(e,t,s,r,o)=>{const i=Be(e,t),l=i.length,u=Ae(i),h=ue(i),d=ln(o,h),f=e.length,m=t.length,g=Ae(e),y=Ae(t),w=oa(e,i),v=oa(t,i);if(w.length+v.length===0)for(let b=0;b<d.length;++b)d[b]=n(s[b%s.length],r[b%r.length]);else for(let b=0;b<d.length;++b){const C=ga(b,l,u),S=C.slice(-f);w.forEach(O=>S[O]=0);const $=ar(S,f,g),N=C.slice(-m);v.forEach(O=>N[O]=0);const R=ar(N,m,y);d[b]=n(s[$],r[R])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,l=t.makeTensorInfo(s.shape,"complex64"),u=t.data.get(l.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",i)},l}const kz={kernelName:ex,backendName:"cpu",kernelFunc:jn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nd(n,e,t="float32"){if(t==="complex64"){const r=nd(n,e,"float32"),o=nd(n,e,"float32");return jn({inputs:{real:r,imag:o},backend:n})}const s=gn(ue(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gr(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Cz={kernelName:su,backendName:"cpu",kernelFunc:gr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ui(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const Iz={kernelName:kx,backendName:"cpu",kernelFunc:ui};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SS(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=hi([0],t),[o,i]=Vt((l,u)=>l!==u?1:0)(e,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function go(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return gr({inputs:{x:r},backend:t});const d=nd(t,r.shape,r.dtype),f=go({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),m=jn({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),m}if(r.dtype==="complex64"){const d=ui({inputs:{input:r},backend:t}),f=go({inputs:{x:d},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(d),f}if(!lk(r.dtype,o)){const d=gr({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:o}}const i=t.data.get(r.dataId).values,[l,u,h]=SS(i,r.shape,r.dtype,o);return t.makeTensorInfo(l,u,h)}const $z={kernelName:Gl,backendName:"cpu",kernelFunc:go};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nn(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a:i,b:l}=r,u=o;Se([i,l],n);const h=u.data.get(i.dataId).values,d=u.data.get(l.dataId).values,f=i.dtype==="string"?ai(h):h,m=i.dtype==="string"?ai(d):d,g=s||i.dtype,[y,w]=e(i.shape,l.shape,f,m,g);return u.makeTensorInfo(w,g,y)}:({inputs:r,backend:o})=>{const{a:i,b:l}=r,u=o;if(i.dtype==="complex64"||l.dtype==="complex64"){const h=go({inputs:{x:i},backend:u,attrs:{dtype:"complex64"}}),d=u.data.get(h.dataId),f=d.complexTensorInfos.real,m=d.complexTensorInfos.imag,g=u.data.get(f.dataId).values,y=u.data.get(m.dataId).values,w=go({inputs:{x:l},backend:u,attrs:{dtype:"complex64"}}),v=u.data.get(w.dataId),b=v.complexTensorInfos.real,C=v.complexTensorInfos.imag,S=u.data.get(b.dataId).values,$=u.data.get(C.dataId).values,[N,R,O]=t(i.shape,l.shape,g,y,S,$),F=u.makeTensorInfo(O,"float32",N),A=u.makeTensorInfo(O,"float32",R),D=jn({inputs:{real:F,imag:A},backend:u});return u.disposeIntermediateTensorInfo(h),u.disposeIntermediateTensorInfo(w),u.disposeIntermediateTensorInfo(F),u.disposeIntermediateTensorInfo(A),D}else{const h=u.data.get(i.dataId).values,d=u.data.get(l.dataId).values,f=s||i.dtype,[m,g]=e(i.shape,l.shape,h,d,f);return u.makeTensorInfo(g,f,m)}}}function d1(n){return(e,t,s,r,o,i)=>{const l=Be(e,t),u=ue(l),h=l.length,d=Ae(l),f=ln("float32",u),m=ln("float32",u),g=oa(e,l),y=oa(t,l),w=Fr(s,r),v=Fr(o,i),b=e.length,C=Ae(e),S=t.length,$=Ae(t);if(g.length+y.length===0)for(let N=0;N<f.length;N++){const R=N%w.length,O=N%v.length,F=n(w[R*2],w[R*2+1],v[O*2],v[O*2+1]);f[N]=F.real,m[N]=F.imag}else for(let N=0;N<f.length;N++){const R=ga(N,h,d),O=R.slice(-b);g.forEach(z=>O[z]=0);const F=ar(O,b,C),A=R.slice(-S);y.forEach(z=>A[z]=0);const D=ar(A,S,$),T=n(w[F*2],w[F*2+1],v[D*2],v[D*2+1]);f[N]=T.real,m[N]=T.imag}return[f,m,l]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NS=Vt((n,e)=>n+e),Sz=d1((n,e,t,s)=>({real:n+t,imag:e+s})),ca=nn(xa,NS,Sz),Nz={kernelName:xa,backendName:"cpu",kernelFunc:ca};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f1(n,e,t,s,r){const o=ue(s),i=gn(r,t);for(let l=0;l<n.length;l++){const u=n[l];if(u<0)throw new Error("Input x must be non-negative!");u>=r||(o>0?i[u]+=e[l]:i[u]+=1)}return i}function TS(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],i=He([r,t],e.dtype);for(let l=0;l<r;l++)for(let u=0;u<o;u++){const h=n.get(l,u);if(h<0)throw new Error("Input x must be non-negative!");h>=t||(s?i.set(1,l,h):e.size>0?i.set(i.get(l,h)+e.get(l,u),l,h):i.set(i.get(l,h)+1,l,h))}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Io(n){return(e,t,s)=>{const r=ln(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lt(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;if(Se(i,n),i.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");const l=o,u=l.data.get(i.dataId).values,h=ue(i.shape),d=t||i.dtype,f=Jt(d,h);for(let m=0;m<h;++m)f[m]=e(u[m],r);return l.makeTensorInfo(i.shape,d,f)}}function Ia(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;if(Se(i,n),i.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");const l=o,u=l.data.get(i.dataId).values,h=t||i.dtype,d=e(u,h,r);return l.makeTensorInfo(i.shape,h,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ES=Io(n=>Math.ceil(n)),Tz=Ia(Hl,ES),Ez={kernelName:Hl,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RS(n,e,t,s){const r=Jt(t,ue(e));if(s&&t!=="string"){let o=0;n.forEach(i=>{const l=ue(i.shape);r.set(i.vals,o),o+=l})}else{let o=0;n.forEach(i=>{const l=t==="string"?ai(i.vals):i.vals;let u=0;for(let h=0;h<i.shape[0];++h){const d=h*e[1]+o;for(let f=0;f<i.shape[1];++f)r[d+f]=l[u++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DS=Vt((n,e)=>n===e?1:0),AS=nn(Sd,DS,null,"bool"),Rz={kernelName:Sd,backendName:"cpu",kernelFunc:AS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FS=Io(n=>Math.exp(n)),_S=Ia(Zl,FS,"float32"),Dz={kernelName:Zl,backendName:"cpu",kernelFunc:_S};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OS=Io(n=>Math.expm1(n)),Az=Ia(Jl,OS),Fz={kernelName:Jl,backendName:"cpu",kernelFunc:Az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LS=Io(n=>Math.floor(n)),_z=Ia(eu,LS),Oz={kernelName:eu,backendName:"cpu",kernelFunc:_z};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PS(n,e,t,s,r,o,i,l,u){const h=He([s,o],t);for(let d=0;d<s;d++){const f=[];let m=0;for(let g=0;g<r;g++){const y=n[d*r+g];m+=y*i[g],f.push(y)}if(m<0||m>=u/o)throw new Error(`Invalid indices: ${f} does not index into ${l}`);for(let g=0;g<o;g++)h.values[d*o+g]=e.get(...e.indexToLoc(m*o+g))}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MS(n,e,t){const s=He(t,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),l=i[0],u=i[2],h=e.locToIndex([l,u]);i[2]=e.values[h];const d=n.locToIndex(i);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zS=Vt((n,e)=>n>e?1:0),Lz=nn(Rd,zS,null,"bool"),Pz={kernelName:Rd,backendName:"cpu",kernelFunc:Lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS=Vt((n,e)=>n>=e?1:0),Mz=nn(nu,BS,null,"bool"),zz={kernelName:nu,backendName:"cpu",kernelFunc:Mz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VS=Vt((n,e)=>n<e?1:0),Bz=nn(Ad,VS,null,"bool"),Vz={kernelName:Ad,backendName:"cpu",kernelFunc:Bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WS=Vt((n,e)=>n<=e?1:0),Wz=nn(Fd,WS,null,"bool"),Uz={kernelName:Fd,backendName:"cpu",kernelFunc:Wz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(n,e,t){const s=(e-n)/(t-1),r=gn(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GS=Io(n=>Math.log(n)),Gz=Ia(au,GS),Hz={kernelName:au,backendName:"cpu",kernelFunc:Gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HS(n,e,t,s){const r=ln(s,ue(t));for(let o=0;o<r.length;++o){const i=o*e;let l=n[i];for(let u=0;u<e;++u){const h=n[i+u];(Number.isNaN(h)||h>l)&&(l=h)}r[o]=l}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jS=Vt((n,e)=>Math.max(n,e)),jz=nn(uu,jS),Kz={kernelName:uu,backendName:"cpu",kernelFunc:jz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS=Vt((n,e)=>Math.min(n,e)),qz=nn(cu,KS),Xz={kernelName:cu,backendName:"cpu",kernelFunc:qz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p1=Vt((n,e)=>n*e),Yz=d1((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),Pf=nn(du,p1,Yz),Qz={kernelName:du,backendName:"cpu",kernelFunc:Pf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qS(n,e,t){const s=yo(-1,t);return p1([],e,s,n,t)}function Zz(n){const{inputs:e,backend:t}=n,{x:s}=e;Se(s,"neg");const r=t.data.get(s.dataId).values,[o,i]=qS(r,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,o)}const Jz={kernelName:Gd,backendName:"cpu",kernelFunc:Zz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XS=Vt((n,e)=>n!==e?1:0),e4=nn(Hd,XS,null,"bool"),t4={kernelName:Hd,backendName:"cpu",kernelFunc:e4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m1(n,e,t,s,r){const o=e.length,i=ue(e),l=Ae(e),u=Ae(r),h=ln(t,ue(r));for(let d=0;d<i;++d){const f=ga(d,o,l),m=new Array(f.length);for(let y=0;y<m.length;y++)m[y]=f[s[y]];const g=ar(m,o,u);h[g]=n[d]}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ln(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;Se(r,"transpose");const i=r.shape.length,l=new Array(i);for(let f=0;f<l.length;f++)l[f]=r.shape[o[f]];const u=s.data.get(r.dataId).values,h=m1(u,r.shape,r.dtype,o,l);return{dataId:s.write(h,l,r.dtype),shape:l,dtype:r.dtype}}const n4={kernelName:Zi,backendName:"cpu",kernelFunc:Ln};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YS(n,e,t,s){const[r,o]=tn(n,s),i=Kn(e,"int32"),l=gn(ue(r),i),u=ue(o);for(let h=0;h<l.length;++h){const d=h*u;let f=1;for(let m=0;m<u;++m)f*=t[d+m];l[h]=f}return{outVals:l,outShape:r,outDtype:i}}function s4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Se(r,"prod");const l=r.shape.length,u=je(o,r.shape),h=Tt(u,l);let d=u,f=r;const m=[];h!=null&&(f=Ln({inputs:{x:r},backend:t,attrs:{perm:h}}),m.push(f),d=Ft(d.length,l));const g=t.data.get(f.dataId).values,{outVals:y,outShape:w,outDtype:v}=YS(f.shape,f.dtype,g,d);let b=w;return i&&(b=Bt(w,u)),m.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(b,v,y)}const r4={kernelName:Qd,backendName:"cpu",kernelFunc:s4};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=ga(r,e.length,Ae(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function i4(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function a4(n,e,t,s){const r=[];let o=0;const i=e.length-1+t.length,l=new Array(i).fill(null).map(()=>[0]);i4(t,s);let u=1;for(let h=0;h<e.length-1;++h){u*=e[h];const d=e[h+1];for(let f=1;f<u+1;++f)l[h].push(f*d)}for(let h=0;h<n.length;++h){let d=n[h],f=n[h]+1;for(let m=0;m<t.length;++m){const g=t[m],y=m+e.length-1;if(y>=0){const w=l[y],v=w[w.length-1]-g[d];for(let b=d;b<f;++b)l[y].push(g[b+1]+v)}d=g[d],f=g[f]}f!==d&&(r.push([d,f]),o+=f-d)}return{outSplits:l,valueSlices:r,numValues:o}}function l4(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=Jt("int32",s);e.push(r),n[t].forEach((o,i)=>r[i]=o)}return e}function Tb(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function u4(n,e,t,s,r,o){const i=Tb(e,2)[1],l=Tb(o,2)[1];let u=0;for(const h of t)for(let d=h[0];d<h[1];++d){for(let f=0;f<s;++f)r[u*l+f]=n[d*i+f];++u}}function c4(n,e,t,s,r){const o=e.slice();o[0]=r;const i=Jt(t,ue(o)),l=n.length,u=l===0?0:l/e[0];return u4(n,e,s,u,i,o),[i,o]}function QS(n,e,t,s,r,o,i,l){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const u=e[0][0]-1;if(o4(o,i,u),s.length===0)throw new Error("params.rank must be nonzero");const h=s[0],{outSplits:d,valueSlices:f,numValues:m}=a4(o,i,n,h),g=l4(d),y=c4(t,s,r,f,m);return[g,y[0],y[1]]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vs=Vs;class sd{constructor(e,t,s,r,o,i,l,u,h,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=l,this.rowPartitionValues=u,this.rowPartitionValuesShapes=h,this.rowPartitionTypes=KC(d),this.raggedRank=qC(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===vs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===vs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case vs.VALUE_ROWIDS:return sd.getMaxWidthValueRowID(t);case vs.ROW_SPLITS:return sd.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${vs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<t;++i){const l=e[i];l!==r&&(r=l,o=Math.max(i-s,o),s=i)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Rb(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;XC(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=jC(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(let l=1;l<=this.raggedRank;++l)i[l]<0&&(i[l]=this.getMaxWidth(l));return i}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let i=0;for(let l=0;l<r;++l,i+=t)o.push(i);for(let l=r;l<e;++l)o.push(-1);return _(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,i=[];for(let l=0;l<o-1;++l){const u=e[l+1]-e[l];let h=Math.min(r,u),d=t[l];d===-1&&(h=0);for(let f=0;f<h;++f)i.push(d),d+=s;for(let f=0;f<u-h;++f)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,i=[];if(o===0)return[];let l=0,u=e[0];if(u>=t.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${t.length}`);let h=t[u];i.push(h);for(let d=1;d<o;++d){const f=e[d];if(f===u)h>=0&&(++l,l<r?h+=s:h=-1);else{if(l=0,u=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);h=t[f]}i.push(h)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case vs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case vs.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${vs[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case vs.FIRST_DIM_SIZE:return e[0];case vs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case vs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${vs[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let u=r.length-2;u>=0;--u)r[u]=r[u+1]*s[u+1];const o=Rb(s,!1),i=Jt(this.valuesDType,ue(o));if(r[0]*s[0]>0){let u=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let h=1;h<=this.raggedRank;++h)u=this.calculateOutputIndex(h-1,u,r[h],s[h]);this.setOutput(this.raggedRank,u,i,o)}return[o,i]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,i=s;let l=r.slice();l=l.slice(e+1);const u=ue(l),h=t.length;let d=this.defaultValue;if(d.length!==u&&d.length!==1){const y=this.defaultValueShape;re(()=>{const w=Z(d,y);d=Il(w,l).dataSync()})}let f=0,m=0,g=0;for(let y=0;y<=h;++y){let w=y<h?t[y]:-1;if(w===g){++g;continue}if(m<g){const v=o.subarray(f*u),b=i.subarray(m*u),C=(g-m)*u;Eb(b,v,C)}if(y>=h){const v=s.length;w=Math.floor(v/u)}if(w>g)if(this.defaultValue.length===1)i.subarray(g*u,w*u).fill(this.defaultValue[0]),g=w;else for(;w>g;){const v=i.slice(g*u);Eb(v,d,u),++g}w<0?(f=y+1,m=g):(f=y,m=g,g=m+1)}}}function Eb(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function Rb(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function ZS(n,e,t,s,r,o,i,l,u,h){return new sd(n,e,t,s,r,o,i,l,u,h).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JS(n,e,t,s){const r=n===e,o=n<e&&t<0,i=e<n&&t>1;if(r||o||i)return gn(0,s);const l=Math.abs(Math.ceil((e-n)/t)),u=gn(l,s);e<n&&t===1&&(t=-1),u[0]=n;for(let h=1;h<u.length;h++)u[h]=u[h-1]+t;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e2=Io(n=>1/Math.sqrt(n)),h4=Ia(yu,e2),d4={kernelName:yu,backendName:"cpu",kernelFunc:h4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(n,e,t,s,r,o,i,l,u,h){const d=[s/r,r],f=n.values,m=e.values;if(s===0)return He(t,e.dtype);const g=He(d,e.dtype);typeof u=="string"||typeof u=="number"?g.values.fill(u):typeof u=="boolean"&&g.values.fill(+u);for(let y=0;y<o;y++){const w=[];let v=0;for(let b=0;b<i;b++){const C=f[y*i+b];w.push(C),v+=C*l[b]}if(v<0||v>=s/r)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let b=0;b<r;b++)h?g.values[v*r+b]+=m[y*r+b]:g.values[v*r+b]=e.rank===0?m[0]:m[y*r+b]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f4=Io(n=>1/(1+Math.exp(-n))),t2=lt(Cu,n=>1/(1+Math.exp(-n))),p4={kernelName:Cu,backendName:"cpu",kernelFunc:t2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2(n,e,t,s,r){const o=zx(s,e,t),i=ue(t),l=Ae(s);if(o){const f=Bx(e,l);return r==="string"?n.slice(f,f+i):n.subarray(f,f+i)}const u=r==="string"?ai(n):n,h=He(s,r,u),d=He(t,r);for(let f=0;f<d.size;++f){const m=d.indexToLoc(f),g=m.map((y,w)=>y+e[w]);d.set(h.get(...g),...m)}return r==="string"?mI(d.values):d.values}function ci(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s;Se(r,"slice");const[l,u]=mf(r,o,i);Px(r,l,u);const h=t.data.get(r.dataId).values,d=n2(h,l,u,r.shape,r.dtype);return t.makeTensorInfo(u,r.dtype,d)}const m4={kernelName:sf,backendName:"cpu",kernelFunc:ci};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s2(n,e,t,s,r,o,i){const l=e[0],u=o[0],h=new Array(u),d=new Array(l),f=e[1];if(u===0){if(l!==0)throw new Error(nI(l));const v=Jt(t,0),b=Jt(r,0);return[v,[0,f],b,h,d]}let m=!0,g=0;const y=new Array(u).fill(0);for(let v=0;v<l;++v){const b=n[v*f];if(b<0)throw new Error(sI(v,b));if(b>=u)throw new Error(rI(v,b,u));++y[b],m=m&&b>=g,g=b}let w=!0;for(let v=0;v<u;++v){const b=y[v]===0;h[v]=b,w=w&&!b,y[v]=Math.max(y[v],1),v>0&&(y[v]+=y[v-1])}if(w&&m){const v=n,b=s;for(let C=0;C<l;++C)d[C]=C;return[v,[l,f],b,h,d]}else{const v=y[u-1],b=Jt(t,v*f),C=Jt(r,v),S=new Array(u).fill(0);for(let $=0;$<l;++$){const N=n[$*f],R=S[N],O=(N===0?0:y[N-1])+R;S[N]++;for(let F=0;F<f;++F)b[O*f+F]=n[$*f+F];C[O]=s[$],d[$]=O}for(let $=0;$<u;++$)if(S[$]===0){const R=$===0?0:y[$-1];b[R*f+0]=$;for(let O=1;O<f;++O)b[R*f+O]=0;C[R]=i}return[b,[v,f],C,h,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2(n,e,t,s,r){const o=ue(s),i=e[0],l=r.length,u=[];let h=1,d=-1;for(let v=0;v<l;++v){const b=r[v];if(b===-1){if(d!==-1)throw new Error(oI(d,v));d=v,u.push(1)}else{if(b<0)throw new Error(iI(v,b));h*=b,u.push(b)}}if(d!==-1){if(h<=0)throw new Error(aI());const v=Math.trunc(o/h);if(h*v!==o)throw new Error(lI(s,u));u[d]=v}if(ue(u)!==o)throw new Error(uI(s,u));const m=s.length,g=[];if(m>0){g[m-1]=1;for(let v=m-2;v>=0;--v)g[v]=g[v+1]*s[v+1]}const y=[];if(l>0){y[l-1]=1;for(let v=l-2;v>=0;--v)y[v]=y[v+1]*u[v+1]}const w=Jt(t,i*l);for(let v=0;v<i;++v){let b=0;for(let C=0;C<m;++C)b+=n[v*m+C]*g[C];for(let C=0;C<l;++C)w[v*l+C]=Math.trunc(b/y[C]),b%=y[C]}return[w,[i,l],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g1(n,e,t,s,r,o=!1,i=0){const l=s.length,u=[e[0],n.length/e[0]],h=u[1],f=l>0?r[l-1]+1:0;if(f<0)throw new Error($g());const m=e.slice();m[0]=f;const g=m.reduce((S,$)=>S*$,1),y=Jt(t,g);if(l===0)return f>0&&y.fill(i),[y,m];if(f<=0)throw new Error($g());let w=0,v=1,b=0,C=r[w];for(;;){let S=0;if(v<l){if(S=r[v],C===S){++v;continue}if(C>=S)throw new Error(cI())}if(C<0||C>=f)throw new Error(hI(C,f));C>b&&y.fill(i,b*h,C*h);for(let $=w;$<v;++$){const N=s[$];if(N<0||N>=u[0])throw new Error(dI($,s[$],u[0]));for(let R=0;R<h;R++)y[C*h+R]+=n[N*h+R]}if(o)for(let $=0;$<h;$++)y[C*h+$]/=v-w;if(w=v,++v,b=C+1,C=S,v>l)break}return b<f&&y.fill(i,b*h,f*h),[y,m]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g4=Io(n=>Math.sqrt(n)),x4=lt($u,n=>Math.sqrt(n)),y4={kernelName:$u,backendName:"cpu",kernelFunc:x4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o2=Vt((n,e)=>{const t=n-e;return t*t}),w4=nn(Su,o2),v4={kernelName:Su,backendName:"cpu",kernelFunc:w4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i2(n,e,t,s){const r=He(n,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),l=new Array(i.length);for(let u=0;u<l.length;u++)l[u]=i[u]*t[u]+s[u];r.set(e.get(...l),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b4{constructor(e,t,s,r,o,i){this.separator=ao(e),this.nGramWidths=t,this.leftPad=ao(s),this.rightPad=ao(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,i){for(let l=0;l<o;++l){const u=this.getPadWidth(i),h=Math.max(0,u-l),d=Math.max(0,u-(o-(l+1))),f=i-(h+d),m=t+(h>0?0:l-u);let g=0;g+=h*this.leftPad.length;for(let C=0;C<f;++C)g+=e[m+C].length;g+=d*this.rightPad.length;const y=h+d+f-1;g+=y*this.separator.length,s[r+l]=new Uint8Array(g);const w=s[r+l];let v=0;const b=C=>C.forEach(S=>w[v++]=S);for(let C=0;C<h;++C)b(this.leftPad),b(this.separator);for(let C=0;C<f-1;++C)b(e[m+C]),b(this.separator);if(f>0){b(e[m+f-1]);for(let C=0;C<d;++C)b(this.separator),b(this.rightPad)}else{for(let C=0;C<d-1;++C)b(this.rightPad),b(this.separator);b(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let u=t[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let h=1;h<r;++h){let d=t[h]>=u;if(d=d&&t[h]<=s,!d)throw new Error(`Invalid split value ${t[h]}, must be in [${u}, ${s}]`);u=t[h]}if(u!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${u}`)}const o=r-1,i=Jt("int32",r);if(s===0||r===0){const u=new Array(s);for(let h=0;h<=o;++h)i[h]=0;return[u,i]}i[0]=0;for(let u=1;u<=o;++u){const h=t[u]-t[u-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(h,f)}),this.preserveShort&&h>0&&d===0&&(d=1),i[u]=i[u-1]+d}const l=new Array(i[o]);for(let u=0;u<o;++u){const h=t[u];let d=i[u];if(this.nGramWidths.forEach(f=>{const m=t[u+1]-t[u],g=this.getNumNGrams(m,f);this.createNGrams(e,h,l,d,g,f),d+=g}),this.preserveShort&&d===i[u]){const f=t[u+1]-t[u];if(f===0)continue;const m=f+2*this.padWidth;this.createNGrams(e,h,l,d,1,m)}}return[l,i]}}function a2(n,e,t,s,r,o,i,l){return new b4(t,s,r,o,i,l).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const l=n.subarray(0,i);(!t||l.length!==0)&&s.push(l),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!t||i.length!==0)&&s.push(i),r=o+1}}function l2(n,e,t){const s=n.length,r=[];let o=0,i=0;const l=new Array(s);for(let m=0;m<s;++m){const g=r.length;k4(n[m],e,t,r);const y=r.length-g;l[m]=y,o+=y,i=Math.max(i,y)}const u=Jt("int32",o*2),h=new Array(o),d=[s,i];let f=0;for(let m=0;m<s;++m)for(let g=0;g<l[m];++g)u[f*2]=m,u[f*2+1]=g,h[f]=r[f],++f;return[u,h,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u2(n,e){const t=Jt("int32",n.length);for(let s=0;s<n.length;++s)t[s]=tR(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c2=Vt((n,e)=>n-e),C4=d1((n,e,t,s)=>({real:n-t,imag:e-s})),x1=nn(Nu,c2,C4),I4={kernelName:Nu,backendName:"cpu",kernelFunc:x1};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h2(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=He(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let u=0;u<i.length;u++)i[u]=o[u]%n.shape[u];const l=n.locToIndex(i);s.values[r]=n.values[l]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bl=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function d2(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const l=s-t+1,u=e-t+1,h=Math.log(l),d=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*d*(l-d)/l)*Math.sign(u-l/2),m=Math.max(t,Math.floor(e-u*d/l+f)),g=Math.min(s,Math.floor(e+(l-u)*d/l+f));d2(n,e,m,g)}const r=n[e];let o=t,i=s;for(Ki(n,t,e),bl(n[s],r)>0&&Ki(n,t,s);o<i;){for(Ki(n,o,i),o++,i--;bl(n[o],r)<0;)o=o+1;for(;bl(n[i],r)>0;)i=i-1}bl(n[t],r)===0?Ki(n,t,i):(i=i+1,Ki(n,i,s)),i<=e&&(t=i+1),e<=i&&(s=i-1)}}function f2(n,e,t,s,r){const o=e[e.length-1],[i,l]=[n.length/o,o],u=ln(t,i*s),h=ln("int32",i*s);for(let f=0;f<i;f++){const m=f*l,g=n.subarray(m,m+l);let y=new Array(g.length);g.forEach((C,S)=>y[S]={value:C,index:S}),s<y.length&&(d2(y,s),y=y.slice(0,s)),r&&y.sort(bl);const w=f*s,v=u.subarray(w,w+s),b=h.subarray(w,w+s);for(let C=0;C<s;C++)v[C]=y[C].value,b[C]=y[C].index}const d=e.slice();return d[d.length-1]=s,[He(d,t,u),He(d,"int32",h)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2(n,e,t,s){const r=je(e,t)[0],o=[1,t[0],1];for(let y=0;y<r;y++)o[0]*=t[y];o[1]=t[r];for(let y=r+1;y<t.length;y++)o[2]*=t[y];const i={},l=new Int32Array(t[r]),u=new mn(o,s,n),h=[],d=o[0]===1&&o[2]===1;for(let y=0;y<t[r];y++){let w;if(d)w=n[y].toString();else{const v=[];for(let b=0;b<o[0];b++)for(let C=0;C<o[2];C++)v.push(u.get(b,y,C));w=v.join(",")}if(i[w]!==void 0)l[y]=i[w];else{const v=Object.keys(i).length;i[w]=v,l[y]=v,h.push(y)}}const f=o.slice();f[1]=Object.keys(i).length;const m=new mn(f,s);h.forEach((y,w)=>{for(let v=0;v<o[0];v++)for(let b=0;b<o[2];b++)m.set(u.get(v,y,b),v,w,b)});const g=t.slice();return g[r]=f[1],{outputValues:m.values,outputShape:g,indices:l}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $4=Object.freeze(Object.defineProperty({__proto__:null,addImpl:NS,bincountImpl:f1,bincountReduceImpl:TS,castImpl:SS,ceilImpl:ES,concatImpl:RS,equalImpl:DS,expImpl:FS,expm1Impl:OS,floorImpl:LS,gatherNdImpl:PS,gatherV2Impl:MS,greaterEqualImpl:BS,greaterImpl:zS,lessEqualImpl:WS,lessImpl:VS,linSpaceImpl:US,logImpl:GS,maxImpl:HS,maximumImpl:jS,minimumImpl:KS,multiplyImpl:p1,negImpl:qS,notEqualImpl:XS,prodImpl:YS,raggedGatherImpl:QS,raggedTensorToTensorImpl:ZS,rangeImpl:JS,rsqrtImpl:e2,scatterImpl:Yi,sigmoidImpl:f4,simpleAbsImpl:$S,sliceImpl:n2,sparseFillEmptyRowsImpl:s2,sparseReshapeImpl:r2,sparseSegmentReductionImpl:g1,sqrtImpl:g4,squaredDifferenceImpl:o2,stridedSliceImpl:i2,stringNGramsImpl:a2,stringSplitImpl:l2,stringToHashBucketFastImpl:u2,subImpl:c2,tileImpl:h2,topKImpl:f2,transposeImpl:m1,uniqueImpl:p2},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */iC("cpu",()=>new Lf,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m2=lt(Yl,n=>n>=0?n:Math.exp(n)-1),S4={kernelName:Yl,backendName:"cpu",kernelFunc:m2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g2(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;Se([r],"leakyRelu");const i=ue(r.shape),l=t.data.get(r.dataId).values,u=ln("float32",i);for(let h=0;h<l.length;h++)u[h]=l[h]<0?o*l[h]:l[h];return t.makeTensorInfo(r.shape,"float32",u)}const N4={kernelName:Dd,backendName:"cpu",kernelFunc:g2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4=Vt((n,e)=>n<0?e*n:n);function x2(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Se([s,r],"prelu");const o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,[l,u]=T4(s.shape,r.shape,o,i,"float32");return t.makeTensorInfo(u,"float32",l)}const E4={kernelName:Yd,backendName:"cpu",kernelFunc:x2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y2=lt(mu,n=>Math.max(0,n)),R4={kernelName:mu,backendName:"cpu",kernelFunc:y2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w2=lt(gu,n=>Math.min(Math.max(0,n),6)),D4={kernelName:gu,backendName:"cpu",kernelFunc:w2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rd(n,e,t,s,r){if(t==="linear")return gr({inputs:{x:e},backend:n});if(t==="relu")return y2({inputs:{x:e},backend:n});if(t==="elu")return m2({inputs:{x:e},backend:n});if(t==="relu6")return w2({inputs:{x:e},backend:n});if(t==="prelu")return x2({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return g2({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return t2({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=ue(r.shape),l=ak(o,i),u=ue(l);_(i===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const h=t.data.get(r.dataId);if(h.complexTensorInfos!=null){const d=h.complexTensorInfos.real,f=h.complexTensorInfos.imag;d.shape=l,f.shape=l}return{dataId:r.dataId,shape:l,dtype:r.dtype}}const A4={kernelName:Zd,backendName:"cpu",kernelFunc:mt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v2(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:l}=s;Se([r,o],"matMul");const u=r.shape.length,h=o.shape.length,d=i?r.shape[u-2]:r.shape[u-1],f=l?o.shape[h-1]:o.shape[h-2],m=i?r.shape[u-1]:r.shape[u-2],g=l?o.shape[h-2]:o.shape[h-1],y=r.shape.slice(0,-2),w=o.shape.slice(0,-2),v=ue(y),b=ue(w),S=Be(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([m,g]);_(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${l} must match.`);const $=i?[v,d,m]:[v,m,d],N=l?[b,g,f]:[b,f,g],R=mt({inputs:{x:r},backend:t,attrs:{shape:$}}),O=mt({inputs:{x:o},backend:t,attrs:{shape:N}}),F=i?R.shape[1]:R.shape[2],A=i?R.shape[2]:R.shape[1],D=l?O.shape[1]:O.shape[2],T=Math.max(v,b),z=t.data.get(R.dataId).values,U=t.data.get(O.dataId).values,Q=Ae(R.shape),q=Ae(O.shape),[J,ne,B]=i?[Q[0],1,Q[1]]:[Q[0],Q[1],1],[X,Y,L]=l?[1,q[1],q[0]]:[q[1],1,q[0]],W=A*D,ie=He([T,A,D],R.dtype),ce=ie.values,he=t.blockSize;for(let fe=0;fe<T;fe++)for(let we=0;we<A;we+=he)for(let ve=0;ve<D;ve+=he)for(let be=0;be<F;be+=he){const Fe=Math.min(we+he,A),We=Math.min(ve+he,D),Ze=Math.min(be+he,F);for(let et=we;et<Fe;et++)for(let it=ve;it<We;it++){let ct=0;for(let tt=be;tt<Ze;tt++){const dt=Math.min(fe,v-1)*J,vt=Math.min(fe,b-1)*L,Zn=z[dt+et*ne+tt*B],$t=U[tt*X+it*Y+vt];ct+=Zn*$t}ce[fe*W+(et*D+it)]+=ct}}return t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(O),t.makeTensorInfo(S,ie.dtype,ie.values)}const F4={kernelName:gd,backendName:"cpu",kernelFunc:v2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _4(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:l}=e,{transposeA:u,transposeB:h,activation:d,leakyreluAlpha:f}=s;let m,g,y;const w=[];m=v2({inputs:{a:r,b:o},attrs:{transposeA:u,transposeB:h},backend:t}),i&&(g=ca({inputs:{a:m,b:i},backend:t}),w.push(m),m=g),d&&(y=rd(t,m,d,l,f),w.push(m),m=y);for(const b of w)t.disposeIntermediateTensorInfo(b);return m}const O4={kernelName:Lh,backendName:"cpu",kernelFunc:_4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L4=lt(Pl,n=>Math.acos(n)),P4={kernelName:Pl,backendName:"cpu",kernelFunc:L4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M4=lt(Ml,n=>Math.acosh(n)),z4={kernelName:Ml,backendName:"cpu",kernelFunc:M4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B4(n){const{inputs:e,backend:t}=n,s=e;Se(e,"addN");const r=s.map(l=>t.data.get(l.dataId).values),o=He(s[0].shape,s[0].dtype),i=o.values;for(let l=0;l<s.length;l++){const u=r[l];for(let h=0;h<i.length;h++)i[h]+=u[h]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const V4={kernelName:qg,backendName:"cpu",kernelFunc:B4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Se(r,"all");const l=je(o,r.shape);let u=l;const h=Tt(u,r.shape.length);let d=r;h!=null&&(d=Ln({inputs:{x:r},backend:t,attrs:{perm:h}}),u=Ft(u.length,r.shape.length)),cn("all",u,d.shape.length);const[f,m]=tn(d.shape,u),g=ue(m),y=gn(ue(f),d.dtype),w=t.data.get(d.dataId).values;for(let b=0;b<y.length;++b){const C=b*g;let S=w[C];for(let $=0;$<g;++$){const N=w[C+$];S=S&&N}y[b]=S}h!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,y);if(i){const b=Bt(f,l),C=mt({inputs:{x:v},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(v),C}return v}const U4={kernelName:Xg,backendName:"cpu",kernelFunc:W4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Se(r,"any");const l=je(o,r.shape);let u=l;const h=Tt(u,r.shape.length);let d=r;h!=null&&(d=Ln({inputs:{x:r},backend:t,attrs:{perm:h}}),u=Ft(u.length,r.shape.length)),cn("any",u,d.shape.length);const[f,m]=tn(d.shape,u),g=ue(m),y=gn(ue(f),d.dtype),w=t.data.get(d.dataId).values;for(let b=0;b<y.length;++b){const C=b*g;let S=w[C];for(let $=0;$<g;++$){const N=w[C+$];S=S||N}y[b]=S}h!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,y);if(i){const b=Bt(f,l),C=mt({inputs:{x:v},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(v),C}return v}const H4={kernelName:Yg,backendName:"cpu",kernelFunc:G4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;Se(r,"argMax");let i=je(o,r.shape);const l=Tt(i,r.shape.length);let u=r;const h=[];l!=null&&(u=Ln({inputs:{x:r},backend:t,attrs:{perm:l}}),h.push(u),i=Ft(i.length,u.shape.length)),i=[i[0]],cn("argMax",i,u.shape.length);const[d,f]=tn(u.shape,i),m=ue(d),g=gn(m,"int32"),y=ue(f),w=t.data.get(u.dataId).values;for(let v=0;v<g.length;++v){const b=v*y;let C=w[b],S=0;for(let $=0;$<y;++$){const N=w[b+$];N>C&&(C=N,S=$)}g[v]=S}return h.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.makeTensorInfo(d,"int32",g)}const K4={kernelName:dd,backendName:"cpu",kernelFunc:j4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;Se(r,"argMin");let i=je(o,r.shape);const l=Tt(i,r.shape.length);let u=r;const h=[];l!=null&&(u=Ln({inputs:{x:r},backend:t,attrs:{perm:l}}),h.push(u),i=Ft(i.length,u.shape.length)),i=[i[0]],cn("argMin",i,u.shape.length);const[d,f]=tn(u.shape,i),m=ue(d),g=gn(m,"int32"),y=ue(f),w=t.data.get(u.dataId).values;for(let v=0;v<g.length;++v){const b=v*y;let C=w[b],S=0;for(let $=0;$<y;++$){const N=w[b+$];N<C&&(C=N,S=$)}g[v]=S}return h.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.makeTensorInfo(d,"int32",g)}const X4={kernelName:fd,backendName:"cpu",kernelFunc:q4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y4=lt(zl,n=>Math.asin(n)),Q4={kernelName:zl,backendName:"cpu",kernelFunc:Y4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z4=lt(Bl,n=>Math.asinh(n)),J4={kernelName:Bl,backendName:"cpu",kernelFunc:Z4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eB=lt(Vl,n=>Math.atan(n)),tB={kernelName:Vl,backendName:"cpu",kernelFunc:eB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nB=Vt((n,e)=>Math.atan2(n,e)),sB=nn(Ul,nB),rB={kernelName:Ul,backendName:"cpu",kernelFunc:sB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oB=lt(Wl,n=>Math.atanh(n)),iB={kernelName:Wl,backendName:"cpu",kernelFunc:oB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y1(n,e,t,s,r,o){const i=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.top,g=r.padInfo.left,y=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=He(r.outShape,t),v=w.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3],C=r.outShape[2]*r.outShape[3],S=r.outShape[3];for(let $=0;$<r.batchSize;++$){const N=$*b,R=$*s[0];for(let O=0;O<r.inChannels;++O)for(let F=0;F<r.outHeight;++F){const A=F*i-m,D=Math.max(0,A),T=Math.min(r.inHeight,d+A),z=N+F*C;for(let U=0;U<r.outWidth;++U){const Q=U*l-g,q=Math.max(0,Q),J=Math.min(r.inWidth,f+Q);let ne=y,B=0,X=0;for(let L=D;L<T;L+=u){const W=R+L*s[1];for(let ie=q;ie<J;ie+=h){const ce=W+ie*s[2],he=n[ce+O];o==="max"&&he>ne?ne=he:o==="avg"&&(B+=he,X++)}if(isNaN(ne))break}const Y=z+U*S+O;v[Y]=o==="avg"?B/X:ne}}}return w}function b2(n,e,t,s,r=!1,o=!1){const i=He(s.outShape,"int32"),l=s.strideHeight,u=s.strideWidth,h=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,m=s.effectiveFilterWidth,g=s.padInfo.top,y=s.padInfo.left,w=He(e,t,n);for(let v=0;v<s.batchSize;++v)for(let b=0;b<s.inChannels;++b)for(let C=0;C<s.outHeight;++C){const S=C*l-g;let $=S;for(;$<0;)$+=h;const N=Math.min(s.inHeight,f+S);for(let R=0;R<s.outWidth;++R){const O=R*u-y;let F=O;for(;F<0;)F+=d;const A=Math.min(s.inWidth,m+O);let D=Number.NEGATIVE_INFINITY,T=-1;for(let z=$;z<N;z+=h){const U=z-S;for(let Q=F;Q<A;Q+=d){const q=Q-O,J=w.get(v,z,Q,b);J>D&&(D=J,r?T=o?((v*s.inHeight+z)*s.inWidth+Q)*s.inChannels+b:(z*s.inWidth+Q)*s.inChannels+b:T=U*m+q)}}i.set(T,v,C,R,b)}}return i}function k2(n,e,t,s,r,o){const i=r.strideDepth,l=r.strideHeight,u=r.strideWidth,h=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,m=r.effectiveFilterDepth,g=r.effectiveFilterHeight,y=r.effectiveFilterWidth,w=r.padInfo.front,v=r.padInfo.top,b=r.padInfo.left,C=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=He(r.outShape,t),$=S.values,N=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],R=r.outShape[2]*r.outShape[3]*r.outShape[4],O=r.outShape[3]*r.outShape[4],F=r.outShape[4];for(let A=0;A<r.batchSize;++A){const D=A*N,T=A*s[0];for(let z=0;z<r.inChannels;++z)for(let U=0;U<r.outDepth;++U){const Q=U*i-w;let q=Q;for(;q<0;)q+=h;const J=Math.min(r.inDepth,m+Q),ne=D+U*R;for(let B=0;B<r.outHeight;++B){const X=B*l-v;let Y=X;for(;Y<0;)Y+=d;const L=Math.min(r.inHeight,g+X),W=ne+B*O;for(let ie=0;ie<r.outWidth;++ie){const ce=ie*u-b;let he=ce;for(;he<0;)he+=f;const fe=Math.min(r.inWidth,y+ce),we=W+ie*F;let ve=C,be=0,Fe=0;for(let Ze=q;Ze<J;Ze+=h){const et=T+Ze*s[1];for(let it=Y;it<L;it+=d){const ct=et+it*s[2];for(let tt=he;tt<fe;tt+=f){const dt=ct+tt*s[3],vt=n[dt+z];if(o==="max"&&vt>ve?ve=vt:o==="avg"&&(be+=vt,Fe++),isNaN(ve))break}if(isNaN(ve))break}if(isNaN(ve))break}const We=we+z;$[We]=o==="avg"?be/Fe:ve}}}}return S}function aB(n,e){const t=He(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let v=0;v<e.inChannels;++v)for(let b=0;b<e.outDepth;++b){const C=b*s-m;let S=C;for(;S<0;)S+=i;const $=Math.min(e.inDepth,h+C);for(let N=0;N<e.outHeight;++N){const R=N*r-g;let O=R;for(;O<0;)O+=l;const F=Math.min(e.inHeight,d+R);for(let A=0;A<e.outWidth;++A){const D=A*o-y;let T=D;for(;T<0;)T+=u;const z=Math.min(e.inWidth,f+D);let U=Number.NEGATIVE_INFINITY,Q=-1;for(let q=S;q<$;q+=i){const J=q-C;for(let ne=O;ne<F;ne+=l){const B=ne-R;for(let X=T;X<z;X+=u){const Y=X-D,L=n.get(w,q,ne,X,v);L>=U&&(U=L,Q=J*d*f+B*d+Y)}}}t.set(Q,w,b,N,A,v)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Se(r,"avgPool");const{filterSize:o,strides:i,pad:l,dimRoundingMode:u}=s,h=1;_(xn(i,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const d=Ns(r.shape,o,i,h,l,u);let f;if(d.filterWidth===1&&d.filterHeight===1&&ot(d.inShape,d.outShape))f=gr({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=Ae(r.shape),y=y1(m,r.shape,r.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,y.values)}return f}const uB={kernelName:pd,backendName:"cpu",kernelFunc:lB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:l,dimRoundingMode:u,dataFormat:h}=s;Se(r,"avgPool3d");const d=_r(r.shape,o,i,1,l,u,h),f=t.data.get(r.dataId).values,m=k2(f,r.shape,r.dtype,Ae(r.shape),d,"avg");return t.makeTensorInfo(m.shape,"float32",m.values)}const hB={kernelName:md,backendName:"cpu",kernelFunc:cB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:l,pad:u,dimRoundingMode:h}=s;Se([r,o],"avgPool3DGrad");const d=_r(o.shape,i,l,1,u,h),f=d.strideDepth,m=d.strideHeight,g=d.strideWidth,y=d.filterDepth,w=d.filterHeight,v=d.filterWidth,b=d.dilationDepth,C=d.dilationHeight,S=d.dilationWidth,$=d.effectiveFilterDepth,N=d.effectiveFilterHeight,R=d.effectiveFilterWidth,O=$-1-d.padInfo.front,F=R-1-d.padInfo.left,A=N-1-d.padInfo.top,D=He(o.shape,"float32"),T=1/(y*w*v),z=t.bufferSync(r);for(let U=0;U<d.batchSize;++U)for(let Q=0;Q<d.inChannels;++Q)for(let q=0;q<d.inDepth;++q)for(let J=0;J<d.inHeight;++J)for(let ne=0;ne<d.inWidth;++ne){const B=q-O,X=J-A,Y=ne-F;let L=0;for(let W=0;W<$;W+=b){const ie=(B+W)/f;if(!(ie<0||ie>=d.outDepth||Math.floor(ie)!==ie))for(let ce=0;ce<N;ce+=C){const he=(X+ce)/m;if(!(he<0||he>=d.outHeight||Math.floor(he)!==he))for(let fe=0;fe<R;fe+=S){const we=(Y+fe)/g;if(we<0||we>=d.outWidth||Math.floor(we)!==we)continue;const ve=z.get(U,ie,he,we,Q);L+=ve}}}D.set(L*T,U,q,J,ne,Q)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const fB={kernelName:Zg,backendName:"cpu",kernelFunc:dB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;Se([r,o],"avgPoolGrad");const{filterSize:l,strides:u,pad:h}=s,d=Ns(i.shape,l,u,1,h),f=d.strideHeight,m=d.strideWidth,g=d.filterHeight,y=d.filterWidth,w=d.dilationHeight,v=d.dilationWidth,b=d.effectiveFilterHeight,C=d.effectiveFilterWidth,S=C-1-d.padInfo.left,$=b-1-d.padInfo.top,N=He(i.shape,"float32"),R=1/(g*y),O=t.data.get(r.dataId).values,F=He(r.shape,"float32",O);for(let A=0;A<d.batchSize;++A)for(let D=0;D<d.inChannels;++D)for(let T=0;T<d.inHeight;++T)for(let z=0;z<d.inWidth;++z){const U=T-$,Q=z-S;let q=0;for(let J=0;J<b;J+=w){const ne=(U+J)/f;if(!(ne<0||ne>=d.outHeight||Math.floor(ne)!==ne))for(let B=0;B<C;B+=v){const X=(Q+B)/m;if(X<0||X>=d.outWidth||Math.floor(X)!==X)continue;const Y=F.get(A,ne,X,D);q+=Y}}N.set(q*R,A,T,z,D)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const mB={kernelName:Qg,backendName:"cpu",kernelFunc:pB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:i,mean:l,variance:u}=e;_(l.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),_(i==null||l.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),_(o==null||l.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Se([r,l,u,o,i],"batchNorm");let{varianceEpsilon:h}=s;h==null&&(h=.001);const d=t.data.get(r.dataId).values,f=t.data.get(l.dataId).values,m=t.data.get(u.dataId).values,g=o?t.data.get(o.dataId).values:new Float32Array([1]),y=i?t.data.get(i.dataId).values:new Float32Array([0]),w=new Float32Array(d.length),v=y.length,b=g.length,C=m.length,S=f.length;let $=0,N=0,R=0,O=0;for(let F=0;F<d.length;++F)w[F]=y[$++]+(d[F]-f[N++])*g[R++]/Math.sqrt(m[O++]+h),$>=v&&($=0),N>=S&&(N=0),R>=b&&(R=0),O>=C&&(O=0);return t.makeTensorInfo(r.shape,r.dtype,w)}const xB={kernelName:Td,backendName:"cpu",kernelFunc:gB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;Se([r],"batchToSpaceND");const l=o.reduce((b,C)=>b*C),u=Pu(r.shape,o,l),h=Mu(u.length,o.length),d=zu(r.shape,o,l),f=N0(i,o.length),m=T0(d,i,o.length),g=mt({inputs:{x:r},backend:t,attrs:{shape:u}}),y=Ln({inputs:{x:g},backend:t,attrs:{perm:h}}),w=mt({inputs:{x:y},backend:t,attrs:{shape:d}}),v=ci({inputs:{x:w},backend:t,attrs:{begin:f,size:m}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),v}const wB={kernelName:xd,backendName:"cpu",kernelFunc:yB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,h=f1(l,u,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,h)}const bB={kernelName:Jg,backendName:"cpu",kernelFunc:vB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,l=Be(Array.from(o),Array.from(i));return t.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const CB={kernelName:mk,backendName:"cpu",kernelFunc:kB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IB=lt(jl,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),$B={kernelName:jl,backendName:"cpu",kernelFunc:IB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SB=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(ue(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,l=t.data.get(o.dataId).values,u=t.data.get(i.dataId).values;for(let h=0;h<l.length;h++){const d=l[h],f=u[h];s[h]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},NB={kernelName:yd,backendName:"cpu",kernelFunc:SB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ha(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const TB={kernelName:px,backendName:"cpu",kernelFunc:ha};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function da(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=je(r,e[0].shape)[0],i=e.map(w=>w.shape);I0(i,o);let l=ur(e.map(w=>w.shape),o);if(ue(l)===0)return t.makeTensorInfo(l,e[0].dtype,[]);const u=e.filter(w=>ue(w.shape)>0);if(u.length===1)return gr({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){const w=u.map($=>ui({inputs:{input:$},backend:t})),v=u.map($=>ha({inputs:{input:$},backend:t})),b=da({inputs:w,backend:t,attrs:{axis:o}}),C=da({inputs:v,backend:t,attrs:{axis:o}}),S=jn({inputs:{real:b,imag:C},backend:t});return w.forEach($=>t.disposeIntermediateTensorInfo($)),v.forEach($=>t.disposeIntermediateTensorInfo($)),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(C),S}const h=u.map(w=>{const b=[-1,ue(w.shape.slice(o))];return mt({inputs:{x:w},backend:t,attrs:{shape:b}})}),d=h.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));l=ur(h.map(w=>w.shape),1);const f=h[0].shape[0]===1,m=RS(d,l,e[0].dtype,f),g=ur(u.map(w=>w.shape),o),y=t.makeTensorInfo(g,e[0].dtype,m);return h.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const EB={kernelName:wd,backendName:"cpu",kernelFunc:da};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C2(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}=s;Se([r,o],"conv2d");const f=Or(u),m=un(r.shape,o.shape,i,h,l,d,!1,f),g=m.filterHeight,y=m.filterWidth,w=m.dilationHeight,v=m.dilationWidth,b=m.padInfo.left,C=m.padInfo.top,S=m.dataFormat==="channelsLast",$=new mn(m.outShape,r.dtype),N=Ae(r.shape),R=Ae(o.shape),O=N[0],F=S?N[1]:N[2],A=S?N[2]:1,D=S?1:N[1],T=$.strides[0],z=S?$.strides[1]:$.strides[2],U=S?$.strides[2]:1,Q=S?1:$.strides[1],q=t.data.get(r.dataId).values,J=t.data.get(o.dataId).values,ne=$.values;for(let B=0;B<m.batchSize;++B){const X=B*O,Y=B*T;for(let L=0;L<m.outHeight;++L){const W=Y+L*z,ie=L*m.strideHeight-C;for(let ce=0;ce<g;++ce){const he=ie+ce*w;if(he<0||he>=m.inHeight)continue;const fe=ce*R[0],we=X+he*F;for(let ve=0;ve<m.outWidth;++ve){const be=W+ve*U,Fe=ve*m.strideWidth-b;for(let We=0;We<y;++We){const Ze=Fe+We*v;if(Ze<0||Ze>=m.inWidth)continue;const et=fe+We*R[1],it=we+Ze*A;let ct=et;for(let tt=0;tt<m.inChannels;++tt){const dt=q[it+tt*D];for(let vt=0;vt<m.outChannels;++vt)ne[be+vt*Q]+=dt*J[ct+vt];ct+=m.outChannels}}}}}}return t.makeTensorInfo($.shape,$.dtype,ne)}const RB={kernelName:vd,backendName:"cpu",kernelFunc:C2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:l,dataFormat:u,dimRoundingMode:h,filterShape:d}=s;Se([r,o],"conv2dBackpropFilter");const f=Or(u),m=un(r.shape,d,i,1,l,h,!1,f),{strideHeight:g,strideWidth:y,filterHeight:w,filterWidth:v}=m,b=m.dataFormat==="channelsLast",C=new mn(m.filterShape,"float32"),S=m.padInfo.left,$=m.padInfo.top,N=t.data.get(r.dataId).values,R=t.data.get(o.dataId).values,O=new mn(r.shape,r.dtype,N),F=new mn(o.shape,o.dtype,R);for(let A=0;A<w;++A){const D=Math.max(0,Math.ceil(($-A)/g)),T=Math.min(m.outHeight,(m.inHeight+$-A)/g);for(let z=0;z<v;++z){const U=Math.max(0,Math.ceil((S-z)/y)),Q=Math.min(m.outWidth,(m.inWidth+S-z)/y);for(let q=0;q<m.inChannels;++q)for(let J=0;J<m.outChannels;++J){let ne=0;for(let B=0;B<m.batchSize;++B)for(let X=D;X<T;++X){const Y=A+X*g-$;for(let L=U;L<Q;++L){const W=z+L*y-S;b?ne+=O.get(B,Y,W,q)*F.get(B,X,L,J):ne+=O.get(B,q,Y,W)*F.get(B,J,X,L)}}C.set(ne,A,z,q,J)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const AB={kernelName:tx,backendName:"cpu",kernelFunc:DB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:l,pad:u,dataFormat:h,dimRoundingMode:d}=s;Se([r,o],"conv2dBackpropInput");const f=Ae(o.shape),m=Ae(r.shape);let g=Or(h);const y=un(i,o.shape,l,1,u,d,!1,g),w=new mn(y.inShape,"float32"),v=w.values,b=t.data.get(r.dataId).values,C=t.data.get(o.dataId).values,[S,$,N]=f,{batchSize:R,filterHeight:O,filterWidth:F,inChannels:A,inHeight:D,inWidth:T,outChannels:z,outHeight:U,outWidth:Q,strideHeight:q,strideWidth:J}=y;g=y.dataFormat;const ne=O-1-y.padInfo.top,B=F-1-y.padInfo.left,X=g==="channelsLast",Y=w.strides[0],L=X?w.strides[1]:w.strides[2],W=X?w.strides[2]:1,ie=X?1:w.strides[1],ce=m[0],he=X?m[1]:m[2],fe=X?m[2]:1,we=X?1:m[1];for(let ve=0;ve<R;++ve)for(let be=0;be<A;++be)for(let Fe=0;Fe<D;++Fe){const We=Fe-ne,Ze=Math.max(0,Math.ceil(We/q)),et=Math.min(U,(O+We)/q);for(let it=0;it<T;++it){const ct=it-B,tt=Math.max(0,Math.ceil(ct/J)),dt=Math.min(Q,(F+ct)/J);let vt=0;for(let $t=Ze;$t<et;++$t){const Rn=$t*q-We;for(let dn=tt;dn<dt;++dn){const Ys=dn*J-ct,zn=ce*ve+he*$t+fe*dn,hs=S*(O-1-Rn)+$*(F-1-Ys)+N*be;for(let Ds=0;Ds<z;++Ds){const ds=b[zn+we*Ds],Jn=C[hs+Ds];vt+=ds*Jn}}}const Zn=Y*ve+L*Fe+W*it+ie*be;v[Zn]=vt}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const _B={kernelName:bd,backendName:"cpu",kernelFunc:FB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:l,dilations:u}=s;Se([r,o],"conv3d");const h=wo(r.shape,o.shape,i,u,l),{filterDepth:d,filterHeight:f,filterWidth:m,dilationDepth:g,dilationHeight:y,dilationWidth:w,padInfo:v}=h,b=v.front,C=v.left,S=v.top,$=new mn(h.outShape,r.dtype),N=t.data.get(r.dataId).values,R=t.data.get(o.dataId).values,O=$.values,F=Ae(r.shape),A=Ae(o.shape);for(let D=0;D<h.batchSize;++D){const T=D*F[0],z=D*$.strides[0];for(let U=0;U<h.outDepth;++U){const Q=z+U*$.strides[1],q=U*h.strideDepth-b;for(let J=0;J<d;++J){const ne=q+J*g;if(ne<0||ne>=h.inDepth)continue;const B=J*A[0],X=T+ne*F[1];for(let Y=0;Y<h.outHeight;++Y){const L=Q+Y*$.strides[2],W=Y*h.strideHeight-S;for(let ie=0;ie<f;++ie){const ce=W+ie*y;if(ce<0||ce>=h.inHeight)continue;const he=B+ie*A[1],fe=X+ce*F[2];for(let we=0;we<h.outWidth;++we){const ve=L+we*h.outChannels,be=we*h.strideWidth-C;for(let Fe=0;Fe<m;++Fe){const We=be+Fe*w;if(We<0||We>=h.inWidth)continue;const Ze=he+Fe*A[2],et=fe+We*h.inChannels;let it=Ze;for(let ct=0;ct<h.inChannels;++ct){const tt=N[et+ct];for(let dt=0;dt<h.outChannels;++dt)O[ve+dt]+=tt*R[it+dt];it+=h.outChannels}}}}}}}}return t.makeTensorInfo($.shape,$.dtype,$.values)}const LB={kernelName:kd,backendName:"cpu",kernelFunc:OB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:l,filterShape:u}=s;Se([r,o],"conv3dBackpropFilterV2");const h=Ae(r.shape),d=Ae(o.shape),f=wo(r.shape,u,i,1,l),m=f.strideDepth,g=f.strideHeight,y=f.strideWidth,w=f.filterDepth,v=f.filterHeight,b=f.filterWidth,C=new mn(f.filterShape,"float32"),S=C.values,[$,N,R,O]=C.strides,F=t.data.get(o.dataId).values,[A,D,T,z]=d,U=t.data.get(r.dataId).values,[Q,q,J,ne]=h,B=f.padInfo.front,X=f.padInfo.left,Y=f.padInfo.top;for(let L=0;L<w;++L){const W=Math.max(0,Math.ceil((B-L)/m)),ie=Math.min(f.outDepth,(f.inDepth+B-L)/m),ce=L*$;for(let he=0;he<v;++he){const fe=Math.max(0,Math.ceil((Y-he)/g)),we=Math.min(f.outHeight,(f.inHeight+Y-he)/g),ve=he*N+ce;for(let be=0;be<b;++be){const Fe=Math.max(0,Math.ceil((X-be)/y)),We=Math.min(f.outWidth,(f.inWidth+X-be)/y),Ze=be*R+ve;for(let et=0;et<f.inChannels;++et){const it=et*O+Ze;for(let ct=0;ct<f.outChannels;++ct){let tt=0;for(let dt=0;dt<f.batchSize;++dt){const vt=dt*Q,Zn=dt*A;for(let $t=W;$t<ie;++$t){const dn=(L+$t*m-B)*q+vt,Ys=$t*D+Zn;for(let zn=fe;zn<we;++zn){const Ds=(he+zn*g-Y)*J+dn,ds=zn*T+Ys;for(let Jn=Fe;Jn<We;++Jn){const xr=(be+Jn*y-X)*ne+Ds,yr=Jn*z+ds;tt+=U[xr+et]*F[yr+ct]}}}}S[it+ct]=tt}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const MB={kernelName:nx,backendName:"cpu",kernelFunc:PB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:l,inputShape:u}=s;Se([r],"conv3dBackpropInputV2");const h=Ae(r.shape),d=Ae(o.shape),f=wo(u,o.shape,l,1,i),m=new mn(f.inShape,"float32"),g=m.values,[y,w,v,b]=m.strides,C=t.data.get(r.dataId).values,[S,$,N,R]=h,O=t.data.get(o.dataId).values,[F,A,D,T]=d,{batchSize:z,filterDepth:U,filterHeight:Q,filterWidth:q,inChannels:J,inDepth:ne,inHeight:B,inWidth:X,outChannels:Y,outDepth:L,outHeight:W,outWidth:ie,strideDepth:ce,strideHeight:he,strideWidth:fe}=f,we=U-1-f.padInfo.front,ve=Q-1-f.padInfo.top,be=q-1-f.padInfo.left;for(let Fe=0;Fe<z;++Fe)for(let We=0;We<J;++We)for(let Ze=0;Ze<ne;++Ze){const et=Ze-we,it=Math.max(0,Math.ceil(et/ce)),ct=Math.min(L,(U+et)/ce);for(let tt=0;tt<B;++tt){const dt=tt-ve,vt=Math.max(0,Math.ceil(dt/he)),Zn=Math.min(W,(Q+dt)/he);for(let $t=0;$t<X;++$t){const Rn=$t-be,dn=Math.max(0,Math.ceil(Rn/fe)),Ys=Math.min(ie,(q+Rn)/fe);let zn=0;for(let hs=it;hs<ct;++hs){const Ds=hs*ce-et;for(let ds=vt;ds<Zn;++ds){const Jn=ds*he-dt;for(let Pr=dn;Pr<Ys;++Pr){const xr=Pr*fe-Rn,yr=S*Fe+$*hs+N*ds+R*Pr,Uf=F*(U-1-Ds)+A*(Q-1-Jn)+D*(q-1-xr)+T*We;for(let So=0;So<Y;++So){const sc=C[yr+So],Gf=O[Uf+So];zn+=sc*Gf}}}}g[y*Fe+w*Ze+v*tt+b*$t+We]=zn}}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const BB={kernelName:sx,backendName:"cpu",kernelFunc:zB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VB=lt(Kl,n=>Math.cos(n)),WB={kernelName:Kl,backendName:"cpu",kernelFunc:VB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UB=lt(ql,n=>Math.cosh(n)),GB={kernelName:ql,backendName:"cpu",kernelFunc:UB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:l,method:u,extrapolationValue:h}=s,[d,f,m,g]=r.shape,y=o.shape[0],[w,v]=l,b=He([y,w,v,g],"float32"),C=t.data.get(o.dataId).values,S=t.data.get(i.dataId).values,$=t.data.get(r.dataId).values,N=Ae(r.shape),R=Ae(b.shape);for(let O=0;O<y;O++){const F=O*4,A=C[F],D=C[F+1],T=C[F+2],z=C[F+3],U=S[O];if(U>=d)continue;const Q=w>1?(T-A)*(f-1)/(w-1):0,q=v>1?(z-D)*(m-1)/(v-1):0;for(let J=0;J<w;J++){const ne=w>1?A*(f-1)+J*Q:.5*(A+T)*(f-1);if(ne<0||ne>f-1){for(let B=0;B<v;B++)for(let X=0;X<g;X++){const Y=X+B*R[2]+J*R[1]+O*R[0];b.values[Y]=h}continue}if(u==="bilinear"){const B=Math.floor(ne),X=Math.ceil(ne),Y=ne-B;for(let L=0;L<v;L++){const W=v>1?D*(m-1)+L*q:.5*(D+z)*(m-1);if(W<0||W>m-1){for(let fe=0;fe<g;fe++){const we=fe+L*R[2]+J*R[1]+O*R[0];b.values[we]=h}continue}const ie=Math.floor(W),ce=Math.ceil(W),he=W-ie;for(let fe=0;fe<g;fe++){let we=fe+ie*N[2]+B*N[1]+U*N[0];const ve=$[we];we=fe+ce*N[2]+B*N[1]+U*N[0];const be=$[we];we=fe+ie*N[2]+X*N[1]+U*N[0];const Fe=$[we];we=fe+ce*N[2]+X*N[1]+U*N[0];const We=$[we],Ze=ve+(be-ve)*he,et=Fe+(We-Fe)*he;we=fe+L*R[2]+J*R[1]+O*R[0],b.values[we]=Ze+(et-Ze)*Y}}}else for(let B=0;B<v;++B){const X=v>1?D*(m-1)+B*q:.5*(D+z)*(m-1);if(X<0||X>m-1){for(let W=0;W<g;W++){const ie=W+B*R[2]+J*R[1]+O*R[0];b.values[ie]=h}continue}const Y=Math.round(X),L=Math.round(ne);for(let W=0;W<g;W++){const ie=W+Y*N[2]+L*N[1]+U*N[0],ce=W+B*R[2]+J*R[1]+O*R[0];b.values[ce]=$[ie]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const jB={kernelName:ox,backendName:"cpu",kernelFunc:HB};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:l}=s;Se(r,"cumprod");const u=Tt([o],r.shape.length);let h=r;u!=null&&(h=Ln({inputs:{x:r},backend:t,attrs:{perm:u}}));const d=Ft(1,r.shape.length)[0];if(d!==h.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${d}`);const f=Kn(h.dtype,"int32"),m=jg(ue(h.shape),f),g=t.data.get(h.dataId).values,y=h.shape[h.shape.length-1],w=l?(b,C)=>b+y-C-1:(b,C)=>b+C;for(let b=0;b<g.length;b+=y)for(let C=0;C<y;C++){const S=w(b,C);if(C===0)m[S]=i?1:g[S];else{const $=w(b,C-1);m[S]=i?g[$]*m[$]:g[S]*m[$]}}const v=t.makeTensorInfo(h.shape,f,m);if(u!=null){const b=vo(u),C=Ln({inputs:{x:v},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(h),C}return v}const qB={kernelName:rx,backendName:"cpu",kernelFunc:KB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:l}=s;Se(r,"cumsum");const u=Tt([o],r.shape.length);let h=r;u!=null&&(h=Ln({inputs:{x:r},backend:t,attrs:{perm:u}}));const d=Ft(1,r.shape.length)[0];if(d!==h.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${d}`);const f=Kn(h.dtype,"int32"),m=gn(ue(h.shape),f),g=t.data.get(h.dataId).values,y=h.shape[h.shape.length-1],w=l?(b,C)=>b+y-C-1:(b,C)=>b+C;for(let b=0;b<g.length;b+=y)for(let C=0;C<y;C++){const S=w(b,C);if(C===0)m[S]=i?0:g[S];else{const $=w(b,C-1);m[S]=i?g[$]+m[$]:g[S]+m[$]}}const v=t.makeTensorInfo(h.shape,f,m);if(u!=null){const b=vo(u),C=Ln({inputs:{x:v},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(h),C}return v}const YB={kernelName:Cd,backendName:"cpu",kernelFunc:XB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:l}=s;if(r.shape.length===1){const u=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,d=f1(u,h,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const u=t.bufferSync(r),h=t.bufferSync(o),d=TS(u,h,i,l);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const ZB={kernelName:gk,backendName:"cpu",kernelFunc:QB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s;_(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const l=r.shape[0],u=r.shape[1],h=r.shape[2],d=r.shape[3],f=u*o,m=h*o,g=d/(o*o),y=t.data.get(r.dataId).values,w=new Float32Array(l*f*m*g);let v=0;for(let b=0;b<l;++b)for(let C=0;C<f;++C){const S=Math.floor(C/o),$=C%o;for(let N=0;N<m;++N){const R=Math.floor(N/o),O=N%o,F=($*o+O)*g;for(let A=0;A<g;++A){const T=A+F+d*(R+h*(S+u*b));w[v++]=y[T]}}}return t.makeTensorInfo([l,f,m,g],r.dtype,w)}const eV={kernelName:ix,backendName:"cpu",kernelFunc:JB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:l,dilations:u,dimRoundingMode:h}=s;Se([r,o],"depthwiseConv2DNative");const d=Ae(r.shape),f=Ae(o.shape);let m=u;m==null&&(m=[1,1]),_(xn(i,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${m}'`);const g=un(r.shape,o.shape,i,m,l,h,!0),{filterHeight:y,filterWidth:w,dilationHeight:v,dilationWidth:b,padInfo:C}=g,S=C.left,$=C.top,N=g.outChannels/g.inChannels,R=new mn(g.outShape,r.dtype),O=t.data.get(r.dataId).values,F=t.data.get(o.dataId).values,A=R.values;for(let D=0;D<g.batchSize;++D){const T=D*d[0],z=D*R.strides[0];for(let U=0;U<g.outHeight;++U){const Q=z+U*R.strides[1],q=U*g.strideHeight-$;for(let J=0;J<y;++J){const ne=q+J*v;if(ne<0||ne>=g.inHeight)continue;const B=J*f[0],X=T+ne*d[1];for(let Y=0;Y<g.outWidth;++Y){const L=Q+Y*R.strides[2],W=Y*g.strideWidth-S;for(let ie=0;ie<w;++ie){const ce=W+ie*b;if(ce<0||ce>=g.inWidth)continue;const he=B+ie*f[1],fe=X+ce*g.inChannels;let we=L,ve=he;for(let be=0;be<g.inChannels;++be){const Fe=O[fe+be];for(let We=0;We<N;++We)A[we+We]+=Fe*F[ve+We];we+=N,ve+=N}}}}}}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const tV={kernelName:Id,backendName:"cpu",kernelFunc:I2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:l,pad:u,dimRoundingMode:h,filterShape:d}=s;Se([r,o],"depthwiseConv2dNativeBackpropFilter");const f=un(r.shape,d,i,l,u,h,!0),{strideHeight:m,strideWidth:g,filterHeight:y,filterWidth:w}=f,v=new mn(f.filterShape,"float32"),b=f.padInfo.left,C=f.padInfo.top,S=f.outChannels/f.inChannels,$=t.data.get(r.dataId).values,N=new mn(r.shape,r.dtype,$),R=t.data.get(o.dataId).values,O=new mn(o.shape,o.dtype,R);for(let F=0;F<y;++F){const A=Math.max(0,Math.ceil((C-F)/m)),D=Math.min(f.outHeight,(f.inHeight+C-F)/m);for(let T=0;T<w;++T){const z=Math.max(0,Math.ceil((b-T)/g)),U=Math.min(f.outWidth,(f.inWidth+b-T)/g);for(let Q=0;Q<f.outChannels;++Q){const q=Math.trunc(Q/S),J=Q%S;let ne=0;for(let B=0;B<f.batchSize;++B)for(let X=A;X<D;++X){const Y=F+X*m-C;for(let L=z;L<U;++L){const W=T+L*g-b;ne+=N.get(B,Y,W,q)*O.get(B,X,L,Q)}}v.set(ne,F,T,q,J)}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const sV={kernelName:ax,backendName:"cpu",kernelFunc:nV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:l,pad:u,dimRoundingMode:h,inputShape:d}=s;Se([r,o],"depthwiseConv2DNativeBackpropInput");const f=Ae(r.shape),m=Ae(o.shape),g=un(d,o.shape,i,l,u,h,!0),y=new mn(g.inShape,"float32"),w=y.values,[v,b,C]=y.strides,S=t.data.get(r.dataId).values,[$,N,R]=f,O=t.data.get(o.dataId).values,[F,A,D]=m,{batchSize:T,filterHeight:z,filterWidth:U,inChannels:Q,inHeight:q,inWidth:J,outChannels:ne,outHeight:B,outWidth:X,strideHeight:Y,strideWidth:L}=g,W=z-1-g.padInfo.top,ie=U-1-g.padInfo.left,ce=ne/Q;for(let he=0;he<T;++he)for(let fe=0;fe<Q;++fe)for(let we=0;we<q;++we){const ve=we-W,be=Math.max(0,Math.ceil(ve/Y)),Fe=Math.min(B,(z+ve)/Y);for(let We=0;We<J;++We){const Ze=We-ie,et=Math.max(0,Math.ceil(Ze/L)),it=Math.min(X,(U+Ze)/L);let ct=0;for(let tt=be;tt<Fe;++tt){const dt=tt*Y-ve;for(let vt=et;vt<it;++vt){const Zn=vt*L-Ze,$t=$*he+N*tt+R*vt,Rn=F*(z-1-dt)+A*(U-1-Zn)+D*fe;for(let dn=0;dn<ce;++dn){const Ys=fe*ce+dn,zn=S[$t+Ys],hs=O[Rn+dn];ct+=zn*hs}}}w[v*he+b*we+C*We+fe]=ct}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const oV={kernelName:lx,backendName:"cpu",kernelFunc:rV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n){const{inputs:e,backend:t}=n,{x:s}=e,r=ue(s.shape),o=t.data.get(s.dataId).values,i=He([r,r],s.dtype),l=i.values;for(let h=0;h<o.length;h++)l[h*r+h]=o[h];const u=[...s.shape,...s.shape];return t.makeTensorInfo(u,i.dtype,i.values)}const aV={kernelName:xk,backendName:"cpu",kernelFunc:iV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lV={kernelName:$d,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:l}=t,u=e,h=u.data.get(s.dataId).values,d=s.shape.length,f=u.data.get(r.dataId).values,m=r.shape.length,{batchSize:g,inHeight:y,inWidth:w,inChannels:v,outHeight:b,outWidth:C,padInfo:S,strideHeight:$,strideWidth:N,filterHeight:R,filterWidth:O,dilationHeight:F,dilationWidth:A,outShape:D}=Fu(s.shape,r.shape,o,i,"NHWC",l),T=ue(D),z=D.length,U=Jt(s.dtype,T);for(let q=0;q<g;++q)for(let J=0;J<b;++J){const ne=J*$-S.top;for(let B=0;B<C;++B){const X=B*N-S.left;for(let Y=0;Y<v;++Y){let L=Number.MIN_SAFE_INTEGER;for(let ie=0;ie<R;++ie){const ce=ne+ie*F;if(ce>=0&&ce<y)for(let he=0;he<O;++he){const fe=X+he*A;if(fe>=0&&fe<w){const we=ar([q,ce,fe,Y],d,Ae(s.shape)),ve=ar([ie,he,Y],m,Ae(r.shape)),be=h[we]+f[ve];be>L&&(L=be)}}}const W=ar([q,J,B,Y],z,Ae(D));U[W]=L}}}return{dataId:u.write(hi(U,s.dtype),D,s.dtype),shape:D,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uV={kernelName:ug,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:l,dilations:u}=t,h=e,d=Gs(s.shape,h.data.get(s.dataId).values),f=Gs(r.shape,h.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:y,inChannels:w,outHeight:v,outWidth:b,padInfo:C,strideHeight:S,strideWidth:$,filterHeight:N,filterWidth:R,dilationHeight:O,dilationWidth:F,outShape:A}=Fu(s.shape,r.shape,i,l,"NHWC",u);_(o.rank===A.length,()=>`Error in ${ug}, dy must have the same rank as output ${A.length}, but got ${o.rank}`);const D=Gs(A,h.data.get(o.dataId).values),T=ck(r.shape,r.dtype);for(let U=0;U<m;++U)for(let Q=0;Q<v;++Q){const q=Q*S-C.top;for(let J=0;J<b;++J){const ne=J*$-C.left;for(let B=0;B<w;++B){let X=Number.MIN_SAFE_INTEGER,Y=0,L=0;for(let W=0;W<N;++W){const ie=q+W*O;if(ie>=0&&ie<g)for(let ce=0;ce<R;++ce){const he=ne+ce*F;if(he>=0&&he<y){const fe=d[U][ie][he][B]+f[W][ce][B];fe>X&&(X=fe,Y=W,L=ce)}}}T[Y][L][B]+=D[U][Q][J][B]}}}return{dataId:h.write(hi(T,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cV={kernelName:lg,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:l,dilations:u}=t,h=e,d=Gs(s.shape,h.data.get(s.dataId).values),f=Gs(r.shape,h.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:y,inChannels:w,outHeight:v,outWidth:b,padInfo:C,strideHeight:S,strideWidth:$,filterHeight:N,filterWidth:R,dilationHeight:O,dilationWidth:F,outShape:A}=Fu(s.shape,r.shape,i,l,"NHWC",u);_(o.rank===A.length,()=>`Error in ${lg}, dy must have the same rank as output ${A.length}, but got ${o.rank}`);const D=Gs(A,h.data.get(o.dataId).values),T=ck(s.shape,s.dtype);for(let U=0;U<m;++U)for(let Q=0;Q<v;++Q){const q=Q*S-C.top;for(let J=0;J<b;++J){const ne=J*$-C.left;for(let B=0;B<w;++B){let X=Number.MIN_SAFE_INTEGER,Y=q<0?0:q,L=ne<0?0:ne;for(let W=0;W<N;++W){const ie=q+W*O;if(ie>=0&&ie<g)for(let ce=0;ce<R;++ce){const he=ne+ce*F;if(he>=0&&he<y){const fe=d[U][ie][he][B]+f[W][ce][B];fe>X&&(X=fe,Y=ie,L=he)}}}T[U][Y][L][B]+=D[U][Q][J][B]}}}return{dataId:h.write(hi(T,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xu(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Se(r,"sum");let l;r.dtype==="bool"?l=go({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):l=gr({inputs:{x:r},backend:t});const u=l.shape.length,h=je(o,l.shape),d=Tt(h,u);let f=h,m=l;d!=null&&(m=Ln({inputs:{x:l},backend:t,attrs:{perm:d}}),f=Ft(f.length,u)),cn("sum",f,m.shape.length);const[g,y]=tn(m.shape,f),w=Kn(m.dtype,"int32");let v=nd(t,g,w);const b=ue(y),C=t.data.get(v.dataId).values,S=t.data.get(m.dataId).values;for(let $=0;$<C.length;++$){const N=$*b;let R=0;for(let O=0;O<b;++O)R+=S[N+O];C[$]=R}if(i){const $=Bt(v.shape,h),N=v;v=mt({inputs:{x:v},backend:t,attrs:{shape:$}}),t.disposeIntermediateTensorInfo(N)}return t.disposeIntermediateTensorInfo(l),d!=null&&t.disposeIntermediateTensorInfo(m),v}const hV={kernelName:rf,backendName:"cpu",kernelFunc:Xu};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:l,idDims:u}=L0(r,o.length);M0(i.length,u,o);const{path:h,steps:d}=z0(l,u),f=d.length;let m=null,g=i.length;const y=[];for(let w=0;w<f;++w){for(const v of d[w]){const{permutationIndices:b,expandDims:C}=P0(g,u[v]);let S;B0(b)?S=o[v]:(S=Ln({inputs:{x:o[v]},backend:t,attrs:{perm:b}}),y.push(S));const $=S.shape.slice();for(let N=0;N<C.length;++N)$.splice(C[N],0,1);ot(S.shape,$)||(S=mt({inputs:{x:S},backend:t,attrs:{shape:$}}),y.push(S)),m===null?m=S:(m=Pf({inputs:{a:S,b:m},backend:t}),y.push(m))}w<f-1&&(h[w]>=0&&(m=Xu({inputs:{x:m},backend:t,attrs:{axis:h[w]-(i.length-g),keepDims:!1}}),y.push(m)),g--)}for(const w of y)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const fV={kernelName:yk,backendName:"cpu",kernelFunc:dV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Se([s,r],"eluGrad");const o=new Float32Array(ue(r.shape)),i=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values;for(let u=0;u<i.length;++u){const h=i[u];h>=1?o[u]=l[u]:o[u]=l[u]*(h+1)}return t.makeTensorInfo(r.shape,"float32",o)}const mV={kernelName:ux,backendName:"cpu",kernelFunc:pV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gV=E0,xV=R0,yV=D0,wV=A0,vV=F0,bV=_0,kV=lt(Ql,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+gV*t);return e*(1-((((bV*s+vV)*s+wV)*s+yV)*s+xV)*s*Math.exp(-t*t))}),CV={kernelName:Ql,backendName:"cpu",kernelFunc:kV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function od(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,i=r.shape.length,l=r.shape.slice();let u=o;return o<0&&(_(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+o+1),l.splice(u,0,1),mt({inputs:{x:r},backend:t,attrs:{shape:l}})}const IV={kernelName:Nd,backendName:"cpu",kernelFunc:od};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $V=Vt((n,e)=>n/e),w1=nn(Xl,$V),Lg={kernelName:Xl,backendName:"cpu",kernelFunc:w1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(n,e,t){const s=n.shape,r=s[0],o=s[1],i=t.data.get(n.dataId),l=i.complexTensorInfos.real,u=i.complexTensorInfos.imag,h=[r,o],d=ue(h),f=ln("float32",d),m=ln("float32",d);for(let v=0;v<r;v++){const b=ci({inputs:{x:l},backend:t,attrs:{begin:[v,0],size:[1,o]}}),C=ci({inputs:{x:u},backend:t,attrs:{begin:[v,0],size:[1,o]}}),S=jn({inputs:{real:b,imag:C},backend:t}),{real:$,imag:N}=SV(S,e,t),R=Fr($,N);for(let O=0;O<o;O++){const F=O0(R,O);f[v*o+O]=F.real,m[v*o+O]=F.imag}t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(S)}const g=t.makeTensorInfo(h,"float32",f),y=t.makeTensorInfo(h,"float32",m),w=jn({inputs:{real:g,imag:y},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),w}function SV(n,e,t){const s=ue(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,i=t.data.get(r.complexTensorInfos.imag.dataId).values;if(NV(s)){const l=Pg(o,i,s,e,t),u=[n.shape[0],n.shape[1]];if(e){const h=t.makeTensorInfo(u,"float32",l.real),d=t.makeTensorInfo(u,"float32",l.imag),f=t.makeTensorInfo([],"float32",yo(s,"float32")),m=gr({inputs:{x:f},backend:t}),g=Lg.kernelFunc({inputs:{a:h,b:f},backend:t}),y=Lg.kernelFunc({inputs:{a:d,b:m},backend:t}),w=t.data.get(g.dataId).values,v=t.data.get(y.dataId).values;return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),{real:w,imag:v}}return l}else{const l=Fr(o,i),u=TV(l,s,e);return YC(u)}}function NV(n){return(n&n-1)===0}function Pg(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=Fr(n,e),i=t/2,l=QC(o),u=l.real,h=l.imag,d=[u.length],f=r.makeTensorInfo(d,"float32",u),m=r.makeTensorInfo(d,"float32",h),g=jn({inputs:{real:f,imag:m},backend:r}),y=ZC(o),w=y.real,v=y.imag,b=[w.length],C=r.makeTensorInfo(b,"float32",w),S=r.makeTensorInfo(b,"float32",v),$=jn({inputs:{real:C,imag:S},backend:r}),N=Pg(u,h,i,s,r),R=N.real,O=N.imag,F=[R.length],A=r.makeTensorInfo(F,"float32",R),D=r.makeTensorInfo(F,"float32",O),T=jn({inputs:{real:A,imag:D},backend:r}),z=Pg(w,v,i,s,r),U=z.real,Q=z.imag,q=[U.length],J=r.makeTensorInfo(q,"float32",U),ne=r.makeTensorInfo(q,"float32",Q),B=jn({inputs:{real:J,imag:ne},backend:r}),X=eI(t,s),Y=[X.real.length],L=r.makeTensorInfo(Y,"float32",X.real),W=r.makeTensorInfo(Y,"float32",X.imag),ie=jn({inputs:{real:L,imag:W},backend:r}),ce=Pf({inputs:{a:ie,b:B},backend:r}),he=ca({inputs:{a:T,b:ce},backend:r}),fe=x1({inputs:{a:T,b:ce},backend:r}),we=ui({inputs:{input:he},backend:r}),ve=ui({inputs:{input:fe},backend:r}),be=ha({inputs:{input:he},backend:r}),Fe=ha({inputs:{input:fe},backend:r}),We=da({inputs:[we,ve],backend:r,attrs:{axis:0}}),Ze=da({inputs:[be,Fe],backend:r,attrs:{axis:0}}),et=r.data.get(We.dataId).values,it=r.data.get(Ze.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(ne),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(he),r.disposeIntermediateTensorInfo(fe),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(be),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo(Fe),r.disposeIntermediateTensorInfo(We),r.disposeIntermediateTensorInfo(Ze),{real:et,imag:it}}function TV(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let l=0;l<e;l++){const u=tI(r*l,e,t),h=O0(n,l);o+=h.real*u.real-h.imag*u.imag,i+=h.real*u.imag+h.imag*u.real}t&&(o/=e,i/=e),JC(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ue(s.shape),o=s.shape[s.shape.length-1],i=r/o,l=mt({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),u=$2(l,!1,t),h=mt({inputs:{x:u},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),h}const RV={kernelName:cx,backendName:"cpu",kernelFunc:EV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,i=o||Ll(r),l=Jt(i,ue(s));return AV(l,r,i),e.makeTensorInfo(s,i,l)}const DV={kernelName:hx,backendName:"cpu",kernelFunc:v1};function AV(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FV={kernelName:dx,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=ln(s.dtype,ue(s.shape)),[i,l,u,h]=s.shape,d=r.data.get(s.dataId).values;for(let m=0;m<i;m++){const g=m*u*l*h;for(let y=0;y<l;y++){const w=y*(u*h);for(let v=0;v<u;v++){const b=v*h;for(let C=0;C<h;C++){const S=Math.round(u-v-1),$=g+w+b+C;let N=d[$];if(S>=0&&S<u){const R=S*h,O=g+w+R+C;N=d[O]}o[$]=N}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _V=Vt((n,e)=>Math.floor(n/e)),OV=nn(tu,_V,null,"int32"),LV={kernelName:tu,backendName:"cpu",kernelFunc:OV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:l}=e,{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:y}=s;let w=C2({inputs:{x:r,filter:o},backend:t,attrs:{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:m}});if(i){const v=w;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const b=mt({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});w=ca({inputs:{a:w,b},backend:t}),t.disposeIntermediateTensorInfo(b)}else w=ca({inputs:{a:w,b:i},backend:t});t.disposeIntermediateTensorInfo(v)}if(g){const v=w;if(d==="NCHW"&&g==="prelu"&&l.shape.length===1&&l.shape[0]!==1){const b=mt({inputs:{x:l},backend:t,attrs:{shape:[l.shape[0],1,1]}});w=rd(t,w,g,b,y),t.disposeIntermediateTensorInfo(b)}else w=rd(t,w,g,l,y);t.disposeIntermediateTensorInfo(v)}return w}const MV={kernelName:Ph,backendName:"cpu",kernelFunc:PV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:l}=e,{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:y}=s;let w=I2({inputs:{x:r,filter:o},backend:t,attrs:{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:m}});if(i){const v=w;w=ca({inputs:{a:w,b:i},backend:t}),t.disposeIntermediateTensorInfo(v)}if(g){const v=w;w=rd(t,w,g,l,y),t.disposeIntermediateTensorInfo(v)}return w}const BV={kernelName:Ok,backendName:"cpu",kernelFunc:zV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=ue(s.shape),i=r.shape,l=i[i.length-1],[u,h,d,f]=Lx(s,r);if(h===0)return t.makeTensorInfo(u,s.dtype,[]);const m=t.data.get(r.dataId).values,g=t.bufferSync(s),y=PS(m,g,s.dtype,h,l,d,f,s.shape,o);return t.makeTensorInfo(u,s.dtype,y.values)}const WV={kernelName:wk,backendName:"cpu",kernelFunc:VV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:l}=s;Se([r,o],"gatherV2");const u=je(i,r.shape)[0],h=t.data.get(o.dataId).values,d=r.shape[u];for(let $=0;$<h.length;++$){const N=h[$];_(N<=d-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${d-1}]`)}let f=l;l==null&&(f=0);const m=ue(o.shape),g=W0(r,o,u,f),y=mt({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),w=mt({inputs:{x:o},backend:t,attrs:{shape:[g.batchSize,m/g.batchSize]}}),v=[g.batchSize,g.outerSize,m/g.batchSize,g.sliceSize],b=t.bufferSync(w),C=t.bufferSync(y),S=MS(C,b,v);return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(g.outputShape,S.dtype,S.values)}const GV={kernelName:Ed,backendName:"cpu",kernelFunc:UV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ue(s.shape),o=s.shape[s.shape.length-1],i=r/o,l=mt({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),u=$2(l,!0,t),h=mt({inputs:{x:u},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),h}const jV={kernelName:fx,backendName:"cpu",kernelFunc:HV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KV=lt(ru,n=>Number.isFinite(n)?1:0,"bool"),qV={kernelName:ru,backendName:"cpu",kernelFunc:KV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XV=lt(ou,n=>Math.abs(n)===1/0?1:0,"bool"),YV={kernelName:ou,backendName:"cpu",kernelFunc:XV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QV=lt(iu,n=>Number.isNaN(n)?1:0,"bool"),ZV={kernelName:iu,backendName:"cpu",kernelFunc:QV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JV(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=US(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const eW={kernelName:vk,backendName:"cpu",kernelFunc:JV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tW=lt(lu,n=>Math.log1p(n)),nW={kernelName:lu,backendName:"cpu",kernelFunc:tW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sW=Vt((n,e)=>n&&e),rW=nn(_d,sW,null,"bool"),oW={kernelName:_d,backendName:"cpu",kernelFunc:rW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iW=lt(Od,n=>n?0:1,"bool"),aW={kernelName:Od,backendName:"cpu",kernelFunc:iW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lW=Vt((n,e)=>n||e),uW=nn(Ld,lW,null,"bool"),cW={kernelName:Ld,backendName:"cpu",kernelFunc:uW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:l,beta:u}=s;Se(r,"LRN");const h=r.shape[3],d=h-1,f=t.data.get(r.dataId).values,m=ue(r.shape),g=new Float32Array(m);function y(w){const v=w%h;let b=w-v+Math.max(0,v-o);const C=w-v+Math.min(v+o,d);let S=0;for(;b<=C;b++){const $=f[b];S+=$*$}return S}for(let w=0;w<m;w++){const v=y(w),b=f[w]*Math.pow(i+l*v,-u);g[w]=b}return t.makeTensorInfo(r.shape,r.dtype,g)}const dW={kernelName:Pd,backendName:"cpu",kernelFunc:hW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:l,bias:u,alpha:h,beta:d}=s;Se(i,"LRNGrad");const f=ue(i.shape),m=i.shape[3],g=t.data.get(i.dataId).values,y=t.data.get(r.dataId).values,w=t.data.get(o.dataId).values,v=new Float32Array(f),b=f;for(let C=0;C<b;C++){const S=C%m,$=C-S+Math.max(0,S-l),N=C-S+Math.min(m,S+l+1);let R=0;for(let O=$;O<N;O++)R+=Math.pow(y[O],2);R=h*R+u;for(let O=$;O<N;O++){let F=-2*h*d*y[O]*w[C]/R;C===O&&(F+=Math.pow(R,-d)),F*=g[C],v[O]+=F}}return t.makeTensorInfo(i.shape,r.dtype,v)}const pW={kernelName:mx,backendName:"cpu",kernelFunc:fW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,l=t;let u=r.shape;const h=u.length,d=je(o,u);let f=d;const m=Tt(f,h);let g=l.data.get(r.dataId).values;if(m!=null){const $=new Array(h);for(let N=0;N<$.length;N++)$[N]=u[m[N]];g=m1(g,u,r.dtype,m,$),f=Ft(f.length,h),u=$}Se(r,"max"),cn("max",f,h);const[y,w]=tn(u,f),v=ue(w),b=HS(g,v,y,r.dtype),C=l.write(b,y,r.dtype);let S=y;return i&&(S=Bt(y,d)),{dataId:C,shape:S,dtype:r.dtype}}const mW={kernelName:Md,backendName:"cpu",kernelFunc:S2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Se(r,"maxPool");const{filterSize:o,strides:i,pad:l,dimRoundingMode:u}=s,h=1;_(xn(i,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const d=Ns(r.shape,o,i,h,l,u);let f;if(d.filterWidth===1&&d.filterHeight===1&&ot(d.inShape,d.outShape))f=gr({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=Ae(r.shape),y=y1(m,r.shape,r.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,y.values)}return f}const xW={kernelName:zd,backendName:"cpu",kernelFunc:gW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:l,dimRoundingMode:u,dataFormat:h}=s;Se(r,"maxPool3d");const d=_r(r.shape,o,i,1,l,u,h),f=t.data.get(r.dataId).values,m=k2(f,r.shape,r.dtype,Ae(r.shape),d,"max");return t.makeTensorInfo(m.shape,"float32",m.values)}const wW={kernelName:Bd,backendName:"cpu",kernelFunc:yW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:l,pad:u,dimRoundingMode:h}=s;Se([r,o],"maxPool3DGrad");const d=_r(o.shape,i,l,1,u,h),f=t.bufferSync(o),m=aB(f,d),g=d.strideDepth,y=d.strideHeight,w=d.strideWidth,v=d.dilationDepth,b=d.dilationHeight,C=d.dilationWidth,S=d.effectiveFilterDepth,$=d.effectiveFilterHeight,N=d.effectiveFilterWidth,R=S-1-d.padInfo.front,O=N-1-d.padInfo.left,F=$-1-d.padInfo.top,A=He(o.shape,"float32"),D=t.bufferSync(r);for(let T=0;T<d.batchSize;++T)for(let z=0;z<d.inChannels;++z)for(let U=0;U<d.inDepth;++U)for(let Q=0;Q<d.inHeight;++Q)for(let q=0;q<d.inWidth;++q){const J=U-R,ne=Q-F,B=q-O;let X=0;for(let Y=0;Y<S;Y+=v){const L=(J+Y)/g;if(!(L<0||L>=d.outDepth||Math.floor(L)!==L))for(let W=0;W<$;W+=b){const ie=(ne+W)/y;if(!(ie<0||ie>=d.outHeight||Math.floor(ie)!==ie))for(let ce=0;ce<N;ce+=C){const he=(B+ce)/w;if(he<0||he>=d.outWidth||Math.floor(he)!==he)continue;const fe=S*$*N-1-m.get(T,L,ie,he,z),we=Y*$*N+W*N+ce,ve=fe===we?1:0;if(ve===0)continue;const be=D.get(T,L,ie,he,z);X+=be*ve}}}A.set(X,T,U,Q,q,z)}return t.makeTensorInfo(A.shape,A.dtype,A.values)}const bW={kernelName:xx,backendName:"cpu",kernelFunc:vW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kW(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,l=o;Se([o,i],"maxPoolGrad");const{filterSize:u,strides:h,pad:d,dimRoundingMode:f}=s,m=Ns(l.shape,u,h,1,d,f),g=t.data.get(l.dataId).values,y=He(m.outShape,l.dtype,b2(g,l.shape,l.dtype,m).values),w=m.strideHeight,v=m.strideWidth,b=m.dilationHeight,C=m.dilationWidth,S=m.effectiveFilterHeight,$=m.effectiveFilterWidth,N=$-1-m.padInfo.left,R=S-1-m.padInfo.top,O=He(l.shape,"float32"),F=t.data.get(r.dataId).values,A=He(r.shape,"float32",F);for(let D=0;D<m.batchSize;++D)for(let T=0;T<m.inChannels;++T)for(let z=0;z<m.inHeight;++z)for(let U=0;U<m.inWidth;++U){const Q=z-R,q=U-N;let J=0;for(let ne=0;ne<S;ne+=b){const B=(Q+ne)/w;if(!(B<0||B>=m.outHeight||Math.floor(B)!==B))for(let X=0;X<$;X+=C){const Y=(q+X)/v;if(Y<0||Y>=m.outWidth||Math.floor(Y)!==Y)continue;const L=S*$-1-y.get(D,B,Y,T),W=ne*$+X,ie=L===W?1:0;if(ie===0)continue;const ce=A.get(D,B,Y,T);J+=ce*ie}}O.set(J,D,z,U,T)}return t.makeTensorInfo(O.shape,O.dtype,O.values)}const CW={kernelName:gx,backendName:"cpu",kernelFunc:kW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(n,e,t,s,r){const o=Ae(e),i=y1(n,e,t,o,r,"max"),l=b2(n,e,t,r,!0,s);return[i.values,l.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $W={kernelName:bk,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:l}=e,u=t;Se(s,"MaxPoolWithArgmax");const h=u.data.get(s.dataId).values,d=Ns(s.shape,r,o,[1,1],i),[f,m]=IW(h,s.shape,s.dtype,l,d),g=u.write(f,d.outShape,s.dtype),y=u.write(m,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:y,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,l=je(o,r.shape),h=tn(r.shape,l)[1],d=ue(h),f=[],m=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(m);const g=go({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const y=w1({inputs:{a:g,b:m},backend:t});f.push(y);const w=Xu({inputs:{x:y},backend:t,attrs:{axis:o,keepDims:i}});return f.forEach(v=>t.disposeIntermediateTensorInfo(v)),w}const NW={kernelName:Vd,backendName:"cpu",kernelFunc:SW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Se(r,"min");const l=je(o,r.shape);let u=l;const h=Tt(u,r.shape.length);let d=r;h!=null&&(d=Ln({inputs:{x:r},backend:t,attrs:{perm:h}}),u=Ft(u.length,r.shape.length)),cn("min",u,d.shape.length);const[f,m]=tn(d.shape,u),g=ue(m),y=gn(ue(f),d.dtype),w=t.data.get(d.dataId).values;for(let b=0;b<y.length;++b){const C=b*g;let S=w[C];for(let $=0;$<g;++$){const N=w[C+$];(Number.isNaN(N)||N<S)&&(S=N)}y[b]=S}h!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,y);if(i){const b=Bt(f,l),C=mt({inputs:{x:v},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(v),C}return v}const EW={kernelName:Wd,backendName:"cpu",kernelFunc:TW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:i}=s;Se(r,"mirrorPad");const l=o.map((S,$)=>S[0]+r.shape[$]+S[1]),u=o.map(S=>S[0]),h=o.map((S,$)=>S[0]+r.shape[$]),d=i==="reflect"?0:1,f=t.data.get(r.dataId).values,m=r.shape.length,g=Ae(r.shape),y=ue(l),w=l.length,v=Ae(l),b=ln(r.dtype,y);for(let S=0;S<y;S++){let $=ga(S,w,v);for(let R=0;R<w;R++)$[R]<u[R]?$[R]=u[R]*2-$[R]-d:$[R]>=h[R]&&($[R]=(h[R]-1)*2-$[R]+d);$=$.map((R,O)=>R-u[O]);const N=ar($,m,g);b[S]=f[N]}return{dataId:t.write(b,l,r.dtype),shape:l,dtype:r.dtype}}const DW={kernelName:Ud,backendName:"cpu",kernelFunc:RW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AW=Vt((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),FW=nn(hu,AW),_W={kernelName:hu,backendName:"cpu",kernelFunc:FW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N2(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=r.shape.length;let l=o;if(l===-1&&(l=i-1),l!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${l}`);const u=je([l],r.shape),h=S2({inputs:{x:r},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),d=Bt(h.shape,u),f=mt({inputs:{x:h},backend:t,attrs:{shape:d}}),m=x1({inputs:{a:r,b:f},backend:t}),g=_S({inputs:{x:m},backend:t}),y=Xu({inputs:{x:g},backend:t,attrs:{axis:u,keepDims:!1}}),w=mt({inputs:{x:y},backend:t,attrs:{shape:d}}),v=w1({inputs:{a:g,b:w},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),v}const OW={kernelName:lf,backendName:"cpu",kernelFunc:N2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LW(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:l}=s;Se(r,"multinomial");const u=l?r:N2({inputs:{logits:r},backend:t,attrs:{dim:-1}}),h=u.shape[0],d=u.shape[1],f=t.data.get(u.dataId).values,m=[h,o],g=gn(ue(m),"int32");for(let y=0;y<h;++y){const w=y*d,v=new Float32Array(d-1);v[0]=f[w];for(let S=1;S<v.length;++S)v[S]=v[S-1]+f[w+S];const b=o0.alea(i.toString()),C=y*o;for(let S=0;S<o;++S){const $=b();g[C+S]=v.length;for(let N=0;N<v.length;N++)if($<v[N]){g[C+S]=N;break}}}return l||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(m,"int32",g)}const PW={kernelName:kk,backendName:"cpu",kernelFunc:LW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MW=p0;function zW(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u}=s;Se(r,"NonMaxSuppression");const h=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:f}=MW(h,d,i,l,u);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const BW={kernelName:yx,backendName:"cpu",kernelFunc:zW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VW=m0;function WW(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,padToMaxOutputSize:h}=s;Se(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(o.dataId).values,{selectedIndices:m,validOutputs:g}=VW(d,f,i,l,u,h);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const UW={kernelName:wx,backendName:"cpu",kernelFunc:WW};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GW=g0;function HW(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,softNmsSigma:h}=s;Se(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(o.dataId).values,m=i,g=l,y=u,w=h,{selectedIndices:v,selectedScores:b}=GW(d,f,m,g,y,w);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const jW={kernelName:vx,backendName:"cpu",kernelFunc:HW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KW(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:l,offValue:u}=s;Se(r,"oneHot");const h=ue(r.shape),d=new Float32Array(h*i);d.fill(u);const f=t.data.get(r.dataId).values;for(let m=0;m<h;++m)f[m]>=0&&f[m]<i&&(d[m*i+f[m]]=l);return t.makeTensorInfo([...r.shape,i],o,d)}const qW={kernelName:Kd,backendName:"cpu",kernelFunc:KW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function id(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ui({inputs:{input:s},backend:t}),o=id({inputs:{x:r},backend:t}),i=ha({inputs:{input:s},backend:t}),l=id({inputs:{x:i},backend:t}),u=jn({inputs:{real:o,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),u}else return v1({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const XW={kernelName:hf,backendName:"cpu",kernelFunc:id};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T2(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ui({inputs:{input:s},backend:t}),o=T2({inputs:{x:r},backend:t}),i=ha({inputs:{input:s},backend:t}),l=id({inputs:{x:i},backend:t}),u=jn({inputs:{real:o,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),u}else return v1({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const YW={kernelName:jd,backendName:"cpu",kernelFunc:T2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E2(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return od({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Hg(o,d.shape,"All tensors passed to stack must have matching shapes"),_(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],u=e.map(d=>{const f=od({inputs:{input:d},backend:t,attrs:{dim:r}});return l.push(f),f}),h=da({inputs:u,backend:t,attrs:{axis:r}});return l.forEach(d=>t.disposeIntermediateTensorInfo(d)),h}const QW={kernelName:qd,backendName:"cpu",kernelFunc:E2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;Se(r,"pad");const l=o.map((C,S)=>C[0]+r.shape[S]+C[1]),u=o.map(C=>C[0]),h=t.data.get(r.dataId).values,d=ue(r.shape),f=r.shape.length,m=Ae(r.shape),g=ue(l),y=l.length,w=Ae(l),v=ln(r.dtype,g);i!==0&&v.fill(i);for(let C=0;C<d;C++){const $=ga(C,f,m).map((R,O)=>R+u[O]),N=ar($,y,w);v[N]=h[C]}return{dataId:t.write(v,l,r.dtype),shape:l,dtype:r.dtype}}const R2={kernelName:Xd,backendName:"cpu",kernelFunc:ZW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JW=Vt((n,e)=>Math.pow(n,e)),eU=nn(fu,JW),tU={kernelName:fu,backendName:"cpu",kernelFunc:eU};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nU(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,l=r.map(v=>t.data.get(v.dataId).values),u=r.map(v=>v.shape),h=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values,[f,m,g]=QS(l,u,h,o.shape,o.dtype,d,i.shape),y=f.map(v=>t.makeTensorInfo([v.length],"int32",v)),w=t.makeTensorInfo(g,o.dtype,m);return y.concat([w])}const sU={kernelName:Ck,backendName:"cpu",kernelFunc:nU};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rU(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:l}=e,{rowPartitionTypes:u}=s,h=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,f=t.data.get(i.dataId).values,m=l.map(v=>t.data.get(v.dataId).values),g=l.map(v=>v.shape),[y,w]=ZS(h,r.shape,d,o.shape,o.dtype,f,i.shape,m,g,u);return t.makeTensorInfo(y,o.dtype,w)}const oU={kernelName:Ik,backendName:"cpu",kernelFunc:rU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iU(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:i}=t,l=JS(s,r,i,o);return e.makeTensorInfo([l.length],o,l)}const aU={kernelName:bx,backendName:"cpu",kernelFunc:iU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU=lt(pu,n=>1/n),uU={kernelName:pu,backendName:"cpu",kernelFunc:lU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:l}=s;Se(r,"resizeBilinear");const u=Ae(r.shape),[h,d]=l,[f,m,g,y]=r.shape,w=t.data.get(r.dataId).values,v=new Float32Array(ue([f,h,d,y])),b=[o&&h>1?m-1:m,o&&d>1?g-1:g],C=[o&&h>1?h-1:h,o&&d>1?d-1:d];let S=0;const $=b[0]/C[0],N=b[1]/C[1];for(let R=0;R<f;R++)for(let O=0;O<h;O++){let F;i?F=$*(O+.5)-.5:F=$*O;const A=Math.max(0,Math.floor(F)),D=F-A,T=Math.min(m-1,Math.ceil(F)),z=R*u[0]+A*u[1],U=R*u[0]+T*u[1];for(let Q=0;Q<d;Q++){let q;i?q=N*(Q+.5)-.5:q=N*Q;const J=Math.max(0,Math.floor(q)),ne=q-J,B=Math.min(g-1,Math.ceil(q)),X=z+J*u[2],Y=U+J*u[2],L=z+B*u[2],W=U+B*u[2];for(let ie=0;ie<y;ie++){const ce=w[X+ie],he=w[Y+ie],fe=w[L+ie],we=w[W+ie],ve=ce+(fe-ce)*ne,be=he+(we-he)*ne,Fe=ve+(be-ve)*D;v[S++]=Fe}}}return t.makeTensorInfo([f,h,d,y],"float32",v)}const hU={kernelName:ef,backendName:"cpu",kernelFunc:cU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dU(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;Se([o,r],"resizeBilinearGrad");const l=Ae(r.shape),[u,h,d,f]=r.shape,[,m,g]=o.shape,y=new Float32Array(u*h*d*f),w=[i&&m>1?h-1:h,i&&g>1?d-1:d],v=[i&&m>1?m-1:m,i&&g>1?g-1:g],b=w[0]/v[0],C=w[1]/v[1],S=t.data.get(o.dataId).values;let $=0;for(let N=0;N<u;N++){const R=N*l[0];for(let O=0;O<m;O++){const F=O*b,A=Math.floor(F),D=Math.min(Math.ceil(F),h-1),T=R+A*l[1],z=R+D*l[1],U=F-A,Q=1-U;for(let q=0;q<g;q++){const J=q*C,ne=Math.floor(J),B=Math.min(Math.ceil(J),d-1),X=J-ne,Y=1-X,L=T+ne*l[2],W=T+B*l[2],ie=z+ne*l[2],ce=z+B*l[2],he=Q*Y,fe=Q*X,we=U*Y,ve=U*X;for(let be=0;be<f;be++){const Fe=S[$++];y[L+be]+=Fe*he,y[W+be]+=Fe*fe,y[ie+be]+=Fe*we,y[ce+be]+=Fe*ve}}}}return t.makeTensorInfo([u,d,h,f],"float32",y)}const fU={kernelName:Ix,backendName:"cpu",kernelFunc:dU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pU(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:l}=s;Se(r,"resizeNearestNeighbor");const u=Ae(r.shape),[h,d]=l,[f,m,g,y]=r.shape,w=t.data.get(r.dataId).values,v=new Float32Array(f*h*d*y),b=[o&&h>1?m-1:m,o&&d>1?g-1:g],C=[o&&h>1?h-1:h,o&&d>1?d-1:d],S=b[0]/C[0],$=b[1]/C[1];let N=0;for(let R=0;R<f;R++){const O=R*u[0];for(let F=0;F<h;F++){const A=i?S*(F+.5):S*F;let D=Math.min(m-1,o?Math.round(A):Math.floor(A));i&&(D=Math.max(0,D));const T=O+D*u[1];for(let z=0;z<d;z++){const U=i?$*(z+.5):$*z;let Q=Math.min(g-1,o?Math.round(U):Math.floor(U));i&&(Q=Math.max(0,Q));const q=T+Q*u[2];for(let J=0;J<y;J++){const ne=w[q+J];v[N++]=ne}}}}return t.makeTensorInfo([f,h,d,y],r.dtype,v)}const mU={kernelName:Jd,backendName:"cpu",kernelFunc:pU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gU(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;Se([o,r],"resizeNearestNeighborGrad");const l=Ae(r.shape),u=Ae(o.shape),[h,d,f,m]=r.shape,[,g,y]=o.shape,w=new Float32Array(h*d*f*m),v=t.data.get(o.dataId).values,b=[i&&g>1?d-1:d,i&&y>1?f-1:f],C=[i&&g>1?g-1:g,i&&y>1?y-1:y],S=b[0]/C[0],$=b[1]/C[1],N=1/S,R=1/$,O=Math.ceil(N)*2+2,F=Math.ceil(R)*2+2;for(let A=0;A<h;A++){const D=A*l[0];for(let T=0;T<d;T++){const z=D+T*l[1],U=Math.floor(T*N),Q=Math.floor(U-O/2);for(let q=0;q<f;q++){const J=z+q*l[2],ne=Math.floor(q*R),B=Math.floor(ne-F/2);for(let X=0;X<m;X++){let Y=0;for(let L=0;L<O;L++){const W=L+Q;if(W<0||W>=g)continue;const ie=D+W*u[1],ce=W*S,he=Math.min(d-1,i?Math.round(ce):Math.floor(ce));if(T===he)for(let fe=0;fe<F;fe++){const we=fe+B;if(we<0||we>=y)continue;const ve=ie+we*u[2],be=we*$,Fe=Math.min(f-1,i?Math.round(be):Math.floor(be));q===Fe&&(Y+=v[ve+X])}}w[J+X]=Y}}}}return t.makeTensorInfo(r.shape,r.dtype,w)}const xU={kernelName:Cx,backendName:"cpu",kernelFunc:gU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;Se(r,"reverse");const i=r.shape.length,l=je(o,r.shape);if(i===0)return gr({inputs:{x:r},backend:t});const u=new mn(r.shape,r.dtype),h=t.bufferSync(r);for(let d=0;d<u.size;d++){const f=u.indexToLoc(d),m=f.slice();l.forEach(g=>m[g]=r.shape[g]-1-m[g]),u.set(h.get(...m),...f)}return t.makeTensorInfo(u.shape,u.dtype,u.values)}const wU={kernelName:tf,backendName:"cpu",kernelFunc:yU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU={kernelName:Rx,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,l=t,u=ln(s.dtype,ue(s.shape)),[h,d,f,m]=s.shape,[g,y]=S0(i,d,f),w=255,v=Math.sin(r),b=Math.cos(r),C=l.data.get(s.dataId).values;for(let $=0;$<h;$++){const N=$*f*d*m;for(let R=0;R<d;R++){const O=R*(f*m);for(let F=0;F<f;F++){const A=F*m;for(let D=0;D<m;D++){const T=[h,R,F,D],z=T[2],U=T[1];let Q=(z-g)*b-(U-y)*v,q=(z-g)*v+(U-y)*b;Q=Math.round(Q+g),q=Math.round(q+y);let J=o;if(typeof o!="number"&&(D===3?J=w:J=o[D]),Q>=0&&Q<f&&q>=0&&q<d){const B=q*(f*m),X=Q*m,Y=N+B+X+D;J=C[Y]}const ne=N+O+A+D;u[ne]=J}}}}return{dataId:l.write(u,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU=lt(xu,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),kU={kernelName:xu,backendName:"cpu",kernelFunc:bU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CU(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:f}=Au(o,r,i),m=!0,g=t.bufferSync(r),y=t.bufferSync(o),w=Yi(g,y,i,f,h,u,l,d,0,m);return t.makeTensorInfo(i,w.dtype,w.values)}const IU={kernelName:$k,backendName:"cpu",kernelFunc:CU};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $U(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function SU(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function NU(n,e,t,s,r,o){const i=Jt("int32",t*r);for(let l=0;l<t;++l){const u=n.slice(l*s,(l+1)*s),h=l*r;for(let d=0;d<r;++d)i[h+d]=o==="left"?$U(u,e[d+h]):SU(u,e[d+h])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,h=NU(l,u,r.shape[0],r.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",h)}const EU={kernelName:Sk,backendName:"cpu",kernelFunc:TU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RU(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;Se([s,r,o],"select");const i=s.shape.length,l=t.data.get(s.dataId).values,u=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,d=Kn(r.dtype,o.dtype),f=gn(ue(r.shape),d);let m=0;const g=i===0||i>1||r.shape.length===1?1:ue(r.shape.slice(1));for(let y=0;y<l.length;y++)for(let w=0;w<g;w++)l[y]===1?f[m++]=u[y]:f[m++]=h[y];return t.makeTensorInfo(r.shape,d,f)}const DU={kernelName:nf,backendName:"cpu",kernelFunc:RU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU=If,FU=$f,_U=lt(wu,n=>n>=0?FU*n:AU*(Math.exp(n)-1)),OU={kernelName:wu,backendName:"cpu",kernelFunc:_U};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU=lt(ku,n=>n<0?-1:n>0?1:0),PU={kernelName:ku,backendName:"cpu",kernelFunc:LU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU=lt(vu,n=>Math.sin(n)),zU={kernelName:vu,backendName:"cpu",kernelFunc:MU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BU=lt(bu,n=>Math.sinh(n)),VU={kernelName:bu,backendName:"cpu",kernelFunc:BU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU=11920928955078125e-23,Db=Math.log(WU)+2,UU=lt(Iu,n=>{const e=n>-Db,t=n<Db,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),GU={kernelName:Iu,backendName:"cpu",kernelFunc:UU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;Se([r],"spaceToBatchND");const l=ue(o),u=[[0,0]];u.push(...i);for(let R=1+o.length;R<r.shape.length;++R)u.push([0,0]);const h=R2.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:u,constantValue:0}}),d=Pu(h.shape,o,l,!1),f=Mu(d.length,o.length,!1),m=zu(h.shape,o,l,!1),w=mt({inputs:{x:h},backend:t,attrs:{shape:d}}),C=Ln({inputs:{x:w},backend:t,attrs:{perm:f}}),N=mt({inputs:{x:C},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(C),N}const jU={kernelName:of,backendName:"cpu",kernelFunc:HU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KU(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const l=t.data.get(s.dataId).values,u=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values[0],[f,m,g,y,w]=s2(l,s.shape,s.dtype,u,r.dtype,h,d);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(v=>Number(v)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const qU={kernelName:Nk,backendName:"cpu",kernelFunc:KU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XU(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(r.dataId).values),l=t.data.get(s.dataId).values,u=Array.from(t.data.get(o.dataId).values),[h,d,f]=r2(l,s.shape,s.dtype,i,u);return[t.makeTensorInfo(d,s.dtype,h),t.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}const YU={kernelName:Tk,backendName:"cpu",kernelFunc:XU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QU(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,[h,d]=g1(i,s.shape,s.dtype,l,u,!0);return t.makeTensorInfo(d,s.dtype,h)}const ZU={kernelName:Ek,backendName:"cpu",kernelFunc:QU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JU(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,[h,d]=g1(i,s.shape,s.dtype,l,u);return t.makeTensorInfo(d,s.dtype,h)}const eG={kernelName:Rk,backendName:"cpu",kernelFunc:JU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:l}=s,{sliceRank:u,numUpdates:h,sliceSize:d,strides:f,outputSize:m}=Au(o,r,l),g=!1,y=t.bufferSync(r);let w;switch(o.dtype){case"bool":{const v=t.bufferSync(o),b=!!t.data.get(i.dataId).values[0];w=Yi(y,v,l,m,d,h,u,f,b,g);break}case"float32":{const v=t.bufferSync(o),b=t.data.get(i.dataId).values[0];w=Yi(y,v,l,m,d,h,u,f,b,g);break}case"int32":{const v=t.bufferSync(o),b=t.data.get(i.dataId).values[0];w=Yi(y,v,l,m,d,h,u,f,b,g);break}case"string":{const v=t.bufferSync(o),b=co(t.data.get(i.dataId).values[0]);w=Yi(y,v,l,m,d,h,u,f,b,g);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(l,w.dtype,w.values)}const nG={kernelName:Dk,backendName:"cpu",kernelFunc:tG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,l=je(i,r.shape)[0],u=V0(r,o,l),h=new Array(r.shape.length).fill(0),d=r.shape.slice();return u.map(f=>{const m=[...d];m[l]=f;const g=ci({inputs:{x:r},backend:t,attrs:{begin:h,size:m}});return h[l]+=f,g})}const rG={kernelName:af,backendName:"cpu",kernelFunc:sG};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:$x,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Se(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let l=0;l<r.length;++l){const u=r[l];o[l]=u*u}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG=lt(Du,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),aG={kernelName:Du,backendName:"cpu",kernelFunc:iG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:l,beginMask:u,endMask:h,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:m}=s;Se(r,"stridedSlice");const{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:v,isSimpleSlice:b,begin:C,end:S,strides:$}=Vx(r.shape,o,i,l,u,h,d,f,m);let N;if(w)N=mt({inputs:{x:r},backend:t,attrs:{shape:y}});else if(v||b){_(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const R=Mx(C,S,$),O=ci({inputs:{x:r},backend:t,attrs:{begin:C,size:R}});N=mt({inputs:{x:O},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(O)}else{const R=t.bufferSync(r),O=i2(g,R,$,C);N=t.makeTensorInfo(y,O.dtype,O.values)}return N}const uG={kernelName:Sx,backendName:"cpu",kernelFunc:lG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cG(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:l,padWidth:u,preserveShortSequences:h}=s,{data:d,dataSplits:f}=e,m=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[y,w]=a2(m,g,r,o,i,l,u,h);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(f.shape,"int32",w)]}const hG={kernelName:Ak,backendName:"cpu",kernelFunc:cG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const l=t.data.get(o.dataId).values,u=t.data.get(i.dataId).values[0],[h,d,f]=l2(l,u,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",h),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const fG={kernelName:Fk,backendName:"cpu",kernelFunc:dG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pG(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,l=u2(i,r);return t.makeTensorInfo(o.shape,"int32",l)}const mG={kernelName:_k,backendName:"cpu",kernelFunc:pG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG=lt(Tu,n=>Math.tan(n)),xG={kernelName:Tu,backendName:"cpu",kernelFunc:gG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yG=lt(Eu,n=>Math.tanh(n)),wG={kernelName:Eu,backendName:"cpu",kernelFunc:yG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;Se(r,"tile");const i=h2(t.bufferSync(r),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const bG={kernelName:Ru,backendName:"cpu",kernelFunc:vG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s;Se(r,"topk");const l=t.data.get(r.dataId).values,[u,h]=f2(l,r.shape,r.dtype,o,i);return[t.makeTensorInfo(u.shape,u.dtype,u.values),t.makeTensorInfo(h.shape,h.dtype,h.values)]}const CG={kernelName:Nx,backendName:"cpu",kernelFunc:kG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IG(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:l,fillValue:u,outputShape:h}=t,[d,f,m,g]=r.shape,[y,w]=h??[f,m],v=[d,y,w,g],b=Ae(r.shape),C=b[0],S=b[1],$=b[2],N=Ae(v),R=N[0],O=N[1],F=N[2],A=ln(r.dtype,ue(v));A.fill(u);const D=s.data.get(r.dataId).values,T=s.data.get(o.dataId).values;for(let U=0;U<d;++U){const Q=o.shape[0]===1?T:T.subarray(U*8,U*8+8);for(let q=0;q<y;++q)for(let J=0;J<w;++J)for(let ne=0;ne<g;++ne){let B;const X=Q[6]*J+Q[7]*q+1;if(X===0)continue;const Y=(Q[0]*J+Q[1]*q+Q[2])/X,L=(Q[3]*J+Q[4]*q+Q[5])/X,W=Ab(Y,m,l),ie=Ab(L,f,l);switch(i){case"nearest":B=RG(D,f,m,C,S,$,U,ie,W,ne,u);break;case"bilinear":B=DG(D,f,m,C,S,$,U,ie,W,ne,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const ce=U*R+q*O+J*F+ne;A[ce]=B}return s.makeTensorInfo(v,r.dtype,A)}return{dataId:s.write(A,v,r.dtype),shape:r.shape,dtype:r.dtype}}const $G={kernelName:Tx,backendName:"cpu",kernelFunc:IG};function Ab(n,e,t){switch(t){case"reflect":return SG(n,e);case"wrap":return NG(n,e);case"nearest":return EG(n,e);case"constant":default:return TG(n)}}function SG(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Jo(0,t,e-1)}function NG(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Jo(0,t,e-1)}function TG(n,e){return n}function EG(n,e){return Jo(0,n,e-1)}function kl(n,e,t,s,r,o,i,l,u,h,d){const f=i*s+l*r+u*o+h;return 0<=l&&l<e&&0<=u&&u<t?n[f]:d}function RG(n,e,t,s,r,o,i,l,u,h,d){const f=Math.round(l),m=Math.round(u);return kl(n,e,t,s,r,o,i,f,m,h,d)}function DG(n,e,t,s,r,o,i,l,u,h,d){const f=Math.floor(l),m=Math.floor(u),g=f+1,y=m+1,w=(y-u)*kl(n,e,t,s,r,o,i,f,m,h,d)+(u-m)*kl(n,e,t,s,r,o,i,f,y,h,d),v=(y-u)*kl(n,e,t,s,r,o,i,g,m,h,d)+(u-m)*kl(n,e,t,s,r,o,i,g,y,h,d);return(g-l)*w+(l-f)*v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AG(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Se(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:l,outputShape:u,indices:h}=p2(i,r,o.shape,o.dtype);return[s.makeTensorInfo(u,o.dtype,l),s.makeTensorInfo([h.length],"int32",h)]}const FG={kernelName:Ex,backendName:"cpu",kernelFunc:AG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _G(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,l=r.shape[o],u=new Array(i-1);let h=0;for(let g=0;g<i;g++)g!==o&&(u[h++]=r.shape[g]);const d=new Array(i).fill(0),f=r.shape.slice();f[o]=1;const m=new Array(l);for(let g=0;g<m.length;g++){d[o]=g;const y=ci({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});m[g]=mt({inputs:{x:y},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(y)}return m}const OG={kernelName:uf,backendName:"cpu",kernelFunc:_G};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s;Se(r,"unsortedSegmentSum");const l=r.shape.length,u=o.shape.length,h=[],d=[],f=l-u;let m=o;for(let y=0;y<f;++y){const w=od({inputs:{input:m},backend:t,attrs:{dim:y+1}});m=w,d.push(w)}for(let y=0;y<i;++y){const w=yo(y,"int32"),v=t.makeTensorInfo([],"int32",w),b=AS({inputs:{a:v,b:m},backend:t}),C=go({inputs:{x:b},backend:t,attrs:{dtype:"float32"}}),S=Pf({inputs:{a:C,b:r},backend:t}),$=Xu({inputs:{x:S},backend:t,attrs:{axis:0,keepDims:!1}});h.push($),d.push(v),d.push(b),d.push(C),d.push(S),d.push($)}const g=E2({inputs:h,backend:t,attrs:{axis:0}});return d.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const PG={kernelName:cf,backendName:"cpu",kernelFunc:LG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG=[O4,bz,P4,z4,Nz,V4,U4,H4,K4,X4,Q4,J4,tB,rB,iB,uB,hB,fB,mB,F4,xB,wB,bB,CB,$z,Ez,$B,kz,NB,EB,RB,AB,_B,LB,MB,BB,WB,GB,jB,qB,YB,ZB,eV,tV,sV,oV,aV,lV,uV,cV,fV,S4,mV,Rz,CV,Dz,IV,Fz,RV,DV,FV,Oz,LV,MV,BV,WV,GV,Pz,zz,Cz,jV,TB,qV,YV,ZV,N4,Vz,Uz,eW,Hz,nW,oW,aW,cW,dW,pW,mW,Kz,xW,wW,bW,CW,$W,NW,EW,Xz,DW,_W,PW,Qz,Jz,BW,UW,jW,t4,qW,YW,QW,R2,tU,E4,r4,sU,oU,aU,Iz,Lg,uU,R4,D4,A4,hU,fU,mU,xU,wU,vU,kU,d4,IU,EU,DU,OU,p4,PU,zU,VU,m4,OW,GU,jU,qU,YU,ZU,eG,nG,rG,y4,oG,v4,aG,uG,hG,fG,mG,I4,hV,xG,wG,bG,CG,$G,n4,FG,OG,PG,XW];for(const n of MG)Lk(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jo={},yh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function zG(n,e){jo[n]=e}function qs(n,e){if(!(n in jo)||e!=null){const s=VG(n,e);if(s!==null)jo[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=jo[n];return t==null||t.isContextLost()?(delete jo[n],qs(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),jo[n])}function BG(n){if(typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function VG(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??BG(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete jo[n]},!1),ae().getBool("SOFTWARE_WEBGL_ENABLED")&&(yh.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",yh)||t.getContext("experimental-webgl",yh):t.getContext("webgl2",yh)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Dl;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Dl||(Dl={}));var as;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(as||(as={}));var an;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(an||(an={}));function Yu(n,e){return[e,n]}function WG(n,e){return n*e}function wh(n){const e=ue(n),t=Math.ceil(e/4);return sg(t)}function $a(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function UG(n,e){const[t,s]=$a(n,e);return t*s*4}function b1(n,e){const t=n;let s,r,o,i,l,u,h,d,f,m;return ae().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,i=t.RGBA32F,l=t.RED,h=4,d=1,f=t.HALF_FLOAT,m=t.FLOAT,u=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=t.RGBA,l=n.RGBA,h=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,m=n.FLOAT,u=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:l,downloadTextureFormat:u,downloadUnpackNumChannels:h,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:m}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ne(n,e){const t=e();return ae().getBool("DEBUG")&&GG(n),t}function GG(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+qG(n,e))}const HG=596e-10,jG=65504;function KG(n){return!!(ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||HG<Math.abs(n)&&Math.abs(n)<jG)}function qG(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function vh(n,e){return Lr(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function XG(n,e){const t=Lr(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ne(n,()=>n.shaderSource(t,e)),Ne(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function YG(n,e){const t=Lr(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ne(n,()=>n.shaderSource(t,e)),Ne(n,()=>n.compileShader(t)),ae().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw D2(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const QG=/ERROR: [0-9]+:([0-9]+):/g;function D2(n,e){const t=QG.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((f,m)=>Qi((m+1).toString(),o)+f);let l=0;for(let f=0;f<i.length;f++)l=Math.max(i[f].length,l);const u=i.slice(0,s-1),h=i.slice(s-1,s),d=i.slice(s);console.log(u.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Qi(h[0],l)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function ZG(n){return Lr(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function JG(n,e){if(Ne(n,()=>n.linkProgram(e)),!ae().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Ym(n,e){if(Ne(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function eH(n,e){const t=Lr(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ne(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Ne(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function tH(n,e){const t=Lr(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ne(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Ne(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function nH(n){return Lr(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function sH(n,e){const t=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function rH(n){return Lr(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Fb(n,e,t,s,r,o,i){const l=n.getAttribLocation(e,t);return l===-1?!1:(Ne(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Ne(n,()=>n.vertexAttribPointer(l,r,n.FLOAT,!1,o,i)),Ne(n,()=>n.enableVertexAttribArray(l)),!0)}function oH(n,e,t){cH(n,t),Ne(n,()=>n.activeTexture(n.TEXTURE0+t)),Ne(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function iH(n,e,t){return Lr(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function aH(n,e,t){return n.getUniformLocation(e,t)}function lH(n,e,t,s){Ne(n,()=>oH(n,e,s)),Ne(n,()=>n.uniform1i(t,s))}function Qm(n,e,t){Ne(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Ne(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function _b(n,e){Ne(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Ne(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function bh(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+uH(n,e))}function uH(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Lr(n,e,t){const s=Ne(n,()=>e());if(s==null)throw new Error(t);return s}function cH(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function fa(n,e=2){return ue(n.slice(0,n.length-e))}function pa(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Zm(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[fa(n),...pa(n)]),e}function hH(n,e=!1){let t=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ae().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ae().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((l,u)=>u>=n.length-2?Gg(n[u]):n[u]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=xo(n).newShape);let r=ue(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const l=fa(n);let u=2,h=2;n.length&&([u,h]=pa(n)),r=l*(u/2)*(h/2),o=sg(r).map(d=>d*2)}else o=sg(r);return o}function kh(n){return n%2===0}function ad(n,e){if(n=n.slice(-2),e=e.slice(-2),ot(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n.slice(-1)[0],s=e.slice(-1)[0];if(t===s||kh(t)&&kh(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&kh(n[0])&&kh(e[0])}let Jm,eg;function dH(n){if(Jm==null){const e=qs(n);Jm=e.getParameter(e.MAX_TEXTURE_SIZE)}return Jm}function fH(n){if(eg==null){const e=qs(n);eg=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,eg)}function pH(n){if(n===0)return 0;let e;const t=qs(n);return $s(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:$s(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function $s(n,e){return n.getExtension(e)!=null}function Ob(n){try{if(qs(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function mH(n){if(n===0)return!1;const e=qs(n);if(n===1){if(!$s(e,"OES_texture_float"))return!1}else if(!$s(e,"EXT_color_buffer_float"))return!1;return Mg(e)}function gH(n){if(n===0)return!1;const e=qs(n);if(n===1){if(!$s(e,"OES_texture_float")||!$s(e,"WEBGL_color_buffer_float"))return!1}else{if($s(e,"EXT_color_buffer_float"))return Mg(e);const s="EXT_color_buffer_half_float";if($s(e,s)){const r=e.getExtension(s);return xH(e,r)}return!1}return Mg(e)}function Mg(n){const e=b1(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function xH(n,e){const t=b1(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const l=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),l}function yH(n){return n!==2?!1:qs(n).fenceSync!=null}function Qu(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&_(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Re=ae();Re.registerFlag("HAS_WEBGL",()=>Re.getNumber("WEBGL_VERSION")>0);Re.registerFlag("WEBGL_VERSION",()=>Ob(2)?2:Ob(1)?1:0);Re.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Re.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Re.get("WEBGL_VERSION")===2);Re.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Re.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Re.registerFlag("WEBGL_PACK",()=>Re.getBool("HAS_WEBGL"));Re.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_PACK_CLIP",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_PACK_REDUCE",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_LAZILY_UNPACK",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_CONV_IM2COL",()=>Re.getBool("WEBGL_PACK"));Re.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>dH(Re.getNumber("WEBGL_VERSION")));Re.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>fH(Re.getNumber("WEBGL_VERSION")));Re.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Re.getNumber("WEBGL_VERSION");return n===0?0:pH(n)});Re.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Re.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!jk());Re.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>mH(Re.getNumber("WEBGL_VERSION")));Re.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Re.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Re.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Re.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>gH(Re.getNumber("WEBGL_VERSION")));Re.registerFlag("WEBGL_FENCE_API_ENABLED",()=>yH(Re.getNumber("WEBGL_VERSION")));Re.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Re.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Re.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Re.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>jk()?1:-1,n=>{if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Re.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Re.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Re.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Re.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Re.registerFlag("WEBGL_EXP_CONV",()=>!1);Re.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Re.getBool("IS_TEST"));Re.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Re.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Re.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tn(){let n,e,t,s,r,o,i,l,u,h;return ae().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",l=ae().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",i="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:l,defineSpecialInf:u,defineRound:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gi(n,e,t="index"){const s=Ae(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / ${r}`,l=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${l};`}).join("")}function Mf(n,e,t="index"){const s=Ae(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,l=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${l};`}).join("")}function wH(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function vH(n,e,t="index"){const s=n.map((o,i)=>i),r=wH(s,e);return r.map((o,i)=>{const l=`int ${n[i]} = ${t} / ${r[i]}`,u=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${l}; ${u};`}).join("")}function k1(n){const e=Ae(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function C1(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const A2=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:F2}=b3;function bH(n,e,t){const s=[];if(n.forEach(g=>{const y=ue(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${y>1?`[${y}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:w}=I1(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(w.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(g=>kH(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,l=Tn(),u=$H(l);let h,d,f=TH(l);return e.isPacked?(h=CH(e.logicalShape,i,t.enableShapeUniforms),d=NH(l)):(h=IH(e.logicalShape,i,t.enableShapeUniforms),d=SH(l)),t.packedInputs&&(f+=AH),[f,u,d,r,h,o,t.userCode].join(`
`)}function Sa(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return GH(n,e);case 1:return jH(n,e);case 2:return qH(n,e);case 3:return YH(n,e);case 4:return ZH(n,e);case 5:return JH(n);case 6:return e6(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function _2(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return UH(n);case 1:return HH(n,e);case 2:return KH(n,e);case 3:return XH(n,e);default:return QH(n,e)}}function kH(n,e,t=!1,s){let r="";t?r+=_2(n,s):r+=Sa(n,s);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?r+=t6(n,e):r+=n6(n,e)),r}function CH(n,e,t){switch(n.length){case 0:return O2();case 1:return FH(n,e,t);case 2:return VH(n,e,t);case 3:return OH(n,e,t);default:return PH(n,e,t)}}function IH(n,e,t){switch(n.length){case 0:return O2();case 1:return _H(n,e,t);case 2:return WH(n,e,t);case 3:return LH(n,e,t);case 4:return MH(n,e,t);case 5:return zH(n,e);case 6:return BH(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function $H(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function SH(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function NH(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function TH(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${EH}
    ${RH}
    ${DH}
  `}const EH=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,RH=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,DH=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,AH=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function O2(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function FH(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function _H(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function OH(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function LH(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Mf(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=gi(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function PH(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,l="",u="b, r, c";for(let h=2;h<n.length-1;h++)i*=n[n.length-h-1],l=`
      int b${h} = index / ${i};
      index -= b${h} * ${i};
    `+l,u=`b${h}, `+u;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${l}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${u});
    }
  `}function MH(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Mf(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=gi(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function zH(n,e){const t=gi(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function BH(n,e){const t=gi(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function VH(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(ot(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function WH(n,e,t){return ot(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function xi(n){return`offset${n}`}function UH(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Tn();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function GH(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=xi(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[l,u]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${l}, ${u}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function HH(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=Tn();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function jH(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Na(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const l=xi(t);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${l});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${l});
      return sampleTexture(${t}, uv);
    }
  `}function KH(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],l=o[1],u=Tn();if(o!=null&&ot(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${u.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${l}.0, ${i}.0);

        return ${u.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${s}, uv);
    }
  `;const h=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${h[0]}, ${h[1]}, row, col);
      return ${u.texture2D}(${s}, uv);
    }
  `}function qH(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&ot(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const m=o[0],g=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${m}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:l}=xo(t),u=i;if(u.length<t.length){const m=Ta(n,u),g=["row","col"];return`
      ${Sa(m,e)}
      float ${r}(int row, int col) {
        return ${r}(${Ea(g,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Na(n)}
      }
    `;const h=o[0],d=o[1],f=xi(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `:h===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${h}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function XH(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const m=t.slice(1),g=[1,2],y=Ta(n,m),w=["b","row","col"];return`
        ${_2(y,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Ea(w,g)});
        }
      `}const l=Tn();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=i[0],h=i[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${h}, ${f}, ${d}, b, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function YH(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],i=t[2],{newShape:l,keptDims:u}=xo(t),h=l;if(h.length<t.length){const w=Ta(n,h),v=["row","col","depth"];return`
        ${Sa(w,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Ea(v,u)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Na(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],m=d[1],g=n.shapeInfo.flatOffset;if(m===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(m===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const y=xi(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${y};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${y};
        vec2 uv = uvFromFlat(${f}, ${m}, index);
        return sampleTexture(${s}, uv);
      }
  `}function QH(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Tn();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,l=n.shapeInfo.texShape,u=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=u[0],d=u[1],f=Math.ceil(o[i-1]/2);let m=f*Math.ceil(o[i-2]/2),g="int b, int row, int col",y=`b * ${m} + (row / 2) * ${f} + (col / 2)`;for(let w=2;w<i-1;w++)g=`int b${w}, `+g,m*=o[i-w-1],y=`b${w} * ${m} + `+y;return`
    vec4 ${s}(${g}) {
      int index = ${y};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${h});
      return ${r.texture2D}(${t}, uv);
    }
  `}function ZH(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],i=t[2]*o,l=t[1]*i,{newShape:u,keptDims:h}=xo(t);if(u.length<t.length){const C=Ta(n,u),S=["row","col","depth","depth2"];return`
      ${Sa(C,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Ea(S,h)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${l}, ${i}, ${o}, 1)));
        ${Na(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],g=f[1],y=`int stride2 = ${s}Shape[3];`,w=`int stride1 = ${s}Shape[2] * stride2;`,v=`int stride0 = ${s}Shape[1] * stride1;`;if(g===l&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${y}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===o&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;const b=xi(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${y}
      ${w}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${b});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${m}, ${g}, index + ${b});
      return sampleTexture(${s}, uv);
    }
  `}function JH(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,l=e[1]*i,{newShape:u,keptDims:h}=xo(e);if(u.length<e.length){const w=Ta(n,u),v=["row","col","depth","depth2","depth3"];return`
      ${Sa(w)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Ea(v,h)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${l}, ${i}, ${o}, ${r})) +
          depth3;
        ${Na(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],g=f[1];if(g===l&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=xi(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${y};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function e6(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=xo(e);if(r.length<e.length){const v=Ta(n,r),b=["row","col","depth","depth2","depth3","depth4"];return`
      ${Sa(v)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Ea(b,o)});
      }
    `}const i=e[5],l=e[4]*i,u=e[3]*l,h=e[2]*u,d=e[1]*h;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${h}, ${u}, ${l})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Na(n)}
      }
    `;const f=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,g=m[0],y=m[1];if(y===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${h}, ${u}, ${l}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(y===i&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=xi(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${h} + depth * ${u} +
          depth2 * ${l} + depth3 * ${i} + depth4 + ${w};
      vec2 uv = uvFromFlat(${g}, ${y}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Na(n){const e=n.name,t=ue(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function t6(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,l=F2(n.shapeInfo.logicalShape,e.logicalShape),u=gt(i),h=i-o;let d;const f=["x","y","z","w","u","v"];o===0?d="":i<2&&l.length>=1?d="coords = 0;":d=l.map(C=>`coords.${f[C+h]} = 0;`).join(`
`);let m="";i<2&&o>0?m="coords":m=n.shapeInfo.logicalShape.map((C,S)=>`coords.${f[S+h]}`).join(", ");let g="return outputValue;";const w=ue(n.shapeInfo.logicalShape)===1,b=ue(e.logicalShape)===1;if(o===1&&!w&&!b)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!b)i===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(l.length){const C=o-2,S=o-1;l.indexOf(C)>-1&&l.indexOf(S)>-1?g="return vec4(outputValue.x);":l.indexOf(C)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(S)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${u} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${m});
      ${g}
    }
  `}function n6(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,l=n.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!n.shapeInfo.isUniform&&l===u&&n.shapeInfo.flatOffset==null&&ot(i,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const h=gt(u),d=F2(n.shapeInfo.logicalShape,e.logicalShape),f=u-l;let m;const g=["x","y","z","w","u","v"];l===0?m="":u<2&&d.length>=1?m="coords = 0;":m=d.map(w=>`coords.${g[w+f]} = 0;`).join(`
`);let y="";return u<2&&l>0?y="coords":y=n.shapeInfo.logicalShape.map((w,v)=>`coords.${g[v+f]}`).join(", "),`
    float ${r}() {
      ${h} coords = getOutputCoords();
      ${m}
      return get${s}(${y});
    }
  `}function gt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function I1(n,e,t){const{newShape:s,keptDims:r}=xo(e),o=e.length,i=n&&o===3&&e[0]===1,l=i?e.slice(1):s,u=!n&&o>1&&!ot(e,t)&&s.length<o||i;return{useSqueezeShape:u,uniformShape:u?l:e,keptDims:r}}function Ta(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Ea(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6(n,e,t,s){const r=t.map((d,f)=>{const m={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(m.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:m}}),o=r.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},l=bH(r,i,e),u=YG(n.gl,l),h=n.createProgram(u);return ae().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:l,webGLProgram:h,inShapeInfos:o,outShapeInfo:i,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:l,webGLProgram:h,inShapeInfos:o,outShapeInfo:i},L2(n,e,h))}function L2(n,e,t){const s={},r={},o={},i=[];let l,u,h,d=null,f=null;f=n.getUniformLocation(t,"NAN",!1),ae().getNumber("WEBGL_VERSION")===1&&(d=n.getUniformLocation(t,"INFINITY",!1));const m=!1;for(let g=0;g<e.variableNames.length;g++){const y=e.variableNames[g];s[y]=n.getUniformLocation(t,y,m),s[`offset${y}`]=n.getUniformLocation(t,`offset${y}`,m),e.enableShapeUniforms&&(r[`${y}Shape`]=n.getUniformLocation(t,`${y}Shape`,m),o[`${y}TexShape`]=n.getUniformLocation(t,`${y}TexShape`,m))}return e.enableShapeUniforms&&(l=n.getUniformLocation(t,"outShape",m),h=n.getUniformLocation(t,"outShapeStrides",m),u=n.getUniformLocation(t,"outTexShape",m)),e.customUniforms&&e.customUniforms.forEach((g,y)=>{i[y]=n.getUniformLocation(t,g.name,m)}),{uniformLocations:s,customUniformLocations:i,infLoc:d,nanLoc:f,inShapesLocations:r,inTexShapesLocations:o,outShapeLocation:l,outShapeStridesLocation:h,outTexShapeLocation:u}}function Lb(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],i=o.shape;if(!ot(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const l=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!ot(l,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${l} and ${u} must match`)})}function r6(n,e,t,s,r){e.program.enableShapeUniforms||(Lb(e.inShapeInfos,t),Lb([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),ae().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN),t.forEach((u,h)=>{const d=e.program.variableNames[h],f=e.uniformLocations[d],m=e.uniformLocations[`offset${d}`],g=e.inShapesLocations[`${d}Shape`],y=e.inTexShapesLocations[`${d}TexShape`];if(g){const{uniformShape:w}=I1(e.program.packedInputs,u.shape,u.texData.texShape);switch(w.length){case 1:n.gl.uniform1iv(g,new Int32Array(w));break;case 2:n.gl.uniform2iv(g,new Int32Array(w));break;case 3:n.gl.uniform3iv(g,new Int32Array(w));break;case 4:n.gl.uniform4iv(g,new Int32Array(w));break}}if(y&&n.gl.uniform2i(y,u.texData.texShape[0],u.texData.texShape[1]),f!=null){if(u.isUniform){if(ue(u.shape)<2)n.gl.uniform1f(f,u.uniformValues[0]);else{let w=u.uniformValues;w instanceof Float32Array||(w=new Float32Array(w)),n.gl.uniform1fv(f,w)}return}u.texData.slice!=null&&m!=null&&n.gl.uniform1i(m,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,f,h)}});const l=e.outShapeLocation;if(l)switch(s.shape.length){case 1:n.gl.uniform1iv(l,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(l,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(l,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(l,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const u=Ae(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r&&e.program.customUniforms.forEach((u,h)=>{const d=e.customUniformLocations[h],f=r[h];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}),n.executeProgram()}function o6(n,e,t){let s="";e.concat(t).forEach(i=>{const l=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const u=i.texData.texShape,{useSqueezeShape:h,uniformShape:d,keptDims:f}=I1(n.packedInputs,i.shape,u);let m="",g="",y="";if(d.length===1&&n.packedInputs){const N=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];m=`${N[0]>1}_${N[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const N=Ae(d);y=`${N[0]===u[1]}_${N[N.length-1]===u[1]}`}const w=i.shape.length,v=d.length===2&&ot(i.shape,u),b=ue(i.shape)===1,C=oa(i.shape,t.shape),S=!n.packedInputs&&w===t.shape.length&&ot(u,t.texData.texShape),$=n.packedInputs||d.length>2?"":`${u[0]>1}_${u[1]>1}`;s+=`${w}_${S}_${h?f:""}_${d.length}_${b}_${C}_${v}_${m}_${g}_${y}_${$}_${l}`}else{const u=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${u}_${l}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${ae().getNumber("WEBGL_VERSION")}`,o}function En(n){return ae().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i6{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Dl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Tn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Mf(["r","c","d"],e):gi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a6{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Dl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Tn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Mf(["r","c","d"],e):gi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l6{constructor(e){this.variableNames=["A"],this.outTexUsage=as.DOWNLOAD;const t=Tn();this.outputShape=e,this.userCode=`
      ${A2}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u6{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=as.DOWNLOAD;const t=Tn();this.outputShape=e,this.userCode=`
      ${A2}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c6{constructor(e,t=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Tn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);let r="result";t&&(r="floor(result * 255. + 0.5)"),this.userCode=`
      ${this.enableShapeUniforms?C1():k1(e)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = ${s.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${s.output} = vec4(${r}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h6{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Tn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let l=0;l<=1;l++){const u=i*2+l;r+=`
          localCoords = coords;
          if(localCoords[2] + ${l} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${l};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?C1():k1(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(n){const e=Tn(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return XG(n,t)}function f6(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return eH(n,e)}function p6(n){const e=new Uint16Array([0,1,2,2,1,3]);return tH(n,e)}function Zu(n,e,t,s,r,o){sH(e,t);const i=nH(n),l=n.TEXTURE_2D;return Ne(n,()=>n.bindTexture(l,i)),Ne(n,()=>n.texParameteri(l,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Ne(n,()=>n.texParameteri(l,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Ne(n,()=>n.texParameteri(l,n.TEXTURE_MIN_FILTER,n.NEAREST)),Ne(n,()=>n.texParameteri(l,n.TEXTURE_MAG_FILTER,n.NEAREST)),ae().getNumber("WEBGL_VERSION")===1?Ne(n,()=>n.texImage2D(l,0,s,e,t,0,r,o,null)):Ne(n,()=>n.texStorage2D(l,1,s,e,t)),Ne(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function P2(n){return n.internalFormatFloat}function m6(n,e,t,s){const[r,o]=Yu(e,t);return Zu(n,r,o,P2(s),s.textureFormatFloat,n.FLOAT)}function M2(n){return n.internalFormatHalfFloat}function g6(n,e,t,s){const[r,o]=Yu(e,t);return Zu(n,r,o,M2(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function z2(n){return n.downloadTextureFormat}function x6(n,e,t,s){const[r,o]=Yu(e,t);return Zu(n,r,o,z2(s),n.RGBA,n.UNSIGNED_BYTE)}function B2(n){return n.internalFormatPackedFloat}function y6(n,e,t,s){const[r,o]=$a(e,t);return Zu(n,r,o,B2(s),n.RGBA,n.FLOAT)}function V2(n){return n.internalFormatPackedHalfFloat}function w6(n,e,t,s){const[r,o]=$a(e,t);return Zu(n,r,o,V2(s),n.RGBA,s.textureTypeHalfFloat)}function v6(n,e,t){return Ne(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Fb(n,e,"clipSpacePos",t,3,20,0)&&Fb(n,e,"uv",t,2,20,12)}function b6(n,e,t,s,r,o){Ne(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,l,u;r instanceof Uint8Array?(i=new Uint8Array(t*s*4),l=n.UNSIGNED_BYTE,u=n.RGBA):(i=new Float32Array(t*s*4),l=n.FLOAT,u=o.internalFormatPackedFloat),i.set(r),ae().getNumber("WEBGL_VERSION")===2?Ne(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,l,i)):Ne(n,()=>n.texImage2D(n.TEXTURE_2D,0,u,t,s,0,n.RGBA,l,i)),Ne(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function k6(n,e,t){Ne(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?ae().getNumber("WEBGL_VERSION")===2?Ne(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Ne(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):ae().getNumber("WEBGL_VERSION")===2?Ne(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Ne(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Ne(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function C6(n,e,t,s){const r=n.createBuffer();Ne(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const l=4*4*e*t;return Ne(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,l,n.STREAM_READ)),Ne(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Ne(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function I6(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function $6(n,e,t,s){const[r,o]=Yu(e,t),i=4,l=new Uint8Array(WG(e*t,i));return Ne(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,l)),new Float32Array(l.buffer)}function S6(n,e,t,s,r,o,i,l){const u=n,h=new Float32Array(UG(o,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,h),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),h}function N6(n,e,t){const s=new Float32Array(e*t*4);return Ne(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tg{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=ae().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,zG(t,e)):this.gl=qs(t);let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ae().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=vh(this.gl,o),$s(this.gl,i))this.textureHalfFloatExtension=vh(this.gl,i);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),$s(this.gl,r))this.colorBufferHalfFloatExtension=vh(this.gl,r);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",$s(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if($s(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=f6(this.gl),this.indexBuffer=p6(this.gl),this.framebuffer=rH(this.gl),this.textureConfig=b1(this.gl,this.textureHalfFloatExtension)}get debug(){return ae().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ne(e,()=>e.finish()),Ne(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ne(e,()=>e.deleteFramebuffer(this.framebuffer)),Ne(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ne(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ne(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),m6(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),g6(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),x6(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),k6(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),b6(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),w6(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),y6(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(_b(this.gl,this.framebuffer),this.outputTexture=null),Ne(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>$6(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,i){return S6(this.gl,e,t,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return I6(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=C6(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(ae().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},t=o}else ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>N6(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=d6(t));const s=ZG(t);return Ne(t,()=>t.attachShader(s,this.vertexShader)),Ne(t,()=>t.attachShader(s,e)),JG(t,s),this.debug&&Ym(t,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=v6(t,this.program,this.vertexBuffer)),s}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Ne(this.gl,()=>this.gl.deleteProgram(e))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Ym(this.gl,this.program),Ne(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?iH(this.gl,e,t):aH(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Ne(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),lH(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=$a(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Ym(this.gl,this.program),bh(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),Ne(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ne(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=vh(this.gl,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await bv(()=>this.disposed||this.isQueryAvailable(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=T6(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ae().platform&&(s=ae().platform.setTimeoutCustom.bind(ae().platform)),bv(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Qm(this.gl,e,this.framebuffer),this.debug&&bh(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Qm(this.gl,this.outputTexture,this.framebuffer),this.debug&&bh(this.gl)):_b(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;Qm(r,e,this.framebuffer),this.debug&&bh(r),this.outputTexture=e,Ne(r,()=>r.viewport(0,0,t,s)),Ne(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Ne(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function T6(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:E6,bincountImpl:W2,bincountReduceImpl:R6,castImpl:D6,ceilImpl:A6,concatImpl:F6,equalImpl:_6,expImpl:O6,expm1Impl:L6,floorImpl:P6,gatherNdImpl:M6,gatherV2Impl:z6,greaterImpl:B6,greaterEqualImpl:V6,lessImpl:W6,lessEqualImpl:U6,linSpaceImpl:G6,logImpl:H6,maxImpl:j6,maximumImpl:K6,minimumImpl:q6,multiplyImpl:X6,negImpl:Y6,notEqualImpl:Q6,prodImpl:Z6,raggedGatherImpl:J6,raggedTensorToTensorImpl:ej,rangeImpl:tj,rsqrtImpl:nj,scatterImpl:sj,sigmoidImpl:rj,simpleAbsImpl:U2,sliceImpl:oj,sparseFillEmptyRowsImpl:ij,sparseReshapeImpl:aj,sparseSegmentReductionImpl:G2,sqrtImpl:lj,stridedSliceImpl:uj,stringNGramsImpl:cj,stringSplitImpl:hj,stringToHashBucketFastImpl:dj,subImpl:fj,tileImpl:pj,topKImpl:mj,transposeImpl:$1,uniqueImpl:gj}=$4;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H2(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function $n(n,e){return e===1?[n]:H2(n,e)}function xj(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yj{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=En(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=$n("rc",this.rank),s=gt(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j2{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${wj(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?C1():k1(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function wj(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?vH(["r","c","d"],"inputShape"):gi(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vj{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,s){const r=Mb(t,s),o=zb(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=Pb(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const u=this.freeTextures[o].shift();return this.usedTextures[o].push(u),u}let l;return r===an.PACKED_2X2_FLOAT32?l=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===an.PACKED_2X2_FLOAT16?l=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===an.UNPACKED_FLOAT32?l=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===an.UNPACKED_FLOAT16?l=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===an.PACKED_4X1_UNSIGNED_BYTE&&(l=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(l),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),l}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=Mb(s,r),i=zb(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const l=Pb(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),u=ae().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=l):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=l),this.numUsedTextures--;const h=this.usedTextures[i],d=h.indexOf(e);if(d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");h.splice(d,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function bj(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function Pb(n,e,t,s,r){const o=kj(e,s);let i;if(r){const[u,h]=$a(n[0],n[1]);i=u*h}else{const[u,h]=Yu(n[0],n[1]);i=u*h}const l=bj(t,o);return i*l}function kj(n,e){switch(n){case an.PACKED_2X2_FLOAT32:return B2(e);case an.PACKED_2X2_FLOAT16:return V2(e);case an.UNPACKED_FLOAT32:return P2(e);case an.UNPACKED_FLOAT16:return M2(e);case an.PACKED_4X1_UNSIGNED_BYTE:return z2(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function Cj(n){return ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?an.PACKED_2X2_FLOAT32:an.UNPACKED_FLOAT32:n?an.PACKED_2X2_FLOAT16:an.UNPACKED_FLOAT16}function Mb(n,e){if(n===as.UPLOAD)return an.PACKED_2X2_FLOAT32;if(n===as.RENDER||n==null)return Cj(e);if(n===as.DOWNLOAD||n===as.PIXELS)return an.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function zb(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rr{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Rs="if (isnan(x)) return x;",Ij="return x;",Bb="return abs(x);",$j="return (x >= 0.0) ? x : (exp(x) - 1.0);",Sj=Rs+`
  return (x < 0.0) ? 0.0 : x;
`,Nj=Rs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Hi="return x;",Tj="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ej="return x;",Rj=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Dj=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Aj=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Fj="return 1.0 / (1.0 + exp(-1.0 * x));";class qo{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _j{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);const t=e.length,s=$n("rc",t),r=gt(t),o=xj(t,s),i=s.slice(-2),l=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${l}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oj=WC,Lj=1e-7,Pj=1e-4,Ch={};function Mj(n){return n in Ch||(Ch[n]={}),Ch[n]}const zj=ae().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Bj=600;function Vj(){return ae().global.screen==null?1024:ae().global.screen.height*ae().global.screen.width*window.devicePixelRatio*Bj/1024/1024}class zf extends Ug{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ae().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof tg)t=e;else{const s=qs(ae().getNumber("WEBGL_VERSION"),e);t=new tg(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=qs(ae().getNumber("WEBGL_VERSION"));t=new tg(s),this.binaryCache=Mj(ae().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new vj(this.gpgpu),this.numMBBeforeWarning=Vj(),this.texData=new ok(this,so())}nextDataId(){return zf.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,t,s){if((ae().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ae().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:as.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(ae().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:as.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:l,isPacked:u}=t;if(i!=null){let m;u?m=new qo(l,Hi):m=new Rr(l,Hi);const g=this.runWebGLProgram(m,[{dataId:e,shape:l,dtype:r}],r),y=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const h=this.activeTimers!=null;let d;h&&(d=Fn());let f;if(r==="complex64"){const m=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);f=Fr(m,g)}else f=this.getValuesFromTexture(e);return h&&(this.downloadWaitMs+=Fn()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const y=this.pendingRead.get(e);return new Promise(w=>y.push(w))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:l,isPacked:u}=t;if(o!=null){let y;u?y=new qo(r,Hi):y=new Rr(r,Hi);const w=this.runWebGLProgram(y,[{dataId:e,shape:r,dtype:i}],i),v=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),v}if(s!=null)return this.convertAndCacheOnCPU(e);if(ae().getBool("DEBUG")&&!ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ae().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let h=null,d;if(i!=="complex64"&&ae().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const y=this.texData.get(d.dataId);h=this.gpgpu.createBufferFromTexture(y.texture.texture,...wh(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(i==="complex64"){const y=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),w=y[0],v=y[1];f=Fr(w,v)}else if(h==null)f=this.getValuesFromTexture(e);else{const y=ue(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(h,y)}if(d!=null&&this.disposeIntermediateTensorInfo(d),h!=null){const y=this.gpgpu.gl;Ne(y,()=>y.deleteBuffer(h))}const m=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(y=>y(m)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&so().removeDataId(e,this),this.pendingDeletes--),m}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:l,isPacked:u,texture:h}=s;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let g;u?g=new qo(o,Hi):g=new Rr(o,Hi);const y=this.runWebGLProgram(g,[{dataId:e,shape:o,dtype:l}],l),w=this.readToGPU(y,t);return this.disposeIntermediateTensorInfo(y),w}if(h==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=so().makeTensorFromTensorInfo(d),m=this.texData.get(d.dataId);return Object.assign({tensorRef:f},m.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>co(r));return He(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return He(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!KG(s))throw ae().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=ue(t);if(ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const m=this.decode(e),g=this.texData.get(m.dataId),y=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...wh(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(m),y}const i=ae().getBool("WEBGL_PACK")&&r===!0,l=i?Zm(t):t,u=i?new u6(l):new l6(l),h=this.runWebGLProgram(u,[{shape:l,dtype:s,dataId:e}],"float32"),d=this.texData.get(h.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(h),f}timerAvailable(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=na(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),i=na(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(o);l.kernelMs=FE(u),l.getExtraProfileInfo=()=>u.map((h,d)=>({name:i[d],ms:h})).map(h=>`${h.name}: ${h.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Fn(),endMs:null}}endTimer(e){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Fn(),e)}async getQueryTime(e){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:i,slice:l}=this.texData.get(e),u=l&&l.origDataId||e,h=this.dataRefCount.get(u);h>1?this.dataRefCount.set(u,h-1):(this.dataRefCount.delete(u),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=zj){return ae().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&ue(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){os("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Oj(e.shape,t)}packedUnaryOp(e,t,s){const r=new qo(e.shape,t),o=this.compileAndRun(r,[e],s);return so().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=U2(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Bb,e.dtype);const t=new Rr(e.shape,Bb),s=this.compileAndRun(t,[e]);return so().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Ol(s[0])){const o=s.map(i=>ao(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return so().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new _j(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new yj(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[fa(e.shape),...pa(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[fa(t),...pa(t)],i=new j2(o,s),l=!0,u=[s],h=this.runWebGLProgram(i,[r],e.dtype,u,l);return{dataId:h.dataId,shape:t,dtype:h.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(t!=null){const m=ue(o),g=t[0]*t[1]*4;_(m<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const l=Zm(o);let u;r?u=new a6(l):u=new i6(l);const h=!0,d=[t??wh(l)],f=this.runWebGLProgram(u,[{shape:l,dtype:i,dataId:e}],i,d,h,t);return{dtype:i,shape:o,dataId:f.dataId}}runWebGLProgram(e,t,s,r,o=!1,i){const l=this.makeTensorInfo(e.outputShape,s),u=this.texData.get(l.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===Dl.DENSE){const b=i??wh(e.outputShape);u.texShape=b.map(C=>C*2)}if(e.outTexUsage!=null&&(u.usage=e.outTexUsage),ue(l.shape)===0)return u.values=ln(l.dtype,0),l;const h=[],d=t.map(b=>{if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(b.dataId);if(C.texture==null){if(!e.packedInputs&&ue(b.shape)<=ae().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=b.shape)}if(this.uploadToGPU(b.dataId),!!C.isPacked!=!!e.packedInputs)b=C.isPacked?this.unpackTensor(b):this.packTensor(b),h.push(b),C=this.texData.get(b.dataId);else if(C.isPacked&&!ad(C.shape,b.shape)){const S=b,$=b.shape;b.shape=C.shape,b=this.packedReshape(b,$),h.push(b),C=this.texData.get(b.dataId),S.shape=$}return{shape:b.shape,texData:C,isUniform:!1}});this.uploadToGPU(l.dataId);const f={shape:l.shape,texData:u,isUniform:!1},m=o6(e,d,f),g=this.getAndSaveBinary(m,()=>s6(this.gpgpu,e,d,f)),y=this.activeTimers!=null;let w;y&&(w=this.startTimer()),ae().get("ENGINE_COMPILE_ONLY")||r6(this.gpgpu,g,d,f,r),h.forEach(b=>this.disposeIntermediateTensorInfo(b)),y&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const v=ae().get("WEBGL_FLUSH_THRESHOLD");if(v>0){const b=Fn();b-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!ae().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&o===!1){const b=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),b}return l}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ae().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=re(()=>{if(!ae().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ae().getBool("DEBUG");ae().set("DEBUG",!1);const t=this.abs(rt(1e-8)).dataSync()[0];if(ae().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Lj:Pj}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:l,isPacked:u}=t;if(i!=null)return;const h=this.activeTimers!=null;let d;h&&(d=Fn());let f=t.texShape;if(f==null&&(f=hH(s,u),t.texShape=f),o!=null){const m=Zm(s);let g,y=f[1],w=f[0];const v=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(u||!v)&&([y,w]=$a(f[0],f[1])),u?g=new h6(m,v):g=new c6(m,v);const b=v?[w,y]:f,C=this.makeTensorInfo(b,r),S=this.texData.get(C.dataId);v?S.usage=as.PIXELS:S.usage=as.UPLOAD,S.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),y,w,o);const $=[[w,y]],R=this.runWebGLProgram(g,[C],r,$,!0),O=this.texData.get(R.dataId);t.texShape=O.texShape,t.isPacked=O.isPacked,t.usage=O.usage,ae().get("ENGINE_COMPILE_ONLY")?this.disposeData(R.dataId):(t.texture=O.texture,t.values=null,this.texData.delete(R.dataId)),this.disposeIntermediateTensorInfo(C),h&&(this.uploadWaitMs+=Fn()-d)}else{const m=this.acquireTexture(f,l,r,u);t.texture=m}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return this.releaseGPUData(e),t!=null&&(s.values=Wj(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*rg(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await HC(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(D2(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,inShapesLocations:i,inTexShapesLocations:l,outShapeLocation:u,outShapeStridesLocation:h,outTexShapeLocation:d}=L2(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.inShapesLocations=i,e.inTexShapesLocations=l,e.outShapeLocation=u,e.outShapeStridesLocation=h,e.outTexShapeLocation=d}}}zf.nextDataId=0;function Wj(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Kk()&&iC("webgl",()=>new zf,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S1=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class ma{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=Be(t,s),this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ju=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class ec{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Be(t,s);const o=this.outputShape.length;this.enableShapeUniforms=En(o);let i="";if(r)if(o===0||ue(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${gt(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=$n("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${u[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${u[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${u[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${u[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qn(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Uj={kernelName:su,backendName:"webgl",kernelFunc:Qn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $o(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),i=t.texData.get(o.dataId),l=Qn({inputs:{x:s},backend:t}),u=Qn({inputs:{x:r},backend:t});return i.complexTensorInfos={real:l,imag:u},o}const Gj={kernelName:ex,backendName:"webgl",kernelFunc:$o};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K2="return (a < 0.) ? b * a : a;",q2=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Hj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,i=t.makeTensorInfo([],"float32",yo(o,"float32")),l=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ec(q2,r.shape,i.shape):new ma(K2,r.shape,i.shape),u=t.runWebGLProgram(l,[r,i],"float32");return t.disposeIntermediateTensorInfo(i),u}const jj={kernelName:Dd,backendName:"webgl",kernelFunc:Hj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X2="return (a < 0.) ? b * a : a;",Y2=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Kj(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ec(Y2,s.shape,r.shape):new ma(X2,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const qj={kernelName:Yd,backendName:"webgl",kernelFunc:Kj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ra="if (isnan(x)) return x;";function Qe({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,l=o,u=s||i.dtype;if(l.shouldExecuteOnCPU([i])&&t!=null){const f=l.texData.get(i.dataId),m=t(f.values,u);return l.makeTensorInfo(i.shape,u,m)}const h=ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return h?d=new qo(i.shape,e):d=new Rr(i.shape,n),l.runWebGLProgram(d,[i],u)}}function hn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:l})=>{const{a:u,b:h}=i,d=l;if(s&&u.dtype==="complex64"){const y=d.texData.get(u.dataId),w=d.texData.get(h.dataId),[v,b]=[[y.complexTensorInfos.real,w.complexTensorInfos.real],[y.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(S=>{const[$,N]=S,R={dataId:$.dataId,dtype:$.dtype,shape:u.shape},O={dataId:N.dataId,dtype:N.dtype,shape:h.shape},F=new ma(n,u.shape,h.shape);return d.runWebGLProgram(F,[R,O],Kn($.dtype,N.dtype))}),C=$o({inputs:{real:v,imag:b},backend:d});return d.disposeIntermediateTensorInfo(v),d.disposeIntermediateTensorInfo(b),C}const f=o||Kn(u.dtype,h.dtype);if((u.dtype==="string"||h.dtype==="string"||d.shouldExecuteOnCPU([u,h]))&&r!=null){const y=d.texData.get(u.dataId).values,w=d.texData.get(h.dataId).values,v=u.dtype==="string"?ai(y):y,b=u.dtype==="string"?ai(w):w,[C,S]=r(u.shape,h.shape,v,b,f),$=d.makeTensorInfo(S,f),N=d.texData.get($.dataId);return N.values=C,$}const m=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return m?g=new ec(e,u.shape,h.shape,t):g=new ma(n,u.shape,h.shape),d.runWebGLProgram(g,[u,h],f)}}function Al(n,e=!1){if(n==="linear")return e?Ej:Ij;if(n==="relu")return e?Dj:Sj;if(n==="elu")return e?Rj:$j;if(n==="relu6")return e?Aj:Nj;if(n==="prelu")return e?Y2:X2;if(n==="leakyrelu")return e?q2:K2;if(n==="sigmoid")return e?Fj:Tj;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q2{constructor(e,t,s,r=!1,o=!1,i=!1,l=null,u=!1,h=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=En(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),m=r?"i * 2, rc.y":"rc.y, i * 2",g=o?"rc.z, i * 2":"i * 2, rc.z",y=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",b="";l&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${l}
        }`:h?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${l}
        }`:v=`vec4 activation(vec4 x) {
          ${l}
        }`,b="result = activation(result);");const C=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),h&&this.variableNames.push("leakyreluAlpha");let S="rc.x",$="rc.x";e[0]<t[0]?S=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&($=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${f}; i++) {
          int batchA = ${S};
          int batchB = ${$};
          vec4 a = getMatrixA(batchA, ${m});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${y[0]} * ${w[0]});
          result += (${y[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${b}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vb={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class Wb{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Be(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ub="return a * b;";function N1(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=Kn(s.dtype,r.dtype);if(s.dtype==="complex64"){const l=t.texData.get(s.dataId),u=t.texData.get(r.dataId),h=new Wb(Vb.REAL,s.shape,r.shape),d=new Wb(Vb.IMAG,s.shape,r.shape),f=[{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:r.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:r.shape}],m=t.runWebGLProgram(h,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),y=$o({inputs:{real:m,imag:g},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}if(t.shouldExecuteOnCPU([s,r])){const l=t.texData.get(s.dataId),u=t.texData.get(r.dataId),[h,d]=X6(s.shape,r.shape,l.values,u.values,o),f=t.makeTensorInfo(d,o),m=t.texData.get(f.dataId);return m.values=h,f}let i;return ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new ec(Ub,s.shape,r.shape):i=new ma(Ub,s.shape,r.shape),t.runWebGLProgram(i,[s,r],o)}const Xj={kernelName:du,backendName:"webgl",kernelFunc:N1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yj(n,e,t){const s=[fa(n.shape),...pa(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[fa(e),...pa(e)],i=new j2(o,s),l=!0,u=[s],h=t.runWebGLProgram(i,[r],n.dtype,u,l);return{dataId:h.dataId,shape:e,dtype:h.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=t,l=ue(r.shape),u=ak(o,l),h=ue(u);_(l===h,()=>`The new shape (${u}) has ${h} elements and the old shape (${r.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(r.dataId);return d.isPacked&&!ad(r.shape,u)&&!(d.texture!==null&&ad(d.shape,u))?Yj(r,u,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:u,dtype:r.dtype})}const Qj={kernelName:Zd,backendName:"webgl",kernelFunc:ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gb{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const l=Math.floor(s/4)*4,u=s%4;let h="sumValue += dot(values, ones);";if(t!=null){const f=1/t;h=`sumValue += dot(values * ${sa(f)?f.toPrecision(2):f}, ones);`}let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${l}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${l};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${h}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${h}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${h}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zj{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let l="0.0",u="";t==="prod"?l="1.0":t==="min"?(l="1.0 / 1e-20",u="min"):t==="max"&&(l="-1.0 / 1e-20",u="max");let h=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?h="sumValue":t==="prod"?h="prodValue":t==="all"?h="allValue":t==="any"&&(h="anyValue");const d=Math.floor(s/4)*4,f=s%4;let m=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(l="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(l="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let y="";o%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${l};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${l});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${m}
        }
        setOutput(${h});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jj(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=Cf(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function yi(n,e,t,s){const r=Jj(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:l,windowSize:u,outSize:h}=r[i];let d,f;t==="mean"?d=i===0?new Gb({windowSize:u,inSize:l,batchSize:n.shape[0],outSize:h},l):new Gb({windowSize:u,inSize:l,batchSize:n.shape[0],outSize:h}):d=new Zj({windowSize:u,inSize:l,batchSize:n.shape[0],outSize:h},t),f=o,o=s.runWebGLProgram(d,[o],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e5{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[t[i]];this.outputShape=s,this.rank=s.length;const r=gt(this.rank),o=t5(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function t5(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n5{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=gt(this.rank),o=H2("rc",this.rank),i=new Array(this.rank);for(let d=0;d<t.length;d++)i[t[d]]=o[d];const l=`vec2(${i.slice(-2).join()})`,u=`++${o[this.rank-1]} < ${s[this.rank-1]}`,h=`getChannel(getA(${i.join()}), ${l})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${h};
      if(${u}) {
        result[1] = ${h};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${h};
        if(${u}) {
          result[3] = ${h};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bf(n,e,t){const s=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new n5(n.shape,e):new e5(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(n,e,t,s){const r=e,o=n.shape.length,i=je(r,n.shape);let l=i;const u=Tt(l,o),h=u!=null;let d=n;h&&(d=Bf(n,u,s),l=Ft(l.length,o)),cn("sum",l,o);const[f,m]=tn(d.shape,l);let g=f;t&&(g=Bt(f,i));const y=ue(m),v=ue(n.shape)/y,b=ke({inputs:{x:d},attrs:{shape:[v,y]},backend:s}),C=Dx(n.dtype),S=yi(b,C,"sum",s),$=ke({inputs:{x:S},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(S),h&&s.disposeIntermediateTensorInfo(d),$}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vf(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;return s5(r,o,i,t)}const r5={kernelName:rf,backendName:"webgl",kernelFunc:Vf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,i=t,l=r.shape.length,u=new Array(l);for(let d=0;d<u.length;d++)u[d]=r.shape[o[d]];let h;if(i.shouldExecuteOnCPU([r])){const f=i.texData.get(r.dataId).values,m=$1(f,r.shape,r.dtype,o,u);h=i.makeTensorInfo(u,r.dtype);const g=i.texData.get(h.dataId);g.values=m}else h=Bf(r,o,i);return h}const o5={kernelName:Zi,backendName:"webgl",kernelFunc:Nn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z2=1e3;function ld({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:l=0,activation:u=null}){const h=n.shape.length,d=e.shape.length,f=t?n.shape[h-2]:n.shape[h-1],m=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[h-1]:n.shape[h-2],y=s?e.shape[d-2]:e.shape[d-1],w=n.shape.slice(0,-2),v=e.shape.slice(0,-2),b=ue(w),C=ue(v),$=Be(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,y]);_(f===m,()=>`Error in matMul: inner shapes (${f}) and (${m}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const N=t?[b,f,g]:[b,g,f],R=s?[C,y,m]:[C,m,y],O=ke({inputs:{x:n},backend:r,attrs:{shape:N}}),F=ke({inputs:{x:e},backend:r,attrs:{shape:R}}),A=[O,F],D=Math.max(b,C),T=t?O.shape[1]:O.shape[2],z=o!=null,U=i!=null,Q=u==="leakyrelu",q=u!=null?Al(u,!0):null,J=z||U||Q||q!=null;let ne;if((g===1||y===1)&&T>Z2&&J===!1){let X=O,Y=F;t&&(X=Nn({inputs:{x:O},backend:r,attrs:{perm:[0,2,1]}}),A.push(X)),s&&(Y=Nn({inputs:{x:F},backend:r,attrs:{perm:[0,2,1]}}),A.push(Y));const L=y!==1,W=y===1;let ie=X;L&&(ie=ke({inputs:{x:X},backend:r,attrs:{shape:[D,T,1]}}),A.push(ie));const ce=y===1?2:1;let he=Y;W&&(he=ke({inputs:{x:Y},backend:r,attrs:{shape:[D,1,T]}}),A.push(he));const fe=N1({inputs:{a:ie,b:he},backend:r});ne=Vf({inputs:{x:fe},backend:r,attrs:{axis:ce,keepDims:!0}}),A.push(fe)}else{const X=Kn(n.dtype,e.dtype),Y=new Q2(N,R,[D,g,y],t,s,z,q,U,Q),L=[O,F];if(o!=null&&L.push(o),U&&L.push(i),Q){const W=r.makeTensorInfo([],"float32",yo(l,"float32"));L.push(W),A.push(W)}ne=r.runWebGLProgram(Y,L,X)}const B=ke({inputs:{x:ne},backend:r,attrs:{shape:$}});A.push(ne);for(const X of A)r.disposeIntermediateTensorInfo(X);return B}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:l}=e,{transposeA:u,transposeB:h,activation:d,leakyreluAlpha:f}=s;return ld({a:r,b:o,transposeA:u,transposeB:h,backend:t,bias:i,preluActivationWeights:l,leakyreluAlpha:f,activation:d})}const a5={kernelName:Lh,backendName:"webgl",kernelFunc:i5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hb="return abs(x);";function l5(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),i=U2(o.values);return t.makeTensorInfo(s.shape,s.dtype,i)}let r;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new qo(s.shape,Hb):r=new Rr(s.shape,Hb),t.runWebGLProgram(r,[s],s.dtype)}const u5={kernelName:hd,backendName:"webgl",kernelFunc:l5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c5=Rs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,h5=Qe({opSnippet:c5}),d5={kernelName:Pl,backendName:"webgl",kernelFunc:h5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f5=Rs+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,p5=Qe({opSnippet:f5}),m5={kernelName:Ml,backendName:"webgl",kernelFunc:p5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jb="return a + b;",g5=hn({opSnippet:jb,packedOpSnippet:jb,supportsComplex:!0,cpuKernelImpl:E6}),x5={kernelName:xa,backendName:"webgl",kernelFunc:g5};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y5{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w5{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Qn({inputs:{x:s[0]},backend:t});if(s.length>ae().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(s.length/2),h=Oh({inputs:s.slice(0,u),backend:t}),d=Oh({inputs:s.slice(u),backend:t});return Oh({inputs:[h,d],backend:t})}const r=s.map(u=>u.dtype).reduce((u,h)=>Kn(u,h)),o=s.map(u=>u.shape),l=ae().getBool("WEBGL_PACK")?new w5(s[0].shape,o):new y5(s[0].shape,o);return t.runWebGLProgram(l,s,r)}const v5={kernelName:qg,backendName:"webgl",kernelFunc:Oh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,l=r.shape.length,u=je(o,r.shape);let h=u;const d=Tt(h,l);let f=r;d!=null&&(f=Nn({inputs:{x:r},backend:t,attrs:{perm:d}}),h=Ft(h.length,l)),cn("all",h,l);const[m,g]=tn(f.shape,h),y=ue(g),w=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),v=yi(w,w.dtype,"all",t);let b;if(i){const C=Bt(m,u);b=ke({inputs:{x:v},backend:t,attrs:{shape:C}})}else b=ke({inputs:{x:v},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),b}const k5={kernelName:Xg,backendName:"webgl",kernelFunc:b5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,l=r.shape.length,u=je(o,r.shape);let h=u;const d=Tt(h,l);let f=r;d!=null&&(f=Nn({inputs:{x:r},backend:t,attrs:{perm:d}}),h=Ft(h.length,l)),cn("any",h,l);const[m,g]=tn(f.shape,h),y=ue(g),w=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),v=yi(w,w.dtype,"any",t);let b;if(i){const C=Bt(m,u);b=ke({inputs:{x:v},backend:t,attrs:{shape:C}})}else b=ke({inputs:{x:v},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),b}const I5={kernelName:Yg,backendName:"webgl",kernelFunc:C5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $5{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const l=t==="max"?">":"<",u=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${l} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S5{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,_(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const l=this.outputShape,u=l.length,h=gt(u),d=$n("coords",u);let f,m;if(i===1){m=u+1;const F=gt(m);f=`
        ${F} sourceLocR = ${F}(${d.join()}, 0);
        ++${d[u-1]};
        ${F} sourceLocG = ${F}(${d.join()}, 0);
        ++${d[u-2]};
        ${F} sourceLocA = ${F}(${d.join()}, 0);
        --${d[u-1]};
        ${F} sourceLocB = ${F}(${d.join()}, 0);
        --${d[u-2]};`}else m=u,f=`
        ${h} sourceLocR = coords;
        ++${d[u-1]};
        ${h} sourceLocG = coords;
        ++${d[u-2]};
        ${h} sourceLocA = coords;
        --${d[u-1]};
        ${h} sourceLocB = coords;
        --${d[u-2]};`;const g=["x","y","z","w","u","v"].slice(0,m),y="."+g[m-1],w=g.map(F=>"int "+F),v=$n("sourceLocR",m-1).concat("inIdx.r"),b=$n("sourceLocG",m-1).concat("inIdx.g"),C=$n("sourceLocB",m-1).concat("inIdx.b"),S=$n("sourceLocA",m-1).concat("inIdx.a"),$=s==="max"?"greaterThan":"lessThan",N=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${S.join()})));`,R=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${b.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,O=r?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${O}
      void main() {
        ${h} coords = getOutputCoords();
        bool hasNextCol = ${d[u-1]} < ${l[u-1]-1};
        bool hasNextRow = ${d[u-2]} < ${l[u-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${y}, sourceLocG${y},
          sourceLocB${y}, sourceLocA${y}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${R};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${N}
          vec4 candidate = ${R};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${$}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=Cf(o),l={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},u=new $5(l,t,s==null),h=[e];s!=null&&h.push(s);const d=n.runWebGLProgram(u,h,"int32");if(d.shape[1]===1)return d;const f=J2(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function eN(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=Cf(o),l=new S5(r,i,t,s==null),u=s==null?[e]:[e,s],h=n.runWebGLProgram(l,u,"int32");if(h.shape.length===e.shape.length){const d=eN(n,e,t,h);return n.disposeIntermediateTensorInfo(h),d}return h}function tN(n,e,t,s){const r=[t];if(cn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!ae().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),l=i!==null&&i.isPacked;let u=e;l&&(u=n.unpackTensor(e),o.push(u));const[h,d]=tn(u.shape,r),f=ue(d),m=ke({inputs:{x:u},backend:n,attrs:{shape:[-1,f]}});o.push(m);const g=J2(n,m,s);o.push(g);const y=ke({inputs:{x:g},backend:n,attrs:{shape:h}});return o.forEach(w=>n.disposeIntermediateTensorInfo(w)),y}return eN(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=je(o,r.shape);const l=Tt(i,r.shape.length);let u=r;const h=[];l!=null&&(u=Nn({inputs:{x:r},backend:t,attrs:{perm:l}}),h.push(u),i=Ft(i.length,u.shape.length)),cn("argMax",[i[0]],u.shape.length);const d=tN(t,u,i[0],"max");return h.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const T5={kernelName:dd,backendName:"webgl",kernelFunc:N5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=je(o,r.shape);const l=Tt(i,r.shape.length);let u=r;const h=[];l!=null&&(u=Nn({inputs:{x:r},backend:t,attrs:{perm:l}}),h.push(u),i=Ft(i.length,u.shape.length)),cn("argMin",[i[0]],u.shape.length);const d=tN(t,u,i[0],"min");return h.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const R5={kernelName:fd,backendName:"webgl",kernelFunc:E5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D5=Rs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,A5=Qe({opSnippet:D5}),F5={kernelName:zl,backendName:"webgl",kernelFunc:A5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _5=Rs+"return log(x + sqrt(x * x + 1.0));",O5=Qe({opSnippet:_5}),L5={kernelName:Bl,backendName:"webgl",kernelFunc:O5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P5=Rs+`
  return atan(x);
`,M5=Qe({opSnippet:P5}),z5={kernelName:Vl,backendName:"webgl",kernelFunc:M5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B5=S1+`
  return atan(a, b);
`,V5=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ju+`
  return result;
`,W5=hn({opSnippet:B5,packedOpSnippet:V5}),U5={kernelName:Ul,backendName:"webgl",kernelFunc:W5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5=Rs+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,H5=Qe({opSnippet:G5}),j5={kernelName:Wl,backendName:"webgl",kernelFunc:H5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fl{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,l=e.strideHeight,u=e.strideWidth,h=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,b=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(w||(C="-1.0 / 1e-20"),s){const F=">=";this.userCode=`
        const ivec2 strides = ivec2(${l}, ${u});
        const ivec2 pads = ivec2(${g}, ${y});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${F} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?v:b:`wR * ${m} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let $=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&($="avgValue / count");const N=Math.floor(i/4)*4,R=i%4,O=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${g}, ${y});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${h}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${N}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${O}
          }

          int xC = xCCorner + ${N};
          if (${R===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${O}
          } else if (${R===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${O}
          } else if (${R===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${O}
          }
        }
        setOutput(${$});
      }
    `}}class T1{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,l=e.strideDepth,u=e.strideHeight,h=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,m=e.dilationWidth,g=e.effectiveFilterDepth,y=e.effectiveFilterHeight,w=e.effectiveFilterWidth,v=e.padInfo.front,b=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const S=t==="avg";let $="0.0";if(S||($="-1.0 / 1e-20"),s){const D=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${l}, ${u}, ${h});
        const ivec3 pads = ivec3(${v}, ${b}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${y};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${m}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${D} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${y} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let R=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(R="avgValue / count");const O=Math.floor(i/4)*4,F=i%4,A=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${l}, ${u}, ${h});
      const ivec3 pads = ivec3(${v}, ${b}, ${C});
      const float initializationValue = ${$};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${$});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${y};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${O}; wC += 4) {
              int xC = xCCorner + wC * ${m};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                getValue(batch, xD, xR, xC + 3 * ${m}, ch)
              );

              ${A}
            }

            int xC = xCCorner + ${O};
            if (${F===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${F===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${F===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                initializationValue
              );

              ${A}
            }
          }
          setOutput(${R});
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Qu(r,"avgPool");const{filterSize:o,strides:i,pad:l,dimRoundingMode:u}=s,h=1;_(xn(i,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const d=Ns(r.shape,o,i,h,l,u);if(d.filterWidth===1&&d.filterHeight===1&&ot(d.inShape,d.outShape))return Qn({inputs:{x:r},backend:t});const f=new Fl(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const q5={kernelName:pd,backendName:"webgl",kernelFunc:K5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:l,dimRoundingMode:u,dataFormat:h}=s,d=[1,1,1],f=_r(r.shape,o,i,d,l,u,h),m=new T1(f,"avg",!1);return t.runWebGLProgram(m,[r],"float32")}const Y5={kernelName:md,backendName:"webgl",kernelFunc:X5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q5{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=u-1-e.padInfo.top,f=h-1-e.padInfo.left,m=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${m});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${h};
            wC+= ${l}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Z5{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,y=f-1-e.padInfo.front,w=m-1-e.padInfo.top,v=g-1-e.padInfo.left,b=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${y}, ${w}, ${v});
      const float avgMultiplier = float(${b});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${m};
              wR += ${h}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=s,f=[1,1,1],m=_r(i.shape,l,u,f,h,d),g=new Z5(m);return t.runWebGLProgram(g,[r],i.dtype)}const eK={kernelName:Zg,backendName:"webgl",kernelFunc:J5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;Qu([r,o],"avgPoolGrad");const{filterSize:l,strides:u,pad:h}=s,d=Ns(i.shape,l,u,1,h),f=new Q5(d);return t.runWebGLProgram(f,[r],i.dtype)}const nK={kernelName:Qg,backendName:"webgl",kernelFunc:tK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:l}=s;return ld({a:r,b:o,transposeA:i,transposeB:l,backend:t})}const rK={kernelName:gd,backendName:"webgl",kernelFunc:sK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oK{constructor(e,t,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Be(e,t),Be(e,s);let l="0.0";r!=null&&(Be(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let u="1.0";o!=null&&(Be(e,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${l};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iK{constructor(e,t,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Be(e,t),Be(e,s);let l="vec4(0.0)";r!=null&&(Be(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let u="vec4(1.0)";o!=null&&(Be(e,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${l};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aK=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:i,scale:l}=n;_(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),_(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),_(l==null||r.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=t;u==null&&(u=.001);const h=[s,r,o];let d=null;i!=null&&(d=i.shape,h.push(i));let f=null;l!=null&&(f=l.shape,h.push(l));const m=ae().getBool("WEBGL_PACK_NORMALIZATION")?new iK(s.shape,r.shape,o.shape,d,f,u):new oK(s.shape,r.shape,o.shape,d,f,u);return e.runWebGLProgram(m,h,h[0].dtype)},lK={kernelName:Td,backendName:"webgl",kernelFunc:aK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uK{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=gt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=cK(this.rank);let r;const o=e.map((i,l)=>`sourceLoc.${zg[l]} = start[${l}] + coords.${zg[l]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const zg=["x","y","z","w","u","v"];function cK(n){if(n===1)return"sourceLoc";if(n<=6)return zg.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hK{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=gt(this.rank),s=$n("coords",this.rank),r=$n("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,l=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${h}
        vec4 result = vec4(0.);
        ${l}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=t,i.dtype=n.dtype;let l=Bx(e,Ae(n.shape));r.slice&&(l+=r.slice.flatOffset),i.slice={flatOffset:l,origDataId:r.slice&&r.slice.origDataId||n.dataId};const u=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,u+1),o}function Da(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s,[l,u]=mf(r,o,i);if(Px(r,l,u),ue(u)===0)return t.makeTensorInfo(u,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),m=oj(f.values,l,u,r.shape,r.dtype);return t.makeTensorInfo(u,r.dtype,m)}const{isPacked:h}=t.texData.get(r.dataId),d=zx(r.shape,l,u);if(h||!d){const f=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hK(u):new uK(u),m=[l];return t.runWebGLProgram(f,[r],r.dtype,m)}return t.uploadToGPU(r.dataId),dK(r,l,u,t)}const fK={kernelName:sf,backendName:"webgl",kernelFunc:Da};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pK=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;_(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const l=o.reduce((C,S)=>C*S),u=Pu(r.shape,o,l),h=Mu(u.length,o.length),d=zu(r.shape,o,l),f=N0(i,o.length),m=T0(d,i,o.length),g=[],y=ke({inputs:{x:r},backend:t,attrs:{shape:u}}),w=Nn({inputs:{x:y},backend:t,attrs:{perm:h}}),v=ke({inputs:{x:w},backend:t,attrs:{shape:d}}),b=Da({inputs:{x:v},backend:t,attrs:{begin:f,size:m}});return g.push(y),g.push(w),g.push(v),g.forEach(C=>t.disposeIntermediateTensorInfo(C)),b},mK={kernelName:xd,backendName:"webgl",kernelFunc:pK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,l=t.readSync(r.dataId),u=t.readSync(o.dataId),h=W2(l,u,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,h)}const xK={kernelName:Jg,backendName:"webgl",kernelFunc:gK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),i=t.readSync(r.dataId),l=Be(Array.from(o),Array.from(i));return t.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const wK={kernelName:mk,backendName:"webgl",kernelFunc:yK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vK="return float(a != b);",nN=hn({opSnippet:vK,cpuKernelImpl:Q6,dtype:"bool"}),bK={kernelName:Hd,backendName:"webgl",kernelFunc:nN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Qn({inputs:{x:r.complexTensorInfos.real},backend:t})}const kK={kernelName:kx,backendName:"webgl",kernelFunc:tc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK="return float(int(x));";function IK(n,e){const t=new Rr(n.shape,CK),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bg(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Qn({inputs:{x:r},backend:t});const i=Zt(r.shape),l=Bg({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),u=$o({inputs:{real:l,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(l),u}if(r.dtype==="complex64"){const i=tc({inputs:{input:r},backend:t}),l=Bg({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),l}if(!lk(r.dtype,o)){const i=Qn({inputs:{x:r},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId).values,[l,u,h]=D6(i,r.shape,r.dtype,o);return t.makeTensorInfo(l,u,h)}if(o==="int32")return IK(r,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",ln("bool",1)),u=nN({inputs:{a:r,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),u}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const $K={kernelName:Gl,backendName:"webgl",kernelFunc:Bg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kb="return ceil(x);",SK=Qe({opSnippet:Kb,packedOpSnippet:Kb,cpuKernelImpl:A6}),NK={kernelName:Hl,backendName:"webgl",kernelFunc:SK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TK{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EK{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let l;ae().getBool("WEBGL_PACK_CLIP")?l=new EK(r.shape):l=new TK(r.shape);const u=[[o],[i]];return t.runWebGLProgram(l,[r],r.dtype,u)}const DK={kernelName:jl,backendName:"webgl",kernelFunc:RK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AK{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qb(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function FK(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new AK(s.shape),i=[qb(s,r.complexTensorInfos.real),qb(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const _K={kernelName:yd,backendName:"webgl",kernelFunc:FK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OK{constructor(e){this.outputShape=[],this.outputShape=ur(e,1),this.variableNames=e.map((i,l)=>`T${l}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const l=t[i-1];s.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${l}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LK{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ur(e,t);const s=this.outputShape,r=s.length,o=gt(r),i=$n("coords",r),l=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((w,v)=>`T${v}`);const u=new Array(e.length-1);u[0]=e[0][t];for(let w=1;w<u.length;w++)u[w]=u[w-1]+e[w][t];const h=l[t],d=l.slice(-2),f=l.join();let m=`if (${h} < ${u[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let w=1;w<u.length;w++){const v=u[w-1];m+=`
        if (${h} < ${u[w]}  && ${h} >= ${u[w-1]}) {
          return getChannel(
            getT${w}(${Ih(l,h,v)}),
            vec2(${Ih(d,h,v)}));
        }`}const g=u.length,y=u[u.length-1];m+=`
        return getChannel(
          getT${g}(${Ih(l,h,y)}),
          vec2(${Ih(d,h,y)}));`,this.userCode=`
      float getValue(${l.map(w=>"int "+w)}) {
        ${m}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Ih(n,e,t){const s=n.indexOf(e);return n.map((o,i)=>i===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wf(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Qn({inputs:{x:r.complexTensorInfos.imag},backend:t})}const PK={kernelName:px,backendName:"webgl",kernelFunc:Wf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cl(n,e,t){const s=n[0].dtype;if(s==="complex64"){const f=n.map(v=>tc({inputs:{input:v},backend:t})),m=n.map(v=>Wf({inputs:{input:v},backend:t})),g=Cl(f,e,t),y=Cl(m,e,t),w=$o({inputs:{real:g,imag:y},backend:t});return f.forEach(v=>t.disposeIntermediateTensorInfo(v)),m.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),w}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const f=n.map(C=>{const $=[-1,ue(C.shape.slice(e))];return ke({inputs:{x:C},backend:t,attrs:{shape:$}})}),m=f.map(C=>({vals:t.readSync(C.dataId),shape:C.shape})),g=ur(f.map(C=>C.shape),1),y=f[0].shape[0]===1,w=F6(m,g,s,y),v=ur(n.map(C=>C.shape),e),b=t.makeTensorInfo(v,s,w);return f.forEach(C=>t.disposeIntermediateTensorInfo(C)),b}const o=ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(n.length>o){const f=[];for(let g=0;g<n.length;g+=o){const y=n.slice(g,g+o);f.push(Cl(y,e,t))}const m=Cl(f,e,t);for(const g of f)t.disposeIntermediateTensorInfo(g);return m}if(ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].shape.length>1){const f=new LK(n.map(m=>m.shape),e);return t.runWebGLProgram(f,n,s)}const{tensors2D:i,outShape:l}=MK(n,e,t),u=new OK(i.map(f=>f.shape)),h=t.runWebGLProgram(u,i,s);i.forEach(f=>t.disposeIntermediateTensorInfo(f));const d=ke({inputs:{x:h},attrs:{shape:l},backend:t});return t.disposeIntermediateTensorInfo(h),d}function MK(n,e,t){const s=ur(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>ke({inputs:{x:o},attrs:{shape:[-1,ue(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sN(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=je(r,e[0].shape)[0],i=e.map(h=>h.shape);I0(i,o);const l=ur(e.map(h=>h.shape),o);if(ue(l)===0)return t.makeTensorInfo(l,e[0].dtype,[]);const u=e.filter(h=>ue(h.shape)>0);return u.length===1?Qn({inputs:{x:u[0]},backend:t}):Cl(u,o,t)}const zK={kernelName:wd,backendName:"webgl",kernelFunc:sN};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,l=e.padInfo.left,u=e.strideHeight,h=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,m=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,v=e.dataFormat==="channelsLast",b=v?1:2,C=v?2:3,S=v?3:1;let $="",N="";s&&(r?$=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?$=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:$=`
          float activation(float x) {
            ${s}
          }
        `,N="result = activation(result);");const R=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${$}

      const ivec2 strides = ivec2(${u}, ${h});
      const ivec2 pads = ivec2(${i}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${b}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${y}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${y}) *
                    getW(wR, wC, ${y}, d2);
              } else {
                dotProd +=
                    getX(batch, ${y}, xR, xC) *
                    getW(wR, wC, ${y}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2),
                getW(wR, wC, ${y} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1),
                  getX(batch, xR, xC, ${y} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC),
                  getX(batch, ${y} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${R}
        ${N}
        setOutput(result);
      }
    `}}class BK{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,m=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${l});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m}; wR++) {
            int xR = xRCorner + wR * ${h};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${y}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${y}) *
                  getW(wF, wR, wC, ${y}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1),
                  getX(batch, xF, xR, xC, ${y} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2),
                  getW(wF, wR, wC, ${y} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);const i=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,f=d;let m=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)m+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;m+=`
     for (int r = 0; r < ${h}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let v=0;v<d;v++)m+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;m+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(f+1)/2;v++){const b=v*2;if(m+=`
           xC = xCCorner + ${b*u};
           `,l===1){if(b<d&&(i%2===1?(m+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }
               `,u===1&&b>0?m+=`
                 xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                 `:m+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                   } else {
                     xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                   }
                   `):m+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xC${b} = xTexelC${b};
                 `,b+1<d)){const C=i%2===0?Gg(u):u;u%2===0&&i%2===1||u%2!==0&&i%2!==1?(m+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                     xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${b+1}.zw = vec2(0.0);
                     }
                     xTexelC${b+1}Ready = 1;
                   }
                   `,u>1?m+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                     } else {
                      xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                     }
                     `:m+=`
                     xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                     `):C===1?m+=`
                     xC${b+1} = xTexelC${b};
                     `:m+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                       xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${b+1}.zw = vec2(0.0);
                       }
                       xTexelC${b+1}Ready = 1;
                     }

                     xC${b+1} = xTexelC${b+1};
                     `}}else b<d&&(i%2===1?(m+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.0);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
               `,b+1<d&&(m+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                 `)):(m+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(
                   xTexelC${b}.xy, xTexelC${b+1}.xy);
               `,b+1<d&&(m+=`
                   xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                 `)));b<d&&(m+=`
             wTexel = getW(r, ${b}, d1, d2);
             dotProd += xC${b}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${b}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,b+1<d&&(m+=`
               wTexel = getW(r, ${b+1}, d1, d2);
               dotProd += xC${b+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${b+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}m+=`
     }
   `,m+=`
     }
   `,m+=`
     }
   `;let g="",y="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,y="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${m}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${y}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VK{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);const{dataFormat:s}=t,r=Tn(),o=s==="channelsLast",i=o?1:2,l=o?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let h="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)h+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${l}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${h}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ud(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function iN({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:l=null}){const u=n.shape,h=s.texData.get(n.dataId),d=t.inChannels,f=u[0]*u[1]*u[2],m=t.outChannels,g=t.dataFormat==="channelsLast",y=!1,w=!1;let v;const b=[];if(o!=null){const $=ud(o.shape,g);$!=null&&(o=ke({inputs:{x:o},backend:s,attrs:{shape:$}}),b.push(o))}if(r!=null){const $=ud(r.shape,g);$!=null&&(r=ke({inputs:{x:r},backend:s,attrs:{shape:$}}),b.push(r))}if(!((f===1||m===1)&&d>Z2)&&h.isPacked&&g&&h.texture!=null&&u[2]%2!==0&&ot(h.shape.slice(-3),u.slice(-3))){const $=u[0]*u[1]*(u[2]+1),N={dataId:n.dataId,shape:[1,$,t.inChannels],dtype:n.dtype},R=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,_(ad(h.shape,N.shape),()=>`packed reshape ${h.shape} to ${N.shape} isn't free`);const O=ke({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});b.push(O);const F=ld({a:N,b:O,backend:s,transposeA:y,transposeB:w,bias:r,activation:l,preluActivationWeights:o,leakyreluAlpha:i}),A=s.texData.get(F.dataId);_(A.isPacked,()=>"batchMatMul result is expected to be packed"),h.shape=R,A.shape=t.outShape,v=Qn({inputs:{x:F},backend:s}),v.shape=t.outShape,b.push(F)}else{const $=t.outHeight*t.outWidth,N=ke({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,$,t.inChannels]:[t.batchSize,t.inChannels,$]}}),R=ke({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),O=ld({a:g?N:R,b:g?R:N,transposeA:!g,transposeB:w,backend:s,bias:r,activation:l,preluActivationWeights:o,leakyreluAlpha:i});v=ke({inputs:{x:O},backend:s,attrs:{shape:t.outShape}}),b.push(N),b.push(R),b.push(O)}for(const $ of b)s.disposeIntermediateTensorInfo($);return v}function aN({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:l=null}){const{filterWidth:u,filterHeight:h,inChannels:d,outWidth:f,outHeight:m,dataFormat:g}=t,y=g==="channelsLast",w=u*h*d,v=m*f,b=[t.batchSize,w,v],C=!0,S=!1,$=[];if(o!=null){const B=ud(o.shape,y);B!=null&&(o=ke({inputs:{x:o},backend:s,attrs:{shape:B}}),$.push(o))}if(r!=null){const B=ud(r.shape,y);B!=null&&(r=ke({inputs:{x:r},backend:s,attrs:{shape:B}}),$.push(r))}const N=ke({inputs:{x:e},backend:s,attrs:{shape:[1,w,ue(e.shape)/w]}});$.push(N);const R=new VK(b,t),O=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],F=s.runWebGLProgram(R,[n],"float32",O),A=ke({inputs:{x:F},backend:s,attrs:{shape:b}});$.push(F),$.push(A);const D=r!=null,T=o!=null,z=l==="leakyrelu",U=l?Al(l,!0):null,Q=new Q2(y?A.shape:N.shape,y?N.shape:A.shape,y?[t.batchSize,v,t.outChannels]:[t.batchSize,t.outChannels,v],C,S,D,U,T,z),q=y?[A,N]:[N,A];if(r&&q.push(r),T&&q.push(o),z){const B=s.makeTensorInfo([],"float32",yo(i,"float32"));q.push(B),$.push(B)}const J=s.runWebGLProgram(Q,q,"float32"),ne=ke({inputs:{x:J},backend:s,attrs:{shape:t.outShape}});$.push(J);for(const B of $)s.disposeIntermediateTensorInfo(B);return ne}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}=s,f=Or(u),m=un(r.shape,o.shape,i,h,l,d,!1,f);let g;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=iN({x:r,filter:o,convInfo:m,backend:t});else if(m.strideWidth<=2&&f==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const w=new oN(m),v=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];g=t.runWebGLProgram(w,[r,o],"float32",v)}else if(ae().getBool("WEBGL_CONV_IM2COL"))g=aN({x:r,filter:o,convInfo:m,backend:t});else{const w=new rN(m);g=t.runWebGLProgram(w,[r,o],"float32")}const y=ke({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return t.disposeIntermediateTensorInfo(g),y}const UK={kernelName:vd,backendName:"webgl",kernelFunc:WK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GK{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              if (${i}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class HK{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",l=t-1-e.padInfo.top,u=s-1-e.padInfo.left,h=i?1:2,d=i?2:3,f=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${h}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jK{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,l=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${l};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class KK{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,l=e.strideWidth,u=t-1-e.padInfo.front,h=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${h}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:l,dataFormat:u,dimRoundingMode:h,filterShape:d}=s,f=Or(u),m=un(r.shape,d,i,1,l,h,!1,f),g=new GK(m);return t.runWebGLProgram(g,[r,o],"float32")}const XK={kernelName:tx,backendName:"webgl",kernelFunc:qK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:l,pad:u,dataFormat:h,dimRoundingMode:d}=s,f=Or(h),m=un(i,o.shape,l,1,u,d,!1,f),g=new HK(m);return t.runWebGLProgram(g,[r,o],"float32")}const QK={kernelName:bd,backendName:"webgl",kernelFunc:YK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:l,dilations:u}=s,h=wo(r.shape,o.shape,i,u,l),d=new BK(h);return t.runWebGLProgram(d,[r,o],"float32")}const JK={kernelName:kd,backendName:"webgl",kernelFunc:ZK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:l,filterShape:u}=s,h=wo(r.shape,u,i,1,l),d=new jK(h);return t.runWebGLProgram(d,[r,o],"float32")}const t8={kernelName:nx,backendName:"webgl",kernelFunc:e8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:l,inputShape:u}=s,h=wo(u,o.shape,l,1,i),d=new KK(h);return t.runWebGLProgram(d,[r,o],"float32")}const s8={kernelName:sx,backendName:"webgl",kernelFunc:n8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8=Ra+`
  return cos(x);
`,o8=Qe({opSnippet:r8}),i8={kernelName:Kl,backendName:"webgl",kernelFunc:o8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,l8=Qe({opSnippet:a8}),u8={kernelName:ql,backendName:"webgl",kernelFunc:l8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c8{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,l,u,h]=e,[d]=t,[f,m]=s;this.outputShape=[d,f,m,h];const g=r==="bilinear"?1:0,[y,w]=[`${l-1}.0`,`${u-1}.0`],[v,b,C]=f>1?[`${(l-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${y} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${y}`],[S,$,N]=m>1?[`${(u-1)/(m-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${b};
        float width_scale = ${$};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${y} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${N};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:l,method:u,extrapolationValue:h}=s,d=new c8(r.shape,o.shape,l,u,h);return t.runWebGLProgram(d,[r,o,i],"float32")},d8={kernelName:ox,backendName:"webgl",kernelFunc:h8};var _l;(function(n){n.Prod="*",n.Sum="+"})(_l||(_l={}));class Xb{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===_l.Prod?"1.0":"0.0",l=s?i:`getX(${Yb(o,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let h="",d="";s?(h=r?`end != ${u-1}`:"end != 0",d=r?"end + 1":"end - 1"):(h=r?`end + pow2 < ${u}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${gt(o)} coords = getOutputCoords();
        int end = ${Qb(o,"coords",this.op)};
        float val = ${l};
        int pow2 = int(pow(2.0, index));
        if (${h}) {
          int idx = ${d};
          ${Qb(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${Yb(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function Yb(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function Qb(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lN(n,e,t,s,r,o){const i=e.shape.length,l=Tt([s],i);let u=e;l!=null&&(u=Nn({inputs:{x:e},backend:t,attrs:{perm:l}}));const h=Ft(1,i)[0];if(h!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=u.shape[h];let f=Qn({inputs:{x:u},backend:t});for(let m=0;m<=Math.ceil(Math.log2(d))-1;m++){const g=new Xb(n,u.shape,!1,o),y=[[m]],w=f;f=t.runWebGLProgram(g,[f],f.dtype,y),t.disposeIntermediateTensorInfo(w)}if(r){const m=new Xb(n,u.shape,r,o),g=f;f=t.runWebGLProgram(m,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(l!=null){const m=vo(l),g=Nn({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:l}=s;return lN(_l.Prod,r,t,o,i,l)}const p8={kernelName:rx,backendName:"webgl",kernelFunc:f8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:l}=s;return lN(_l.Sum,r,t,o,i,l)}const g8={kernelName:Cd,backendName:"webgl",kernelFunc:m8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:l}=s;if(r.shape.length===1){const u=t.readSync(r.dataId),h=t.readSync(o.dataId),d=W2(u,h,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const u=t.bufferSync(r),h=t.bufferSync(o),d=R6(u,h,i,l);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const y8={kernelName:gk,backendName:"webgl",kernelFunc:x8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w8{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s,l=r.shape[0],u=i==="NHWC"?r.shape[1]:r.shape[2],h=i==="NHWC"?r.shape[2]:r.shape[3],d=i==="NHWC"?r.shape[3]:r.shape[1],f=u*o,m=h*o,g=d/(o*o),y=i==="NHWC"?[l,f,m,g]:[l,g,f,m],w=new w8(y,o,i);return t.runWebGLProgram(w,[r],r.dtype)}const b8={kernelName:ix,backendName:"webgl",kernelFunc:v8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);const i=e.filterHeight,l=e.filterWidth,u=e.outChannels/e.inChannels;let h="",d="";s&&(r?h=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?h=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:h=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${h}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${l}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);const i=e.outChannels/e.inChannels,l=e.padInfo.left,u=e.strideWidth,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,m=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<f;b++)g+=`
          vec4 xTexelC${b*2};
          int xTexelC${b*2}Ready;
          vec4 xTexelC${b*2+1};
          int xTexelC${b*2+1}Ready;
          vec4 xC${b};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let b=0;b<f;b++)g+=`
          xTexelC${b*2} = vec4(0.0);
          xTexelC${b*2}Ready = 0;
          xTexelC${b*2+1} = vec4(0.0);
          xTexelC${b*2+1}Ready = 0;
          xC${b} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let b=0;b<(m+1)/2;b++){const C=b*2;if(g+=`
          xC = xCCorner + ${C*h};
          `,u===1){if(C<f&&(l%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,h===1&&C>0?g+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<f)){const S=l%2===0?Gg(h):h;h%2===0&&l%2===1||h%2!==0&&l%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${S};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,h>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:g+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):S===1?g+=`
                    xC${C+1} = xTexelC${C};
                    `:g+=`
                    xCOffset = xC + ${S};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<f&&(l%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<f&&(g+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<f&&(g+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<f&&(g+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let y="",w="";s&&(r?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:y=`vec4 activation(vec4 x) {
          ${s}
        }`,w="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:l,dilations:u,dimRoundingMode:h}=s;let d=u;d==null&&(d=[1,1]),_(xn(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const f=un(r.shape,o.shape,i,d,l,h,!0);let m;ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?m=new cN(f):m=new uN(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(m,[r,o],"float32",g)}const C8={kernelName:Id,backendName:"webgl",kernelFunc:k8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I8{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class $8{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:l,pad:u,dimRoundingMode:h,filterShape:d}=s,f=un(r.shape,d,i,l,u,h,!0),m=new I8(f);return t.runWebGLProgram(m,[r,o],"float32")}const N8={kernelName:ax,backendName:"webgl",kernelFunc:S8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:l,pad:u,dimRoundingMode:h,inputShape:d}=s,f=un(d,o.shape,i,l,u,h,!0),m=new $8(f);return t.runWebGLProgram(m,[r,o],"float32")}const E8={kernelName:lx,backendName:"webgl",kernelFunc:T8};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R8{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=ue(s.shape),i=ke({inputs:{x:s},backend:t,attrs:{shape:[o]}}),l=new R8(o),u=t.runWebGLProgram(l,[i],i.dtype),h=ke({inputs:{x:u},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(u),h}const A8={kernelName:xk,backendName:"webgl",kernelFunc:D8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F8{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:l,filterWidth:u,dilationHeight:h,dilationWidth:d}=e,{top:f,left:m}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${f}, ${m});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${l}; h++) {
          int hIn = hBeg + h * ${h};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:l,dilations:u}=s,h=Fu(r.shape,o.shape,i,l,"NHWC",u);let d;const f=new F8(h);d=t.runWebGLProgram(f,[r,o],"float32");const m=ke({inputs:{x:d},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(d),m}const O8={kernelName:$d,backendName:"webgl",kernelFunc:_8};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L8(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:l,idDims:u}=L0(r,o.length);M0(i.length,u,o);const{path:h,steps:d}=z0(l,u),f=d.length;let m=null,g=i.length;const y=[];for(let w=0;w<f;++w){for(const v of d[w]){const{permutationIndices:b,expandDims:C}=P0(g,u[v]);let S;B0(b)?S=o[v]:(S=Nn({inputs:{x:o[v]},backend:t,attrs:{perm:b}}),y.push(S));const $=S.shape.slice();for(let N=0;N<C.length;++N)$.splice(C[N],0,1);ot(S.shape,$)||(S=ke({inputs:{x:S},backend:t,attrs:{shape:$}}),y.push(S)),m===null?m=S:(m=N1({inputs:{a:S,b:m},backend:t}),y.push(m))}w<f-1&&(h[w]>=0&&(m=Vf({inputs:{x:m},backend:t,attrs:{axis:h[w]-(i.length-g),keepDims:!1}}),y.push(m)),g--)}for(const w of y)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const P8={kernelName:yk,backendName:"webgl",kernelFunc:L8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8="return (x >= 0.0) ? x : (exp(x) - 1.0);",z8=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,B8=Qe({opSnippet:M8,packedOpSnippet:z8}),V8={kernelName:Yl,backendName:"webgl",kernelFunc:B8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W8="return (b >= 1.0) ? a : a * (b + 1.0);",U8=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,G8=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ec(U8,s.shape,r.shape):new ma(W8,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},H8={kernelName:ux,backendName:"webgl",kernelFunc:G8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8=`
  return vec4(equal(a, b));
`,K8="return float(a == b);",q8=hn({opSnippet:K8,packedOpSnippet:j8,dtype:"bool",cpuKernelImpl:_6}),X8={kernelName:Sd,backendName:"webgl",kernelFunc:q8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${E0};
  float a1 = ${R0};
  float a2 = ${D0};
  float a3 = ${A0};
  float a4 = ${F0};
  float a5 = ${_0};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Q8=Qe({opSnippet:Y8}),Z8={kernelName:Ql,backendName:"webgl",kernelFunc:Q8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8=Ra+`
  return exp(x);
`,eq=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,hN=Qe({opSnippet:J8,packedOpSnippet:eq,cpuKernelImpl:O6,dtype:"float32"}),tq={kernelName:Zl,backendName:"webgl",kernelFunc:hN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vg(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,i=o.shape.length,l=o.shape.slice();let u=r;return r<0&&(_(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+r+1),l.splice(u,0,1),ke({inputs:{x:o},backend:s,attrs:{shape:l}})}const nq={kernelName:Nd,backendName:"webgl",kernelFunc:Vg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zb="return exp(x) - 1.0;",sq=Qe({opSnippet:Zb,packedOpSnippet:Zb,cpuKernelImpl:L6}),rq={kernelName:Jl,backendName:"webgl",kernelFunc:sq};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jb{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let l;if(e==="real")l="return real * expR - imag * expI;";else if(e==="imag")l="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${l}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dN(n,e,t){const s=t.texData.get(n.dataId),r=ue(n.shape),o=n.shape[n.shape.length-1],i=r/o,l=ke({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),u=l.shape,h=new Jb("real",u,e),d=new Jb("imag",u,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:u},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:u}],m=t.runWebGLProgram(h,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),y=$o({inputs:{real:m,imag:g},backend:t});t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g);const w=ke({inputs:{x:y},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(y),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(n){const{inputs:e,backend:t}=n,{input:s}=e;return dN(s,!1,t)}const iq={kernelName:cx,backendName:"webgl",kernelFunc:oq};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aq{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nc(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||Ll(r),o==="string"){const i=Jt(o,ue(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new aq(s,r),l=[[r]];return e.runWebGLProgram(i,[],o,l)}}const lq={kernelName:hx,backendName:"webgl",kernelFunc:nc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uq{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cq={kernelName:dx,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new uq(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ek="return floor(x);",hq=Qe({opSnippet:ek,packedOpSnippet:ek,cpuKernelImpl:P6}),dq={kernelName:eu,backendName:"webgl",kernelFunc:hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fq=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,pq=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,mq=hn({opSnippet:fq,packedOpSnippet:pq,dtype:"int32"}),gq={kernelName:tu,backendName:"webgl",kernelFunc:mq};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xq{constructor(e){this.variableNames=["A"];const t=Tn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yq{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Tn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wq={kernelName:jE,backendName:"webgl",kernelFunc:vq};let ji,ng=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function vq(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[u,h]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[h,u],f=[h,u,o];if(l||i){const w=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ji==null||w!==ng)&&(ng=w,ji=document.createElement("canvas").getContext("2d",{willReadFrequently:ng})),ji.canvas.width=u,ji.canvas.height=h,ji.drawImage(r,0,0,u,h),r=ji.canvas}const m=t.makeTensorInfo(d,"int32");t.texData.get(m.dataId).usage=as.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),r);const g=ae().getBool("WEBGL_PACK")?new yq(f):new xq(f),y=t.runWebGLProgram(g,[m],"int32");return t.disposeData(m.dataId),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:l}=e,{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:y}=s,w=Or(d),v=un(r.shape,o.shape,u,f,h,m,!1,w);let b;const C=[],S=i!=null,$=l!=null,N=g==="leakyrelu",R=()=>{const F=[r,o],A=(D,T)=>{if(T==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const z=ke({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return C.push(z),z}return D};if(S&&F.push(A(i,d)),$&&F.push(A(l,d)),N){const D=t.makeTensorInfo([],"float32",yo(y,"float32"));F.push(D),C.push(D)}return F};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))b=iN({x:r,filter:o,convInfo:v,backend:t,bias:i,activation:g,preluActivationWeights:l,leakyreluAlpha:y});else if(v.strideWidth<=2&&w==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const F=g?Al(g,!0):null,A=new oN(v,S,F,$,N),D=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],T=R();b=t.runWebGLProgram(A,T,"float32",D)}else if(ae().getBool("WEBGL_CONV_IM2COL"))b=aN({x:r,filter:o,convInfo:v,backend:t,bias:i,activation:g,preluActivationWeights:l,leakyreluAlpha:y});else{const F=g?Al(g,!1):null,A=new rN(v,S,F,$,N),D=R();b=t.runWebGLProgram(A,D,"float32")}const O=ke({inputs:{x:b},backend:t,attrs:{shape:v.outShape}});return C.push(b),C.forEach(F=>t.disposeIntermediateTensorInfo(F)),O}const kq={kernelName:Ph,backendName:"webgl",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:l}=e,{strides:u,pad:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s,y=[];let w=d;w==null&&(w=[1,1]),_(xn(u,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${w}'`);const v=un(r.shape,o.shape,u,w,h,f,!0),b=ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,C=m?Al(m,b):null,S=[r,o],$=i!=null,N=l!=null,R=m==="leakyrelu";if($&&S.push(i),N&&S.push(l),R){const D=t.makeTensorInfo([],"float32",yo(g,"float32"));S.push(D),y.push(D)}let O;b?O=new cN(v,$,C,N,R):O=new uN(v,$,C,N,R);const F=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],A=t.runWebGLProgram(O,S,"float32",F);return y.forEach(D=>t.disposeIntermediateTensorInfo(D)),A}const Iq={kernelName:Ok,backendName:"webgl",kernelFunc:Cq};class $q{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=gt(s.length);let i=`
    int index;`;for(let l=0;l<this.sliceDim;l++)i+=`
          index = round(getIndices(coords[0], ${l}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[l]};
          flattenIndex += index * ${this.strides[l]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sq(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],l=ue(s.shape),[u,h,d,f]=Lx(s,r),m=ke({inputs:{x:r},backend:t,attrs:{shape:[h,i]}}),g=ke({inputs:{x:s},backend:t,attrs:{shape:[ue(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const b=t.readSync(r.dataId),C=t.bufferSync(s),S=M6(b,C,s.dtype,h,i,d,f,s.shape,l);return t.makeTensorInfo(u,s.dtype,S.values)}const y=new $q(i,f,[h,d],s.shape),w=t.runWebGLProgram(y,[g,m],g.dtype),v=ke({inputs:{x:w},backend:t,attrs:{shape:u}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(w),v}const Nq={kernelName:wk,backendName:"webgl",kernelFunc:Sq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tq{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=gt(this.rank),r=Eq(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Eq(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:l}=s,u=je(i,r.shape)[0];if(ae().get("DEBUG")){const C=t.readSync(o.dataId),S=r.shape[u];for(let $=0;$<C.length;++$){const N=C[$];_(N<=S-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${S-1}]`)}}const h=W0(r,o,u,l),d=ue(o.shape),f=[],m=ke({inputs:{x:r},backend:t,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),g=ke({inputs:{x:o},backend:t,attrs:{shape:[h.batchSize,d/h.batchSize]}});f.push(m),f.push(g);const y=[h.batchSize,h.outerSize,d/h.batchSize,h.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const C=t.bufferSync(g),S=t.bufferSync(m),$=z6(S,C,y);return f.forEach(N=>t.disposeIntermediateTensorInfo(N)),t.makeTensorInfo(h.outputShape,$.dtype,$.values)}const w=new Tq(m.shape,y),v=t.runWebGLProgram(w,[m,g],m.dtype);f.push(v);const b=ke({inputs:{x:v},backend:t,attrs:{shape:h.outputShape}});return f.forEach(C=>t.disposeIntermediateTensorInfo(C)),b}const Rq={kernelName:Ed,backendName:"webgl",kernelFunc:fN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dq="return float(a > b);",Aq=`
  return vec4(greaterThan(a, b));
`,Fq=hn({opSnippet:Dq,packedOpSnippet:Aq,cpuKernelImpl:B6,dtype:"bool"}),_q={kernelName:Rd,backendName:"webgl",kernelFunc:Fq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oq="return float(a >= b);",Lq=`
  return vec4(greaterThanEqual(a, b));
`,Pq=hn({opSnippet:Oq,packedOpSnippet:Lq,dtype:"bool",cpuKernelImpl:V6}),Mq={kernelName:nu,backendName:"webgl",kernelFunc:Pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zq(n){const{inputs:e,backend:t}=n,{input:s}=e;return dN(s,!0,t)}const Bq={kernelName:fx,backendName:"webgl",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vq="return float(!isnan(x) && !isinf(x));",Wq=Qe({opSnippet:Vq,dtype:"bool"}),Uq={kernelName:ru,backendName:"webgl",kernelFunc:Wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq="return float(isinf(x));",Hq=Qe({opSnippet:Gq,dtype:"bool"}),jq={kernelName:ou,backendName:"webgl",kernelFunc:Hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq="return float(isnan(x));",qq=Qe({opSnippet:Kq,dtype:"bool"}),Xq={kernelName:iu,backendName:"webgl",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yq="return float(a < b);",Qq=`
  return vec4(lessThan(a, b));
`,Zq=hn({opSnippet:Yq,packedOpSnippet:Qq,cpuKernelImpl:W6,dtype:"bool"}),Jq={kernelName:Ad,backendName:"webgl",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eX="return float(a <= b);",tX=`
  return vec4(lessThanEqual(a, b));
`,nX=hn({opSnippet:eX,packedOpSnippet:tX,cpuKernelImpl:U6,dtype:"bool"}),sX={kernelName:Fd,backendName:"webgl",kernelFunc:nX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=G6(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const oX={kernelName:vk,backendName:"webgl",kernelFunc:rX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX=Ra+`
  return x < 0.0 ? 0./0. : log(x);
`,aX=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,lX=Qe({opSnippet:iX,packedOpSnippet:aX,cpuKernelImpl:H6}),uX={kernelName:au,backendName:"webgl",kernelFunc:lX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cX=Ra+`
  return log(1.0 + x);
`,hX=Qe({opSnippet:cX}),dX={kernelName:lu,backendName:"webgl",kernelFunc:hX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fX="return float(a >= 1.0 && b >= 1.0);",pX=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,mX=hn({opSnippet:fX,packedOpSnippet:pX,dtype:"bool"}),gX={kernelName:_d,backendName:"webgl",kernelFunc:mX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX="return float(!(x >= 1.0));",yX=Qe({opSnippet:xX}),wX={kernelName:Od,backendName:"webgl",kernelFunc:yX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX="return float(a >= 1.0 || b >= 1.0);",bX=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,kX=hn({opSnippet:vX,packedOpSnippet:bX,dtype:"bool"}),CX={kernelName:Ld,backendName:"webgl",kernelFunc:kX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IX{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=t,l=e[3]-1;this.outputShape=e;let u;const h=`float(${s}) + float(${r}) * sum`;o===.5?u=`inversesqrt(${h})`:o===1?u=`1.0/(${h})`:u=`exp(log(${h}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${l}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $X{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,l=e[3]-1;this.outputShape=e;let u;const h=`float(${s}) + float(${r}) * sum`;o===.5?u=`inversesqrt(${h})`:o===1?u=`1.0/(${h})`:u=`exp(log(${h}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${l}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SX=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:l,beta:u}=s,h=ae().getBool("WEBGL_PACK_NORMALIZATION")?new $X(r.shape,o,i,l,u):new IX(r.shape,o,i,l,u);return t.runWebGLProgram(h,[r],r.dtype)},NX={kernelName:Pd,backendName:"webgl",kernelFunc:SX};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TX{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:l,bias:u,alpha:h,beta:d}=s,f=new TX(r.shape,l,u,h,d);return t.runWebGLProgram(f,[r,o,i],r.dtype)},RX={kernelName:mx,backendName:"webgl",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DX(n,e,t,s){const r=ue(e),i=ue(n.shape)/r,l=ke({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),u=yi(l,n.dtype,"max",s),h=ke({inputs:{x:u},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(u),h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,l=r.shape.length,u=je(o,r.shape);let h=u;const d=Tt(h,l),f=d!=null,m=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(m){const S=t.texData.get(g.dataId).values,$=new Array(l);for(let O=0;O<$.length;O++)$[O]=r.shape[d[O]];const N=$1(S,r.shape,r.dtype,d,$);g=t.makeTensorInfo($,r.dtype);const R=t.texData.get(g.dataId);R.values=N}else g=Bf(r,d,t);h=Ft(h.length,l)}cn("max",h,l);const[y,w]=tn(g.shape,h);let v=y;i&&(v=Bt(y,u));let b;if(m){const S=t.texData.get(g.dataId).values,$=j6(S,ue(w),v,r.dtype);b=t.makeTensorInfo(v,r.dtype);const N=t.texData.get(b.dataId);N.values=$}else b=DX(g,w,v,t);return f&&t.disposeIntermediateTensorInfo(g),b}const AX={kernelName:Md,backendName:"webgl",kernelFunc:pN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX=S1+`
  return max(a, b);
`,_X=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ju+`
  return result;
`,OX=hn({opSnippet:FX,packedOpSnippet:_X,cpuKernelImpl:K6}),LX={kernelName:uu,backendName:"webgl",kernelFunc:OX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Qu(r,"maxPool");const{filterSize:o,strides:i,pad:l,dimRoundingMode:u}=s,h=1;_(xn(i,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const d=Ns(r.shape,o,i,h,l,u);if(d.filterWidth===1&&d.filterHeight===1&&ot(d.inShape,d.outShape))return Qn({inputs:{x:r},backend:t});const f=new Fl(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const MX={kernelName:zd,backendName:"webgl",kernelFunc:PX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:l,dataFormat:u,dimRoundingMode:h}=s,d=[1,1,1],f=_r(r.shape,o,i,d,l,h,u),m=new T1(f,"max",!1);return t.runWebGLProgram(m,[r],r.dtype)}const BX={kernelName:Bd,backendName:"webgl",kernelFunc:zX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VX{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,l=o-1-e.padInfo.top,u=i-1-e.padInfo.left,h=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${h} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class WX{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=u-1-e.padInfo.front,m=h-1-e.padInfo.top,g=d-1-e.padInfo.left,y=u*h*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${m}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${l}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${y} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${h} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=s,f=[1,1,1],m=_r(i.shape,l,u,f,h,d),g=new T1(m,"max",!0),y=t.runWebGLProgram(g,[i],i.dtype),w=new WX(m),v=t.runWebGLProgram(w,[r,y],i.dtype);return t.disposeIntermediateTensorInfo(y),v}const GX={kernelName:xx,backendName:"webgl",kernelFunc:UX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HX(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,l=o;Qu([o,i],"maxPoolGrad");const{filterSize:u,strides:h,pad:d,dimRoundingMode:f}=s,m=Ns(l.shape,u,h,1,d,f),g=!0,y=new Fl(m,"max",g),w=t.runWebGLProgram(y,[l],l.dtype),v=new VX(m),b=t.runWebGLProgram(v,[r,w],l.dtype);return t.disposeIntermediateTensorInfo(w),b}const jX={kernelName:gx,backendName:"webgl",kernelFunc:HX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KX(n,e,t,s){let r=new Fl(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new Fl(t,"max",!0,!0,e);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qX={kernelName:bk,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:l}=e,u=t;_(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const h=[1,1];_(xn(o,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=Ns(s.shape,r,o,h,i),[f,m]=KX(s,l,d,u);return[f,m]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XX(n,e,t,s){const r=ue(e),i=ue(n.shape)/r,l=ke({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),u=yi(l,"float32","mean",s),h=ke({inputs:{x:u},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(u),h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YX={kernelName:Vd,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,i=t,l=s.shape.length,u=je(o,s.shape);let h=u;const d=Tt(h,l),f=d!=null,m=i.shouldExecuteOnCPU([s]),g=[];let y=s;if(f){if(m){const $=i.texData.get(y.dataId).values,N=new Array(l);for(let F=0;F<N.length;F++)N[F]=s.shape[d[F]];const R=$1($,s.shape,s.dtype,d,N);y=i.makeTensorInfo(N,s.dtype);const O=i.texData.get(y.dataId);O.values=R}else y=Bf(s,d,i);g.push(y),h=Ft(h.length,l)}cn("sum",h,l);const[w,v]=tn(y.shape,h);let b=w;r&&(b=Bt(w,u));const C=XX(y,v,b,i);for(const S of g)i.disposeIntermediateTensorInfo(S);return C}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,l=r.shape.length,u=je(o,r.shape);let h=u;const d=Tt(h,l);let f=r;d!=null&&(f=Nn({inputs:{x:r},backend:t,attrs:{perm:d}}),h=Ft(h.length,r.shape.length)),cn("min",h,l);const[m,g]=tn(f.shape,h),y=ue(g),w=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),v=yi(w,w.dtype,"min",t);let b;if(i){const C=Bt(m,u);b=ke({inputs:{x:v},backend:t,attrs:{shape:C}})}else b=ke({inputs:{x:v},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),b}const ZX={kernelName:Wd,backendName:"webgl",kernelFunc:QX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JX=S1+`
  return min(a, b);
`,e7=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ju+`
  return result;
`,t7=hn({opSnippet:JX,packedOpSnippet:e7,cpuKernelImpl:q6}),n7={kernelName:cu,backendName:"webgl",kernelFunc:t7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s7{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,o=gt(r),i=t.map(d=>d[0]).join(","),l=t.map((d,f)=>d[0]+e[f]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),h=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${h};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${h};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${l});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${h};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${h};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r7{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((y,w)=>y[0]+e[w]+y[1]);const r=e.length,o=gt(r),i=t.map(y=>y[0]).join(","),l=t.map((y,w)=>y[0]+e[w]).join(","),u=$n("rc",r),h=$n("source",r),d=`${u[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${h.slice(-2).join()})`,m=s==="reflect"?0:1;let g="";if(r===1){const y=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${m};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${m};
        }
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${h.join()}), ${f});
        ${u[r-1]} += 1;
        if(${d}) {
          ${y}
          result[1] = getChannel(getX(${h.join()}), ${f});
        }
      `}else{const y=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${m}) +
                gte * ((end - 1) * 2 - source + ${m});
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${h.join()}), ${f});
        ${u[r-1]} += 1;
        if(${d}) {
          ${y}
          result[1] = getChannel(getX(${h.join()}), ${f});
        }
        rc = outputLoc;
        ${u[r-2]} += 1;
        if(${u[r-2]} < ${this.outputShape[r-2]}) {
          ${y}
          result[2] = getChannel(getX(${h.join()}), ${f});
          ${u[r-1]} += 1;
          if(${d}) {
            ${y}
            result[3] = getChannel(getX(${h.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${l});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o7=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,i=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new r7(s.shape,r,o):new s7(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},i7={kernelName:Ud,backendName:"webgl",kernelFunc:o7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a7=`if (b == 0.0) return NAN;
  return mod(a, b);`,l7=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Ju+`
  return result;
`,u7=hn({opSnippet:a7,packedOpSnippet:l7}),c7={kernelName:hu,backendName:"webgl",kernelFunc:u7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h7{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7=`
if (a == b) {
  return 1.0;
};
return a / b;`,f7=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,mN=hn({opSnippet:d7,packedOpSnippet:f7,checkOutOfBounds:!0}),p7={kernelName:Xl,backendName:"webgl",kernelFunc:mN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tk="return a - b;",gN=hn({opSnippet:tk,packedOpSnippet:tk,supportsComplex:!0,cpuKernelImpl:fj}),m7={kernelName:Nu,backendName:"webgl",kernelFunc:gN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xN(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=je([o],r.shape),l=pN({inputs:{x:r},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),u=Bt(l.shape,i),h=ke({inputs:{x:l},backend:t,attrs:{shape:u}}),d=gN({inputs:{a:r,b:h},backend:t}),f=hN({inputs:{x:d},backend:t}),m=Vf({inputs:{x:f},backend:t,attrs:{axis:i,keepDims:!1}}),g=ke({inputs:{x:m},backend:t,attrs:{shape:u}}),y=mN({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}const g7={kernelName:lf,backendName:"webgl",kernelFunc:xN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:l}=s,u=l?r:xN({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),h=u.shape[0],d=u.shape[1],f=new h7(h,d,o),m=[[i]],g=t.runWebGLProgram(f,[u],"int32",m);return l||t.disposeIntermediateTensorInfo(u),g}const y7={kernelName:kk,backendName:"webgl",kernelFunc:x7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7=Rs+`
  return -x;
`,v7=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function b7(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[i,l]=Y6(o.values,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,i)}let r;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new qo(s.shape,v7):r=new Rr(s.shape,w7),t.runWebGLProgram(r,[s],s.dtype)}const k7={kernelName:Gd,backendName:"webgl",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7=p0;function I7(n){os("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u}=s,h=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:f}=C7(h,d,i,l,u);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const $7={kernelName:yx,backendName:"webgl",kernelFunc:I7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=m0;function N7(n){os("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,padToMaxOutputSize:h}=s,d=t.readSync(r.dataId),f=t.readSync(o.dataId),{selectedIndices:m,validOutputs:g}=S7(d,f,i,l,u,h);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const T7={kernelName:wx,backendName:"webgl",kernelFunc:N7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7=g0;function R7(n){os("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,softNmsSigma:h}=s,d=t.readSync(r.dataId),f=t.readSync(o.dataId),m=i,g=l,y=u,w=h,{selectedIndices:v,selectedScores:b}=E7(d,f,m,g,y,w);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const D7={kernelName:vx,backendName:"webgl",kernelFunc:R7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A7{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:l,offValue:u}=s,h=ue(r.shape),d=new A7(h,i,l,u),f=ke({inputs:{x:r},backend:t,attrs:{shape:[h]}}),m=t.runWebGLProgram(d,[f],o);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,i],y=ke({inputs:{x:m},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(m),y},_7={kernelName:Kd,backendName:"webgl",kernelFunc:F7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cd(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=tc({inputs:{input:s},backend:t}),o=cd({inputs:{x:r},backend:t}),i=Wf({inputs:{input:s},backend:t}),l=cd({inputs:{x:i},backend:t}),u=$o({inputs:{real:o,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),u}else return nc({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const O7={kernelName:hf,backendName:"webgl",kernelFunc:cd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yN(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=tc({inputs:{input:s},backend:t}),o=yN({inputs:{x:r},backend:t}),i=Wf({inputs:{input:s},backend:t}),l=cd({inputs:{x:i},backend:t}),u=$o({inputs:{real:o,imag:l},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),u}else return nc({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const L7={kernelName:jd,backendName:"webgl",kernelFunc:yN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Vg({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Hg(o,d.shape,"All tensors passed to stack must have matching shapes"),_(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],u=e.map(d=>{const f=Vg({inputs:{input:d},backend:t,attrs:{dim:r}});return l.push(f),f}),h=sN({inputs:u,backend:t,attrs:{axis:r}});return l.forEach(d=>t.disposeIntermediateTensorInfo(d)),h}const M7={kernelName:qd,backendName:"webgl",kernelFunc:P7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z7{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((h,d)=>h[0]+e[d]+h[1]);const r=e.length,o=gt(r),i=t.map(h=>h[0]).join(","),l=t.map((h,d)=>h[0]+e[d]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${l});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B7{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,v)=>w[0]+e[v]+w[1]);const r=e.length,o=gt(r),i=t.map(w=>w[0]).join(","),l=t.map((w,v)=>w[0]+e[v]).join(","),u=$n("rc",r),h=$n("source",r),d=`${u[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${h.slice(-2).join()})`,m=[`${o} rc = outputLoc;`,`${u[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${u[r-2]} += 1;
       if(${u[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${u[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let y="";for(let w=0,v=r===1?2:4;w<v;w++)y+=`
        ${m[w]}
        if (${g}) {
          result[${w}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${w}] = getChannel(getX(${h.join()}), ${f});
        }
      `;y+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${l});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wN=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;if(ue(r.shape)===0){const h=o.map((d,f)=>d[0]+r.shape[f]+d[1]);return nc({backend:t,attrs:{shape:h,value:i,dtype:r.dtype}})}const l=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B7(r.shape,o,i):new z7(r.shape,o,i),u=[[i]];return t.runWebGLProgram(l,[r],r.dtype,u)},V7={kernelName:Xd,backendName:"webgl",kernelFunc:wN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,U7=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Ju+`
  return result;
`,G7=hn({opSnippet:W7,packedOpSnippet:U7}),H7={kernelName:fu,backendName:"webgl",kernelFunc:G7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,l=r.shape.length,u=[],h=je(o,r.shape);let d=h;const f=Tt(d,l);let m=r;f!=null&&(m=Nn({inputs:{x:r},backend:t,attrs:{perm:f}}),d=Ft(d.length,l),u.push(m)),cn("prod",d,l);let g;if(t.shouldExecuteOnCPU([m])){const y=t.texData.get(m.dataId).values,{outVals:w,outShape:v,outDtype:b}=Z6(m.shape,m.dtype,y,d);g=t.makeTensorInfo(v,b,w)}else{const[y,w]=tn(m.shape,d),v=ue(w),b=ke({inputs:{x:m},backend:t,attrs:{shape:[-1,v]}}),C=Dx(r.dtype),S=yi(b,C,"prod",t);g=ke({inputs:{x:S},backend:t,attrs:{shape:y}}),u.push(b),u.push(S)}if(i){u.push(g);const y=Bt(g.shape,h);g=ke({inputs:{x:g},backend:t,attrs:{shape:y}})}return u.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const K7={kernelName:Qd,backendName:"webgl",kernelFunc:j7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:l}=s,u=r.map(b=>t.readSync(b.dataId)),h=r.map(b=>b.shape),d=t.readSync(o.dataId),f=t.readSync(i.dataId),[m,g,y]=J6(u,h,d,o.shape,o.dtype,f,i.shape,l),w=m.map(b=>t.makeTensorInfo([b.length],"int32",b)),v=t.makeTensorInfo(y,o.dtype,g);return w.concat([v])}const X7={kernelName:Ck,backendName:"webgl",kernelFunc:q7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:l}=e,{rowPartitionTypes:u}=s,h=t.readSync(r.dataId),d=t.readSync(o.dataId),f=t.readSync(i.dataId),m=l.map(v=>t.readSync(v.dataId)),g=l.map(v=>v.shape),[y,w]=ej(h,r.shape,d,o.shape,o.dtype,f,i.shape,m,g,u);return t.makeTensorInfo(y,o.dtype,w)}const Q7={kernelName:Ik,backendName:"webgl",kernelFunc:Y7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vN=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:i}=t,l=tj(s,r,o,i);return e.makeTensorInfo([l.length],i,l)},Z7={kernelName:bx,backendName:"webgl",kernelFunc:vN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7="return 1.0 / x;",e9=Qe({opSnippet:J7}),t9={kernelName:pu,backendName:"webgl",kernelFunc:e9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n9=Rs+`
  return (x < 0.0) ? 0.0 : x;
`,s9=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,r9=Qe({opSnippet:n9,packedOpSnippet:s9}),o9={kernelName:mu,backendName:"webgl",kernelFunc:r9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i9=Rs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,a9=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,l9=Qe({opSnippet:i9,packedOpSnippet:a9}),u9={kernelName:gu,backendName:"webgl",kernelFunc:l9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c9{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,l,u,h]=e;this.outputShape=[i,t,s,h];const d=[r&&t>1?l-1:l,r&&s>1?u-1:u],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;o?m="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h9{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,l,u,h]=e;this.outputShape=[i,t,s,h];const d=[r&&t>1?l-1:l,r&&s>1?u-1:u],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;o?m="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:l}=s,[u,h]=l,d=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new h9(r.shape,u,h,o,i):new c9(r.shape,u,h,o,i);return t.runWebGLProgram(d,[r],"float32")}const f9={kernelName:ef,backendName:"webgl",kernelFunc:d9};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p9{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,l]=e,u=[s&&i>1?r-1:r,s&&l>1?o-1:o],h=[s&&i>1?i-1:i,s&&l>1?l-1:l],d=u[0]/h[0],f=u[1]/h[1],m=1/d,g=1/f,y=Math.ceil(m)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,l=new p9(o.shape,r.shape,i);return t.runWebGLProgram(l,[o],o.dtype)}const g9={kernelName:Ix,backendName:"webgl",kernelFunc:m9};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x9{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,l,u,h]=e;this.outputShape=[i,t,s,h];const d=[r&&t>1?l-1:l,r&&s>1?u-1:u],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;o?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y9{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,l,u,h]=e;this.outputShape=[i,t,s,h];const d=[r&&t>1?l-1:l,r&&s>1?u-1:u],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;o?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:l}=s,[u,h]=l,d=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new y9(r.shape,u,h,o,i):new x9(r.shape,u,h,o,i);return t.runWebGLProgram(d,[r],r.dtype)}const v9={kernelName:Jd,backendName:"webgl",kernelFunc:w9};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b9{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,l]=e,u=[s&&i>1?r-1:r,s&&l>1?o-1:o],h=[s&&i>1?i-1:i,s&&l>1?l-1:l],d=u[0]/h[0],f=u[1]/h[1],m=1/d,g=1/f,y=Math.ceil(m)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${h[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${h[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k9(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,l=new b9(o.shape,r.shape,i);return t.runWebGLProgram(l,[o],o.dtype)}const C9={kernelName:Cx,backendName:"webgl",kernelFunc:k9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I9{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=l=>t.indexOf(l)!==-1&&e[l]!==1?`${e[l]} - coords[${l}] - 1`:`coords[${l}]`,o=e.map((l,u)=>r(u)).join(","),i=gt(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $9{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=$n("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,l=gt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${l} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(r.slice())};
          if(${o}){
            result.g = ${h(r.slice())};
          }
          if(${i}) {
            result.b = ${d(r.slice())};
            if(${o}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(y){return m(y)}function h(y){return y[s-1]="("+y[s-1]+" + 1)",m(y)}function d(y){return y[s-2]="("+y[s-2]+" + 1)",m(y)}function f(y){return y[s-1]="("+y[s-1]+" + 1)",y[s-2]="("+y[s-2]+" + 1)",m(y)}function m(y){const w=e.map((C,S)=>g(S,y)),v=w.join(","),b=w.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${b}))`}function g(y,w){return t.indexOf(y)!==-1&&e[y]!==1?`${e[y]} - ${w[y]} - 1`:`${w[y]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,i=r.shape.length,l=je(o,r.shape);if(i===0)return Qn({inputs:{x:r},backend:t});const u=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $9(r.shape,l):new I9(r.shape,l);return t.runWebGLProgram(u,[r],r.dtype)}const N9={kernelName:tf,backendName:"webgl",kernelFunc:S9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T9{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E9={kernelName:Rx,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,l=t,u=new T9(s.shape,o),[h,d]=S0(i,s.shape[1],s.shape[2]),f=[[h,d,Math.sin(r),Math.cos(r)]];return l.runWebGLProgram(u,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R9=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,D9=Qe({opSnippet:R9}),A9={kernelName:xu,backendName:"webgl",kernelFunc:D9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F9="return inversesqrt(x);",_9=Qe({opSnippet:F9,cpuKernelImpl:nj}),O9={kernelName:yu,backendName:"webgl",kernelFunc:_9};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bN{constructor(e,t,s,r,o,i,l=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const u=gt(o.length),h=gt(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const f=`getIndices(${d})`;let m="";r===1?m="i":r===2&&(m="i, coords[1]");const g=`getUpdates(${m})`,y=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${g};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L9(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:f}=Au(o,r,i),m=[f/h,h];if(f===0)return t.makeTensorInfo(i,r.dtype);const g=ke({inputs:{x:r},backend:t,attrs:{shape:[u,l]}}),y=ke({inputs:{x:o},backend:t,attrs:{shape:[u,h]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0])),v=new bN(u,l,g.shape.length,y.shape.length,d,m),b=t.runWebGLProgram(v,[y,g,w],y.dtype),C=ke({inputs:{x:b},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),C}const P9={kernelName:$k,backendName:"webgl",kernelFunc:L9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M9{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,l=ae().getNumber("WEBGL_VERSION")===2?o:i,u=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${l}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z9(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,l=new M9(r.shape[0],r.shape[1],o.shape[1],i),u=[[r.shape[1]]];return t.runWebGLProgram(l,[r,o],"int32",u)}const B9={kernelName:Sk,backendName:"webgl",kernelFunc:z9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V9{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const l=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],h=[];for(let d=0;d<t.length;d++)h.push(`${l[d]}`),d<e&&u.push(`${l[d]}`);r=u.join(),o=h.join()}const i=gt(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W9(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,i=new V9(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(i,[s,r,o],Kn(r.dtype,o.dtype))}const U9={kernelName:nf,backendName:"webgl",kernelFunc:W9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G9=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${If};
  float scale = ${$f};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,H9=Qe({opSnippet:G9}),j9={kernelName:wu,backendName:"webgl",kernelFunc:H9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K9=Ra+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,q9=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,X9=Qe({opSnippet:K9,packedOpSnippet:q9,cpuKernelImpl:rj}),Y9={kernelName:Cu,backendName:"webgl",kernelFunc:X9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q9=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Z9=Qe({opSnippet:Q9}),J9={kernelName:ku,backendName:"webgl",kernelFunc:Z9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eY=Ra+`
  return sin(x);
`,tY=Qe({opSnippet:eY}),nY={kernelName:vu,backendName:"webgl",kernelFunc:tY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sY=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,rY=Qe({opSnippet:sY}),oY={kernelName:bu,backendName:"webgl",kernelFunc:rY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iY=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,aY=Qe({opSnippet:iY}),lY={kernelName:Iu,backendName:"webgl",kernelFunc:aY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uY=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;_(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const l=o.reduce((b,C)=>b*C),u=[[0,0]];u.push(...i);for(let b=1+o.length;b<r.shape.length;++b)u.push([0,0]);const h=[],d=wN({inputs:{x:r},backend:t,attrs:{paddings:u,constantValue:0}}),f=Pu(d.shape,o,l,!1),m=Mu(f.length,o.length,!1),g=zu(d.shape,o,l,!1),y=ke({inputs:{x:d},backend:t,attrs:{shape:f}}),w=Nn({inputs:{x:y},backend:t,attrs:{perm:m}}),v=ke({inputs:{x:w},backend:t,attrs:{shape:g}});return h.push(d),h.push(y),h.push(w),h.forEach(b=>t.disposeIntermediateTensorInfo(b)),v},cY={kernelName:of,backendName:"webgl",kernelFunc:uY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const l=t.readSync(s.dataId),u=t.readSync(r.dataId),h=t.readSync(o.dataId),d=t.readSync(i.dataId)[0],[f,m,g,y,w]=ij(l,s.shape,s.dtype,u,r.dtype,h,d);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(v=>Number(v)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const dY={kernelName:Nk,backendName:"webgl",kernelFunc:hY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(r.dataId)),l=t.readSync(s.dataId),u=Array.from(t.readSync(o.dataId)),[h,d,f]=aj(l,s.shape,s.dtype,i,u);return[t.makeTensorInfo(d,s.dtype,h),t.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}const pY={kernelName:Tk,backendName:"webgl",kernelFunc:fY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mY(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(o.dataId),[h,d]=G2(i,s.shape,s.dtype,l,u,!0);return t.makeTensorInfo(d,s.dtype,h)}const gY={kernelName:Ek,backendName:"webgl",kernelFunc:mY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(o.dataId),[h,d]=G2(i,s.shape,s.dtype,l,u);return t.makeTensorInfo(d,s.dtype,h)}const yY={kernelName:Rk,backendName:"webgl",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:l}=s,{sliceRank:u,numUpdates:h,sliceSize:d,strides:f,outputSize:m}=Au(o,r,l),g=!1;if(o.dtype==="string"){const b=t.bufferSync(r),C=t.bufferSync(o),S=co(t.readSync(i.dataId)[0]),$=sj(b,C,l,m,d,h,u,f,S,g);return t.makeTensorInfo(l,$.dtype,$.values)}const y=new bN(h,u,r.shape.length,o.shape.length,f,[m,1],g),w=t.runWebGLProgram(y,[o,r,i],o.dtype),v=ke({inputs:{x:w},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(w),v}const vY={kernelName:Dk,backendName:"webgl",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,l=je(i,r.shape)[0],u=V0(r,o,l),h=r.shape.length,d=new Array(h).fill(0),f=r.shape.slice();return u.map(m=>{const g=[...f];g[l]=m;const y=Da({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[l]+=m,y})}const kY={kernelName:af,backendName:"webgl",kernelFunc:bY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nk="return sqrt(x);",CY=Qe({opSnippet:nk,packedOpSnippet:nk,cpuKernelImpl:lj}),IY={kernelName:$u,backendName:"webgl",kernelFunc:CY};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Y="return x * x;",SY=Qe({opSnippet:$Y}),NY={kernelName:$x,backendName:"webgl",kernelFunc:SY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sk="return (a - b) * (a - b);",TY=hn({opSnippet:sk,packedOpSnippet:sk}),EY={kernelName:Su,backendName:"webgl",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=Rs+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Rr(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const DY={kernelName:Du,backendName:"webgl",kernelFunc:RY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AY{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=gt(s.length),i=gt(s.length);let l="";if(r===1)l="coords * strides + begin";else{let u=0;l=s.map((h,d)=>(u++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${u-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:l,beginMask:u,endMask:h,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:m}=s,{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:v,isSimpleSlice:b,begin:C,end:S,strides:$}=Vx(r.shape,o,i,l,u,h,d,f,m);let N;if(w)N=ke({inputs:{x:r},backend:t,attrs:{shape:y}});else if(v||b){_(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const O=Mx(C,S,$),F=Da({inputs:{x:r},backend:t,attrs:{begin:C,size:O}});N=ke({inputs:{x:F},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(F)}else if(t.shouldExecuteOnCPU([r])){const F=t.readSync(r.dataId),A=He(r.shape,r.dtype,F),D=uj(g,A,$,C);N=t.makeTensorInfo(y,r.dtype,D.values)}else{const F=new AY(C,$,g);N=t.runWebGLProgram(F,[r],r.dtype)}const R=ke({inputs:{x:N},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(N),R}const _Y={kernelName:Sx,backendName:"webgl",kernelFunc:FY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OY(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:l,padWidth:u,preserveShortSequences:h}=s,{data:d,dataSplits:f}=e,m=t.readSync(d.dataId),g=t.readSync(f.dataId),[y,w]=cj(m,g,r,o,i,l,u,h);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(f.shape,"int32",w)]}const LY={kernelName:Ak,backendName:"webgl",kernelFunc:OY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const l=t.readSync(o.dataId),u=t.readSync(i.dataId)[0],[h,d,f]=hj(l,u,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",h),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const MY={kernelName:Fk,backendName:"webgl",kernelFunc:PY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zY(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),l=dj(i,r);return t.makeTensorInfo(o.shape,"int32",l)}const BY={kernelName:_k,backendName:"webgl",kernelFunc:zY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VY="return tan(x);",WY=Qe({opSnippet:VY}),UY={kernelName:Tu,backendName:"webgl",kernelFunc:WY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GY=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,HY=Qe({opSnippet:GY}),jY={kernelName:Eu,backendName:"webgl",kernelFunc:HY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KY{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*t[i];this.outputShape=s,this.rank=s.length;const r=gt(this.rank),o=qY(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function qY(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const u=t.readSync(r.dataId),h=r.dtype==="string"?u.map(m=>co(m)):u,d=He(r.shape,r.dtype,h),f=pj(d,o);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const i=new KY(r.shape,o);return t.runWebGLProgram(i,[r],r.dtype)}const XY={kernelName:Ru,backendName:"webgl",kernelFunc:kN};class YY{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class QY{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wo(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function rk(n){let e=1;for(;e<n;)e*=2;return e}function ZY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s,l=ae().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=ae().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),h=r.shape,d=h[h.length-1];if(t.shouldExecuteOnCPU([r])||d<l||o>u){const D=t.readSync(r.dataId),[T,z]=mj(D,h,r.dtype,o,i);return[t.makeTensorInfo(T.shape,T.dtype,T.values),t.makeTensorInfo(z.shape,z.dtype,z.values)]}if(o===0)return h[h.length-1]=0,[t.makeTensorInfo(h,r.dtype,[]),t.makeTensorInfo(h,"int32",[])];if(d===1)return[r,nc({attrs:{shape:h,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),m=f!==null&&f.isPacked,g=m?t.unpackTensor(r):r,w=ue(h)/d,v=ke({inputs:{x:g},attrs:{shape:[w,d]},backend:t});m&&Wo(t,g);const b=rk(o),C=rk(d);let S=null;const $=()=>S===null?[v,v]:[v,S],N=(D,T,z)=>{const U=$(),Q=new YY(z),J=[[d],[S===null?1:0],[Number.NEGATIVE_INFINITY],[D],[T]],ne=S;S=t.runWebGLProgram(Q,U,"int32",J),Wo(t,ne)};for(let D=1;D<b;D*=2){const T=D*2;for(let z=D;z>=1;z/=2)N(T,z,[w,C])}for(let D=C;D>b;D/=2){const T=$(),z=new QY([w,D/2]),Q=[[d],[S===null?1:0],[b]],q=S;S=t.runWebGLProgram(z,T,"int32",Q),Wo(t,q);const J=b/2,ne=J*2;for(let B=J;B>=1;B/=2)N(ne,B,S.shape)}let R=S;S=Da({inputs:{x:S},backend:t,attrs:{begin:0,size:[w,o]}}),Wo(t,R);let O=fN({inputs:{x:v,indices:S},backend:t,attrs:{axis:1,batchDims:1}});Wo(t,v);const F=h.slice(0,-1);F.push(o),R=S,S=ke({inputs:{x:S},attrs:{shape:F},backend:t}),Wo(t,R);const A=O;return O=ke({inputs:{x:O},attrs:{shape:F},backend:t}),Wo(t,A),[O,S]}const JY={kernelName:Nx,backendName:"webgl",kernelFunc:ZY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eQ{constructor(e,t,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const l=s==="nearest"?1:2;let u;switch(r){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${l} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:l,fillValue:u,outputShape:h}=s,[d,f,m,g]=r.shape,[y,w]=h??[f,m],v=[d,y,w,g],b=new eQ(f,m,i,l,u,v);return t.runWebGLProgram(b,[r,o],"float32")}const nQ={kernelName:Tx,backendName:"webgl",kernelFunc:tQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Qu(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:l,outputShape:u,indices:h}=gj(i,r,o.shape,o.dtype);return[s.makeTensorInfo(u,o.dtype,l),s.makeTensorInfo([h.length],"int32",h)]}const rQ={kernelName:Ex,backendName:"webgl",kernelFunc:sQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,l=i.shape.length,u=r.shape[o],h=new Array(l-1);let d=0;for(let w=0;w<l;w++)w!==o&&(h[d++]=i.shape[w]);const f=[],m=new Array(l).fill(0),g=i.shape.slice();g[o]=1;const y=new Array(u);for(let w=0;w<y.length;w++){m[o]=w;const v=Da({inputs:{x:i},backend:t,attrs:{begin:m,size:g}}),b=ke({inputs:{x:v},backend:t,attrs:{shape:h}});y[w]=b,f.push(v)}return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const iQ={kernelName:uf,backendName:"webgl",kernelFunc:oQ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aQ{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,l=i*Math.ceil(o/s);this.outputShape=[r,l];const u="0.0",h="sumValue",d=Math.floor(s/4)*4,f=s%4,m=`
        sumValue += dot(values, segFilter);
    `;let g="";o%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let y="";o%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${y}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(${h});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s,l=r.shape.length,u=[];let h=0;const d=Tt([h],l);let f=r;d!=null&&(f=Nn({inputs:{x:r},backend:t,attrs:{perm:d}}),u.push(f),h=Ft(1,l)[0]);const m=pI(f.shape,h,i),g=ue([f.shape[h]]),y=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});u.push(y);const w=Dx(r.dtype),v=($,N,R,O,F)=>{const A=$.shape[0],D=$.shape[1],T=fI(D,F),z={windowSize:T,inSize:D,batchSize:A,numSegments:F},U=new aQ(z,N),Q=t.compileAndRun(U,[$,R],O);if(u.push(Q),Q.shape[1]===F)return Q;const q=vN({backend:t,attrs:{start:0,stop:F,step:1,dtype:"float32"}}),J=kN({inputs:{x:q},backend:t,attrs:{reps:[D/T]}});return u.push(q),u.push(J),v(Q,N,J,O,F)},b=v(y,"unsortedSegmentSum",o,w,i),C=ke({inputs:{x:b},backend:t,attrs:{shape:m}});let S=C;if(d!=null){u.push(C);const $=vo(d);S=Nn({inputs:{x:S},backend:t,attrs:{perm:$}})}return u.forEach($=>t.disposeIntermediateTensorInfo($)),S}const uQ={kernelName:cf,backendName:"webgl",kernelFunc:lQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cQ=[a5,u5,d5,m5,x5,v5,k5,I5,T5,R5,F5,L5,z5,U5,j5,q5,Y5,eK,nK,rK,lK,mK,xK,wK,$K,NK,DK,Gj,_K,zK,UK,XK,QK,JK,t8,s8,i8,u8,d8,p8,g8,y8,b8,C8,N8,E8,A8,O8,P8,V8,H8,X8,Z8,tq,nq,rq,iq,lq,cq,dq,gq,wq,kq,Iq,Nq,Rq,_q,Mq,Uj,Bq,PK,Uq,jq,Xq,jj,Jq,sX,oX,uX,dX,gX,wX,CX,NX,RX,AX,LX,MX,BX,GX,jX,qX,YX,ZX,n7,i7,c7,y7,Xj,k7,$7,T7,D7,bK,_7,L7,M7,V7,H7,qj,K7,X7,Q7,Z7,kK,p7,t9,o9,u9,Qj,f9,g9,v9,C9,N9,E9,A9,O9,P9,B9,U9,j9,Y9,J9,nY,oY,fK,g7,lY,cY,dY,pY,gY,yY,vY,kY,IY,NY,EY,DY,_Y,LY,MY,BY,m7,r5,UY,jY,XY,JY,nQ,o5,rQ,iQ,uQ,O7];for(const n of cQ)Lk(n);const hQ=()=>{const[n,e]=Nr.useState([]),[t,s]=Nr.useState(""),[r,o]=Nr.useState(null),[i,l]=Nr.useState(null),[u,h]=Nr.useState(null),d=Nr.useRef(null),f=async()=>{try{const S=await(await fetch("muds/model.json")).json(),$=await oz(sD(S));o($);const R=await(await fetch("muds/tokenizer.json")).json();l(R);const F=await(await fetch("muds/intents.json")).json();h(F.intents)}catch(C){console.log(C)}};Nr.useEffect(()=>{f()},[]);const m=C=>{console.log(C);try{return i?C.map(S=>{const $=S.toLowerCase().trim().split(" ");console.log("Aqui");const N="are",R=JSON.parse(i.config.word_index);return $.map(O=>R[O]||0)}):[]}catch(S){console.log(S)}},g=async C=>{if(!r||!i||!u)return"Cargando el modelo, por favor espera...";const S=m([C]),$=y(S,r.inputs[0].shape[1]),N=r.predict(_h($)),R=N.argMax(-1).dataSync()[0],O=N.dataSync();if(console.log("Probabilidades predichas:",O),console.log("Sequences: ",S),console.log("Padded Sequences: ",$),console.log("Prediction: ",N),console.log("ndice de respuesta:",R),console.log("Intents: ",u.length),R<0||R>=u.length)return console.log("ndice de respuesta fuera de rango:",R),"Lo siento, no pude entender tu solicitudddddd. Puedes intentar otra vez?";const F=u[R];console.log("Intent encontrado:",F);const A=Math.floor(Math.random()*F.responses.length);return F.responses[A]},y=(C,S)=>C.map($=>{const N=Array.from({length:S},()=>0);for(let R=0;R<Math.min($.length,S);R++)N[R]=$[R];return N}),w=async()=>{if(console.log("Input: ",t),t.trim()==="")return;const C=new Date().toLocaleString(),S={text:t,sender:"user",timestamp:C};e($=>[...$,S]);try{console.log(t);const N={text:await g(t),sender:"bot",timestamp:C};e(R=>[...R,N])}catch($){console.log($);const N={text:"Ocurri un error. Enva un mensaje nuevamente...",sender:"bot",timestamp:C};e(R=>[...R,N])}s("")},v=C=>{C.key==="Enter"&&w()},b=()=>{var C;(C=d.current)==null||C.scrollIntoView({behavior:"smooth"})};return Nr.useEffect(()=>{b()},[n]),kn.jsxs("div",{className:"chat-container",children:[kn.jsx("div",{className:"chat-header",children:"Modelo IA Fase 1"}),kn.jsxs("div",{className:"chat-messages",children:[n.map((C,S)=>kn.jsx(EE,{text:C.text,sender:C.sender,timestamp:C.timestamp},S)),kn.jsx("div",{ref:d})," "]}),kn.jsxs("div",{className:"input-group",children:[kn.jsx("input",{type:"text",placeholder:"Escribe un mensaje...",value:t,onChange:C=>s(C.target.value),onKeyPress:v}),kn.jsx("button",{onClick:w,children:"Enviar"})]})]})},dQ=()=>kn.jsx("div",{className:"app",children:kn.jsx(hQ,{})});TE.createRoot(document.getElementById("root")).render(kn.jsx(Nr.StrictMode,{children:kn.jsx(dQ,{})}));
